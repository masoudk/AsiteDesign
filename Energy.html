<!DOCTYPE html>
<!-- Generated by Cython 0.29.21 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: Energy.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
pre { line-height: 125%; margin: 0; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding: 0 5px 0 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding: 0 5px 0 5px; }
.cython .hll { background-color: #ffffcc }
.cython { background: #f8f8f8; }
.cython .c { color: #408080; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #BC7A00 } /* Comment.Preproc */
.cython .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #408080; font-style: italic } /* Comment.Single */
.cython .cs { color: #408080; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .gr { color: #FF0000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #00A000 } /* Generic.Inserted */
.cython .go { color: #888888 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #7D9029 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #999999; font-weight: bold } /* Name.Entity */
.cython .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #A0A000 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #BB6688 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.21</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="Energy.c">Energy.c</a></p>
<div class="cython"><pre class="cython line score-27" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0001</span>: <span class="k">from</span> <span class="nn">pyrosetta</span> <span class="k">import</span> <span class="n">Pose</span></pre>
<pre class='cython code score-27 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_Pose);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_Pose);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_Pose);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_pyrosetta, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_Pose);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_Pose, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
/* â€¦ */
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0002</span>: <span class="k">from</span> <span class="nn">pyrosetta</span> <span class="k">import</span> <span class="n">get_fa_scorefxn</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_get_fa_scorefxn);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_get_fa_scorefxn);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_get_fa_scorefxn);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_pyrosetta, __pyx_t_2, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_get_fa_scorefxn);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_get_fa_scorefxn, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 2, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0003</span>: <span class="k">from</span> <span class="nn">pyrosetta.rosetta.core.scoring</span> <span class="k">import</span> <span class="n">ScoreType</span></pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_ScoreType);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_ScoreType);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_ScoreType);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_pyrosetta_rosetta_core_scoring, __pyx_t_1, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_ScoreType);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ScoreType, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 3, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0004</span>: <span class="k">cimport</span> <span class="nn">cython</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0005</span>: <span class="k">cimport</span> <span class="nn">openmp</span></pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0006</span>: <span class="k">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span></pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 6, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 6, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0007</span>: <span class="k">import</span> <span class="nn">random</span></pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_random, 0, -1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 7, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_random, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 7, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0008</span>: <span class="k">from</span> <span class="nn">libc.stdio</span> <span class="k">cimport</span> <span class="n">printf</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0009</span>: <span class="k">from</span> <span class="nn">libc.math</span> <span class="k">cimport</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">acos</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">M_PI</span><span class="p">,</span> <span class="n">acos</span><span class="p">,</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">fabs</span><span class="p">,</span> <span class="nb">pow</span><span class="p">,</span> <span class="n">exp</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0010</span>: <span class="k">from</span> <span class="nn">libc.float</span> <span class="k">cimport</span> <span class="n">DBL_MAX</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0011</span>: <span class="k">from</span> <span class="nn">cython.parallel</span> <span class="k">cimport</span> <span class="n">prange</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0012</span>: <span class="k">from</span> <span class="nn">cython.parallel</span> <span class="k">cimport</span> <span class="n">parallel</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0013</span>: <span class="k">from</span> <span class="nn">pyrosetta.rosetta.utility</span> <span class="k">import</span> <span class="n">vector1_numeric_xyzVector_double_t</span> <span class="k">as</span> <span class="n">vec1</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_vector1_numeric_xyzVector_double);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_vector1_numeric_xyzVector_double);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_vector1_numeric_xyzVector_double);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_pyrosetta_rosetta_utility, __pyx_t_2, -1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_vector1_numeric_xyzVector_double);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_vec1, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 13, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0014</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0015</span>: <span class="sd">&quot;&quot;&quot;Contains following functions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0016</span>: <span class="sd">self_energy_fast         -&gt; ligand_ligand_reduced</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0017</span>: <span class="sd">pair_energy_fast         -&gt; ligand_environment_reduced</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0018</span>: <span class="sd">                         -&gt; bond</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0019</span>: <span class="sd">                         -&gt; angle</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0020</span>: <span class="sd">self_matrices            -&gt; ligand_ligand_matrices</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0021</span>: <span class="sd">pair_matrices            -&gt; ligand_environment_matrices</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0022</span>: <span class="sd">pair_collision           -&gt; ligand_environment_collision</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0023</span>: <span class="sd">                         -&gt; switch</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0024</span>: <span class="sd">                         -&gt; col_epsi</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0025</span>: <span class="sd">selectTorsionsByDistance -&gt; select_torsions_by_distance</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0026</span>: <span class="sd">                         -&gt; angular_distance_squared</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0027</span>: <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0028</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0029</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0030</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0031</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0032</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-228" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0033</span>: <span class="k">def</span> <span class="nf">reduced_energy</span><span class="p">(</span><span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-228 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_1reduced_energy(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_6Energy_1reduced_energy = {"reduced_energy", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_1reduced_energy, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6Energy_1reduced_energy(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_ligand_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_qij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_dljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_dljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_sol_prefactor = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_nonbonded = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_nonbondedWeights = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_ligand_coupling;
  __Pyx_memviewslice __pyx_v_ligand_weights = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_mask = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_qij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_dljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_dljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environmen_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_sideChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_mainChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_sideChainCoupling;
  double __pyx_v_mainChainCoupling;
  __Pyx_memviewslice __pyx_v_ligand_environment_weights = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("reduced_energy (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ligand_xyz,&amp;__pyx_n_s_environment_xyz,&amp;__pyx_n_s_ligand_qij,&amp;__pyx_n_s_ligand_dljr,&amp;__pyx_n_s_ligand_dljep,&amp;__pyx_n_s_ligand_sol_prefactor,&amp;__pyx_n_s_ligand_lklam,&amp;__pyx_n_s_ligand_nonbonded,&amp;__pyx_n_s_ligand_nonbondedWeights,&amp;__pyx_n_s_ligand_coupling,&amp;__pyx_n_s_ligand_weights,&amp;__pyx_n_s_ligand_mask,&amp;__pyx_n_s_ligand_environment_qij,&amp;__pyx_n_s_ligand_environment_dljr,&amp;__pyx_n_s_ligand_environment_dljep,&amp;__pyx_n_s_ligand_environment_sol_prefactor,&amp;__pyx_n_s_environmen_lklam,&amp;__pyx_n_s_environment_sideChainFalgs,&amp;__pyx_n_s_environment_mainChainFalgs,&amp;__pyx_n_s_sideChainCoupling,&amp;__pyx_n_s_mainChainCoupling,&amp;__pyx_n_s_ligand_environment_weights,0};
    PyObject* values[22] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 22: values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
        CYTHON_FALLTHROUGH;
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_xyz)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_xyz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 1); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_qij)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 2); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_dljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 3); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_dljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 4); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_sol_prefactor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 5); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 6); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_nonbonded)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 7); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_nonbondedWeights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 8); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_coupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 9); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_weights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 10); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_mask)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 11); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_qij)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 12); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_dljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 13); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_dljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 14); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_sol_prefactor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 15); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (likely((values[16] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environmen_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 16); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (likely((values[17] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_sideChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 17); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (likely((values[18] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_mainChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 18); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (likely((values[19] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sideChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 19); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (likely((values[20] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mainChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 20); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 21:
        if (likely((values[21] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_weights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, 21); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "reduced_energy") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 22) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
      values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
      values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
      values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
      values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
      values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
      values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
      values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
      values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
      values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
      values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
      values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
    }
    __pyx_v_ligand_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_xyz.memview)) __PYX_ERR(0, 33, __pyx_L3_error)</span>
    __pyx_v_environment_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_xyz.memview)) __PYX_ERR(0, 34, __pyx_L3_error)</span>
    __pyx_v_ligand_qij = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_qij.memview)) __PYX_ERR(0, 36, __pyx_L3_error)</span>
    __pyx_v_ligand_dljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_dljr.memview)) __PYX_ERR(0, 37, __pyx_L3_error)</span>
    __pyx_v_ligand_dljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_dljep.memview)) __PYX_ERR(0, 38, __pyx_L3_error)</span>
    __pyx_v_ligand_sol_prefactor = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_sol_prefactor.memview)) __PYX_ERR(0, 39, __pyx_L3_error)</span>
    __pyx_v_ligand_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[6], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lklam.memview)) __PYX_ERR(0, 40, __pyx_L3_error)</span>
    __pyx_v_ligand_nonbonded = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[7], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_nonbonded.memview)) __PYX_ERR(0, 41, __pyx_L3_error)</span>
    __pyx_v_ligand_nonbondedWeights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[8], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_nonbondedWeights.memview)) __PYX_ERR(0, 42, __pyx_L3_error)</span>
    __pyx_v_ligand_coupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_ligand_coupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 43, __pyx_L3_error)</span>
    __pyx_v_ligand_weights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[10], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_weights.memview)) __PYX_ERR(0, 44, __pyx_L3_error)</span>
    __pyx_v_ligand_mask = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[11], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_mask.memview)) __PYX_ERR(0, 46, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_qij = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[12], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_qij.memview)) __PYX_ERR(0, 47, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_dljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[13], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_dljr.memview)) __PYX_ERR(0, 48, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_dljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[14], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_dljep.memview)) __PYX_ERR(0, 49, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_sol_prefactor = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(values[15], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_sol_prefactor.memview)) __PYX_ERR(0, 50, __pyx_L3_error)</span>
    __pyx_v_environmen_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[16], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environmen_lklam.memview)) __PYX_ERR(0, 51, __pyx_L3_error)</span>
    __pyx_v_environment_sideChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[17], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_sideChainFalgs.memview)) __PYX_ERR(0, 52, __pyx_L3_error)</span>
    __pyx_v_environment_mainChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[18], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_mainChainFalgs.memview)) __PYX_ERR(0, 53, __pyx_L3_error)</span>
    __pyx_v_sideChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[19]); if (unlikely((__pyx_v_sideChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 54, __pyx_L3_error)</span>
    __pyx_v_mainChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[20]); if (unlikely((__pyx_v_mainChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 55, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_weights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[21], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_weights.memview)) __PYX_ERR(0, 56, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("reduced_energy", 1, 22, 22, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.reduced_energy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_reduced_energy(__pyx_self, __pyx_v_ligand_xyz, __pyx_v_environment_xyz, __pyx_v_ligand_qij, __pyx_v_ligand_dljr, __pyx_v_ligand_dljep, __pyx_v_ligand_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_ligand_nonbonded, __pyx_v_ligand_nonbondedWeights, __pyx_v_ligand_coupling, __pyx_v_ligand_weights, __pyx_v_ligand_mask, __pyx_v_ligand_environment_qij, __pyx_v_ligand_environment_dljr, __pyx_v_ligand_environment_dljep, __pyx_v_ligand_environment_sol_prefactor, __pyx_v_environmen_lklam, __pyx_v_environment_sideChainFalgs, __pyx_v_environment_mainChainFalgs, __pyx_v_sideChainCoupling, __pyx_v_mainChainCoupling, __pyx_v_ligand_environment_weights);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_reduced_energy(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_environment_xyz, __Pyx_memviewslice __pyx_v_ligand_qij, __Pyx_memviewslice __pyx_v_ligand_dljr, __Pyx_memviewslice __pyx_v_ligand_dljep, __Pyx_memviewslice __pyx_v_ligand_sol_prefactor, __Pyx_memviewslice __pyx_v_ligand_lklam, __Pyx_memviewslice __pyx_v_ligand_nonbonded, __Pyx_memviewslice __pyx_v_ligand_nonbondedWeights, double __pyx_v_ligand_coupling, __Pyx_memviewslice __pyx_v_ligand_weights, __Pyx_memviewslice __pyx_v_ligand_mask, __Pyx_memviewslice __pyx_v_ligand_environment_qij, __Pyx_memviewslice __pyx_v_ligand_environment_dljr, __Pyx_memviewslice __pyx_v_ligand_environment_dljep, __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor, __Pyx_memviewslice __pyx_v_environmen_lklam, __Pyx_memviewslice __pyx_v_environment_sideChainFalgs, __Pyx_memviewslice __pyx_v_environment_mainChainFalgs, double __pyx_v_sideChainCoupling, double __pyx_v_mainChainCoupling, __Pyx_memviewslice __pyx_v_ligand_environment_weights) {
  double __pyx_v_energy;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj_)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("reduced_energy", 0);
  <span class='trace'>__Pyx_TraceCall</span>("reduced_energy", __pyx_f[0], 33, 0, <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.reduced_energy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_qij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_dljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_dljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_sol_prefactor, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_nonbonded, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_nonbondedWeights, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_weights, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_mask, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_qij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_dljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_dljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_sol_prefactor, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environmen_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_sideChainFalgs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_mainChainFalgs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_weights, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__32 = <span class='py_c_api'>PyTuple_Pack</span>(23, __pyx_n_s_ligand_xyz, __pyx_n_s_environment_xyz, __pyx_n_s_ligand_qij, __pyx_n_s_ligand_dljr, __pyx_n_s_ligand_dljep, __pyx_n_s_ligand_sol_prefactor, __pyx_n_s_ligand_lklam, __pyx_n_s_ligand_nonbonded, __pyx_n_s_ligand_nonbondedWeights, __pyx_n_s_ligand_coupling, __pyx_n_s_ligand_weights, __pyx_n_s_ligand_mask, __pyx_n_s_ligand_environment_qij, __pyx_n_s_ligand_environment_dljr, __pyx_n_s_ligand_environment_dljep, __pyx_n_s_ligand_environment_sol_prefactor, __pyx_n_s_environmen_lklam, __pyx_n_s_environment_sideChainFalgs, __pyx_n_s_environment_mainChainFalgs, __pyx_n_s_sideChainCoupling, __pyx_n_s_mainChainCoupling, __pyx_n_s_ligand_environment_weights, __pyx_n_s_energy);<span class='error_goto'> if (unlikely(!__pyx_tuple__32)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__32);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__32);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_1reduced_energy, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_reduced_energy, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj_ = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(22, 0, 23, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__32, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_reduced_energy, 33, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj_)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0034</span>:                    <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0035</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0036</span>:                    <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0037</span>:                    <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0038</span>:                    <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0039</span>:                    <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0040</span>:                    <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0041</span>:                    <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0042</span>:                    <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0043</span>:                    <span class="n">double</span> <span class="n">ligand_coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0044</span>:                    <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_weights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0045</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0046</span>:                    <span class="n">double</span><span class="p">[:]</span> <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0047</span>:                    <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0048</span>:                    <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0049</span>:                    <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0050</span>:                    <span class="n">double</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0051</span>:                    <span class="n">double</span> <span class="p">[:]</span> <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0052</span>:                    <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0053</span>:                    <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0054</span>:                    <span class="n">double</span> <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0055</span>:                    <span class="n">double</span> <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0056</span>:                    <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_environment_weights</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0057</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0058</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">energy</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_energy = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0059</span>:     <span class="n">energy</span> <span class="o">+=</span> <span class="n">ligand_ligand_reduced</span><span class="p">(</span><span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>  __pyx_v_energy = (__pyx_v_energy + __pyx_f_6Energy_ligand_ligand_reduced(__pyx_v_ligand_xyz, __pyx_v_ligand_qij, __pyx_v_ligand_dljr, __pyx_v_ligand_dljep, __pyx_v_ligand_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_ligand_nonbonded, __pyx_v_ligand_nonbondedWeights, __pyx_v_ligand_coupling, __pyx_v_ligand_weights));
</pre><pre class="cython line score-0">&#xA0;<span class="">0060</span>:                                   <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0061</span>:                                   <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0062</span>:                                   <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0063</span>:                                   <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0064</span>:                                   <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0065</span>:                                   <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0066</span>:                                   <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0067</span>:                                   <span class="n">ligand_coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0068</span>:                                   <span class="n">ligand_weights</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0069</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0070</span>:     <span class="c"># Compute ligand_environment Energy</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0071</span>:     <span class="n">energy</span> <span class="o">+=</span> <span class="n">ligand_environment_reduced</span><span class="p">(</span><span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>  __pyx_v_energy = (__pyx_v_energy + __pyx_f_6Energy_ligand_environment_reduced(__pyx_v_ligand_xyz, __pyx_v_environment_xyz, __pyx_v_ligand_mask, __pyx_v_ligand_environment_qij, __pyx_v_ligand_environment_dljr, __pyx_v_ligand_environment_dljep, __pyx_v_ligand_environment_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_environmen_lklam, __pyx_v_environment_sideChainFalgs, __pyx_v_environment_mainChainFalgs, __pyx_v_sideChainCoupling, __pyx_v_mainChainCoupling, __pyx_v_ligand_environment_weights));
</pre><pre class="cython line score-0">&#xA0;<span class="">0072</span>:                                        <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0073</span>:                                        <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0074</span>:                                        <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0075</span>:                                        <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0076</span>:                                        <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0077</span>:                                        <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0078</span>:                                        <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0079</span>:                                        <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0080</span>:                                        <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0081</span>:                                        <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0082</span>:                                        <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0083</span>:                                        <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0084</span>:                                        <span class="n">ligand_environment_weights</span><span class="p">)</span></pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0085</span>:     <span class="k">return</span> <span class="n">energy</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0086</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0087</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0088</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0089</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0090</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0091</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0092</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ligand_ligand_reduced</span><span class="p">(</span><span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>static double __pyx_f_6Energy_ligand_ligand_reduced(__Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_ligand_qij, __Pyx_memviewslice __pyx_v_ligand_dljr, __Pyx_memviewslice __pyx_v_ligand_dljep, __Pyx_memviewslice __pyx_v_ligand_sol_prefactor, __Pyx_memviewslice __pyx_v_ligand_lklam, __Pyx_memviewslice __pyx_v_ligand_nonbonded, __Pyx_memviewslice __pyx_v_ligand_nonbondedWeights, double __pyx_v_coupling, __Pyx_memviewslice __pyx_v_weights) {
  int __pyx_v_N;
  double __pyx_v_dx;
  double __pyx_v_dy;
  double __pyx_v_dz;
  double __pyx_v_dij;
  double __pyx_v_dlj_dij;
  double __pyx_v_dlj_dij3;
  double __pyx_v_dlj_dij6;
  double __pyx_v_dlj_dij12;
  double __pyx_v_epsilon;
  double __pyx_v_s;
  double __pyx_v_sol_expfactor_i;
  double __pyx_v_sol_expfactor_j;
  double __pyx_v_rep;
  double __pyx_v_atr;
  double __pyx_v_col;
  double __pyx_v_sol;
  double __pyx_v_C;
  int __pyx_v_pair;
  double __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceCall</span>("ligand_ligand_reduced", __pyx_f[0], 92, 1, <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("Energy.ligand_ligand_reduced", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 1);
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0093</span>:                           <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0094</span>:                           <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0095</span>:                           <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0096</span>:                           <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0097</span>:                           <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0098</span>:                           <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0099</span>:                           <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0100</span>:                           <span class="n">double</span> <span class="n">coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0101</span>:                           <span class="n">double</span> <span class="p">[:]</span> <span class="n">weights</span><span class="p">)</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0102</span>:     <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0103</span>: <span class="sd">    Computes the reduced ligand ligand potential energy from precomputed matrices</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0104</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0105</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">ligand_nonbonded</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_ligand_nonbonded.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0106</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0107</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dx</span><span class="p">,</span> <span class="nf">dy</span><span class="p">,</span> <span class="nf">dz</span><span class="p">,</span> <span class="nf">dij</span><span class="p">,</span> <span class="nf">dlj</span><span class="p">,</span> <span class="nf">dlj_dij</span><span class="p">,</span> <span class="nf">dlj_dij3</span><span class="p">,</span> <span class="nf">dlj_dij6</span><span class="p">,</span> <span class="nf">dlj_dij12</span><span class="p">,</span> <span class="nf">epsilon</span><span class="p">,</span> <span class="nf">s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0108</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sol_expfactor_i</span><span class="p">,</span> <span class="nf">sol_expfactor_j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0109</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">rep</span><span class="p">,</span> <span class="nf">atr</span><span class="p">,</span> <span class="nf">col</span><span class="p">,</span> <span class="nf">sol</span><span class="p">,</span> <span class="nf">C</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0110</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0111</span>:     <span class="n">C</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_C = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0112</span>:     <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_pair = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">0113</span>:             <span class="c">#i = ligand_nonbonded[pair, 0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0114</span>:             <span class="c">#j = ligand_nonbonded[pair, 1]</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0115</span>:             <span class="n">dx</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_pair;
    __pyx_t_5 = 0;
    __pyx_t_6 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_4 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_nonbonded.strides[1]) )));
    __pyx_t_7 = 0;
    __pyx_t_8 = __pyx_v_pair;
    __pyx_t_9 = 1;
    __pyx_t_10 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_8 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_nonbonded.strides[1]) )));
    __pyx_t_11 = 0;
    __pyx_v_dx = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_6 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_10 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0116</span>:             <span class="n">dy</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_pair;
    __pyx_t_8 = 0;
    __pyx_t_11 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_9 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_nonbonded.strides[1]) )));
    __pyx_t_10 = 1;
    __pyx_t_5 = __pyx_v_pair;
    __pyx_t_4 = 1;
    __pyx_t_7 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_5 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_nonbonded.strides[1]) )));
    __pyx_t_6 = 1;
    __pyx_v_dy = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_11 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_7 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_6 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0117</span>:             <span class="n">dz</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_pair;
    __pyx_t_5 = 0;
    __pyx_t_6 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_4 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_nonbonded.strides[1]) )));
    __pyx_t_7 = 2;
    __pyx_t_8 = __pyx_v_pair;
    __pyx_t_9 = 1;
    __pyx_t_10 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_8 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_nonbonded.strides[1]) )));
    __pyx_t_11 = 2;
    __pyx_v_dz = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_6 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_10 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0118</span>:             <span class="n">dij</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">dz</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dij = (((__pyx_v_dx * __pyx_v_dx) + (__pyx_v_dy * __pyx_v_dy)) + (__pyx_v_dz * __pyx_v_dz));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0119</span>:             <span class="n">dij</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dij</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dij = sqrt(__pyx_v_dij);
</pre><pre class="cython line score-0">&#xA0;<span class="">0120</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0121</span>:             <span class="c">#dlj = ligand_dljr[pair]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0122</span>:             <span class="c">#eij = ligand_dljep[pair]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0123</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0124</span>:             <span class="c"># Compute rep</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0125</span>:             <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_pair;
    __pyx_t_12 = ((__pyx_v_dij &lt;= (0.6 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) ))))) != 0);
    if (__pyx_t_12) {
/* â€¦ */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0126</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="mf">1</span><span class="o">/</span><span class="mf">0.6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij = (1.0 / 0.6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0127</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0128</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0129</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0130</span>:                 <span class="n">rep</span> <span class="o">=</span> <span class="p">(</span><span class="n">ligand_dljep</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2</span> <span class="o">*</span> <span class="n">dlj_dij6</span><span class="p">)))</span> <span class="c">#- (dlj_dij*dij)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_pair;
      __pyx_v_rep = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljep.data + __pyx_t_9 * __pyx_v_ligand_dljep.strides[0]) ))) * (__pyx_v_dlj_dij12 - (2.0 * __pyx_v_dlj_dij6)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0131</span>:             <span class="k">elif</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_pair;
    __pyx_t_13 = (((0.6 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) )))) &lt; __pyx_v_dij) != 0);
    if (__pyx_t_13) {
    } else {
      __pyx_t_12 = __pyx_t_13;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_t_9 = __pyx_v_pair;
    __pyx_t_13 = ((__pyx_v_dij &lt;= (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) )))) != 0);
    __pyx_t_12 = __pyx_t_13;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_12) {
/* â€¦ */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0132</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_pair;
      __pyx_v_dlj_dij = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) ))) / __pyx_v_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0133</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0134</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0135</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0136</span>:                 <span class="n">rep</span> <span class="o">=</span> <span class="n">ligand_dljep</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2</span> <span class="o">*</span> <span class="n">dlj_dij6</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_pair;
      __pyx_v_rep = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljep.data + __pyx_t_9 * __pyx_v_ligand_dljep.strides[0]) ))) * (__pyx_v_dlj_dij12 - (2.0 * __pyx_v_dlj_dij6)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0137</span>:             <span class="k">elif</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dij</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_pair;
    __pyx_t_12 = (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) ))) &lt; __pyx_v_dij) != 0);
    if (__pyx_t_12) {
/* â€¦ */
    }
    __pyx_L5:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0138</span>:                 <span class="n">rep</span> <span class="o">=</span>  <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_rep = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0139</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0140</span>:             <span class="c"># Compute atr</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0141</span>:             <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_pair;
    __pyx_t_12 = ((__pyx_v_dij &lt;= (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) )))) != 0);
    if (__pyx_t_12) {
/* â€¦ */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0142</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="o">-</span><span class="n">ligand_dljep</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_pair;
      __pyx_v_atr = (-(*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljep.data + __pyx_t_9 * __pyx_v_ligand_dljep.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0143</span>:             <span class="k">elif</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_pair;
    __pyx_t_13 = (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) ))) &lt; __pyx_v_dij) != 0);
    if (__pyx_t_13) {
    } else {
      __pyx_t_12 = __pyx_t_13;
      goto __pyx_L9_bool_binop_done;
    }
    __pyx_t_13 = ((__pyx_v_dij &lt;= 4.5) != 0);
    __pyx_t_12 = __pyx_t_13;
    __pyx_L9_bool_binop_done:;
    if (__pyx_t_12) {
/* â€¦ */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0144</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_pair;
      __pyx_v_dlj_dij = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) ))) / __pyx_v_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0145</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0146</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0147</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0148</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="n">ligand_dljep</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2</span> <span class="o">*</span> <span class="n">dlj_dij6</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_pair;
      __pyx_v_atr = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljep.data + __pyx_t_9 * __pyx_v_ligand_dljep.strides[0]) ))) * (__pyx_v_dlj_dij12 - (2.0 * __pyx_v_dlj_dij6)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0149</span>:             <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">6.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = ((4.5 &lt; __pyx_v_dij) != 0);
    if (__pyx_t_13) {
    } else {
      __pyx_t_12 = __pyx_t_13;
      goto __pyx_L11_bool_binop_done;
    }
    __pyx_t_13 = ((__pyx_v_dij &lt;= 6.0) != 0);
    __pyx_t_12 = __pyx_t_13;
    __pyx_L11_bool_binop_done:;
    if (__pyx_t_12) {
/* â€¦ */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0150</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_pair;
      __pyx_v_dlj_dij = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) ))) / __pyx_v_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0151</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0152</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0153</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0154</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="n">ligand_dljep</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2</span> <span class="o">*</span> <span class="n">dlj_dij6</span><span class="p">))</span> <span class="o">*</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_pair;
      __pyx_v_atr = (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljep.data + __pyx_t_9 * __pyx_v_ligand_dljep.strides[0]) ))) * (__pyx_v_dlj_dij12 - (2.0 * __pyx_v_dlj_dij6))) * __pyx_f_6Energy_switch(__pyx_v_dij, 4.5, 6.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0155</span>:             <span class="k">elif</span> <span class="mf">6.0</span> <span class="o">&lt;</span> <span class="n">dij</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = ((6.0 &lt; __pyx_v_dij) != 0);
    if (__pyx_t_12) {
/* â€¦ */
    }
    __pyx_L8:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0156</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_atr = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0157</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0158</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0159</span>:             <span class="c"># compute electrostatic</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0160</span>:             <span class="c">#qij = ligand_qij[pair]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0161</span>:             <span class="c">#epsilon = col_epsi(dij)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0162</span>:             <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">6</span></pre>
<pre class='cython code score-0 '>    __pyx_v_epsilon = 6.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0163</span>:             <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">1.45</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = ((__pyx_v_dij &lt; 1.45) != 0);
    if (__pyx_t_12) {
/* â€¦ */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0164</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.45</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_pair;
      __pyx_v_col = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_9 * __pyx_v_ligand_qij.strides[0]) ))) / (1.45 * __pyx_v_epsilon));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0165</span>:             <span class="k">elif</span> <span class="mf">1.45</span> <span class="o">&lt;=</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">1.85</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = ((1.45 &lt;= __pyx_v_dij) != 0);
    if (__pyx_t_13) {
    } else {
      __pyx_t_12 = __pyx_t_13;
      goto __pyx_L14_bool_binop_done;
    }
    __pyx_t_13 = ((__pyx_v_dij &lt; 1.85) != 0);
    __pyx_t_12 = __pyx_t_13;
    __pyx_L14_bool_binop_done:;
    if (__pyx_t_12) {
/* â€¦ */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0166</span>:                 <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dij, 1.45, 1.85);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0167</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">((</span><span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.45</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">5.5</span><span class="o">*</span><span class="mf">5.5</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_pair;
      __pyx_t_8 = __pyx_v_pair;
      __pyx_v_col = ((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_9 * __pyx_v_ligand_qij.strides[0]) ))) / (1.45 * __pyx_v_epsilon)) * __pyx_v_s) + ((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_8 * __pyx_v_ligand_qij.strides[0]) ))) / __pyx_v_epsilon) * ((1.0 / (__pyx_v_dij * __pyx_v_dij)) - (1.0 / (5.5 * 5.5)))) * (1.0 - __pyx_v_s)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0168</span>:             <span class="k">elif</span> <span class="mf">1.85</span> <span class="o">&lt;=</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = ((1.85 &lt;= __pyx_v_dij) != 0);
    if (__pyx_t_13) {
    } else {
      __pyx_t_12 = __pyx_t_13;
      goto __pyx_L16_bool_binop_done;
    }
    __pyx_t_13 = ((__pyx_v_dij &lt; 4.5) != 0);
    __pyx_t_12 = __pyx_t_13;
    __pyx_L16_bool_binop_done:;
    if (__pyx_t_12) {
/* â€¦ */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0169</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">5.5</span><span class="o">*</span><span class="mf">5.5</span><span class="p">)))</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_pair;
      __pyx_v_col = (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_8 * __pyx_v_ligand_qij.strides[0]) ))) / __pyx_v_epsilon) * ((1.0 / (__pyx_v_dij * __pyx_v_dij)) - (1.0 / (5.5 * 5.5))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0170</span>:             <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;=</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">5.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = ((4.5 &lt;= __pyx_v_dij) != 0);
    if (__pyx_t_13) {
    } else {
      __pyx_t_12 = __pyx_t_13;
      goto __pyx_L18_bool_binop_done;
    }
    __pyx_t_13 = ((__pyx_v_dij &lt; 5.5) != 0);
    __pyx_t_12 = __pyx_t_13;
    __pyx_L18_bool_binop_done:;
    if (__pyx_t_12) {
/* â€¦ */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0171</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">5.5</span><span class="o">*</span><span class="mf">5.5</span><span class="p">)))</span> <span class="o">*</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_pair;
      __pyx_v_col = ((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_8 * __pyx_v_ligand_qij.strides[0]) ))) / __pyx_v_epsilon) * ((1.0 / (__pyx_v_dij * __pyx_v_dij)) - (1.0 / (5.5 * 5.5)))) * __pyx_f_6Energy_switch(__pyx_v_dij, 4.5, 5.5));
</pre><pre class="cython line score-0">&#xA0;<span class="">0172</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0173</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_col = 0.0;
    }
    __pyx_L13:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0174</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0175</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0176</span>:             <span class="c"># compute solvation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0177</span>:             <span class="n">sol</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sol = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0178</span>:             <span class="k">if</span> <span class="n">weights</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = 3;
    __pyx_t_12 = (((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_8 * __pyx_v_weights.strides[0]) ))) != 0.0) != 0);
    if (__pyx_t_12) {
/* â€¦ */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0179</span>:                 <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_pair;
      __pyx_t_12 = ((__pyx_v_dij &lt;= ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_8 * __pyx_v_ligand_dljr.strides[0]) ))) - 0.3)) != 0);
      if (__pyx_t_12) {
/* â€¦ */
        goto __pyx_L21;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0180</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_8 = __pyx_v_pair;
        __pyx_t_9 = 0;
        __pyx_v_sol = (__pyx_v_sol + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_8 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_sol_prefactor.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0181</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_9 = __pyx_v_pair;
        __pyx_t_8 = 1;
        __pyx_v_sol = (__pyx_v_sol + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_9 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_sol_prefactor.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0182</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0183</span>:                 <span class="k">elif</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_pair;
      __pyx_t_13 = ((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_8 * __pyx_v_ligand_dljr.strides[0]) ))) - 0.3) &lt; __pyx_v_dij) != 0);
      if (__pyx_t_13) {
      } else {
        __pyx_t_12 = __pyx_t_13;
        goto __pyx_L22_bool_binop_done;
      }
      __pyx_t_8 = __pyx_v_pair;
      __pyx_t_13 = ((__pyx_v_dij &lt;= ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_8 * __pyx_v_ligand_dljr.strides[0]) ))) + 0.2)) != 0);
      __pyx_t_12 = __pyx_t_13;
      __pyx_L22_bool_binop_done:;
      if (__pyx_t_12) {
/* â€¦ */
        goto __pyx_L21;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0184</span>:                     <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_8 = __pyx_v_pair;
        __pyx_t_9 = __pyx_v_pair;
        __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dij, ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_8 * __pyx_v_ligand_dljr.strides[0]) ))) - 0.3), ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) ))) + 0.2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0185</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_9 = __pyx_v_pair;
        __pyx_t_8 = __pyx_v_pair;
        __pyx_t_11 = 0;
        __pyx_t_10 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_8 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_nonbonded.strides[1]) )));
        __pyx_v_sol_expfactor_i = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_10 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0186</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_pair;
        __pyx_t_8 = __pyx_v_pair;
        __pyx_t_10 = 1;
        __pyx_t_9 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_8 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_nonbonded.strides[1]) )));
        __pyx_v_sol_expfactor_j = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_11 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_9 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0187</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">s</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_pair;
        __pyx_t_8 = 0;
        __pyx_t_9 = __pyx_v_pair;
        __pyx_t_11 = 0;
        __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_10 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * __pyx_v_s) + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_9 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * (1.0 - __pyx_v_s))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0188</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">s</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_pair;
        __pyx_t_9 = 1;
        __pyx_t_8 = __pyx_v_pair;
        __pyx_t_10 = 1;
        __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_11 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * __pyx_v_s) + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_8 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * (1.0 - __pyx_v_s))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0189</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0190</span>:                 <span class="k">elif</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_10 = __pyx_v_pair;
      __pyx_t_13 = ((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_10 * __pyx_v_ligand_dljr.strides[0]) ))) + 0.2) &lt; __pyx_v_dij) != 0);
      if (__pyx_t_13) {
      } else {
        __pyx_t_12 = __pyx_t_13;
        goto __pyx_L24_bool_binop_done;
      }
      __pyx_t_13 = ((__pyx_v_dij &lt;= 4.5) != 0);
      __pyx_t_12 = __pyx_t_13;
      __pyx_L24_bool_binop_done:;
      if (__pyx_t_12) {
/* â€¦ */
        goto __pyx_L21;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0191</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_pair;
        __pyx_t_8 = __pyx_v_pair;
        __pyx_t_9 = 0;
        __pyx_t_11 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_8 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_nonbonded.strides[1]) )));
        __pyx_v_sol_expfactor_i = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_10 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_11 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0192</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_9 = __pyx_v_pair;
        __pyx_t_8 = __pyx_v_pair;
        __pyx_t_11 = 1;
        __pyx_t_10 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_8 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_nonbonded.strides[1]) )));
        __pyx_v_sol_expfactor_j = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_9 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_10 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0193</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_pair;
        __pyx_t_8 = 0;
        __pyx_v_sol = (__pyx_v_sol + ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_11 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0194</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_8 = __pyx_v_pair;
        __pyx_t_11 = 1;
        __pyx_v_sol = (__pyx_v_sol + ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_8 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0195</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0196</span>:                 <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">6.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_13 = ((4.5 &lt; __pyx_v_dij) != 0);
      if (__pyx_t_13) {
      } else {
        __pyx_t_12 = __pyx_t_13;
        goto __pyx_L26_bool_binop_done;
      }
      __pyx_t_13 = ((__pyx_v_dij &lt;= 6.0) != 0);
      __pyx_t_12 = __pyx_t_13;
      __pyx_L26_bool_binop_done:;
      if (__pyx_t_12) {
/* â€¦ */
        goto __pyx_L21;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0197</span>:                     <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dij, 4.5, 6.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0198</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_pair;
        __pyx_t_8 = __pyx_v_pair;
        __pyx_t_10 = 0;
        __pyx_t_9 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_8 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_nonbonded.strides[1]) )));
        __pyx_v_sol_expfactor_i = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_11 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_9 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0199</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_pair;
        __pyx_t_8 = __pyx_v_pair;
        __pyx_t_9 = 1;
        __pyx_t_11 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_8 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_nonbonded.strides[1]) )));
        __pyx_v_sol_expfactor_j = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_10 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_11 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0200</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span></pre>
<pre class='cython code score-0 '>        __pyx_t_9 = __pyx_v_pair;
        __pyx_t_8 = 0;
        __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_9 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * __pyx_v_s));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0201</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span></pre>
<pre class='cython code score-0 '>        __pyx_t_8 = __pyx_v_pair;
        __pyx_t_9 = 1;
        __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_8 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * __pyx_v_s));
</pre><pre class="cython line score-0">&#xA0;<span class="">0202</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0203</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0204</span>:                     <span class="n">sol</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_v_sol = 0.0;
      }
      __pyx_L21:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0205</span>:             <span class="c">#print(rep, atr, col, sol)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0206</span>:             <span class="c">#print((weights[0] * rep, weights[1] * atr, weights[2] * col, weights[3] * sol))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0207</span>:             <span class="c">#print(coupling)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0208</span>:             <span class="n">C</span> <span class="o">+=</span> <span class="n">coupling</span> <span class="o">*</span> <span class="n">ligand_nonbondedWeights</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rep</span> <span class="o">+</span> <span class="n">weights</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">atr</span> <span class="o">+</span> <span class="n">weights</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">col</span> <span class="o">+</span> <span class="n">weights</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">sol</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_v_pair;
    __pyx_t_8 = 0;
    __pyx_t_11 = 1;
    __pyx_t_10 = 2;
    __pyx_t_5 = 3;
    __pyx_v_C = (__pyx_v_C + ((__pyx_v_coupling * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_nonbondedWeights.data + __pyx_t_9 * __pyx_v_ligand_nonbondedWeights.strides[0]) )))) * (((((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_8 * __pyx_v_weights.strides[0]) ))) * __pyx_v_rep) + ((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_11 * __pyx_v_weights.strides[0]) ))) * __pyx_v_atr)) + ((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_10 * __pyx_v_weights.strides[0]) ))) * __pyx_v_col)) + ((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_5 * __pyx_v_weights.strides[0]) ))) * __pyx_v_sol))));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0209</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0210</span>:     <span class="k">return</span> <span class="n">C</span></pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_C;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0211</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0212</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0213</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0214</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0215</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0216</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0217</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0218</span>: <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">ligand_environment_reduced</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>static double __pyx_f_6Energy_ligand_environment_reduced(__Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_environment_xyz, __Pyx_memviewslice __pyx_v_ligand_mask, __Pyx_memviewslice __pyx_v_ligand_environment_qij, __Pyx_memviewslice __pyx_v_ligand_environment_dljr, __Pyx_memviewslice __pyx_v_ligand_environment_dljep, __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor, __Pyx_memviewslice __pyx_v_ligand_lklam, __Pyx_memviewslice __pyx_v_environmen_lklam, __Pyx_memviewslice __pyx_v_environment_sideChainFalgs, __Pyx_memviewslice __pyx_v_environment_mainChainFalgs, double __pyx_v_sideChainCoupling, double __pyx_v_mainChainCoupling, __Pyx_memviewslice __pyx_v_weights) {
  int __pyx_v_N;
  int __pyx_v_M;
  int __pyx_v_i;
  int __pyx_v_j;
  double __pyx_v_dx;
  double __pyx_v_dy;
  double __pyx_v_dz;
  double __pyx_v_dij;
  double __pyx_v_dlj_dij;
  double __pyx_v_dlj_dij3;
  double __pyx_v_dlj_dij6;
  double __pyx_v_dlj_dij12;
  double __pyx_v_epsilon;
  double __pyx_v_s;
  double __pyx_v_sol_expfactor_i;
  double __pyx_v_sol_expfactor_j;
  double __pyx_v_coupling;
  double __pyx_v_rep;
  double __pyx_v_atr;
  double __pyx_v_col;
  double __pyx_v_sol;
  double __pyx_v_C;
  double __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceCall</span>("ligand_environment_reduced", __pyx_f[0], 218, 1, <span class='error_goto'>__PYX_ERR(0, 218, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("Energy.ligand_environment_reduced", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 1);
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0219</span>:                                <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0220</span>:                                <span class="n">double</span><span class="p">[:]</span> <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0221</span>:                                <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0222</span>:                                <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0223</span>:                                <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0224</span>:                                <span class="n">double</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0225</span>:                                <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0226</span>:                                <span class="n">double</span> <span class="p">[:]</span> <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0227</span>:                                <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0228</span>:                                <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0229</span>:                                <span class="n">double</span> <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0230</span>:                                <span class="n">double</span> <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0231</span>:                                <span class="n">double</span> <span class="p">[:]</span> <span class="n">weights</span><span class="p">)</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0232</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0233</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_ligand_xyz.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0234</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">M</span> <span class="o">=</span> <span class="n">environment_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_M = (__pyx_v_environment_xyz.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0235</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0236</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dx</span><span class="p">,</span> <span class="nf">dy</span><span class="p">,</span> <span class="nf">dz</span><span class="p">,</span> <span class="nf">dij</span><span class="p">,</span> <span class="nf">dlj</span><span class="p">,</span> <span class="nf">dlj_dij</span><span class="p">,</span> <span class="nf">dlj_dij3</span><span class="p">,</span> <span class="nf">dlj_dij6</span><span class="p">,</span> <span class="nf">dlj_dij12</span><span class="p">,</span> <span class="nf">epsilon</span><span class="p">,</span> <span class="nf">s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0237</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sol_expfactor_i</span><span class="p">,</span> <span class="nf">sol_expfactor_j</span><span class="p">,</span> <span class="nf">coupling</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0238</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">rep</span><span class="p">,</span> <span class="nf">atr</span><span class="p">,</span> <span class="nf">col</span><span class="p">,</span> <span class="nf">sol</span><span class="p">,</span> <span class="nf">C</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_C = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0239</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0240</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0241</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">0242</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0243</span>:         <span class="k">if</span> <span class="n">ligand_mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_mask.data + __pyx_t_4 * __pyx_v_ligand_mask.strides[0]) ))) == 0.0) != 0);
    if (__pyx_t_5) {
/* â€¦ */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0244</span>:             <span class="k">continue</span></pre>
<pre class='cython code score-0 '>      goto __pyx_L3_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">0245</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0246</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_v_M;
    __pyx_t_7 = __pyx_t_6;
    for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {
      __pyx_v_j = __pyx_t_8;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0247</span>:             <span class="n">coupling</span> <span class="o">=</span> <span class="p">(</span><span class="n">environment_sideChainFalgs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">sideChainCoupling</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">environment_mainChainFalgs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">mainChainCoupling</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_4 = __pyx_v_j;
      __pyx_t_9 = __pyx_v_j;
      __pyx_v_coupling = (((*((int *) ( /* dim=0 */ (__pyx_v_environment_sideChainFalgs.data + __pyx_t_4 * __pyx_v_environment_sideChainFalgs.strides[0]) ))) * __pyx_v_sideChainCoupling) + ((*((int *) ( /* dim=0 */ (__pyx_v_environment_mainChainFalgs.data + __pyx_t_9 * __pyx_v_environment_mainChainFalgs.strides[0]) ))) * __pyx_v_mainChainCoupling));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0248</span>:             <span class="k">if</span> <span class="n">coupling</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_5 = ((__pyx_v_coupling == 0.0) != 0);
      if (__pyx_t_5) {
/* â€¦ */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0249</span>:                 <span class="k">continue</span></pre>
<pre class='cython code score-0 '>        goto __pyx_L6_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">0250</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0251</span>:             <span class="c">#print(&#39;couplinfs&#39;, coupling, overlap)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0252</span>:             <span class="n">dx</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">environment_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_i;
      __pyx_t_4 = 0;
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_11 = 0;
      __pyx_v_dx = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_9 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_environment_xyz.data + __pyx_t_10 * __pyx_v_environment_xyz.strides[0]) ) + __pyx_t_11 * __pyx_v_environment_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0253</span>:             <span class="n">dy</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">environment_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_i;
      __pyx_t_10 = 1;
      __pyx_t_4 = __pyx_v_j;
      __pyx_t_9 = 1;
      __pyx_v_dy = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_11 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_environment_xyz.data + __pyx_t_4 * __pyx_v_environment_xyz.strides[0]) ) + __pyx_t_9 * __pyx_v_environment_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0254</span>:             <span class="n">dz</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">environment_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_i;
      __pyx_t_4 = 2;
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_11 = 2;
      __pyx_v_dz = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_9 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_environment_xyz.data + __pyx_t_10 * __pyx_v_environment_xyz.strides[0]) ) + __pyx_t_11 * __pyx_v_environment_xyz.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0255</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0256</span>:             <span class="n">dij</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">dz</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dij = (((__pyx_v_dx * __pyx_v_dx) + (__pyx_v_dy * __pyx_v_dy)) + (__pyx_v_dz * __pyx_v_dz));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0257</span>:             <span class="n">dij</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dij</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dij = sqrt(__pyx_v_dij);
</pre><pre class="cython line score-0">&#xA0;<span class="">0258</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0259</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0260</span>:             <span class="c">#dlj = ligand_environment_dljr[i, j]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0261</span>:             <span class="c">#eij = ligand_environment_dljep[i, j]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0262</span>:             <span class="c"># Compute rep</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0263</span>:             <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_i;
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_5 = ((__pyx_v_dij &lt;= (0.6 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) ))))) != 0);
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L9;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0264</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="mf">1</span><span class="o">/</span><span class="mf">0.6</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij = (1.0 / 0.6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0265</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0266</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0267</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0268</span>:                 <span class="n">rep</span> <span class="o">=</span> <span class="p">(</span><span class="n">ligand_environment_dljep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2</span> <span class="o">*</span> <span class="n">dlj_dij6</span><span class="p">)))</span> <span class="o">-</span> <span class="p">(</span><span class="n">dlj_dij</span><span class="o">*</span><span class="n">dij</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_i;
        __pyx_t_11 = __pyx_v_j;
        __pyx_v_rep = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljep.data + __pyx_t_10 * __pyx_v_ligand_environment_dljep.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljep.strides[1]) ))) * (__pyx_v_dlj_dij12 - (2.0 * __pyx_v_dlj_dij6))) - (__pyx_v_dlj_dij * __pyx_v_dij));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0269</span>:             <span class="k">elif</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_i;
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_12 = (((0.6 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) )))) &lt; __pyx_v_dij) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_10 = __pyx_v_i;
      __pyx_t_11 = __pyx_v_j;
      __pyx_t_12 = ((__pyx_v_dij &lt;= (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[1]) )))) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L10_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L9;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0270</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_i;
        __pyx_t_10 = __pyx_v_j;
        __pyx_v_dlj_dij = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) ))) / __pyx_v_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0271</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0272</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0273</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0274</span>:                 <span class="n">rep</span> <span class="o">=</span> <span class="n">ligand_environment_dljep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2</span> <span class="o">*</span> <span class="n">dlj_dij6</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_i;
        __pyx_t_11 = __pyx_v_j;
        __pyx_v_rep = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljep.data + __pyx_t_10 * __pyx_v_ligand_environment_dljep.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljep.strides[1]) ))) * (__pyx_v_dlj_dij12 - (2.0 * __pyx_v_dlj_dij6)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0275</span>:             <span class="k">elif</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dij</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_i;
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_5 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) ))) &lt; __pyx_v_dij) != 0);
      if (__pyx_t_5) {
/* â€¦ */
      }
      __pyx_L9:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0276</span>:                 <span class="n">rep</span> <span class="o">=</span>  <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_rep = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0277</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0278</span>:             <span class="c"># Compute atr</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0279</span>:             <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_10 = __pyx_v_i;
      __pyx_t_11 = __pyx_v_j;
      __pyx_t_5 = ((__pyx_v_dij &lt;= (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[1]) )))) != 0);
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L12;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0280</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="o">-</span><span class="n">ligand_environment_dljep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_i;
        __pyx_t_10 = __pyx_v_j;
        __pyx_v_atr = (-(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljep.data + __pyx_t_11 * __pyx_v_ligand_environment_dljep.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljep.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0281</span>:             <span class="k">elif</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_10 = __pyx_v_i;
      __pyx_t_11 = __pyx_v_j;
      __pyx_t_12 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[1]) ))) &lt; __pyx_v_dij) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L13_bool_binop_done;
      }
      __pyx_t_12 = ((__pyx_v_dij &lt;= 4.5) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L13_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L12;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0282</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_i;
        __pyx_t_10 = __pyx_v_j;
        __pyx_v_dlj_dij = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) ))) / __pyx_v_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0283</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0284</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0285</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0286</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="n">ligand_environment_dljep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2</span> <span class="o">*</span> <span class="n">dlj_dij6</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_i;
        __pyx_t_11 = __pyx_v_j;
        __pyx_v_atr = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljep.data + __pyx_t_10 * __pyx_v_ligand_environment_dljep.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljep.strides[1]) ))) * (__pyx_v_dlj_dij12 - (2.0 * __pyx_v_dlj_dij6)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0287</span>:             <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">6.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = ((4.5 &lt; __pyx_v_dij) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L15_bool_binop_done;
      }
      __pyx_t_12 = ((__pyx_v_dij &lt;= 6.0) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L15_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L12;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0288</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_i;
        __pyx_t_10 = __pyx_v_j;
        __pyx_v_dlj_dij = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) ))) / __pyx_v_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0289</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0290</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0291</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0292</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="n">ligand_environment_dljep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2</span> <span class="o">*</span> <span class="n">dlj_dij6</span><span class="p">))</span> <span class="o">*</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_i;
        __pyx_t_11 = __pyx_v_j;
        __pyx_v_atr = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljep.data + __pyx_t_10 * __pyx_v_ligand_environment_dljep.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljep.strides[1]) ))) * (__pyx_v_dlj_dij12 - (2.0 * __pyx_v_dlj_dij6))) * __pyx_f_6Energy_switch(__pyx_v_dij, 4.5, 6.0));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0293</span>:             <span class="k">elif</span> <span class="mf">6.0</span> <span class="o">&lt;</span> <span class="n">dij</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_5 = ((6.0 &lt; __pyx_v_dij) != 0);
      if (__pyx_t_5) {
/* â€¦ */
      }
      __pyx_L12:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0294</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_atr = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0295</span>:             <span class="c">#if atr &gt; 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0296</span>:             <span class="c">#    print(i, j, atr, dij, dlj, eij)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0297</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0298</span>:             <span class="c"># compute electrostatic</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0299</span>:             <span class="c">#epsilon = col_epsi(dij)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0300</span>:             <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_epsilon = 6.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0301</span>:             <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">1.45</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_5 = ((__pyx_v_dij &lt; 1.45) != 0);
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0302</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.45</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_i;
        __pyx_t_10 = __pyx_v_j;
        __pyx_v_col = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_11 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_qij.strides[1]) ))) / (1.45 * __pyx_v_epsilon));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0303</span>:             <span class="k">elif</span> <span class="mf">1.45</span> <span class="o">&lt;=</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">1.85</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = ((1.45 &lt;= __pyx_v_dij) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L18_bool_binop_done;
      }
      __pyx_t_12 = ((__pyx_v_dij &lt; 1.85) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L18_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0304</span>:                 <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dij, 1.45, 1.85);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0305</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">((</span><span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.45</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">5.5</span><span class="o">*</span><span class="mf">5.5</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_i;
        __pyx_t_11 = __pyx_v_j;
        __pyx_t_4 = __pyx_v_i;
        __pyx_t_9 = __pyx_v_j;
        __pyx_v_col = ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_10 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_qij.strides[1]) ))) / (1.45 * __pyx_v_epsilon)) * __pyx_v_s) + ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_4 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_qij.strides[1]) ))) / __pyx_v_epsilon) * ((1.0 / (__pyx_v_dij * __pyx_v_dij)) - (1.0 / (5.5 * 5.5)))) * (1.0 - __pyx_v_s)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0306</span>:             <span class="k">elif</span> <span class="mf">1.85</span> <span class="o">&lt;=</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = ((1.85 &lt;= __pyx_v_dij) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L20_bool_binop_done;
      }
      __pyx_t_12 = ((__pyx_v_dij &lt; 4.5) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L20_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0307</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">5.5</span><span class="o">*</span><span class="mf">5.5</span><span class="p">)))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_9 = __pyx_v_i;
        __pyx_t_4 = __pyx_v_j;
        __pyx_v_col = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_9 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_qij.strides[1]) ))) / __pyx_v_epsilon) * ((1.0 / (__pyx_v_dij * __pyx_v_dij)) - (1.0 / (5.5 * 5.5))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0308</span>:             <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;=</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">5.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = ((4.5 &lt;= __pyx_v_dij) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L22_bool_binop_done;
      }
      __pyx_t_12 = ((__pyx_v_dij &lt; 5.5) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L22_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0309</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">5.5</span><span class="o">*</span><span class="mf">5.5</span><span class="p">)))</span> <span class="o">*</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_i;
        __pyx_t_9 = __pyx_v_j;
        __pyx_v_col = ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_4 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_qij.strides[1]) ))) / __pyx_v_epsilon) * ((1.0 / (__pyx_v_dij * __pyx_v_dij)) - (1.0 / (5.5 * 5.5)))) * __pyx_f_6Energy_switch(__pyx_v_dij, 4.5, 5.5));
</pre><pre class="cython line score-0">&#xA0;<span class="">0310</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0311</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_v_col = 0.0;
      }
      __pyx_L17:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0312</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0313</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0314</span>:             <span class="c"># compute solvation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0315</span>:             <span class="n">sol</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_sol = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0316</span>:             <span class="k">if</span> <span class="n">weights</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = 3;
      __pyx_t_5 = (((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_9 * __pyx_v_weights.strides[0]) ))) != 0.0) != 0);
      if (__pyx_t_5) {
/* â€¦ */
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">0317</span>:                 <span class="c">#print(&#39;sol&#39;)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0318</span>:                 <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_9 = __pyx_v_i;
        __pyx_t_4 = __pyx_v_j;
        __pyx_t_5 = ((__pyx_v_dij &lt;= ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[1]) ))) - 0.3)) != 0);
        if (__pyx_t_5) {
/* â€¦ */
          goto __pyx_L25;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0319</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_4 = __pyx_v_i;
          __pyx_t_9 = __pyx_v_j;
          __pyx_t_11 = 0;
          __pyx_v_sol = (__pyx_v_sol + (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_4 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_11 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0320</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_11 = __pyx_v_i;
          __pyx_t_9 = __pyx_v_j;
          __pyx_t_4 = 1;
          __pyx_v_sol = (__pyx_v_sol + (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_11 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_4 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0321</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0322</span>:                 <span class="k">elif</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_i;
        __pyx_t_9 = __pyx_v_j;
        __pyx_t_12 = ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[1]) ))) - 0.3) &lt; __pyx_v_dij) != 0);
        if (__pyx_t_12) {
        } else {
          __pyx_t_5 = __pyx_t_12;
          goto __pyx_L26_bool_binop_done;
        }
        __pyx_t_9 = __pyx_v_i;
        __pyx_t_4 = __pyx_v_j;
        __pyx_t_12 = ((__pyx_v_dij &lt;= ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[1]) ))) + 0.2)) != 0);
        __pyx_t_5 = __pyx_t_12;
        __pyx_L26_bool_binop_done:;
        if (__pyx_t_5) {
/* â€¦ */
          goto __pyx_L25;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0323</span>:                     <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_t_4 = __pyx_v_i;
          __pyx_t_9 = __pyx_v_j;
          __pyx_t_11 = __pyx_v_i;
          __pyx_t_10 = __pyx_v_j;
          __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dij, ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[1]) ))) - 0.3), ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) ))) + 0.2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0324</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_10 = __pyx_v_i;
          __pyx_t_11 = __pyx_v_j;
          __pyx_t_9 = __pyx_v_i;
          __pyx_v_sol_expfactor_i = ((__pyx_v_dij - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_9 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0325</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_9 = __pyx_v_i;
          __pyx_t_11 = __pyx_v_j;
          __pyx_t_10 = __pyx_v_j;
          __pyx_v_sol_expfactor_j = ((__pyx_v_dij - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_10 * __pyx_v_environmen_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0326</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">s</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>          __pyx_t_10 = __pyx_v_i;
          __pyx_t_11 = __pyx_v_j;
          __pyx_t_9 = 0;
          __pyx_t_4 = __pyx_v_i;
          __pyx_t_13 = __pyx_v_j;
          __pyx_t_14 = 0;
          __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_10 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_9 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * __pyx_v_s) + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_4 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_14 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * (1.0 - __pyx_v_s))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0327</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">s</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>          __pyx_t_14 = __pyx_v_i;
          __pyx_t_13 = __pyx_v_j;
          __pyx_t_4 = 1;
          __pyx_t_9 = __pyx_v_i;
          __pyx_t_11 = __pyx_v_j;
          __pyx_t_10 = 1;
          __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_14 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_4 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * __pyx_v_s) + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_9 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_10 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * (1.0 - __pyx_v_s))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0328</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0329</span>:                 <span class="k">elif</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_i;
        __pyx_t_11 = __pyx_v_j;
        __pyx_t_12 = ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[1]) ))) + 0.2) &lt; __pyx_v_dij) != 0);
        if (__pyx_t_12) {
        } else {
          __pyx_t_5 = __pyx_t_12;
          goto __pyx_L28_bool_binop_done;
        }
        __pyx_t_12 = ((__pyx_v_dij &lt;= 4.5) != 0);
        __pyx_t_5 = __pyx_t_12;
        __pyx_L28_bool_binop_done:;
        if (__pyx_t_5) {
/* â€¦ */
          goto __pyx_L25;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0330</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_11 = __pyx_v_i;
          __pyx_t_10 = __pyx_v_j;
          __pyx_t_9 = __pyx_v_i;
          __pyx_v_sol_expfactor_i = ((__pyx_v_dij - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_9 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0331</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_9 = __pyx_v_i;
          __pyx_t_10 = __pyx_v_j;
          __pyx_t_11 = __pyx_v_j;
          __pyx_v_sol_expfactor_j = ((__pyx_v_dij - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_11 * __pyx_v_environmen_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0332</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>          __pyx_t_11 = __pyx_v_i;
          __pyx_t_10 = __pyx_v_j;
          __pyx_t_9 = 0;
          __pyx_v_sol = (__pyx_v_sol + ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_11 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_9 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0333</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>          __pyx_t_9 = __pyx_v_i;
          __pyx_t_10 = __pyx_v_j;
          __pyx_t_11 = 1;
          __pyx_v_sol = (__pyx_v_sol + ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_9 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_11 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0334</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0335</span>:                 <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">6.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = ((4.5 &lt; __pyx_v_dij) != 0);
        if (__pyx_t_12) {
        } else {
          __pyx_t_5 = __pyx_t_12;
          goto __pyx_L30_bool_binop_done;
        }
        __pyx_t_12 = ((__pyx_v_dij &lt;= 6.0) != 0);
        __pyx_t_5 = __pyx_t_12;
        __pyx_L30_bool_binop_done:;
        if (__pyx_t_5) {
/* â€¦ */
        }
        __pyx_L25:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0336</span>:                     <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dij, 4.5, 6.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0337</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_11 = __pyx_v_i;
          __pyx_t_10 = __pyx_v_j;
          __pyx_t_9 = __pyx_v_i;
          __pyx_v_sol_expfactor_i = ((__pyx_v_dij - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_9 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0338</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_9 = __pyx_v_i;
          __pyx_t_10 = __pyx_v_j;
          __pyx_t_11 = __pyx_v_j;
          __pyx_v_sol_expfactor_j = ((__pyx_v_dij - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_11 * __pyx_v_environmen_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0339</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span></pre>
<pre class='cython code score-0 '>          __pyx_t_11 = __pyx_v_i;
          __pyx_t_10 = __pyx_v_j;
          __pyx_t_9 = 0;
          __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_11 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_9 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * __pyx_v_s));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0340</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span></pre>
<pre class='cython code score-0 '>          __pyx_t_9 = __pyx_v_i;
          __pyx_t_10 = __pyx_v_j;
          __pyx_t_11 = 1;
          __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_9 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_11 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * __pyx_v_s));
</pre><pre class="cython line score-0">&#xA0;<span class="">0341</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0342</span>:             <span class="n">C</span> <span class="o">+=</span> <span class="n">coupling</span> <span class="o">*</span> <span class="p">(</span> <span class="n">weights</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rep</span> <span class="o">+</span>  <span class="n">weights</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">atr</span> <span class="o">+</span> <span class="n">weights</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">col</span> <span class="o">+</span> <span class="n">weights</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">sol</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_11 = 0;
      __pyx_t_10 = 1;
      __pyx_t_9 = 2;
      __pyx_t_4 = 3;
      __pyx_v_C = (__pyx_v_C + (__pyx_v_coupling * (((((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_11 * __pyx_v_weights.strides[0]) ))) * __pyx_v_rep) + ((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_10 * __pyx_v_weights.strides[0]) ))) * __pyx_v_atr)) + ((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_9 * __pyx_v_weights.strides[0]) ))) * __pyx_v_col)) + ((*((double *) ( /* dim=0 */ (__pyx_v_weights.data + __pyx_t_4 * __pyx_v_weights.strides[0]) ))) * __pyx_v_sol))));
      __pyx_L6_continue:;
    }
    __pyx_L3_continue:;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0343</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0344</span>:     <span class="k">return</span> <span class="n">C</span></pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_C;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0345</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0346</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0347</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0348</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0349</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0350</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-63" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0351</span>: <span class="k">def</span> <span class="nf">bond</span><span class="p">(</span><span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-63 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_3bond(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6Energy_2bond[] = "\n    Computes bond potential\n    ";
static PyMethodDef __pyx_mdef_6Energy_3bond = {"bond", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_3bond, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6Energy_2bond};
static PyObject *__pyx_pw_6Energy_3bond(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_ligand_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_bond_atomIndex = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_equilibrium_distance = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_force_constance = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("bond (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ligand_xyz,&amp;__pyx_n_s_bond_atomIndex,&amp;__pyx_n_s_equilibrium_distance,&amp;__pyx_n_s_force_constance,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_xyz)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_bond_atomIndex)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bond", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_equilibrium_distance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bond", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_force_constance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bond", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "bond") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_ligand_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_xyz.memview)) __PYX_ERR(0, 351, __pyx_L3_error)</span>
    __pyx_v_bond_atomIndex = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_bond_atomIndex.memview)) __PYX_ERR(0, 352, __pyx_L3_error)</span>
    __pyx_v_equilibrium_distance = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_equilibrium_distance.memview)) __PYX_ERR(0, 353, __pyx_L3_error)</span>
    __pyx_v_force_constance = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_force_constance.memview)) __PYX_ERR(0, 354, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bond", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.bond", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_2bond(__pyx_self, __pyx_v_ligand_xyz, __pyx_v_bond_atomIndex, __pyx_v_equilibrium_distance, __pyx_v_force_constance);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_2bond(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_bond_atomIndex, __Pyx_memviewslice __pyx_v_equilibrium_distance, __Pyx_memviewslice __pyx_v_force_constance) {
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_ibond;
  int __pyx_v_N;
  double __pyx_v_dx;
  double __pyx_v_dy;
  double __pyx_v_dz;
  double __pyx_v_dji;
  double __pyx_v_C;
  PyObject *__pyx_v_d = NULL;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__2)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("bond", 0);
  <span class='trace'>__Pyx_TraceCall</span>("bond", __pyx_f[0], 351, 0, <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.bond", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_d);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_bond_atomIndex, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_equilibrium_distance, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_force_constance, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__33 = <span class='py_c_api'>PyTuple_Pack</span>(14, __pyx_n_s_ligand_xyz, __pyx_n_s_bond_atomIndex, __pyx_n_s_equilibrium_distance, __pyx_n_s_force_constance, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_ibond, __pyx_n_s_N, __pyx_n_s_dx, __pyx_n_s_dy, __pyx_n_s_dz, __pyx_n_s_dji, __pyx_n_s_C, __pyx_n_s_d);<span class='error_goto'> if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__33);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__33);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_3bond, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_bond, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 351, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__2 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__33, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_bond, 351, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__2)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0352</span>:          <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">bond_atomIndex</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0353</span>:          <span class="n">double</span> <span class="p">[:]</span> <span class="n">equilibrium_distance</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0354</span>:          <span class="n">double</span> <span class="p">[:]</span> <span class="n">force_constance</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0355</span>:     <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0356</span>: <span class="sd">    Computes bond potential</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0357</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0358</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">ibond</span><span class="p">,</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">bond_atomIndex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_bond_atomIndex.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0359</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dx</span><span class="p">,</span> <span class="nf">dy</span><span class="p">,</span> <span class="nf">dz</span><span class="p">,</span> <span class="nf">dji</span><span class="p">,</span> <span class="nf">C</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0360</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0361</span>:     <span class="n">C</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_C = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0362</span>:     <span class="k">for</span> <span class="n">ibond</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_ibond = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0363</span>:             <span class="n">i</span> <span class="o">=</span> <span class="n">bond_atomIndex</span><span class="p">[</span><span class="n">ibond</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_ibond;
    __pyx_t_5 = 0;
    __pyx_v_i = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_bond_atomIndex.data + __pyx_t_4 * __pyx_v_bond_atomIndex.strides[0]) ) + __pyx_t_5 * __pyx_v_bond_atomIndex.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0364</span>:             <span class="n">j</span> <span class="o">=</span> <span class="n">bond_atomIndex</span><span class="p">[</span><span class="n">ibond</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_ibond;
    __pyx_t_4 = 1;
    __pyx_v_j = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_bond_atomIndex.data + __pyx_t_5 * __pyx_v_bond_atomIndex.strides[0]) ) + __pyx_t_4 * __pyx_v_bond_atomIndex.strides[1]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">0365</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0366</span>:             <span class="n">dx</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_j;
    __pyx_t_7 = 0;
    __pyx_v_dx = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_6 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0367</span>:             <span class="n">dy</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_i;
    __pyx_t_6 = 1;
    __pyx_t_5 = __pyx_v_j;
    __pyx_t_4 = 1;
    __pyx_v_dy = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_7 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_6 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_5 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0368</span>:             <span class="n">dz</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = 2;
    __pyx_t_6 = __pyx_v_j;
    __pyx_t_7 = 2;
    __pyx_v_dz = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_6 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0369</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0370</span>:             <span class="n">dji</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">dz</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dji = (((__pyx_v_dx * __pyx_v_dx) + (__pyx_v_dy * __pyx_v_dy)) + (__pyx_v_dz * __pyx_v_dz));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0371</span>:             <span class="n">dji</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dji = sqrt(__pyx_v_dji);
</pre><pre class="cython line score-0">&#xA0;<span class="">0372</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0373</span>:             <span class="n">d</span> <span class="o">=</span> <span class="n">dji</span> <span class="o">-</span> <span class="n">equilibrium_distance</span><span class="p">[</span><span class="n">ibond</span><span class="p">]</span></pre>
<pre class='cython code score-6 '>    __pyx_t_7 = __pyx_v_ibond;
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_dji - (*((double *) ( /* dim=0 */ (__pyx_v_equilibrium_distance.data + __pyx_t_7 * __pyx_v_equilibrium_distance.strides[0]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 373, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_d, __pyx_t_8);
    __pyx_t_8 = 0;
</pre><pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0374</span>:             <span class="n">C</span> <span class="o">+=</span> <span class="n">force_constance</span><span class="p">[</span><span class="n">ibond</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">d</span></pre>
<pre class='cython code score-40 '>    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_C);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_7 = __pyx_v_ibond;
    __pyx_t_9 = <span class='py_c_api'>PyFloat_FromDouble</span>((*((double *) ( /* dim=0 */ (__pyx_v_force_constance.data + __pyx_t_7 * __pyx_v_force_constance.strides[0]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_9, __pyx_v_d);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_10, __pyx_v_d);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_8, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 374, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_11 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_10); if (unlikely((__pyx_t_11 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 374, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_v_C = __pyx_t_11;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0375</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0376</span>:     <span class="k">return</span> <span class="n">C</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_10 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_C);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 376, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_r = __pyx_t_10;
  __pyx_t_10 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0377</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0378</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0379</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0380</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0381</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0382</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0383</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-69" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0384</span>: <span class="k">def</span> <span class="nf">angle</span><span class="p">(</span><span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-69 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_5angle(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6Energy_4angle[] = "\n    Computes bond potential\n    ";
static PyMethodDef __pyx_mdef_6Energy_5angle = {"angle", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_5angle, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6Energy_4angle};
static PyObject *__pyx_pw_6Energy_5angle(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_ligand_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_angle_atomIndex = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_equilibrium_angle = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_force_constance = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angle (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ligand_xyz,&amp;__pyx_n_s_angle_atomIndex,&amp;__pyx_n_s_equilibrium_angle,&amp;__pyx_n_s_force_constance,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_xyz)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_angle_atomIndex)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 384, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_equilibrium_angle)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 384, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_force_constance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 384, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "angle") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 384, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_ligand_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_xyz.memview)) __PYX_ERR(0, 384, __pyx_L3_error)</span>
    __pyx_v_angle_atomIndex = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_angle_atomIndex.memview)) __PYX_ERR(0, 385, __pyx_L3_error)</span>
    __pyx_v_equilibrium_angle = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_equilibrium_angle.memview)) __PYX_ERR(0, 386, __pyx_L3_error)</span>
    __pyx_v_force_constance = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_force_constance.memview)) __PYX_ERR(0, 387, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 384, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_4angle(__pyx_self, __pyx_v_ligand_xyz, __pyx_v_angle_atomIndex, __pyx_v_equilibrium_angle, __pyx_v_force_constance);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_4angle(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_angle_atomIndex, __Pyx_memviewslice __pyx_v_equilibrium_angle, __Pyx_memviewslice __pyx_v_force_constance) {
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_iangle;
  int __pyx_v_N;
  double __pyx_v_dji;
  double __pyx_v_djk;
  double __pyx_v_djidjk;
  double __pyx_v_teta;
  double __pyx_v_dteta;
  double __pyx_v_C;
  PyObject *__pyx_v_k = NULL;
  PyObject *__pyx_v_dxji = NULL;
  PyObject *__pyx_v_dyji = NULL;
  PyObject *__pyx_v_dzji = NULL;
  PyObject *__pyx_v_dxjk = NULL;
  PyObject *__pyx_v_dyjk = NULL;
  PyObject *__pyx_v_dzjk = NULL;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__3)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angle", 0);
  <span class='trace'>__Pyx_TraceCall</span>("angle", __pyx_f[0], 384, 0, <span class='error_goto'>__PYX_ERR(0, 384, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_k);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dxji);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dyji);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dzji);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dxjk);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dyjk);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dzjk);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_angle_atomIndex, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_equilibrium_angle, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_force_constance, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__34 = <span class='py_c_api'>PyTuple_Pack</span>(24, __pyx_n_s_ligand_xyz, __pyx_n_s_angle_atomIndex, __pyx_n_s_equilibrium_angle, __pyx_n_s_force_constance, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_iangle, __pyx_n_s_N, __pyx_n_s_dx, __pyx_n_s_dy, __pyx_n_s_dz, __pyx_n_s_dji, __pyx_n_s_djk, __pyx_n_s_djidjk, __pyx_n_s_teta, __pyx_n_s_dteta, __pyx_n_s_C, __pyx_n_s_k, __pyx_n_s_dxji, __pyx_n_s_dyji, __pyx_n_s_dzji, __pyx_n_s_dxjk, __pyx_n_s_dyjk, __pyx_n_s_dzjk);<span class='error_goto'> if (unlikely(!__pyx_tuple__34)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__34);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__34);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_5angle, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_angle, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 384, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__3 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(4, 0, 24, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__34, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_angle, 384, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__3)) __PYX_ERR(0, 384, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0385</span>:           <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">angle_atomIndex</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0386</span>:           <span class="n">double</span> <span class="p">[:]</span> <span class="n">equilibrium_angle</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0387</span>:           <span class="n">double</span> <span class="p">[:]</span> <span class="n">force_constance</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0388</span>:     <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0389</span>: <span class="sd">    Computes bond potential</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0390</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0391</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">iangle</span><span class="p">,</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">angle_atomIndex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_angle_atomIndex.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0392</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dx</span><span class="p">,</span> <span class="nf">dy</span><span class="p">,</span> <span class="nf">dz</span><span class="p">,</span> <span class="nf">dji</span><span class="p">,</span> <span class="nf">djk</span><span class="p">,</span> <span class="nf">djidjk</span><span class="p">,</span> <span class="nf">teta</span><span class="p">,</span> <span class="nf">dteta</span><span class="p">,</span> <span class="nf">C</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0393</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0394</span>:     <span class="n">C</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_C = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0395</span>:     <span class="k">for</span> <span class="n">iangle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_iangle = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0396</span>:             <span class="n">i</span> <span class="o">=</span> <span class="n">angle_atomIndex</span><span class="p">[</span><span class="n">iangle</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_iangle;
    __pyx_t_5 = 0;
    __pyx_v_i = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_angle_atomIndex.data + __pyx_t_4 * __pyx_v_angle_atomIndex.strides[0]) ) + __pyx_t_5 * __pyx_v_angle_atomIndex.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0397</span>:             <span class="n">j</span> <span class="o">=</span> <span class="n">angle_atomIndex</span><span class="p">[</span><span class="n">iangle</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_iangle;
    __pyx_t_4 = 1;
    __pyx_v_j = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_angle_atomIndex.data + __pyx_t_5 * __pyx_v_angle_atomIndex.strides[0]) ) + __pyx_t_4 * __pyx_v_angle_atomIndex.strides[1]) )));
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0398</span>:             <span class="n">k</span> <span class="o">=</span> <span class="n">angle_atomIndex</span><span class="p">[</span><span class="n">iangle</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-3 '>    __pyx_t_4 = __pyx_v_iangle;
    __pyx_t_5 = 2;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_angle_atomIndex.data + __pyx_t_4 * __pyx_v_angle_atomIndex.strides[0]) ) + __pyx_t_5 * __pyx_v_angle_atomIndex.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 398, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_k, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0399</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0400</span>:             <span class="n">dxji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-6 '>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = 0;
    __pyx_t_7 = __pyx_v_j;
    __pyx_t_8 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_5 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_7 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 400, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dxji, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0401</span>:             <span class="n">dyji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-6 '>    __pyx_t_8 = __pyx_v_i;
    __pyx_t_7 = 1;
    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = 1;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_8 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 401, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dyji, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0402</span>:             <span class="n">dzji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-6 '>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = 2;
    __pyx_t_7 = __pyx_v_j;
    __pyx_t_8 = 2;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_5 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_7 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 402, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dzji, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0403</span>: </pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0404</span>:             <span class="n">dxjk</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 404, __pyx_L1_error)</span>
    __pyx_t_8 = __pyx_t_9;
    __pyx_t_7 = 0;
    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_8 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dxjk, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0405</span>:             <span class="n">dyjk</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 405, __pyx_L1_error)</span>
    __pyx_t_5 = __pyx_t_9;
    __pyx_t_4 = 1;
    __pyx_t_7 = __pyx_v_j;
    __pyx_t_8 = 1;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_5 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_7 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 405, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dyjk, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0406</span>:             <span class="n">dzjk</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
    __pyx_t_8 = __pyx_t_9;
    __pyx_t_7 = 2;
    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = 2;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_8 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dzjk, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0407</span>: </pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0408</span>:             <span class="n">dji</span> <span class="o">=</span> <span class="n">dxji</span> <span class="o">*</span> <span class="n">dxji</span> <span class="o">+</span> <span class="n">dyji</span> <span class="o">*</span> <span class="n">dyji</span> <span class="o">+</span> <span class="n">dzji</span> <span class="o">*</span> <span class="n">dzji</span></pre>
<pre class='cython code score-40 '>    __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dxji, __pyx_v_dxji);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 408, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dyji, __pyx_v_dyji);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 408, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_11 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_6, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 408, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dzji, __pyx_v_dzji);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 408, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_11, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 408, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 408, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_dji = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0409</span>:             <span class="n">dji</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dji = sqrt(__pyx_v_dji);
</pre><pre class="cython line score-0">&#xA0;<span class="">0410</span>: </pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0411</span>:             <span class="n">djk</span> <span class="o">=</span> <span class="n">dxjk</span> <span class="o">*</span> <span class="n">dxjk</span> <span class="o">+</span> <span class="n">dyjk</span> <span class="o">*</span> <span class="n">dyjk</span> <span class="o">+</span> <span class="n">dzjk</span> <span class="o">*</span> <span class="n">dzjk</span></pre>
<pre class='cython code score-40 '>    __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dxjk, __pyx_v_dxjk);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 411, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dyjk, __pyx_v_dyjk);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 411, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_11 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_6, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 411, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dzjk, __pyx_v_dzjk);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 411, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_11, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 411, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 411, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_djk = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0412</span>:             <span class="n">djk</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">djk</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_djk = sqrt(__pyx_v_djk);
</pre><pre class="cython line score-0">&#xA0;<span class="">0413</span>: </pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0414</span>:             <span class="n">djidjk</span> <span class="o">=</span> <span class="n">dxji</span> <span class="o">*</span> <span class="n">dxjk</span> <span class="o">+</span> <span class="n">dyji</span> <span class="o">*</span> <span class="n">dyjk</span> <span class="o">+</span> <span class="n">dzji</span> <span class="o">*</span> <span class="n">dzjk</span></pre>
<pre class='cython code score-40 '>    __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dxji, __pyx_v_dxjk);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dyji, __pyx_v_dyjk);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_11 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_6, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dzji, __pyx_v_dzjk);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_11, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 414, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 414, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_djidjk = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0415</span>:             <span class="n">djidjk</span> <span class="o">=</span> <span class="n">djidjk</span> <span class="o">/</span> <span class="p">(</span><span class="n">dji</span> <span class="o">*</span> <span class="n">djk</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_djidjk = (__pyx_v_djidjk / (__pyx_v_dji * __pyx_v_djk));
</pre><pre class="cython line score-0">&#xA0;<span class="">0416</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0417</span>:             <span class="k">if</span> <span class="n">djidjk</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span> <span class="n">djidjk</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = ((__pyx_v_djidjk &gt; 1.0) != 0);
    if (__pyx_t_13) {
      __pyx_v_djidjk = 1.0;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0418</span>:             <span class="k">if</span> <span class="n">djidjk</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span> <span class="n">djidjk</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = ((__pyx_v_djidjk &lt; -1.0) != 0);
    if (__pyx_t_13) {
      __pyx_v_djidjk = -1.0;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">0419</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0420</span>:             <span class="n">teta</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">djidjk</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_teta = acos(__pyx_v_djidjk);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0421</span>:             <span class="n">dteta</span> <span class="o">=</span> <span class="n">teta</span> <span class="o">-</span> <span class="n">equilibrium_angle</span><span class="p">[</span><span class="n">iangle</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_iangle;
    __pyx_v_dteta = (__pyx_v_teta - (*((double *) ( /* dim=0 */ (__pyx_v_equilibrium_angle.data + __pyx_t_5 * __pyx_v_equilibrium_angle.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0422</span>:             <span class="n">C</span> <span class="o">+=</span> <span class="n">force_constance</span><span class="p">[</span><span class="n">iangle</span><span class="p">]</span> <span class="o">*</span> <span class="n">dteta</span> <span class="o">*</span> <span class="n">dteta</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_iangle;
    __pyx_v_C = (__pyx_v_C + (((*((double *) ( /* dim=0 */ (__pyx_v_force_constance.data + __pyx_t_5 * __pyx_v_force_constance.strides[0]) ))) * __pyx_v_dteta) * __pyx_v_dteta));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0423</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0424</span>:     <span class="k">return</span> <span class="n">C</span></pre>
<pre class='cython code score-6 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_C);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 424, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_r = __pyx_t_6;
  __pyx_t_6 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0425</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0426</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0427</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0428</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0429</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0430</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0431</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0432</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0433</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0434</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-116" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0435</span>: <span class="k">def</span> <span class="nf">ligand_ligand_matrices</span><span class="p">(</span><span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_q</span><span class="p">,</span></pre>
<pre class='cython code score-116 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_7ligand_ligand_matrices(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_6Energy_7ligand_ligand_matrices = {"ligand_ligand_matrices", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_7ligand_ligand_matrices, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6Energy_7ligand_ligand_matrices(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_ligand_q = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_qij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_ljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_dljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_ljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_dljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lkdg = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lkvol = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_sol_prefactor = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_nonbonded = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ligand_ligand_matrices (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ligand_q,&amp;__pyx_n_s_ligand_qij,&amp;__pyx_n_s_ligand_ljr,&amp;__pyx_n_s_ligand_dljr,&amp;__pyx_n_s_ligand_ljep,&amp;__pyx_n_s_ligand_dljep,&amp;__pyx_n_s_ligand_lkdg,&amp;__pyx_n_s_ligand_lklam,&amp;__pyx_n_s_ligand_lkvol,&amp;__pyx_n_s_ligand_sol_prefactor,&amp;__pyx_n_s_ligand_nonbonded,0};
    PyObject* values[11] = {0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_q)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_qij)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_ligand_matrices", 1, 11, 11, 1); <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_ljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_ligand_matrices", 1, 11, 11, 2); <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_dljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_ligand_matrices", 1, 11, 11, 3); <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_ljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_ligand_matrices", 1, 11, 11, 4); <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_dljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_ligand_matrices", 1, 11, 11, 5); <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lkdg)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_ligand_matrices", 1, 11, 11, 6); <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_ligand_matrices", 1, 11, 11, 7); <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lkvol)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_ligand_matrices", 1, 11, 11, 8); <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_sol_prefactor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_ligand_matrices", 1, 11, 11, 9); <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_nonbonded)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_ligand_matrices", 1, 11, 11, 10); <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "ligand_ligand_matrices") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 11) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
    }
    __pyx_v_ligand_q = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_q.memview)) __PYX_ERR(0, 435, __pyx_L3_error)</span>
    __pyx_v_ligand_qij = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_qij.memview)) __PYX_ERR(0, 436, __pyx_L3_error)</span>
    __pyx_v_ligand_ljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_ljr.memview)) __PYX_ERR(0, 437, __pyx_L3_error)</span>
    __pyx_v_ligand_dljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_dljr.memview)) __PYX_ERR(0, 438, __pyx_L3_error)</span>
    __pyx_v_ligand_ljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_ljep.memview)) __PYX_ERR(0, 439, __pyx_L3_error)</span>
    __pyx_v_ligand_dljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_dljep.memview)) __PYX_ERR(0, 440, __pyx_L3_error)</span>
    __pyx_v_ligand_lkdg = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[6], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lkdg.memview)) __PYX_ERR(0, 441, __pyx_L3_error)</span>
    __pyx_v_ligand_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[7], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lklam.memview)) __PYX_ERR(0, 442, __pyx_L3_error)</span>
    __pyx_v_ligand_lkvol = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[8], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lkvol.memview)) __PYX_ERR(0, 443, __pyx_L3_error)</span>
    __pyx_v_ligand_sol_prefactor = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[9], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_sol_prefactor.memview)) __PYX_ERR(0, 444, __pyx_L3_error)</span>
    __pyx_v_ligand_nonbonded = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[10], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_nonbonded.memview)) __PYX_ERR(0, 445, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_ligand_matrices", 1, 11, 11, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.ligand_ligand_matrices", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_6ligand_ligand_matrices(__pyx_self, __pyx_v_ligand_q, __pyx_v_ligand_qij, __pyx_v_ligand_ljr, __pyx_v_ligand_dljr, __pyx_v_ligand_ljep, __pyx_v_ligand_dljep, __pyx_v_ligand_lkdg, __pyx_v_ligand_lklam, __pyx_v_ligand_lkvol, __pyx_v_ligand_sol_prefactor, __pyx_v_ligand_nonbonded);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_6ligand_ligand_matrices(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_ligand_q, __Pyx_memviewslice __pyx_v_ligand_qij, __Pyx_memviewslice __pyx_v_ligand_ljr, __Pyx_memviewslice __pyx_v_ligand_dljr, __Pyx_memviewslice __pyx_v_ligand_ljep, __Pyx_memviewslice __pyx_v_ligand_dljep, __Pyx_memviewslice __pyx_v_ligand_lkdg, __Pyx_memviewslice __pyx_v_ligand_lklam, __Pyx_memviewslice __pyx_v_ligand_lkvol, __Pyx_memviewslice __pyx_v_ligand_sol_prefactor, __Pyx_memviewslice __pyx_v_ligand_nonbonded) {
  int __pyx_v_N;
  int __pyx_v_i;
  int __pyx_v_j;
  double __pyx_v_pi_3_2;
  int __pyx_v_pair;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__4)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ligand_ligand_matrices", 0);
  <span class='trace'>__Pyx_TraceCall</span>("ligand_ligand_matrices", __pyx_f[0], 435, 0, <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.ligand_ligand_matrices", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_q, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_qij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_ljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_dljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_ljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_dljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lkdg, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lkvol, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_sol_prefactor, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_nonbonded, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__35 = <span class='py_c_api'>PyTuple_Pack</span>(16, __pyx_n_s_ligand_q, __pyx_n_s_ligand_qij, __pyx_n_s_ligand_ljr, __pyx_n_s_ligand_dljr, __pyx_n_s_ligand_ljep, __pyx_n_s_ligand_dljep, __pyx_n_s_ligand_lkdg, __pyx_n_s_ligand_lklam, __pyx_n_s_ligand_lkvol, __pyx_n_s_ligand_sol_prefactor, __pyx_n_s_ligand_nonbonded, __pyx_n_s_N, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_pi_3_2, __pyx_n_s_pair);<span class='error_goto'> if (unlikely(!__pyx_tuple__35)) __PYX_ERR(0, 435, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__35);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__35);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_7ligand_ligand_matrices, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 435, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ligand_ligand_matrices, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 435, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__4 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(11, 0, 16, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__35, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_ligand_ligand_matrices, 435, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__4)) __PYX_ERR(0, 435, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0436</span>:                            <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0437</span>:                            <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_ljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0438</span>:                            <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0439</span>:                            <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_ljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0440</span>:                            <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0441</span>:                            <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lkdg</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0442</span>:                            <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0443</span>:                            <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lkvol</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0444</span>:                            <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0445</span>:                            <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_nonbonded</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0446</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0447</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">ligand_nonbonded</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_ligand_nonbonded.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0448</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0449</span>:     <span class="c">#cdef double dx, dy, dz, dij, dij_v, dij_col, dij_sol, dlj, epij</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0450</span>:     <span class="c">#cdef double dlj_dij, dlj_dij_3, dlj_dij_6, dlj_dij_12</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0451</span>:     <span class="c">#cdef double sol_prefactor_i, sol_prefactor_j, sol_expfactor_i, sol_expfactor_j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0452</span>:     <span class="c">#cdef double vdw, coupling, col, sol, C = 0.0</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0453</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pi_3_2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">M_PI</span><span class="p">,</span> <span class="mf">3</span><span class="o">/</span><span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_pi_3_2 = pow(M_PI, 1.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">0454</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0455</span>:     <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_pair = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">0456</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0457</span>:         <span class="n">i</span> <span class="o">=</span> <span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_pair;
    __pyx_t_5 = 0;
    __pyx_v_i = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_4 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_nonbonded.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0458</span>:         <span class="n">j</span> <span class="o">=</span> <span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_pair;
    __pyx_t_4 = 1;
    __pyx_v_j = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_5 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_nonbonded.strides[1]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">0459</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0460</span>:         <span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">=</span> <span class="mf">332</span> <span class="o">*</span> <span class="n">ligand_q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_q</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = __pyx_v_j;
    __pyx_t_6 = __pyx_v_pair;
    *((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_6 * __pyx_v_ligand_qij.strides[0]) )) = ((332.0 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_q.data + __pyx_t_4 * __pyx_v_ligand_q.strides[0]) )))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_q.data + __pyx_t_5 * __pyx_v_ligand_q.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0461</span>:         <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_ljr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ligand_ljr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = __pyx_v_j;
    __pyx_t_6 = __pyx_v_pair;
    *((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) )) = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljr.data + __pyx_t_5 * __pyx_v_ligand_ljr.strides[0]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljr.data + __pyx_t_4 * __pyx_v_ligand_ljr.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0462</span>:         <span class="n">ligand_dljep</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">ligand_ljep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_ljep</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = __pyx_v_j;
    __pyx_t_6 = __pyx_v_pair;
    *((double *) ( /* dim=0 */ (__pyx_v_ligand_dljep.data + __pyx_t_6 * __pyx_v_ligand_dljep.strides[0]) )) = sqrt(((*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljep.data + __pyx_t_4 * __pyx_v_ligand_ljep.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljep.data + __pyx_t_5 * __pyx_v_ligand_ljep.strides[0]) )))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0463</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0464</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0465</span>:         <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ligand_lkvol</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lkdg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_ljr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_ljr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">pi_3_2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_j;
    __pyx_t_4 = __pyx_v_i;
    __pyx_t_6 = __pyx_v_i;
    __pyx_t_7 = __pyx_v_i;
    __pyx_t_8 = __pyx_v_i;
    __pyx_t_9 = __pyx_v_pair;
    __pyx_t_10 = 0;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_9 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_sol_prefactor.strides[1]) )) = (((-(*((double *) ( /* dim=0 */ (__pyx_v_ligand_lkvol.data + __pyx_t_5 * __pyx_v_ligand_lkvol.strides[0]) )))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lkdg.data + __pyx_t_4 * __pyx_v_ligand_lkdg.strides[0]) )))) / (((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_6 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljr.data + __pyx_t_7 * __pyx_v_ligand_ljr.strides[0]) )))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljr.data + __pyx_t_8 * __pyx_v_ligand_ljr.strides[0]) )))) * 2.0) * __pyx_v_pi_3_2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0466</span>:         <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ligand_lkvol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lkdg</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_ljr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_ljr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">pi_3_2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = __pyx_v_i;
    __pyx_t_7 = __pyx_v_j;
    __pyx_t_6 = __pyx_v_j;
    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = __pyx_v_j;
    __pyx_t_10 = __pyx_v_pair;
    __pyx_t_9 = 1;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_10 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_sol_prefactor.strides[1]) )) = (((-(*((double *) ( /* dim=0 */ (__pyx_v_ligand_lkvol.data + __pyx_t_8 * __pyx_v_ligand_lkvol.strides[0]) )))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lkdg.data + __pyx_t_7 * __pyx_v_ligand_lkdg.strides[0]) )))) / (((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_6 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljr.data + __pyx_t_4 * __pyx_v_ligand_ljr.strides[0]) )))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljr.data + __pyx_t_5 * __pyx_v_ligand_ljr.strides[0]) )))) * 2.0) * __pyx_v_pi_3_2));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0467</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0468</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0469</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0470</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0471</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0472</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0473</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-156" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0474</span>: <span class="k">def</span> <span class="nf">ligand_environment_matrices</span><span class="p">(</span><span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_q</span><span class="p">,</span></pre>
<pre class='cython code score-156 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_9ligand_environment_matrices(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_6Energy_9ligand_environment_matrices = {"ligand_environment_matrices", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_9ligand_environment_matrices, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6Energy_9ligand_environment_matrices(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_ligand_q = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_q = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_qij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_ljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_ljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_dljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_ljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_ljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_ljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lkdg = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_lkdg = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lkvol = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_lkvol = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ligand_environment_matrices (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ligand_q,&amp;__pyx_n_s_environment_q,&amp;__pyx_n_s_ligand_environment_qij,&amp;__pyx_n_s_ligand_ljr,&amp;__pyx_n_s_environment_ljr,&amp;__pyx_n_s_ligand_environment_dljr,&amp;__pyx_n_s_ligand_ljep,&amp;__pyx_n_s_environment_ljep,&amp;__pyx_n_s_ligand_environment_ljep,&amp;__pyx_n_s_ligand_lkdg,&amp;__pyx_n_s_environment_lkdg,&amp;__pyx_n_s_ligand_lklam,&amp;__pyx_n_s_environment_lklam,&amp;__pyx_n_s_ligand_lkvol,&amp;__pyx_n_s_environment_lkvol,&amp;__pyx_n_s_ligand_environment_sol_prefactor,0};
    PyObject* values[16] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_q)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_q)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 1); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_qij)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 2); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_ljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 3); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_ljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 4); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_dljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 5); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_ljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 6); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_ljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 7); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_ljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 8); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lkdg)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 9); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_lkdg)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 10); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 11); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 12); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lkvol)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 13); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_lkvol)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 14); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_sol_prefactor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, 15); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "ligand_environment_matrices") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 16) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
      values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
      values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
      values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
      values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
      values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
    }
    __pyx_v_ligand_q = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_q.memview)) __PYX_ERR(0, 474, __pyx_L3_error)</span>
    __pyx_v_environment_q = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_q.memview)) __PYX_ERR(0, 475, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_qij = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_qij.memview)) __PYX_ERR(0, 476, __pyx_L3_error)</span>
    __pyx_v_ligand_ljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_ljr.memview)) __PYX_ERR(0, 477, __pyx_L3_error)</span>
    __pyx_v_environment_ljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_ljr.memview)) __PYX_ERR(0, 478, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_dljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_dljr.memview)) __PYX_ERR(0, 479, __pyx_L3_error)</span>
    __pyx_v_ligand_ljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[6], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_ljep.memview)) __PYX_ERR(0, 480, __pyx_L3_error)</span>
    __pyx_v_environment_ljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[7], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_ljep.memview)) __PYX_ERR(0, 481, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_ljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[8], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_ljep.memview)) __PYX_ERR(0, 482, __pyx_L3_error)</span>
    __pyx_v_ligand_lkdg = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[9], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lkdg.memview)) __PYX_ERR(0, 483, __pyx_L3_error)</span>
    __pyx_v_environment_lkdg = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[10], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_lkdg.memview)) __PYX_ERR(0, 484, __pyx_L3_error)</span>
    __pyx_v_ligand_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[11], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lklam.memview)) __PYX_ERR(0, 485, __pyx_L3_error)</span>
    __pyx_v_environment_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[12], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_lklam.memview)) __PYX_ERR(0, 486, __pyx_L3_error)</span>
    __pyx_v_ligand_lkvol = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[13], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lkvol.memview)) __PYX_ERR(0, 487, __pyx_L3_error)</span>
    __pyx_v_environment_lkvol = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[14], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_lkvol.memview)) __PYX_ERR(0, 488, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_sol_prefactor = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(values[15], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_sol_prefactor.memview)) __PYX_ERR(0, 489, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_matrices", 1, 16, 16, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.ligand_environment_matrices", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_8ligand_environment_matrices(__pyx_self, __pyx_v_ligand_q, __pyx_v_environment_q, __pyx_v_ligand_environment_qij, __pyx_v_ligand_ljr, __pyx_v_environment_ljr, __pyx_v_ligand_environment_dljr, __pyx_v_ligand_ljep, __pyx_v_environment_ljep, __pyx_v_ligand_environment_ljep, __pyx_v_ligand_lkdg, __pyx_v_environment_lkdg, __pyx_v_ligand_lklam, __pyx_v_environment_lklam, __pyx_v_ligand_lkvol, __pyx_v_environment_lkvol, __pyx_v_ligand_environment_sol_prefactor);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_8ligand_environment_matrices(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_ligand_q, __Pyx_memviewslice __pyx_v_environment_q, __Pyx_memviewslice __pyx_v_ligand_environment_qij, __Pyx_memviewslice __pyx_v_ligand_ljr, __Pyx_memviewslice __pyx_v_environment_ljr, __Pyx_memviewslice __pyx_v_ligand_environment_dljr, __Pyx_memviewslice __pyx_v_ligand_ljep, __Pyx_memviewslice __pyx_v_environment_ljep, __Pyx_memviewslice __pyx_v_ligand_environment_ljep, __Pyx_memviewslice __pyx_v_ligand_lkdg, __Pyx_memviewslice __pyx_v_environment_lkdg, __Pyx_memviewslice __pyx_v_ligand_lklam, __Pyx_memviewslice __pyx_v_environment_lklam, __Pyx_memviewslice __pyx_v_ligand_lkvol, __Pyx_memviewslice __pyx_v_environment_lkvol, __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor) {
  int __pyx_v_N;
  int __pyx_v_M;
  int __pyx_v_i;
  int __pyx_v_j;
  double __pyx_v_pi_3_2;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__5)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ligand_environment_matrices", 0);
  <span class='trace'>__Pyx_TraceCall</span>("ligand_environment_matrices", __pyx_f[0], 474, 0, <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.ligand_environment_matrices", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_q, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_q, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_qij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_ljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_ljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_dljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_ljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_ljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_ljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lkdg, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_lkdg, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lkvol, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_lkvol, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_sol_prefactor, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__36 = <span class='py_c_api'>PyTuple_Pack</span>(21, __pyx_n_s_ligand_q, __pyx_n_s_environment_q, __pyx_n_s_ligand_environment_qij, __pyx_n_s_ligand_ljr, __pyx_n_s_environment_ljr, __pyx_n_s_ligand_environment_dljr, __pyx_n_s_ligand_ljep, __pyx_n_s_environment_ljep, __pyx_n_s_ligand_environment_ljep, __pyx_n_s_ligand_lkdg, __pyx_n_s_environment_lkdg, __pyx_n_s_ligand_lklam, __pyx_n_s_environment_lklam, __pyx_n_s_ligand_lkvol, __pyx_n_s_environment_lkvol, __pyx_n_s_ligand_environment_sol_prefactor, __pyx_n_s_N, __pyx_n_s_M, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_pi_3_2);<span class='error_goto'> if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 474, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__36);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__36);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_9ligand_environment_matrices, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 474, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ligand_environment_matrices, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 474, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__5 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(16, 0, 21, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__36, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_ligand_environment_matrices, 474, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 474, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0475</span>:                                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">environment_q</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0476</span>:                                 <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0477</span>:                                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_ljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0478</span>:                                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">environment_ljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0479</span>:                                 <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span>  <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0480</span>:                                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_ljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0481</span>:                                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">environment_ljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0482</span>:                                 <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_ljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0483</span>:                                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lkdg</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0484</span>:                                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">environment_lkdg</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0485</span>:                                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0486</span>:                                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">environment_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0487</span>:                                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lkvol</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0488</span>:                                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">environment_lkvol</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0489</span>:                                 <span class="n">double</span> <span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0490</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0491</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">ligand_q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_ligand_q.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0492</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">M</span> <span class="o">=</span> <span class="n">environment_q</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_M = (__pyx_v_environment_q.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0493</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0494</span>:    <span class="c"># cdef double dx, dy, dz, dij, dij_v, dij_col, dij_sol, dlj, epij</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0495</span>:    <span class="c"># cdef double dlj_dij, dlj_dij_3, dlj_dij_6, dlj_dij_12</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0496</span>:     <span class="c">#cdef double sol_prefactor_i, sol_prefactor_j, sol_expfactor_i, sol_expfactor_j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0497</span>:     <span class="c">#cdef double vdw, coupling, col, sol, C = 0.0</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0498</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">pi_3_2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">M_PI</span><span class="p">,</span> <span class="mf">3</span> <span class="o">/</span> <span class="mf">2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_pi_3_2 = pow(M_PI, 1.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">0499</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0500</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0501</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_M;
    __pyx_t_5 = __pyx_t_4;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-0">&#xA0;<span class="">0502</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0503</span>:             <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_ljr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">environment_ljr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_7 = __pyx_v_i;
      __pyx_t_8 = __pyx_v_j;
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_10 = __pyx_v_j;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) )) = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljr.data + __pyx_t_7 * __pyx_v_ligand_ljr.strides[0]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_environment_ljr.data + __pyx_t_8 * __pyx_v_environment_ljr.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0504</span>:             <span class="n">ligand_environment_ljep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">((</span><span class="n">ligand_ljep</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">environment_ljep</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_i;
      __pyx_t_7 = __pyx_v_j;
      __pyx_t_10 = __pyx_v_i;
      __pyx_t_9 = __pyx_v_j;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_ljep.data + __pyx_t_10 * __pyx_v_ligand_environment_ljep.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_ljep.strides[1]) )) = sqrt(((*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljep.data + __pyx_t_8 * __pyx_v_ligand_ljep.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_environment_ljep.data + __pyx_t_7 * __pyx_v_environment_ljep.strides[0]) )))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0505</span>:             <span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">332</span> <span class="o">*</span> <span class="n">ligand_q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">environment_q</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_7 = __pyx_v_i;
      __pyx_t_8 = __pyx_v_j;
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_10 = __pyx_v_j;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_9 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_qij.strides[1]) )) = ((332.0 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_q.data + __pyx_t_7 * __pyx_v_ligand_q.strides[0]) )))) * (*((double *) ( /* dim=0 */ (__pyx_v_environment_q.data + __pyx_t_8 * __pyx_v_environment_q.strides[0]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0506</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0507</span>:             <span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">environment_lkvol</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lkdg</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_ljr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_ljr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">pi_3_2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_j;
      __pyx_t_7 = __pyx_v_i;
      __pyx_t_10 = __pyx_v_i;
      __pyx_t_9 = __pyx_v_i;
      __pyx_t_11 = __pyx_v_i;
      __pyx_t_12 = __pyx_v_i;
      __pyx_t_13 = __pyx_v_j;
      __pyx_t_14 = 0;
      *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_12 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_14 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) )) = (((-(*((double *) ( /* dim=0 */ (__pyx_v_environment_lkvol.data + __pyx_t_8 * __pyx_v_environment_lkvol.strides[0]) )))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lkdg.data + __pyx_t_7 * __pyx_v_ligand_lkdg.strides[0]) )))) / (((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_10 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljr.data + __pyx_t_9 * __pyx_v_ligand_ljr.strides[0]) )))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_ljr.data + __pyx_t_11 * __pyx_v_ligand_ljr.strides[0]) )))) * 2.0) * __pyx_v_pi_3_2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0508</span>:             <span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">ligand_lkvol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">environment_lkdg</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">environment_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">environment_ljr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">environment_ljr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">pi_3_2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_i;
      __pyx_t_9 = __pyx_v_j;
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_7 = __pyx_v_j;
      __pyx_t_8 = __pyx_v_j;
      __pyx_t_14 = __pyx_v_i;
      __pyx_t_13 = __pyx_v_j;
      __pyx_t_12 = 1;
      *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_14 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_12 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) )) = (((-(*((double *) ( /* dim=0 */ (__pyx_v_ligand_lkvol.data + __pyx_t_11 * __pyx_v_ligand_lkvol.strides[0]) )))) * (*((double *) ( /* dim=0 */ (__pyx_v_environment_lkdg.data + __pyx_t_9 * __pyx_v_environment_lkdg.strides[0]) )))) / (((((*((double *) ( /* dim=0 */ (__pyx_v_environment_lklam.data + __pyx_t_10 * __pyx_v_environment_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_environment_ljr.data + __pyx_t_7 * __pyx_v_environment_ljr.strides[0]) )))) * (*((double *) ( /* dim=0 */ (__pyx_v_environment_ljr.data + __pyx_t_8 * __pyx_v_environment_ljr.strides[0]) )))) * 2.0) * __pyx_v_pi_3_2));
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0509</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0510</span>:             <span class="c">#print(i, j, ligand_environment_sol_prefactor[i, j, 0], ligand_lkdg[i])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0511</span>:             <span class="c">#print(i, j, ligand_environment_sol_prefactor[i, j, 1], Blkdg[j])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0512</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0513</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0514</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0515</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0516</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0517</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0518</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-124" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0519</span>: <span class="k">def</span> <span class="nf">ligand_environment_collision</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-124 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_11ligand_environment_collision(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_6Energy_11ligand_environment_collision = {"ligand_environment_collision", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_11ligand_environment_collision, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6Energy_11ligand_environment_collision(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_ligand_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lj = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_lj = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_sideChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_mainChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_sideChainCoupling;
  double __pyx_v_mainChainCoupling;
  double __pyx_v_overlap;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ligand_environment_collision (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ligand_xyz,&amp;__pyx_n_s_environment_xyz,&amp;__pyx_n_s_ligand_lj,&amp;__pyx_n_s_environment_lj,&amp;__pyx_n_s_environment_sideChainFalgs,&amp;__pyx_n_s_environment_mainChainFalgs,&amp;__pyx_n_s_sideChainCoupling,&amp;__pyx_n_s_mainChainCoupling,&amp;__pyx_n_s_overlap,0};
    PyObject* values[9] = {0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_xyz)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_xyz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_collision", 1, 9, 9, 1); <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lj)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_collision", 1, 9, 9, 2); <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_lj)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_collision", 1, 9, 9, 3); <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_sideChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_collision", 1, 9, 9, 4); <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_mainChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_collision", 1, 9, 9, 5); <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sideChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_collision", 1, 9, 9, 6); <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mainChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_collision", 1, 9, 9, 7); <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_overlap)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_collision", 1, 9, 9, 8); <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "ligand_environment_collision") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 9) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
    }
    __pyx_v_ligand_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_xyz.memview)) __PYX_ERR(0, 519, __pyx_L3_error)</span>
    __pyx_v_environment_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_xyz.memview)) __PYX_ERR(0, 520, __pyx_L3_error)</span>
    __pyx_v_ligand_lj = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lj.memview)) __PYX_ERR(0, 521, __pyx_L3_error)</span>
    __pyx_v_environment_lj = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_lj.memview)) __PYX_ERR(0, 522, __pyx_L3_error)</span>
    __pyx_v_environment_sideChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_sideChainFalgs.memview)) __PYX_ERR(0, 523, __pyx_L3_error)</span>
    __pyx_v_environment_mainChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_mainChainFalgs.memview)) __PYX_ERR(0, 524, __pyx_L3_error)</span>
    __pyx_v_sideChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[6]); if (unlikely((__pyx_v_sideChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 525, __pyx_L3_error)</span>
    __pyx_v_mainChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[7]); if (unlikely((__pyx_v_mainChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 526, __pyx_L3_error)</span>
    __pyx_v_overlap = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[8]); if (unlikely((__pyx_v_overlap == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 527, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_collision", 1, 9, 9, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.ligand_environment_collision", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_10ligand_environment_collision(__pyx_self, __pyx_v_ligand_xyz, __pyx_v_environment_xyz, __pyx_v_ligand_lj, __pyx_v_environment_lj, __pyx_v_environment_sideChainFalgs, __pyx_v_environment_mainChainFalgs, __pyx_v_sideChainCoupling, __pyx_v_mainChainCoupling, __pyx_v_overlap);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_10ligand_environment_collision(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_environment_xyz, __Pyx_memviewslice __pyx_v_ligand_lj, __Pyx_memviewslice __pyx_v_environment_lj, __Pyx_memviewslice __pyx_v_environment_sideChainFalgs, __Pyx_memviewslice __pyx_v_environment_mainChainFalgs, double __pyx_v_sideChainCoupling, double __pyx_v_mainChainCoupling, double __pyx_v_overlap) {
  int __pyx_v_N;
  int __pyx_v_M;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_C;
  double __pyx_v_dx;
  double __pyx_v_dy;
  double __pyx_v_dz;
  double __pyx_v_dij;
  double __pyx_v_dlj;
  double __pyx_v_coupling;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__6)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ligand_environment_collision", 0);
  <span class='trace'>__Pyx_TraceCall</span>("ligand_environment_collision", __pyx_f[0], 519, 0, <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.ligand_environment_collision", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lj, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_lj, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_sideChainFalgs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_mainChainFalgs, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__37 = <span class='py_c_api'>PyTuple_Pack</span>(20, __pyx_n_s_ligand_xyz, __pyx_n_s_environment_xyz, __pyx_n_s_ligand_lj, __pyx_n_s_environment_lj, __pyx_n_s_environment_sideChainFalgs, __pyx_n_s_environment_mainChainFalgs, __pyx_n_s_sideChainCoupling, __pyx_n_s_mainChainCoupling, __pyx_n_s_overlap, __pyx_n_s_N, __pyx_n_s_M, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_C, __pyx_n_s_dx, __pyx_n_s_dy, __pyx_n_s_dz, __pyx_n_s_dij, __pyx_n_s_dlj, __pyx_n_s_coupling);<span class='error_goto'> if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__37);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__37);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_11ligand_environment_collision, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ligand_environment_collision, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 519, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__6 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(9, 0, 20, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__37, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_ligand_environment_collision, 519, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__6)) __PYX_ERR(0, 519, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0520</span>:                                  <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0521</span>:                                  <span class="n">double</span><span class="p">[:]</span> <span class="n">ligand_lj</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0522</span>:                                  <span class="n">double</span><span class="p">[:]</span> <span class="n">environment_lj</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0523</span>:                                  <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0524</span>:                                  <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0525</span>:                                  <span class="n">double</span> <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0526</span>:                                  <span class="n">double</span> <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0527</span>:                                  <span class="n">double</span> <span class="n">overlap</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0528</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0529</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_ligand_xyz.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0530</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">M</span> <span class="o">=</span> <span class="n">environment_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_M = (__pyx_v_environment_xyz.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0531</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">C</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_C = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0532</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dx</span><span class="p">,</span> <span class="nf">dy</span><span class="p">,</span> <span class="nf">dz</span><span class="p">,</span> <span class="nf">dij</span><span class="p">,</span> <span class="nf">dlj</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0533</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">coupling</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0534</span>:     <span class="c">#cdef double rep, atr, col, sol</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0535</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0536</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0537</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0538</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_M;
    __pyx_t_5 = __pyx_t_4;
    for (__pyx_t_6 = 0; __pyx_t_6 &lt; __pyx_t_5; __pyx_t_6+=1) {
      __pyx_v_j = __pyx_t_6;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0539</span>:             <span class="n">coupling</span> <span class="o">=</span> <span class="p">(</span><span class="n">environment_sideChainFalgs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">sideChainCoupling</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">environment_mainChainFalgs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">mainChainCoupling</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_7 = __pyx_v_j;
      __pyx_t_8 = __pyx_v_j;
      __pyx_v_coupling = (((*((int *) ( /* dim=0 */ (__pyx_v_environment_sideChainFalgs.data + __pyx_t_7 * __pyx_v_environment_sideChainFalgs.strides[0]) ))) * __pyx_v_sideChainCoupling) + ((*((int *) ( /* dim=0 */ (__pyx_v_environment_mainChainFalgs.data + __pyx_t_8 * __pyx_v_environment_mainChainFalgs.strides[0]) ))) * __pyx_v_mainChainCoupling));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0540</span>:             <span class="k">if</span> <span class="n">coupling</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = ((__pyx_v_coupling == 0.0) != 0);
      if (__pyx_t_9) {
/* â€¦ */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0541</span>:                 <span class="k">continue</span></pre>
<pre class='cython code score-0 '>        goto __pyx_L5_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">0542</span>:             <span class="c">#print(&#39;couplinfs&#39;, coupling, overlap)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0543</span>:             <span class="n">dx</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">environment_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_i;
      __pyx_t_7 = 0;
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_11 = 0;
      __pyx_v_dx = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_8 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_environment_xyz.data + __pyx_t_10 * __pyx_v_environment_xyz.strides[0]) ) + __pyx_t_11 * __pyx_v_environment_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0544</span>:             <span class="n">dy</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">environment_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_i;
      __pyx_t_10 = 1;
      __pyx_t_7 = __pyx_v_j;
      __pyx_t_8 = 1;
      __pyx_v_dy = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_11 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_environment_xyz.data + __pyx_t_7 * __pyx_v_environment_xyz.strides[0]) ) + __pyx_t_8 * __pyx_v_environment_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0545</span>:             <span class="n">dz</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">environment_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_i;
      __pyx_t_7 = 2;
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_11 = 2;
      __pyx_v_dz = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_8 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_environment_xyz.data + __pyx_t_10 * __pyx_v_environment_xyz.strides[0]) ) + __pyx_t_11 * __pyx_v_environment_xyz.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0546</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0547</span>:             <span class="n">dij</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span> <span class="o">+</span> <span class="n">dz</span> <span class="o">*</span> <span class="n">dz</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dij = (((__pyx_v_dx * __pyx_v_dx) + (__pyx_v_dy * __pyx_v_dy)) + (__pyx_v_dz * __pyx_v_dz));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0548</span>:             <span class="n">dij</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dij</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dij = sqrt(__pyx_v_dij);
</pre><pre class="cython line score-0">&#xA0;<span class="">0549</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0550</span>:             <span class="n">dlj</span> <span class="o">=</span> <span class="n">ligand_lj</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">environment_lj</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_i;
      __pyx_t_10 = __pyx_v_j;
      __pyx_v_dlj = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lj.data + __pyx_t_11 * __pyx_v_ligand_lj.strides[0]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_environment_lj.data + __pyx_t_10 * __pyx_v_environment_lj.strides[0]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0551</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0552</span>:             <span class="c"># Terminate if collision found</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0553</span>:             <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="n">dlj</span> <span class="o">*</span> <span class="n">overlap</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = ((__pyx_v_dij &lt; (__pyx_v_dlj * __pyx_v_overlap)) != 0);
      if (__pyx_t_9) {
/* â€¦ */
      }
      __pyx_L5_continue:;
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0554</span>:                 <span class="n">C</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>        __pyx_v_C = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">0555</span>:                 <span class="c">#print(&#39;BBBB colli: i, j&#39;, i, j, dij, dlj, coupling, environment_sideChainFalgs[j], environment_mainChainFalgs[j] )</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0556</span>:                 <span class="c">#print(ligand_xyz[i, 0], ligand_xyz[i, 1], ligand_xyz[i, 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0557</span>:                 <span class="c">#print(environment_xyz[j, 0], environment_xyz[j, 1], environment_xyz[j, 2])</span></pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0558</span>:                 <span class="k">return</span> <span class="n">C</span></pre>
<pre class='cython code score-3 '>        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
        __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_C);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 558, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
        __pyx_r = __pyx_t_12;
        __pyx_t_12 = 0;
        goto __pyx_L0;
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0559</span>:     <span class="k">return</span> <span class="n">C</span></pre>
<pre class='cython code score-3 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_C);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 559, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
  __pyx_r = __pyx_t_12;
  __pyx_t_12 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0560</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0561</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0562</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">double</span> <span class="nf">switch</span><span class="p">(</span><span class="n">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">double</span> <span class="nb">min</span><span class="p">,</span> <span class="n">double</span> <span class="nb">max</span><span class="p">)</span> <span class="k">nogil</span><span class="p">:</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE double __pyx_f_6Energy_switch(double __pyx_v_x, double __pyx_v_min, double __pyx_v_max) {
  double __pyx_v_r2_a2;
  double __pyx_v_b2_a2;
  double __pyx_v_r2a2_b2a2;
  double __pyx_r;
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("Energy.switch", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
  __pyx_r = 0;
  __pyx_L0:;
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0563</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">r2_a2</span><span class="p">,</span> <span class="nf">b2_a2</span><span class="p">,</span> <span class="nf">r2a2_b2a2</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0564</span>:     <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_x &lt; __pyx_v_min) != 0);
  if (__pyx_t_1) {
/* â€¦ */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0565</span>:         <span class="k">return</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_r = 1.0;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0566</span>:     <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_x &gt; __pyx_v_max) != 0);
  if (__pyx_t_1) {
/* â€¦ */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0567</span>:         <span class="k">return</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_r = 0.0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0568</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0569</span>:         <span class="n">r2_a2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nb">min</span> <span class="o">*</span> <span class="nb">min</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_r2_a2 = ((__pyx_v_x * __pyx_v_x) - (__pyx_v_min * __pyx_v_min));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0570</span>:         <span class="n">b2_a2</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span> <span class="o">*</span> <span class="nb">max</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nb">min</span> <span class="o">*</span> <span class="nb">min</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_b2_a2 = ((__pyx_v_max * __pyx_v_max) - (__pyx_v_min * __pyx_v_min));
</pre><pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0571</span>:         <span class="n">r2a2_b2a2</span> <span class="o">=</span> <span class="n">r2_a2</span><span class="o">/</span><span class="n">b2_a2</span></pre>
<pre class='cython code score-9 '>    if (unlikely(__pyx_v_b2_a2 == 0)) {
      #ifdef WITH_THREAD
      PyGILState_STATE __pyx_gilstate_save = <span class='pyx_c_api'>__Pyx_PyGILState_Ensure</span>();
      #endif
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      #ifdef WITH_THREAD
      <span class='pyx_c_api'>__Pyx_PyGILState_Release</span>(__pyx_gilstate_save);
      #endif
      <span class='error_goto'>__PYX_ERR(0, 571, __pyx_L1_error)</span>
    }
    __pyx_v_r2a2_b2a2 = (__pyx_v_r2_a2 / __pyx_v_b2_a2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0572</span>:         <span class="k">return</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="n">r2a2_b2a2</span><span class="o">**</span><span class="mf">2</span> <span class="o">*</span> <span class="p">((</span><span class="mf">2</span> <span class="o">*</span> <span class="n">r2a2_b2a2</span><span class="p">)</span> <span class="o">-</span><span class="mf">3</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>    __pyx_r = (1.0 + (pow(__pyx_v_r2a2_b2a2, 2.0) * ((2.0 * __pyx_v_r2a2_b2a2) - 3.0)));
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0573</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0574</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0575</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">double</span> <span class="nf">col_epsi</span><span class="p">(</span><span class="n">double</span> <span class="n">x</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>static CYTHON_INLINE double __pyx_f_6Energy_col_epsi(double __pyx_v_x) {
  double __pyx_v_d_4;
  double __pyx_v_g;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("col_epsi", 0);
/* â€¦ */
  /* function exit code */
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0576</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">d_4</span><span class="p">,</span> <span class="nf">g</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0577</span>:     <span class="n">d_4</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="mf">0.4</span></pre>
<pre class='cython code score-0 '>  __pyx_v_d_4 = (__pyx_v_x / 0.4);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0578</span>:     <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1</span> <span class="o">+</span> <span class="n">d_4</span> <span class="o">+</span> <span class="p">(</span><span class="n">d_4</span><span class="o">**</span><span class="mf">2</span><span class="p">)</span><span class="o">/</span><span class="mf">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">d_4</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_g = (((1.0 + __pyx_v_d_4) + (pow(__pyx_v_d_4, 2.0) / 2.0)) * exp((-__pyx_v_d_4)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0579</span>:     <span class="k">return</span> <span class="n">g</span><span class="o">*</span><span class="mf">6.0</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1</span><span class="o">-</span><span class="n">g</span><span class="p">)</span><span class="o">*</span><span class="mf">80</span></pre>
<pre class='cython code score-0 '>  __pyx_r = ((__pyx_v_g * 6.0) + ((1.0 - __pyx_v_g) * 80.0));
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0580</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0581</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0582</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0583</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0584</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0585</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0586</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-69" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0587</span>: <span class="k">def</span> <span class="nf">select_torsions_by_distance</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">T</span><span class="p">,</span> <span class="nb">int</span> <span class="n">K</span><span class="p">,</span> <span class="n">double</span> <span class="n">cutoff_percent</span><span class="p">):</span></pre>
<pre class='cython code score-69 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_13select_torsions_by_distance(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_6Energy_13select_torsions_by_distance = {"select_torsions_by_distance", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_13select_torsions_by_distance, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6Energy_13select_torsions_by_distance(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_T = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_K;
  double __pyx_v_cutoff_percent;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("select_torsions_by_distance (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_T,&amp;__pyx_n_s_K,&amp;__pyx_n_s_cutoff_percent,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_T)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_K)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("select_torsions_by_distance", 1, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_cutoff_percent)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("select_torsions_by_distance", 1, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "select_torsions_by_distance") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_T = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_T.memview)) __PYX_ERR(0, 587, __pyx_L3_error)</span>
    __pyx_v_K = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[1]); if (unlikely((__pyx_v_K == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L3_error)</span>
    __pyx_v_cutoff_percent = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[2]); if (unlikely((__pyx_v_cutoff_percent == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("select_torsions_by_distance", 1, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.select_torsions_by_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_12select_torsions_by_distance(__pyx_self, __pyx_v_T, __pyx_v_K, __pyx_v_cutoff_percent);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_12select_torsions_by_distance(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_T, int __pyx_v_K, double __pyx_v_cutoff_percent) {
  int __pyx_v_N;
  int __pyx_v_M;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_counter;
  __Pyx_memviewslice __pyx_v_D = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_C = { 0, 0, { 0 }, { 0 }, { 0 } };
  float __pyx_v_distance;
  float __pyx_v_distanceMax;
  float __pyx_v_cutoff_value;
  __Pyx_memviewslice __pyx_v_C_index = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__7)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("select_torsions_by_distance", 0);
  <span class='trace'>__Pyx_TraceCall</span>("select_torsions_by_distance", __pyx_f[0], 587, 0, <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_19, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_20, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.select_torsions_by_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_D, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_C, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_C_index, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_T, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__38 = <span class='py_c_api'>PyTuple_Pack</span>(15, __pyx_n_s_T, __pyx_n_s_K, __pyx_n_s_cutoff_percent, __pyx_n_s_N, __pyx_n_s_M, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_counter, __pyx_n_s_k, __pyx_n_s_D, __pyx_n_s_C, __pyx_n_s_distance, __pyx_n_s_distanceMax, __pyx_n_s_cutoff_value, __pyx_n_s_C_index);<span class='error_goto'> if (unlikely(!__pyx_tuple__38)) __PYX_ERR(0, 587, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__38);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__38);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_13select_torsions_by_distance, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 587, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_select_torsions_by_distance, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 587, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__7 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(3, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__38, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_select_torsions_by_distance, 587, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 587, __pyx_L1_error)</span>
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0588</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_T.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0589</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">M</span> <span class="o">=</span> <span class="n">T</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_M = (__pyx_v_T.shape[1]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0590</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">counter</span><span class="p">,</span> <span class="nf">k</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0591</span>:     <span class="k">cdef</span> <span class="kt">float</span> [<span class="p">:,</span> <span class="p">:]</span> <span class="n">D</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0592</span>:     <span class="k">cdef</span> <span class="kt">double</span> [<span class="p">:,</span> <span class="p">:]</span> <span class="n">C</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0593</span>:     <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">distance</span><span class="p">,</span> <span class="nf">distanceMax</span><span class="p">,</span> <span class="nf">cutoff_value</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0594</span>:     <span class="k">cdef</span> <span class="kt">int</span> [<span class="p">:]</span> <span class="n">C_index</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0595</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0596</span>:     <span class="c"># Compute distance matrix</span></pre>
<pre class="cython line score-43" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0597</span>:     <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span></pre>
<pre class='cython code score-43 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_3);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_float</span>(__pyx_t_5, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 597, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_D = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0598</span>:     <span class="n">distanceMax</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_distanceMax = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0599</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_v_N;
  __pyx_t_8 = __pyx_t_7;
  for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
    __pyx_v_i = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0600</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mf">1</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_v_N;
    __pyx_t_11 = __pyx_t_10;
    for (__pyx_t_12 = (__pyx_v_i + 1); __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
      __pyx_v_j = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0601</span>:             <span class="n">distance</span> <span class="o">=</span>  <span class="n">angular_distance_squared</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mf">1</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mf">1</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>      __pyx_t_13.data = __pyx_v_T.data;
      __pyx_t_13.memview = __pyx_v_T.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_13, 0);
      {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_T.strides[0];
        __pyx_t_13.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_14 = -1;
      if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_13,
    __pyx_v_T.shape[1], __pyx_v_T.strides[1], __pyx_v_T.suboffsets[1],
    1,
    0,
    &amp;__pyx_t_14,
    0,
    -1L,
    0,
    0,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 601, __pyx_L1_error)</span>
}

__pyx_t_15.data = __pyx_v_T.data;
      __pyx_t_15.memview = __pyx_v_T.memview;
      __PYX_INC_MEMVIEW(&amp;__pyx_t_15, 0);
      {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_j;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_T.strides[0];
        __pyx_t_15.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_14 = -1;
      if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_15,
    __pyx_v_T.shape[1], __pyx_v_T.strides[1], __pyx_v_T.suboffsets[1],
    1,
    0,
    &amp;__pyx_t_14,
    0,
    -1L,
    0,
    0,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 601, __pyx_L1_error)</span>
}

__pyx_v_distance = __pyx_f_6Energy_angular_distance_squared(__pyx_t_13, __pyx_t_15);
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
      __pyx_t_13.memview = NULL;
      __pyx_t_13.data = NULL;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
      __pyx_t_15.memview = NULL;
      __pyx_t_15.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0602</span>:             <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = __pyx_v_i;
      __pyx_t_17 = __pyx_v_j;
      *((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_D.data + __pyx_t_16 * __pyx_v_D.strides[0]) ) + __pyx_t_17 * __pyx_v_D.strides[1]) )) = __pyx_v_distance;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0603</span>:             <span class="n">D</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span></pre>
<pre class='cython code score-0 '>      __pyx_t_17 = __pyx_v_j;
      __pyx_t_16 = __pyx_v_i;
      *((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_D.data + __pyx_t_17 * __pyx_v_D.strides[0]) ) + __pyx_t_16 * __pyx_v_D.strides[1]) )) = __pyx_v_distance;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0604</span>:             <span class="k">if</span> <span class="n">distanceMax</span> <span class="o">&lt;</span> <span class="n">distance</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = ((__pyx_v_distanceMax &lt; __pyx_v_distance) != 0);
      if (__pyx_t_18) {
/* â€¦ */
      }
    }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0605</span>:                 <span class="n">distanceMax</span> <span class="o">=</span> <span class="n">distance</span></pre>
<pre class='cython code score-0 '>        __pyx_v_distanceMax = __pyx_v_distance;
</pre><pre class="cython line score-0">&#xA0;<span class="">0606</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0607</span>:     <span class="c"># compute the cut off value for the torsion vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0608</span>:     <span class="n">cutoff_value</span> <span class="o">=</span> <span class="n">distanceMax</span> <span class="o">*</span> <span class="n">cutoff_percent</span></pre>
<pre class='cython code score-0 '>  __pyx_v_cutoff_value = (__pyx_v_distanceMax * __pyx_v_cutoff_percent);
</pre><pre class="cython line score-0">&#xA0;<span class="">0609</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0610</span>:     <span class="c"># initiate the C</span></pre>
<pre class="cython line score-43" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0611</span>:     <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">K</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></pre>
<pre class='cython code score-43 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_K);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_M);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_3);
  __pyx_t_5 = 0;
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_3, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_19 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_19.memview)) __PYX_ERR(0, 611, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_C = __pyx_t_19;
  __pyx_t_19.memview = NULL;
  __pyx_t_19.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0612</span>:     <span class="n">C</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="p">:]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_15.data = __pyx_v_T.data;
  __pyx_t_15.memview = __pyx_v_T.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_15, 0);
  {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_T.strides[0];
        __pyx_t_15.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_15.shape[0] = __pyx_v_T.shape[1];
__pyx_t_15.strides[0] = __pyx_v_T.strides[1];
    __pyx_t_15.suboffsets[0] = -1;

__pyx_t_13.data = __pyx_v_C.data;
  __pyx_t_13.memview = __pyx_v_C.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_13, 0);
  {
    Py_ssize_t __pyx_tmp_idx = 0;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_C.strides[0];
        __pyx_t_13.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_13.shape[0] = __pyx_v_C.shape[1];
__pyx_t_13.strides[0] = __pyx_v_C.strides[1];
    __pyx_t_13.suboffsets[0] = -1;

if (unlikely(__pyx_memoryview_copy_contents(__pyx_t_15, __pyx_t_13, 1, 1, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 612, __pyx_L1_error)</span>
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
  __pyx_t_13.memview = NULL;
  __pyx_t_13.data = NULL;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
  __pyx_t_15.memview = NULL;
  __pyx_t_15.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0613</span>:     <span class="n">counter</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_counter = 1;
</pre><pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0614</span>:     <span class="n">C_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span></pre>
<pre class='cython code score-34 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_K);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_int32);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 614, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_20 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_5, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_20.memview)) __PYX_ERR(0, 614, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_C_index = __pyx_t_20;
  __pyx_t_20.memview = NULL;
  __pyx_t_20.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">0615</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0616</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0617</span>:     <span class="c"># Assign</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0618</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_v_N;
  __pyx_t_8 = __pyx_t_7;
  for (__pyx_t_9 = 0; __pyx_t_9 &lt; __pyx_t_8; __pyx_t_9+=1) {
    __pyx_v_i = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0619</span>:         <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;=</span> <span class="n">K</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_18 = ((__pyx_v_counter &gt;= __pyx_v_K) != 0);
    if (__pyx_t_18) {
/* â€¦ */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0620</span>:             <span class="k">break</span></pre>
<pre class='cython code score-0 '>      goto __pyx_L9_break;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0621</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">counter</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_v_counter;
    __pyx_t_11 = __pyx_t_10;
    for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
      __pyx_v_j = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0622</span>:             <span class="n">distance</span> <span class="o">=</span> <span class="n">D</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">C_index</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = __pyx_v_j;
      __pyx_t_17 = __pyx_v_i;
      __pyx_t_21 = (*((int *) ( /* dim=0 */ (__pyx_v_C_index.data + __pyx_t_16 * __pyx_v_C_index.strides[0]) )));
      __pyx_v_distance = (*((float *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_D.data + __pyx_t_17 * __pyx_v_D.strides[0]) ) + __pyx_t_21 * __pyx_v_D.strides[1]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">0623</span>:             <span class="c">#print(distance, cutoff_value)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0624</span>:             <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;=</span> <span class="n">cutoff_value</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = ((__pyx_v_distance &gt;= __pyx_v_cutoff_value) != 0);
      if (__pyx_t_18) {
/* â€¦ */
      }
    }
    __pyx_L12_break:;
  }
  __pyx_L9_break:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0625</span>:                 <span class="n">C</span><span class="p">[</span><span class="n">counter</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_15.data = __pyx_v_T.data;
        __pyx_t_15.memview = __pyx_v_T.memview;
        __PYX_INC_MEMVIEW(&amp;__pyx_t_15, 0);
        {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_i;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_T.strides[0];
        __pyx_t_15.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_15.shape[0] = __pyx_v_T.shape[1];
__pyx_t_15.strides[0] = __pyx_v_T.strides[1];
    __pyx_t_15.suboffsets[0] = -1;

__pyx_t_13.data = __pyx_v_C.data;
        __pyx_t_13.memview = __pyx_v_C.memview;
        __PYX_INC_MEMVIEW(&amp;__pyx_t_13, 0);
        {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_counter;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_C.strides[0];
        __pyx_t_13.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_13.shape[0] = __pyx_v_C.shape[1];
__pyx_t_13.strides[0] = __pyx_v_C.strides[1];
    __pyx_t_13.suboffsets[0] = -1;

if (unlikely(__pyx_memoryview_copy_contents(__pyx_t_15, __pyx_t_13, 1, 1, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 625, __pyx_L1_error)</span>
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_13, 1);
        __pyx_t_13.memview = NULL;
        __pyx_t_13.data = NULL;
        __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
        __pyx_t_15.memview = NULL;
        __pyx_t_15.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0626</span>:                 <span class="n">C_index</span><span class="p">[</span><span class="n">counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span></pre>
<pre class='cython code score-0 '>        __pyx_t_16 = __pyx_v_counter;
        *((int *) ( /* dim=0 */ (__pyx_v_C_index.data + __pyx_t_16 * __pyx_v_C_index.strides[0]) )) = __pyx_v_i;
</pre><pre class="cython line score-0">&#xA0;<span class="">0627</span>:                 <span class="c">#print(i, j, distance, cutoff_value, counter, [&#39;{:.1f}&#39;.format(k) for k in np.array(T[i, :])])</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0628</span>:                 <span class="n">counter</span> <span class="o">+=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>        __pyx_v_counter = (__pyx_v_counter + 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0629</span>:                 <span class="k">break</span></pre>
<pre class='cython code score-0 '>        goto __pyx_L12_break;
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0630</span>:     <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="mf">0</span><span class="p">:</span><span class="n">counter</span><span class="p">,</span> <span class="p">:])</span></pre>
<pre class='cython code score-21 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 630, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 630, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_19.data = __pyx_v_C.data;
  __pyx_t_19.memview = __pyx_v_C.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_19, 0);
  __pyx_t_7 = -1;
  if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_19,
    __pyx_v_C.shape[0], __pyx_v_C.strides[0], __pyx_v_C.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_7,
    0,
    __pyx_v_counter,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 630, __pyx_L1_error)</span>
}

__pyx_t_19.shape[1] = __pyx_v_C.shape[1];
__pyx_t_19.strides[1] = __pyx_v_C.strides[1];
    __pyx_t_19.suboffsets[1] = -1;

__pyx_t_1 = __pyx_memoryview_fromslice(__pyx_t_19, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 630, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_19, 1);
  __pyx_t_19.memview = NULL;
  __pyx_t_19.data = NULL;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_5 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 630, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0631</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0632</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0633</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0634</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">double</span> <span class="nf">angular_distance_squared</span><span class="p">(</span><span class="n">double</span> <span class="p">[:]</span> <span class="n">A</span><span class="p">,</span> <span class="n">double</span> <span class="p">[:]</span> <span class="n">B</span><span class="p">):</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE double __pyx_f_6Energy_angular_distance_squared(__Pyx_memviewslice __pyx_v_A, __Pyx_memviewslice __pyx_v_B) {
  int __pyx_v_N;
  int __pyx_v_i;
  double __pyx_v_dx;
  double __pyx_v_D;
  double __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angular_distance_squared", 0);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("Energy.angular_distance_squared", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0635</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_A.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0636</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0637</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dx</span><span class="p">,</span> <span class="nf">D</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_D = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0638</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0639</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0640</span>:         <span class="n">dx</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-4 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = -1;
    if (__pyx_t_4 &lt; 0) {
      __pyx_t_4 += __pyx_v_A.shape[0];
      if (unlikely(__pyx_t_4 &lt; 0)) __pyx_t_5 = 0;
    } else if (unlikely(__pyx_t_4 &gt;= __pyx_v_A.shape[0])) __pyx_t_5 = 0;
    if (unlikely(__pyx_t_5 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_5);
      <span class='error_goto'>__PYX_ERR(0, 640, __pyx_L1_error)</span>
    }
    __pyx_t_6 = __pyx_v_i;
    __pyx_t_5 = -1;
    if (__pyx_t_6 &lt; 0) {
      __pyx_t_6 += __pyx_v_B.shape[0];
      if (unlikely(__pyx_t_6 &lt; 0)) __pyx_t_5 = 0;
    } else if (unlikely(__pyx_t_6 &gt;= __pyx_v_B.shape[0])) __pyx_t_5 = 0;
    if (unlikely(__pyx_t_5 != -1)) {
      <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_5);
      <span class='error_goto'>__PYX_ERR(0, 640, __pyx_L1_error)</span>
    }
    __pyx_v_dx = ((*((double *) ( /* dim=0 */ (__pyx_v_A.data + __pyx_t_4 * __pyx_v_A.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_B.data + __pyx_t_6 * __pyx_v_B.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0641</span>:         <span class="n">dx</span> <span class="o">=</span> <span class="n">fabs</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dx = fabs(__pyx_v_dx);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0642</span>:         <span class="k">if</span> <span class="n">dx</span> <span class="o">&lt;=</span> <span class="mf">180</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = ((__pyx_v_dx &lt;= 180.0) != 0);
    if (__pyx_t_7) {
/* â€¦ */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0643</span>:             <span class="n">D</span> <span class="o">+=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span></pre>
<pre class='cython code score-0 '>      __pyx_v_D = (__pyx_v_D + (__pyx_v_dx * __pyx_v_dx));
</pre><pre class="cython line score-0">&#xA0;<span class="">0644</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0645</span>:             <span class="n">D</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">360</span> <span class="o">-</span> <span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">360</span> <span class="o">-</span> <span class="n">dx</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_D = (__pyx_v_D + ((360.0 - __pyx_v_dx) * (360.0 - __pyx_v_dx)));
    }
    __pyx_L5:;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0646</span>:     <span class="k">return</span> <span class="n">D</span></pre>
<pre class='cython code score-0 '>  __pyx_r = __pyx_v_D;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0647</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0648</span>: <span class="sd">&quot;&quot;&quot;                     Contains following functions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0649</span>: <span class="sd">                         -&gt; ligand_steep_decent</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0650</span>: <span class="sd">                         -&gt; ligand_nonbonded_gradient</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0651</span>: <span class="sd">                         - ligand_enviroment_gradient</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0652</span>: <span class="sd">                         -&gt; bond</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0653</span>: <span class="sd">                         -&gt; angle</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0654</span>: <span class="sd">                         -&gt; switch</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0655</span>: <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0656</span>: <span class="sd">&quot;&quot;&quot;                     Vector definition conventions</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0657</span>: <span class="sd">The displacement vector between two particles i, and j is defined as:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0658</span>: <span class="sd">                                uij = rj - ri</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0659</span>: <span class="sd">where the ri and rj are position vectors. Thus, force vectors for pair</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0660</span>: <span class="sd">potentials are defined as</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0661</span>: <span class="sd">                                fi = -g * uji</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0662</span>: <span class="sd">                                fj = -g * uij</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0663</span>: <span class="sd">where g is the gradient and uij = -uij.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0664</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0665</span>: <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0666</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0667</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0668</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0669</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0670</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0671</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-340" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0672</span>: <span class="k">def</span> <span class="nf">ligand_steep_decent</span><span class="p">(</span><span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-340 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_15ligand_steep_decent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_6Energy_15ligand_steep_decent = {"ligand_steep_decent", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_15ligand_steep_decent, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6Energy_15ligand_steep_decent(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_ligand_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_qij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_dljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_dljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_sol_prefactor = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_nonbonded = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_nonbondedWeights = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_ligand_coupling;
  __Pyx_memviewslice __pyx_v_ligand_weights = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_bond_atomIndex = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_equilibrium_distance = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_bond_force_constance = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_angle_atomIndex = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_equilibrium_angle = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_angle_force_constance = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_mask = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_qij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_dljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_dljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environmen_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_sideChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_mainChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_sideChainCoupling;
  double __pyx_v_mainChainCoupling;
  __Pyx_memviewslice __pyx_v_ligand_environment_weights = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_convergence_cutoff;
  int __pyx_v_max_cycle;
  double __pyx_v_max_line_search;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ligand_steep_decent (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ligand_xyz,&amp;__pyx_n_s_environment_xyz,&amp;__pyx_n_s_ligand_qij,&amp;__pyx_n_s_ligand_dljr,&amp;__pyx_n_s_ligand_dljep,&amp;__pyx_n_s_ligand_sol_prefactor,&amp;__pyx_n_s_ligand_lklam,&amp;__pyx_n_s_ligand_nonbonded,&amp;__pyx_n_s_ligand_nonbondedWeights,&amp;__pyx_n_s_ligand_coupling,&amp;__pyx_n_s_ligand_weights,&amp;__pyx_n_s_bond_atomIndex,&amp;__pyx_n_s_equilibrium_distance,&amp;__pyx_n_s_bond_force_constance,&amp;__pyx_n_s_angle_atomIndex,&amp;__pyx_n_s_equilibrium_angle,&amp;__pyx_n_s_angle_force_constance,&amp;__pyx_n_s_ligand_mask,&amp;__pyx_n_s_ligand_environment_qij,&amp;__pyx_n_s_ligand_environment_dljr,&amp;__pyx_n_s_ligand_environment_dljep,&amp;__pyx_n_s_ligand_environment_sol_prefactor,&amp;__pyx_n_s_environmen_lklam,&amp;__pyx_n_s_environment_sideChainFalgs,&amp;__pyx_n_s_environment_mainChainFalgs,&amp;__pyx_n_s_sideChainCoupling,&amp;__pyx_n_s_mainChainCoupling,&amp;__pyx_n_s_ligand_environment_weights,&amp;__pyx_n_s_convergence_cutoff,&amp;__pyx_n_s_max_cycle,&amp;__pyx_n_s_max_line_search,0};
    PyObject* values[31] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 31: values[30] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 30);
        CYTHON_FALLTHROUGH;
        case 30: values[29] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 29);
        CYTHON_FALLTHROUGH;
        case 29: values[28] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 28);
        CYTHON_FALLTHROUGH;
        case 28: values[27] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 27);
        CYTHON_FALLTHROUGH;
        case 27: values[26] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 26);
        CYTHON_FALLTHROUGH;
        case 26: values[25] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 25);
        CYTHON_FALLTHROUGH;
        case 25: values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
        CYTHON_FALLTHROUGH;
        case 24: values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
        CYTHON_FALLTHROUGH;
        case 23: values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
        CYTHON_FALLTHROUGH;
        case 22: values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
        CYTHON_FALLTHROUGH;
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_xyz)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_xyz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 1); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_qij)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 2); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_dljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 3); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_dljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 4); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_sol_prefactor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 5); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 6); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_nonbonded)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 7); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_nonbondedWeights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 8); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_coupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 9); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_weights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 10); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_bond_atomIndex)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 11); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_equilibrium_distance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 12); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_bond_force_constance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 13); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_angle_atomIndex)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 14); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_equilibrium_angle)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 15); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (likely((values[16] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_angle_force_constance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 16); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (likely((values[17] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_mask)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 17); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (likely((values[18] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_qij)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 18); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (likely((values[19] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_dljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 19); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (likely((values[20] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_dljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 20); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 21:
        if (likely((values[21] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_sol_prefactor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 21); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 22:
        if (likely((values[22] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environmen_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 22); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 23:
        if (likely((values[23] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_sideChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 23); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 24:
        if (likely((values[24] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_mainChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 24); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 25:
        if (likely((values[25] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sideChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 25); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 26:
        if (likely((values[26] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mainChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 26); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 27:
        if (likely((values[27] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_weights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 27); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 28:
        if (likely((values[28] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_convergence_cutoff)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 28); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 29:
        if (likely((values[29] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_max_cycle)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 29); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 30:
        if (likely((values[30] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_max_line_search)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, 30); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "ligand_steep_decent") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 31) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
      values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
      values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
      values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
      values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
      values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
      values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
      values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
      values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
      values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
      values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
      values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
      values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
      values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
      values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
      values[25] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 25);
      values[26] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 26);
      values[27] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 27);
      values[28] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 28);
      values[29] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 29);
      values[30] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 30);
    }
    __pyx_v_ligand_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_xyz.memview)) __PYX_ERR(0, 672, __pyx_L3_error)</span>
    __pyx_v_environment_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_xyz.memview)) __PYX_ERR(0, 673, __pyx_L3_error)</span>
    __pyx_v_ligand_qij = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_qij.memview)) __PYX_ERR(0, 675, __pyx_L3_error)</span>
    __pyx_v_ligand_dljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_dljr.memview)) __PYX_ERR(0, 676, __pyx_L3_error)</span>
    __pyx_v_ligand_dljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_dljep.memview)) __PYX_ERR(0, 677, __pyx_L3_error)</span>
    __pyx_v_ligand_sol_prefactor = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_sol_prefactor.memview)) __PYX_ERR(0, 678, __pyx_L3_error)</span>
    __pyx_v_ligand_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[6], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lklam.memview)) __PYX_ERR(0, 679, __pyx_L3_error)</span>
    __pyx_v_ligand_nonbonded = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[7], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_nonbonded.memview)) __PYX_ERR(0, 680, __pyx_L3_error)</span>
    __pyx_v_ligand_nonbondedWeights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[8], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_nonbondedWeights.memview)) __PYX_ERR(0, 681, __pyx_L3_error)</span>
    __pyx_v_ligand_coupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[9]); if (unlikely((__pyx_v_ligand_coupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 682, __pyx_L3_error)</span>
    __pyx_v_ligand_weights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[10], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_weights.memview)) __PYX_ERR(0, 683, __pyx_L3_error)</span>
    __pyx_v_bond_atomIndex = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[11], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_bond_atomIndex.memview)) __PYX_ERR(0, 685, __pyx_L3_error)</span>
    __pyx_v_equilibrium_distance = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[12], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_equilibrium_distance.memview)) __PYX_ERR(0, 686, __pyx_L3_error)</span>
    __pyx_v_bond_force_constance = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[13], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_bond_force_constance.memview)) __PYX_ERR(0, 687, __pyx_L3_error)</span>
    __pyx_v_angle_atomIndex = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[14], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_angle_atomIndex.memview)) __PYX_ERR(0, 689, __pyx_L3_error)</span>
    __pyx_v_equilibrium_angle = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[15], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_equilibrium_angle.memview)) __PYX_ERR(0, 690, __pyx_L3_error)</span>
    __pyx_v_angle_force_constance = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[16], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_angle_force_constance.memview)) __PYX_ERR(0, 691, __pyx_L3_error)</span>
    __pyx_v_ligand_mask = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[17], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_mask.memview)) __PYX_ERR(0, 694, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_qij = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[18], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_qij.memview)) __PYX_ERR(0, 695, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_dljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[19], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_dljr.memview)) __PYX_ERR(0, 696, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_dljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[20], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_dljep.memview)) __PYX_ERR(0, 697, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_sol_prefactor = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(values[21], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_sol_prefactor.memview)) __PYX_ERR(0, 698, __pyx_L3_error)</span>
    __pyx_v_environmen_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[22], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environmen_lklam.memview)) __PYX_ERR(0, 700, __pyx_L3_error)</span>
    __pyx_v_environment_sideChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[23], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_sideChainFalgs.memview)) __PYX_ERR(0, 701, __pyx_L3_error)</span>
    __pyx_v_environment_mainChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[24], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_mainChainFalgs.memview)) __PYX_ERR(0, 702, __pyx_L3_error)</span>
    __pyx_v_sideChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[25]); if (unlikely((__pyx_v_sideChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 703, __pyx_L3_error)</span>
    __pyx_v_mainChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[26]); if (unlikely((__pyx_v_mainChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 704, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_weights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[27], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_weights.memview)) __PYX_ERR(0, 705, __pyx_L3_error)</span>
    __pyx_v_convergence_cutoff = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[28]); if (unlikely((__pyx_v_convergence_cutoff == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 706, __pyx_L3_error)</span>
    __pyx_v_max_cycle = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[29]); if (unlikely((__pyx_v_max_cycle == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 707, __pyx_L3_error)</span>
    __pyx_v_max_line_search = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[30]); if (unlikely((__pyx_v_max_line_search == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 708, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_steep_decent", 1, 31, 31, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.ligand_steep_decent", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_14ligand_steep_decent(__pyx_self, __pyx_v_ligand_xyz, __pyx_v_environment_xyz, __pyx_v_ligand_qij, __pyx_v_ligand_dljr, __pyx_v_ligand_dljep, __pyx_v_ligand_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_ligand_nonbonded, __pyx_v_ligand_nonbondedWeights, __pyx_v_ligand_coupling, __pyx_v_ligand_weights, __pyx_v_bond_atomIndex, __pyx_v_equilibrium_distance, __pyx_v_bond_force_constance, __pyx_v_angle_atomIndex, __pyx_v_equilibrium_angle, __pyx_v_angle_force_constance, __pyx_v_ligand_mask, __pyx_v_ligand_environment_qij, __pyx_v_ligand_environment_dljr, __pyx_v_ligand_environment_dljep, __pyx_v_ligand_environment_sol_prefactor, __pyx_v_environmen_lklam, __pyx_v_environment_sideChainFalgs, __pyx_v_environment_mainChainFalgs, __pyx_v_sideChainCoupling, __pyx_v_mainChainCoupling, __pyx_v_ligand_environment_weights, __pyx_v_convergence_cutoff, __pyx_v_max_cycle, __pyx_v_max_line_search);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_14ligand_steep_decent(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_environment_xyz, __Pyx_memviewslice __pyx_v_ligand_qij, __Pyx_memviewslice __pyx_v_ligand_dljr, __Pyx_memviewslice __pyx_v_ligand_dljep, __Pyx_memviewslice __pyx_v_ligand_sol_prefactor, __Pyx_memviewslice __pyx_v_ligand_lklam, __Pyx_memviewslice __pyx_v_ligand_nonbonded, __Pyx_memviewslice __pyx_v_ligand_nonbondedWeights, double __pyx_v_ligand_coupling, __Pyx_memviewslice __pyx_v_ligand_weights, __Pyx_memviewslice __pyx_v_bond_atomIndex, __Pyx_memviewslice __pyx_v_equilibrium_distance, __Pyx_memviewslice __pyx_v_bond_force_constance, __Pyx_memviewslice __pyx_v_angle_atomIndex, __Pyx_memviewslice __pyx_v_equilibrium_angle, __Pyx_memviewslice __pyx_v_angle_force_constance, __Pyx_memviewslice __pyx_v_ligand_mask, __Pyx_memviewslice __pyx_v_ligand_environment_qij, __Pyx_memviewslice __pyx_v_ligand_environment_dljr, __Pyx_memviewslice __pyx_v_ligand_environment_dljep, __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor, __Pyx_memviewslice __pyx_v_environmen_lklam, __Pyx_memviewslice __pyx_v_environment_sideChainFalgs, __Pyx_memviewslice __pyx_v_environment_mainChainFalgs, double __pyx_v_sideChainCoupling, double __pyx_v_mainChainCoupling, __Pyx_memviewslice __pyx_v_ligand_environment_weights, double __pyx_v_convergence_cutoff, int __pyx_v_max_cycle, double __pyx_v_max_line_search) {
  int __pyx_v_N;
  int __pyx_v_M;
  __Pyx_memviewslice __pyx_v_gradient_vector = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_xyz_tm = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_E_new;
  double __pyx_v_E_old;
  double __pyx_v_g_Max;
  double __pyx_v_g_norm2;
  double __pyx_v_step;
  CYTHON_UNUSED int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__8)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ligand_steep_decent", 0);
  <span class='trace'>__Pyx_TraceCall</span>("ligand_steep_decent", __pyx_f[0], 672, 0, <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_20);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_21);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_22);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_23);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_24);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_25);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_26);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_27);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_28);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_29);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.ligand_steep_decent", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_gradient_vector, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_xyz_tm, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_qij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_dljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_dljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_sol_prefactor, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_nonbonded, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_nonbondedWeights, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_weights, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_bond_atomIndex, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_equilibrium_distance, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_bond_force_constance, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_angle_atomIndex, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_equilibrium_angle, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_angle_force_constance, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_mask, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_qij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_dljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_dljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_sol_prefactor, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environmen_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_sideChainFalgs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_mainChainFalgs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_weights, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__39 = <span class='py_c_api'>PyTuple_Pack</span>(43, __pyx_n_s_ligand_xyz, __pyx_n_s_environment_xyz, __pyx_n_s_ligand_qij, __pyx_n_s_ligand_dljr, __pyx_n_s_ligand_dljep, __pyx_n_s_ligand_sol_prefactor, __pyx_n_s_ligand_lklam, __pyx_n_s_ligand_nonbonded, __pyx_n_s_ligand_nonbondedWeights, __pyx_n_s_ligand_coupling, __pyx_n_s_ligand_weights, __pyx_n_s_bond_atomIndex, __pyx_n_s_equilibrium_distance, __pyx_n_s_bond_force_constance, __pyx_n_s_angle_atomIndex, __pyx_n_s_equilibrium_angle, __pyx_n_s_angle_force_constance, __pyx_n_s_ligand_mask, __pyx_n_s_ligand_environment_qij, __pyx_n_s_ligand_environment_dljr, __pyx_n_s_ligand_environment_dljep, __pyx_n_s_ligand_environment_sol_prefactor, __pyx_n_s_environmen_lklam, __pyx_n_s_environment_sideChainFalgs, __pyx_n_s_environment_mainChainFalgs, __pyx_n_s_sideChainCoupling, __pyx_n_s_mainChainCoupling, __pyx_n_s_ligand_environment_weights, __pyx_n_s_convergence_cutoff, __pyx_n_s_max_cycle, __pyx_n_s_max_line_search, __pyx_n_s_N, __pyx_n_s_M, __pyx_n_s_gradient_vector, __pyx_n_s_xyz_tm, __pyx_n_s_E_new, __pyx_n_s_E_old, __pyx_n_s_g_Max, __pyx_n_s_g_norm2, __pyx_n_s_step, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k);<span class='error_goto'> if (unlikely(!__pyx_tuple__39)) __PYX_ERR(0, 672, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__39);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__39);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_15ligand_steep_decent, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 672, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ligand_steep_decent, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 672, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__8 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(31, 0, 43, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__39, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_ligand_steep_decent, 672, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 672, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">0673</span>:                         <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0674</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0675</span>:                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0676</span>:                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0677</span>:                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0678</span>:                         <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0679</span>:                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0680</span>:                         <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0681</span>:                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0682</span>:                         <span class="n">double</span> <span class="n">ligand_coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0683</span>:                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_weights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0684</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0685</span>:                         <span class="nb">int</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">bond_atomIndex</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0686</span>:                         <span class="n">double</span><span class="p">[:]</span> <span class="n">equilibrium_distance</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0687</span>:                         <span class="n">double</span><span class="p">[:]</span> <span class="n">bond_force_constance</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0688</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0689</span>:                         <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">angle_atomIndex</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0690</span>:                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">equilibrium_angle</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0691</span>:                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">angle_force_constance</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0692</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0693</span>:                         <span class="c">#double[:, :] ligand_xyz,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0694</span>:                         <span class="n">double</span><span class="p">[:]</span> <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0695</span>:                         <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0696</span>:                         <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0697</span>:                         <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0698</span>:                         <span class="n">double</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0699</span>:                         <span class="c">#double [:] ligand_lklam,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0700</span>:                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0701</span>:                         <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0702</span>:                         <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0703</span>:                         <span class="n">double</span> <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0704</span>:                         <span class="n">double</span> <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0705</span>:                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_environment_weights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0706</span>:                         <span class="n">double</span> <span class="n">convergence_cutoff</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0707</span>:                         <span class="nb">int</span> <span class="n">max_cycle</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0708</span>:                         <span class="n">double</span> <span class="n">max_line_search</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0709</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0710</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_ligand_xyz.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0711</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">M</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_M = (__pyx_v_ligand_xyz.shape[1]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0712</span>:     <span class="k">cdef</span> <span class="kt">double</span> [<span class="p">:,</span> <span class="p">:]</span> <span class="n">gradient_vector</span><span class="p">,</span> <span class="n">xyz_tm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0713</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">E_new</span><span class="p">,</span> <span class="nf">E_old</span><span class="p">,</span> <span class="nf">g_Max</span><span class="p">,</span> <span class="nf">g_norm2</span><span class="p">,</span> <span class="nf">step</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0714</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">k</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0715</span>: </pre>
<pre class="cython line score-42" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0716</span>:     <span class="n">gradient_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="mf">3</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></pre>
<pre class='cython code score-42 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_int_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1, __pyx_int_3);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 716, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_1, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_5, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 716, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_gradient_vector = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class="cython line score-43" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0717</span>:     <span class="n">xyz_tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></pre>
<pre class='cython code score-43 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_N);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_M);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, __pyx_t_1);
  __pyx_t_5 = 0;
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
  __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_2, __pyx_n_s_dtype, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_1, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_4, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 717, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_xyz_tm = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">0718</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0719</span>:     <span class="c">#print(&#39;BBBB initiate&#39;)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0720</span>:     <span class="c"># Compute initial energy E_old</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0721</span>:     <span class="n">E_old</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_E_old = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0722</span>:     <span class="n">E_old</span> <span class="o">+=</span> <span class="n">ligand_ligand_reduced</span><span class="p">(</span><span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>  __pyx_v_E_old = (__pyx_v_E_old + __pyx_f_6Energy_ligand_ligand_reduced(__pyx_v_ligand_xyz, __pyx_v_ligand_qij, __pyx_v_ligand_dljr, __pyx_v_ligand_dljep, __pyx_v_ligand_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_ligand_nonbonded, __pyx_v_ligand_nonbondedWeights, __pyx_v_ligand_coupling, __pyx_v_ligand_weights));
</pre><pre class="cython line score-0">&#xA0;<span class="">0723</span>:                                    <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0724</span>:                                    <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0725</span>:                                    <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0726</span>:                                    <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0727</span>:                                    <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0728</span>:                                    <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0729</span>:                                    <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0730</span>:                                    <span class="n">ligand_coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0731</span>:                                    <span class="n">ligand_weights</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0732</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0733</span>:     <span class="c"># Compute ligand_environment Energy</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0734</span>:     <span class="n">E_old</span> <span class="o">+=</span> <span class="n">ligand_environment_reduced</span><span class="p">(</span><span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>  __pyx_v_E_old = (__pyx_v_E_old + __pyx_f_6Energy_ligand_environment_reduced(__pyx_v_ligand_xyz, __pyx_v_environment_xyz, __pyx_v_ligand_mask, __pyx_v_ligand_environment_qij, __pyx_v_ligand_environment_dljr, __pyx_v_ligand_environment_dljep, __pyx_v_ligand_environment_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_environmen_lklam, __pyx_v_environment_sideChainFalgs, __pyx_v_environment_mainChainFalgs, __pyx_v_sideChainCoupling, __pyx_v_mainChainCoupling, __pyx_v_ligand_environment_weights));
</pre><pre class="cython line score-0">&#xA0;<span class="">0735</span>:                                         <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0736</span>:                                         <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0737</span>:                                         <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0738</span>:                                         <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0739</span>:                                         <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0740</span>:                                         <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0741</span>:                                         <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0742</span>:                                         <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0743</span>:                                         <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0744</span>:                                         <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0745</span>:                                         <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0746</span>:                                         <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0747</span>:                                         <span class="n">ligand_environment_weights</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0748</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0749</span>:     <span class="c"># Compute bond Energy</span></pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0750</span>:     <span class="n">E_old</span> <span class="o">+=</span> <span class="n">bond</span><span class="p">(</span><span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-25 '>  __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_E_old);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_bond);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_ligand_xyz, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
/* â€¦ */
  __pyx_t_1 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_4, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_1); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 750, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_E_old = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0751</span>:                   <span class="n">bond_atomIndex</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_bond_atomIndex, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 751, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0752</span>:                   <span class="n">equilibrium_distance</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_equilibrium_distance, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 752, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
</pre><pre class="cython line score-45" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0753</span>:                   <span class="n">bond_force_constance</span><span class="p">)</span></pre>
<pre class='cython code score-45 '>  __pyx_t_8 = __pyx_memoryview_fromslice(__pyx_v_bond_force_constance, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 753, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
  __pyx_t_9 = NULL;
  __pyx_t_10 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
      __pyx_t_10 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_1)) {
    PyObject *__pyx_temp[5] = {__pyx_t_9, __pyx_t_3, __pyx_t_5, __pyx_t_7, __pyx_t_8};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_1)) {
    PyObject *__pyx_temp[5] = {__pyx_t_9, __pyx_t_3, __pyx_t_5, __pyx_t_7, __pyx_t_8};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  } else
  #endif
  {
    __pyx_t_11 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    if (__pyx_t_9) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0, __pyx_t_9); __pyx_t_9 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 0+__pyx_t_10, __pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 1+__pyx_t_10, __pyx_t_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 2+__pyx_t_10, __pyx_t_7);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_11, 3+__pyx_t_10, __pyx_t_8);
    __pyx_t_3 = 0;
    __pyx_t_5 = 0;
    __pyx_t_7 = 0;
    __pyx_t_8 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_11, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0754</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0755</span>:     <span class="c"># Compute Angles Energy</span></pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0756</span>:     <span class="n">E_old</span> <span class="o">+=</span> <span class="n">angle</span><span class="p">(</span><span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-25 '>  __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_E_old);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 756, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_angle);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 756, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_11 = __pyx_memoryview_fromslice(__pyx_v_ligand_xyz, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 756, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
/* â€¦ */
  __pyx_t_4 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_1, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 756, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 756, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_E_old = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0757</span>:                    <span class="n">angle_atomIndex</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = __pyx_memoryview_fromslice(__pyx_v_angle_atomIndex, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 757, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0758</span>:                    <span class="n">equilibrium_angle</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>  __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_equilibrium_angle, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 758, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
</pre><pre class="cython line score-45" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0759</span>:                    <span class="n">angle_force_constance</span><span class="p">)</span></pre>
<pre class='cython code score-45 '>  __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_angle_force_constance, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 759, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_3 = NULL;
  __pyx_t_10 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
      __pyx_t_10 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_4)) {
    PyObject *__pyx_temp[5] = {__pyx_t_3, __pyx_t_11, __pyx_t_8, __pyx_t_7, __pyx_t_5};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 756, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_4)) {
    PyObject *__pyx_temp[5] = {__pyx_t_3, __pyx_t_11, __pyx_t_8, __pyx_t_7, __pyx_t_5};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_10, 4+__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 756, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  } else
  #endif
  {
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 756, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    if (__pyx_t_3) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+__pyx_t_10, __pyx_t_11);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1+__pyx_t_10, __pyx_t_8);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 2+__pyx_t_10, __pyx_t_7);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 3+__pyx_t_10, __pyx_t_5);
    __pyx_t_11 = 0;
    __pyx_t_8 = 0;
    __pyx_t_7 = 0;
    __pyx_t_5 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 756, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0760</span>:     <span class="c">#print(&#39;BBB initial energy&#39;, E_old)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0761</span>:     <span class="c"># Minimize</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0762</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_cycle</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_10 = __pyx_v_max_cycle;
  __pyx_t_13 = __pyx_t_10;
  for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
    __pyx_v_i = __pyx_t_14;
</pre><pre class="cython line score-0">&#xA0;<span class="">0763</span>:         <span class="c">#print(&#39;BBBB cycle&#39;, i)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0764</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0765</span>:         <span class="c"># rest stuff</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0766</span>:         <span class="n">g_Max</span> <span class="o">=</span> <span class="o">-</span><span class="n">DBL_MAX</span></pre>
<pre class='cython code score-0 '>    __pyx_v_g_Max = (-DBL_MAX);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0767</span>:         <span class="n">g_norm2</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_g_norm2 = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0768</span>:         <span class="n">E_new</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_E_new = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0769</span>:         <span class="c"># Reset the gradient_vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0770</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_15 = __pyx_v_N;
    __pyx_t_16 = __pyx_t_15;
    for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_16; __pyx_t_17+=1) {
      __pyx_v_j = __pyx_t_17;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0771</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = __pyx_v_j;
      __pyx_t_19 = 0;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_18 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_19 * __pyx_v_gradient_vector.strides[1]) )) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0772</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = __pyx_v_j;
      __pyx_t_18 = 1;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_19 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_18 * __pyx_v_gradient_vector.strides[1]) )) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0773</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = __pyx_v_j;
      __pyx_t_19 = 2;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_18 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_19 * __pyx_v_gradient_vector.strides[1]) )) = 0.0;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">0774</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0775</span>:         <span class="c"># Compute ligand ligand non-bonded gradient</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0776</span>:         <span class="n">ligand_ligand_gradient</span><span class="p">(</span><span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_f_6Energy_ligand_ligand_gradient(__pyx_v_ligand_xyz, __pyx_v_ligand_qij, __pyx_v_ligand_dljr, __pyx_v_ligand_dljep, __pyx_v_ligand_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_ligand_nonbonded, __pyx_v_ligand_nonbondedWeights, __pyx_v_ligand_coupling, __pyx_v_ligand_weights, __pyx_v_gradient_vector);
</pre><pre class="cython line score-0">&#xA0;<span class="">0777</span>:                                <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0778</span>:                                <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0779</span>:                                <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0780</span>:                                <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0781</span>:                                <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0782</span>:                                <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0783</span>:                                <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0784</span>:                                <span class="n">ligand_coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0785</span>:                                <span class="n">ligand_weights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0786</span>:                                <span class="n">gradient_vector</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0787</span>:         <span class="c">#for j in range(N):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0788</span>:         <span class="c">#    print(&#39;BBB grad ligand_ligand_gradient: &#39;, gradient_vector[j, 0],  gradient_vector[j, 1], gradient_vector[j, 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0789</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0790</span>:         <span class="c"># Compute ligand environment non-bonded gradient</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0791</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0792</span>:         <span class="n">ligand_environment_gradient</span><span class="p">(</span><span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_ligand_environment_gradient);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 792, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_ligand_xyz, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 792, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0793</span>:                                     <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = __pyx_memoryview_fromslice(__pyx_v_environment_xyz, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 793, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0794</span>:                                     <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_memoryview_fromslice(__pyx_v_ligand_mask, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 794, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0795</span>:                                     <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_memoryview_fromslice(__pyx_v_ligand_environment_qij, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 795, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0796</span>:                                     <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = __pyx_memoryview_fromslice(__pyx_v_ligand_environment_dljr, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 796, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0797</span>:                                     <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_memoryview_fromslice(__pyx_v_ligand_environment_dljep, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 797, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0798</span>:                                     <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_ligand_environment_sol_prefactor, 3, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 798, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0799</span>:                                     <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_20 = __pyx_memoryview_fromslice(__pyx_v_ligand_lklam, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_20)) __PYX_ERR(0, 799, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_20);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0800</span>:                                     <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_21 = __pyx_memoryview_fromslice(__pyx_v_environmen_lklam, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_21)) __PYX_ERR(0, 800, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_21);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0801</span>:                                     <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_22 = __pyx_memoryview_fromslice(__pyx_v_environment_sideChainFalgs, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 801, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0802</span>:                                     <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_23 = __pyx_memoryview_fromslice(__pyx_v_environment_mainChainFalgs, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 802, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0803</span>:                                     <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class='cython code score-5 '>    __pyx_t_24 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_sideChainCoupling);<span class='error_goto'> if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 803, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_24);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0804</span>:                                     <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class='cython code score-5 '>    __pyx_t_25 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_mainChainCoupling);<span class='error_goto'> if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 804, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0805</span>:                                     <span class="n">ligand_environment_weights</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_26 = __pyx_memoryview_fromslice(__pyx_v_ligand_environment_weights, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 805, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
</pre><pre class="cython line score-79" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0806</span>:                                     <span class="n">gradient_vector</span><span class="p">)</span></pre>
<pre class='cython code score-79 '>    __pyx_t_27 = __pyx_memoryview_fromslice(__pyx_v_gradient_vector, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_27)) __PYX_ERR(0, 806, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_27);
    __pyx_t_28 = NULL;
    __pyx_t_15 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
      __pyx_t_28 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
      if (likely(__pyx_t_28)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_28);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
        __pyx_t_15 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
      PyObject *__pyx_temp[16] = {__pyx_t_28, __pyx_t_1, __pyx_t_9, __pyx_t_5, __pyx_t_7, __pyx_t_8, __pyx_t_11, __pyx_t_3, __pyx_t_20, __pyx_t_21, __pyx_t_22, __pyx_t_23, __pyx_t_24, __pyx_t_25, __pyx_t_26, __pyx_t_27};
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_15, 15+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 792, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_28); __pyx_t_28 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_20); __pyx_t_20 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_21); __pyx_t_21 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_27); __pyx_t_27 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
      PyObject *__pyx_temp[16] = {__pyx_t_28, __pyx_t_1, __pyx_t_9, __pyx_t_5, __pyx_t_7, __pyx_t_8, __pyx_t_11, __pyx_t_3, __pyx_t_20, __pyx_t_21, __pyx_t_22, __pyx_t_23, __pyx_t_24, __pyx_t_25, __pyx_t_26, __pyx_t_27};
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_15, 15+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 792, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_28); __pyx_t_28 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_20); __pyx_t_20 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_21); __pyx_t_21 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_27); __pyx_t_27 = 0;
    } else
    #endif
    {
      __pyx_t_29 = <span class='py_c_api'>PyTuple_New</span>(15+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 792, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_29);
      if (__pyx_t_28) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_28); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 0, __pyx_t_28); __pyx_t_28 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 0+__pyx_t_15, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 1+__pyx_t_15, __pyx_t_9);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 2+__pyx_t_15, __pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 3+__pyx_t_15, __pyx_t_7);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 4+__pyx_t_15, __pyx_t_8);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 5+__pyx_t_15, __pyx_t_11);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 6+__pyx_t_15, __pyx_t_3);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_20);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 7+__pyx_t_15, __pyx_t_20);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_21);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 8+__pyx_t_15, __pyx_t_21);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_22);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 9+__pyx_t_15, __pyx_t_22);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_23);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 10+__pyx_t_15, __pyx_t_23);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_24);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 11+__pyx_t_15, __pyx_t_24);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_25);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 12+__pyx_t_15, __pyx_t_25);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_26);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 13+__pyx_t_15, __pyx_t_26);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_27);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 14+__pyx_t_15, __pyx_t_27);
      __pyx_t_1 = 0;
      __pyx_t_9 = 0;
      __pyx_t_5 = 0;
      __pyx_t_7 = 0;
      __pyx_t_8 = 0;
      __pyx_t_11 = 0;
      __pyx_t_3 = 0;
      __pyx_t_20 = 0;
      __pyx_t_21 = 0;
      __pyx_t_22 = 0;
      __pyx_t_23 = 0;
      __pyx_t_24 = 0;
      __pyx_t_25 = 0;
      __pyx_t_26 = 0;
      __pyx_t_27 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_29, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 792, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_29); __pyx_t_29 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0807</span>:         <span class="c">#for j in range(N):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0808</span>:         <span class="c">#    print(&#39;BBB grad ligand_environment_gradient: &#39;, gradient_vector[j, 0],  gradient_vector[j, 1], gradient_vector[j, 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0809</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0810</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0811</span>:         <span class="c"># Compute ligand bond gradient</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0812</span>:         <span class="n">bond_gradient</span><span class="p">(</span><span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_bond_gradient);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 812, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_29 = __pyx_memoryview_fromslice(__pyx_v_ligand_xyz, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 812, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_29);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0813</span>:                       <span class="n">bond_atomIndex</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_27 = __pyx_memoryview_fromslice(__pyx_v_bond_atomIndex, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_27)) __PYX_ERR(0, 813, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_27);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0814</span>:                       <span class="n">equilibrium_distance</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_26 = __pyx_memoryview_fromslice(__pyx_v_equilibrium_distance, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 814, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0815</span>:                       <span class="n">bond_force_constance</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_25 = __pyx_memoryview_fromslice(__pyx_v_bond_force_constance, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 815, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
</pre><pre class="cython line score-49" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0816</span>:                       <span class="n">gradient_vector</span><span class="p">)</span></pre>
<pre class='cython code score-49 '>    __pyx_t_24 = __pyx_memoryview_fromslice(__pyx_v_gradient_vector, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 816, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_24);
    __pyx_t_23 = NULL;
    __pyx_t_15 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
      __pyx_t_23 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
      if (likely(__pyx_t_23)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_23);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
        __pyx_t_15 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
      PyObject *__pyx_temp[6] = {__pyx_t_23, __pyx_t_29, __pyx_t_27, __pyx_t_26, __pyx_t_25, __pyx_t_24};
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 812, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_29); __pyx_t_29 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_27); __pyx_t_27 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
      PyObject *__pyx_temp[6] = {__pyx_t_23, __pyx_t_29, __pyx_t_27, __pyx_t_26, __pyx_t_25, __pyx_t_24};
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 812, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_29); __pyx_t_29 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_27); __pyx_t_27 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
    } else
    #endif
    {
      __pyx_t_22 = <span class='py_c_api'>PyTuple_New</span>(5+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 812, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
      if (__pyx_t_23) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_23); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0, __pyx_t_23); __pyx_t_23 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_29);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0+__pyx_t_15, __pyx_t_29);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_27);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 1+__pyx_t_15, __pyx_t_27);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_26);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 2+__pyx_t_15, __pyx_t_26);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_25);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 3+__pyx_t_15, __pyx_t_25);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_24);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 4+__pyx_t_15, __pyx_t_24);
      __pyx_t_29 = 0;
      __pyx_t_27 = 0;
      __pyx_t_26 = 0;
      __pyx_t_25 = 0;
      __pyx_t_24 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_22, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 812, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0817</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0818</span>:         <span class="c">#for j in range(N):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0819</span>:         <span class="c">#    print(&#39;BBB grad bond_gradient: &#39;, gradient_vector[j, 0],  gradient_vector[j, 1], gradient_vector[j, 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0820</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0821</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0822</span>:         <span class="c"># Compute ligand angle gradient</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0823</span>:         <span class="n">angle_gradient</span><span class="p">(</span><span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_angle_gradient);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 823, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_22 = __pyx_memoryview_fromslice(__pyx_v_ligand_xyz, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 823, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0824</span>:                       <span class="n">angle_atomIndex</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_24 = __pyx_memoryview_fromslice(__pyx_v_angle_atomIndex, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 824, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_24);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0825</span>:                       <span class="n">equilibrium_angle</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_25 = __pyx_memoryview_fromslice(__pyx_v_equilibrium_angle, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 825, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0826</span>:                       <span class="n">angle_force_constance</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_26 = __pyx_memoryview_fromslice(__pyx_v_angle_force_constance, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 826, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
</pre><pre class="cython line score-49" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0827</span>:                       <span class="n">gradient_vector</span><span class="p">)</span></pre>
<pre class='cython code score-49 '>    __pyx_t_27 = __pyx_memoryview_fromslice(__pyx_v_gradient_vector, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_27)) __PYX_ERR(0, 827, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_27);
    __pyx_t_29 = NULL;
    __pyx_t_15 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
      __pyx_t_29 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
      if (likely(__pyx_t_29)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_29);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
        __pyx_t_15 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
      PyObject *__pyx_temp[6] = {__pyx_t_29, __pyx_t_22, __pyx_t_24, __pyx_t_25, __pyx_t_26, __pyx_t_27};
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 823, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_29); __pyx_t_29 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_27); __pyx_t_27 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
      PyObject *__pyx_temp[6] = {__pyx_t_29, __pyx_t_22, __pyx_t_24, __pyx_t_25, __pyx_t_26, __pyx_t_27};
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_15, 5+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 823, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_29); __pyx_t_29 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_27); __pyx_t_27 = 0;
    } else
    #endif
    {
      __pyx_t_23 = <span class='py_c_api'>PyTuple_New</span>(5+__pyx_t_15);<span class='error_goto'> if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 823, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
      if (__pyx_t_29) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_29); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 0, __pyx_t_29); __pyx_t_29 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_22);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 0+__pyx_t_15, __pyx_t_22);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_24);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 1+__pyx_t_15, __pyx_t_24);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_25);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 2+__pyx_t_15, __pyx_t_25);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_26);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 3+__pyx_t_15, __pyx_t_26);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_27);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_23, 4+__pyx_t_15, __pyx_t_27);
      __pyx_t_22 = 0;
      __pyx_t_24 = 0;
      __pyx_t_25 = 0;
      __pyx_t_26 = 0;
      __pyx_t_27 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_23, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 823, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0828</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0829</span>:         <span class="c">#for j in range(N):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0830</span>:         <span class="c">#    print(&#39;BBB grad angle_gradient: &#39;, gradient_vector[j, 0],  gradient_vector[j, 1], gradient_vector[j, 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0831</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0832</span>:         <span class="c"># Go over the grad vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0833</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_15 = __pyx_v_N;
    __pyx_t_16 = __pyx_t_15;
    for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_16; __pyx_t_17+=1) {
      __pyx_v_j = __pyx_t_17;
</pre><pre class="cython line score-0">&#xA0;<span class="">0834</span>:             <span class="c"># Compute the dot product of grad vector. Treat it as a flat matrix</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0835</span>:             <span class="n">g_norm2</span> <span class="o">+=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = __pyx_v_j;
      __pyx_t_18 = 0;
      __pyx_t_30 = __pyx_v_j;
      __pyx_t_31 = 0;
      __pyx_v_g_norm2 = (__pyx_v_g_norm2 + ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_19 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_18 * __pyx_v_gradient_vector.strides[1]) ))) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_30 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_31 * __pyx_v_gradient_vector.strides[1]) )))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0836</span>:             <span class="n">g_norm2</span> <span class="o">+=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_31 = __pyx_v_j;
      __pyx_t_30 = 1;
      __pyx_t_18 = __pyx_v_j;
      __pyx_t_19 = 1;
      __pyx_v_g_norm2 = (__pyx_v_g_norm2 + ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_31 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_30 * __pyx_v_gradient_vector.strides[1]) ))) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_18 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_19 * __pyx_v_gradient_vector.strides[1]) )))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0837</span>:             <span class="n">g_norm2</span> <span class="o">+=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = __pyx_v_j;
      __pyx_t_18 = 2;
      __pyx_t_30 = __pyx_v_j;
      __pyx_t_31 = 2;
      __pyx_v_g_norm2 = (__pyx_v_g_norm2 + ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_19 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_18 * __pyx_v_gradient_vector.strides[1]) ))) * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_30 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_31 * __pyx_v_gradient_vector.strides[1]) )))));
</pre><pre class="cython line score-0">&#xA0;<span class="">0838</span>:             <span class="c">#print(&#39;BBB grad vector: &#39;, gradient_vector[j, 0],  gradient_vector[j, 1], gradient_vector[j, 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0839</span>:             <span class="c"># get g_Max</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0840</span>:             <span class="k">if</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">g_Max</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_31 = __pyx_v_j;
      __pyx_t_30 = 0;
      __pyx_t_32 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_31 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_30 * __pyx_v_gradient_vector.strides[1]) ))) &gt; __pyx_v_g_Max) != 0);
      if (__pyx_t_32) {
/* â€¦ */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0841</span>:                 <span class="n">g_Max</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_30 = __pyx_v_j;
        __pyx_t_31 = 0;
        __pyx_v_g_Max = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_30 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_31 * __pyx_v_gradient_vector.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0842</span>:             <span class="k">if</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">g_Max</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_31 = __pyx_v_j;
      __pyx_t_30 = 1;
      __pyx_t_32 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_31 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_30 * __pyx_v_gradient_vector.strides[1]) ))) &gt; __pyx_v_g_Max) != 0);
      if (__pyx_t_32) {
/* â€¦ */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0843</span>:                 <span class="n">g_Max</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_30 = __pyx_v_j;
        __pyx_t_31 = 1;
        __pyx_v_g_Max = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_30 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_31 * __pyx_v_gradient_vector.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0844</span>:             <span class="k">if</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">g_Max</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_31 = __pyx_v_j;
      __pyx_t_30 = 2;
      __pyx_t_32 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_31 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_30 * __pyx_v_gradient_vector.strides[1]) ))) &gt; __pyx_v_g_Max) != 0);
      if (__pyx_t_32) {
/* â€¦ */
      }
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0845</span>:                 <span class="n">g_Max</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_30 = __pyx_v_j;
        __pyx_t_31 = 2;
        __pyx_v_g_Max = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_30 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_31 * __pyx_v_gradient_vector.strides[1]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">0846</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0847</span>:         <span class="c"># Choose a Step size such that g_Max*Step = 0.5</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0848</span>:         <span class="k">if</span> <span class="n">g_Max</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_32 = ((__pyx_v_g_Max == 0.0) != 0);
    if (__pyx_t_32) {
/* â€¦ */
      goto __pyx_L12;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0849</span>:             <span class="n">step</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_step = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0850</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0851</span>:             <span class="n">step</span> <span class="o">=</span> <span class="n">max_line_search</span><span class="o">/</span><span class="n">g_Max</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_step = (__pyx_v_max_line_search / __pyx_v_g_Max);
    }
    __pyx_L12:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0852</span>:         <span class="c">#step = 0.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0853</span>:         <span class="c">#print(&#39;BBB g_max&#39;, g_Max, &#39;max_line_search&#39;, max_line_search, &#39;step&#39;, step)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0854</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0855</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">10000</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    for (__pyx_t_15 = 0; __pyx_t_15 &lt; 0x2710; __pyx_t_15+=1) {
      __pyx_v_j = __pyx_t_15;
</pre><pre class="cython line score-0">&#xA0;<span class="">0856</span>:             <span class="c">#print(&#39;initiate line search&#39;)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0857</span>:             <span class="c">#return 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0858</span>:             <span class="c"># Get the new coordinate</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0859</span>:             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = __pyx_v_N;
      __pyx_t_17 = __pyx_t_16;
      for (__pyx_t_33 = 0; __pyx_t_33 &lt; __pyx_t_17; __pyx_t_33+=1) {
        __pyx_v_k = __pyx_t_33;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0860</span>:                 <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">step</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_31 = __pyx_v_k;
        __pyx_t_30 = 0;
        __pyx_t_18 = __pyx_v_k;
        __pyx_t_19 = 0;
        __pyx_t_34 = __pyx_v_k;
        __pyx_t_35 = 0;
        *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_34 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_35 * __pyx_v_xyz_tm.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_31 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_30 * __pyx_v_ligand_xyz.strides[1]) ))) + ((-1.0 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_18 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_19 * __pyx_v_gradient_vector.strides[1]) )))) * __pyx_v_step));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0861</span>:                 <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">step</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_19 = __pyx_v_k;
        __pyx_t_18 = 1;
        __pyx_t_30 = __pyx_v_k;
        __pyx_t_31 = 1;
        __pyx_t_35 = __pyx_v_k;
        __pyx_t_34 = 1;
        *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_35 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_34 * __pyx_v_xyz_tm.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_19 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_18 * __pyx_v_ligand_xyz.strides[1]) ))) + ((-1.0 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_30 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_31 * __pyx_v_gradient_vector.strides[1]) )))) * __pyx_v_step));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0862</span>:                 <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">step</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_31 = __pyx_v_k;
        __pyx_t_30 = 2;
        __pyx_t_18 = __pyx_v_k;
        __pyx_t_19 = 2;
        __pyx_t_34 = __pyx_v_k;
        __pyx_t_35 = 2;
        *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_34 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_35 * __pyx_v_xyz_tm.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_31 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_30 * __pyx_v_ligand_xyz.strides[1]) ))) + ((-1.0 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_18 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_19 * __pyx_v_gradient_vector.strides[1]) )))) * __pyx_v_step));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">0863</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0864</span>:             <span class="c"># compute E_new</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0865</span>:             <span class="c"># Compute ligand_ligand Energy</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0866</span>:             <span class="n">E_new</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_E_new = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0867</span>:             <span class="n">E_new</span> <span class="o">+=</span> <span class="n">ligand_ligand_reduced</span><span class="p">(</span><span class="n">xyz_tm</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>      __pyx_v_E_new = (__pyx_v_E_new + __pyx_f_6Energy_ligand_ligand_reduced(__pyx_v_xyz_tm, __pyx_v_ligand_qij, __pyx_v_ligand_dljr, __pyx_v_ligand_dljep, __pyx_v_ligand_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_ligand_nonbonded, __pyx_v_ligand_nonbondedWeights, __pyx_v_ligand_coupling, __pyx_v_ligand_weights));
</pre><pre class="cython line score-0">&#xA0;<span class="">0868</span>:                                            <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0869</span>:                                            <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0870</span>:                                            <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0871</span>:                                            <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0872</span>:                                            <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0873</span>:                                            <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0874</span>:                                            <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0875</span>:                                            <span class="n">ligand_coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0876</span>:                                            <span class="n">ligand_weights</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0877</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0878</span>:             <span class="c"># Compute ligand_environment Energy</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0879</span>:             <span class="n">E_new</span> <span class="o">+=</span> <span class="n">ligand_environment_reduced</span><span class="p">(</span><span class="n">xyz_tm</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>      __pyx_v_E_new = (__pyx_v_E_new + __pyx_f_6Energy_ligand_environment_reduced(__pyx_v_xyz_tm, __pyx_v_environment_xyz, __pyx_v_ligand_mask, __pyx_v_ligand_environment_qij, __pyx_v_ligand_environment_dljr, __pyx_v_ligand_environment_dljep, __pyx_v_ligand_environment_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_environmen_lklam, __pyx_v_environment_sideChainFalgs, __pyx_v_environment_mainChainFalgs, __pyx_v_sideChainCoupling, __pyx_v_mainChainCoupling, __pyx_v_ligand_environment_weights));
</pre><pre class="cython line score-0">&#xA0;<span class="">0880</span>:                                                 <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0881</span>:                                                 <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0882</span>:                                                 <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0883</span>:                                                 <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0884</span>:                                                 <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0885</span>:                                                 <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0886</span>:                                                 <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0887</span>:                                                 <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0888</span>:                                                 <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0889</span>:                                                 <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0890</span>:                                                 <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0891</span>:                                                 <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0892</span>:                                                 <span class="n">ligand_environment_weights</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0893</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0894</span>:             <span class="c"># Compute bond Energy</span></pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0895</span>:             <span class="n">E_new</span> <span class="o">+=</span> <span class="n">bond</span><span class="p">(</span><span class="n">xyz_tm</span><span class="p">,</span></pre>
<pre class='cython code score-25 '>      __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_E_new);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 895, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_23, __pyx_n_s_bond);<span class='error_goto'> if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 895, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
      __pyx_t_27 = __pyx_memoryview_fromslice(__pyx_v_xyz_tm, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_27)) __PYX_ERR(0, 895, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_27);
/* â€¦ */
      __pyx_t_23 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_4, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 895, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_23); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 895, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
      __pyx_v_E_new = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0896</span>:                           <span class="n">bond_atomIndex</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>      __pyx_t_26 = __pyx_memoryview_fromslice(__pyx_v_bond_atomIndex, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 896, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0897</span>:                           <span class="n">equilibrium_distance</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>      __pyx_t_25 = __pyx_memoryview_fromslice(__pyx_v_equilibrium_distance, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 897, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
</pre><pre class="cython line score-45" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0898</span>:                           <span class="n">bond_force_constance</span><span class="p">)</span></pre>
<pre class='cython code score-45 '>      __pyx_t_24 = __pyx_memoryview_fromslice(__pyx_v_bond_force_constance, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 898, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_24);
      __pyx_t_22 = NULL;
      __pyx_t_16 = 0;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_23))) {
        __pyx_t_22 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_23);
        if (likely(__pyx_t_22)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_23);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_22);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_23, function);
          __pyx_t_16 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_23)) {
        PyObject *__pyx_temp[5] = {__pyx_t_22, __pyx_t_27, __pyx_t_26, __pyx_t_25, __pyx_t_24};
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_23, __pyx_temp+1-__pyx_t_16, 4+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 895, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_27); __pyx_t_27 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_23)) {
        PyObject *__pyx_temp[5] = {__pyx_t_22, __pyx_t_27, __pyx_t_26, __pyx_t_25, __pyx_t_24};
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_23, __pyx_temp+1-__pyx_t_16, 4+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 895, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_27); __pyx_t_27 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
      } else
      #endif
      {
        __pyx_t_29 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 895, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_29);
        if (__pyx_t_22) {
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_22); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 0, __pyx_t_22); __pyx_t_22 = NULL;
        }
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_27);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 0+__pyx_t_16, __pyx_t_27);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_26);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 1+__pyx_t_16, __pyx_t_26);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_25);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 2+__pyx_t_16, __pyx_t_25);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_24);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_29, 3+__pyx_t_16, __pyx_t_24);
        __pyx_t_27 = 0;
        __pyx_t_26 = 0;
        __pyx_t_25 = 0;
        __pyx_t_24 = 0;
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_23, __pyx_t_29, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 895, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_29); __pyx_t_29 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0899</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0900</span>:             <span class="c"># Compute Angles Energy</span></pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0901</span>:             <span class="n">E_new</span> <span class="o">+=</span> <span class="n">angle</span><span class="p">(</span><span class="n">xyz_tm</span><span class="p">,</span></pre>
<pre class='cython code score-25 '>      __pyx_t_23 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_E_new);<span class='error_goto'> if (unlikely(!__pyx_t_23)) __PYX_ERR(0, 901, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_23);
      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_angle);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 901, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_29 = __pyx_memoryview_fromslice(__pyx_v_xyz_tm, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_29)) __PYX_ERR(0, 901, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_29);
/* â€¦ */
      __pyx_t_4 = <span class='py_c_api'>PyNumber_InPlaceAdd</span>(__pyx_t_23, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 901, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_23); __pyx_t_23 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_4); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 901, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_v_E_new = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0902</span>:                            <span class="n">angle_atomIndex</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>      __pyx_t_24 = __pyx_memoryview_fromslice(__pyx_v_angle_atomIndex, 2, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_24)) __PYX_ERR(0, 902, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_24);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0903</span>:                            <span class="n">equilibrium_angle</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>      __pyx_t_25 = __pyx_memoryview_fromslice(__pyx_v_equilibrium_angle, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_25)) __PYX_ERR(0, 903, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_25);
</pre><pre class="cython line score-45" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0904</span>:                            <span class="n">angle_force_constance</span><span class="p">)</span></pre>
<pre class='cython code score-45 '>      __pyx_t_26 = __pyx_memoryview_fromslice(__pyx_v_angle_force_constance, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_26)) __PYX_ERR(0, 904, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_26);
      __pyx_t_27 = NULL;
      __pyx_t_16 = 0;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
        __pyx_t_27 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
        if (likely(__pyx_t_27)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_27);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
          __pyx_t_16 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_4)) {
        PyObject *__pyx_temp[5] = {__pyx_t_27, __pyx_t_29, __pyx_t_24, __pyx_t_25, __pyx_t_26};
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_16, 4+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 901, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_27); __pyx_t_27 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_29); __pyx_t_29 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_4)) {
        PyObject *__pyx_temp[5] = {__pyx_t_27, __pyx_t_29, __pyx_t_24, __pyx_t_25, __pyx_t_26};
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_4, __pyx_temp+1-__pyx_t_16, 4+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 901, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_27); __pyx_t_27 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_29); __pyx_t_29 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_24); __pyx_t_24 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_25); __pyx_t_25 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_26); __pyx_t_26 = 0;
      } else
      #endif
      {
        __pyx_t_22 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_16);<span class='error_goto'> if (unlikely(!__pyx_t_22)) __PYX_ERR(0, 901, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_22);
        if (__pyx_t_27) {
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_27); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0, __pyx_t_27); __pyx_t_27 = NULL;
        }
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_29);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 0+__pyx_t_16, __pyx_t_29);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_24);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 1+__pyx_t_16, __pyx_t_24);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_25);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 2+__pyx_t_16, __pyx_t_25);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_26);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_22, 3+__pyx_t_16, __pyx_t_26);
        __pyx_t_29 = 0;
        __pyx_t_24 = 0;
        __pyx_t_25 = 0;
        __pyx_t_26 = 0;
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_22, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 901, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_22); __pyx_t_22 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0905</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0906</span>:             <span class="c">#print(&#39;     line search step &#39;, j, &#39;BBB E_new&#39;, E_new, &#39;step&#39;, step, &#39;condition&#39;, E_old)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0907</span>:             <span class="k">if</span> <span class="n">E_new</span> <span class="o">&gt;</span> <span class="n">E_old</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_32 = ((__pyx_v_E_new &gt; __pyx_v_E_old) != 0);
      if (__pyx_t_32) {
/* â€¦ */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0908</span>:                 <span class="n">step</span> <span class="o">*=</span> <span class="mf">0.5</span></pre>
<pre class='cython code score-0 '>        __pyx_v_step = (__pyx_v_step * 0.5);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0909</span>:                 <span class="k">continue</span></pre>
<pre class='cython code score-0 '>        goto __pyx_L13_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">0910</span>:             <span class="k">else</span><span class="p">:</span>  <span class="c"># accept the move</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0911</span>:                 <span class="k">break</span></pre>
<pre class='cython code score-0 '>      /*else*/ {
        goto __pyx_L14_break;
      }
      __pyx_L13_continue:;
    }
    __pyx_L14_break:;
</pre><pre class="cython line score-0">&#xA0;<span class="">0912</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0913</span>:         <span class="c">#update xyz</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0914</span>:         <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_15 = __pyx_v_N;
    __pyx_t_16 = __pyx_t_15;
    for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_16; __pyx_t_17+=1) {
      __pyx_v_k = __pyx_t_17;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0915</span>:             <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = __pyx_v_k;
      __pyx_t_18 = 0;
      __pyx_t_30 = __pyx_v_k;
      __pyx_t_31 = 0;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_30 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_31 * __pyx_v_ligand_xyz.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_19 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0916</span>:             <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_18 = __pyx_v_k;
      __pyx_t_19 = 1;
      __pyx_t_31 = __pyx_v_k;
      __pyx_t_30 = 1;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_31 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_30 * __pyx_v_ligand_xyz.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_18 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_19 * __pyx_v_xyz_tm.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0917</span>:             <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = __pyx_v_k;
      __pyx_t_18 = 2;
      __pyx_t_30 = __pyx_v_k;
      __pyx_t_31 = 2;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_30 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_31 * __pyx_v_ligand_xyz.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_19 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[1]) )));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">0918</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0919</span>:         <span class="c">#print(&#39;Final energy&#39;, E_old)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0920</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0921</span>:         <span class="c"># Quite if energy converges</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0922</span>:         <span class="k">if</span> <span class="n">fabs</span><span class="p">(</span><span class="n">E_new</span> <span class="o">-</span> <span class="n">E_old</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">convergence_cutoff</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_32 = ((fabs((__pyx_v_E_new - __pyx_v_E_old)) &lt; __pyx_v_convergence_cutoff) != 0);
    if (__pyx_t_32) {
/* â€¦ */
    }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0923</span>:             <span class="k">return</span> <span class="mf">0</span></pre>
<pre class='cython code score-2 '>      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_0);
      __pyx_r = __pyx_int_0;
      goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0924</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0925</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0926</span>:             <span class="n">E_old</span> <span class="o">=</span> <span class="n">E_new</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_E_old = __pyx_v_E_new;
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">0927</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0928</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0929</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0930</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0931</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0932</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0933</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0934</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0935</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ligand_ligand_gradient</span><span class="p">(</span><span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE void __pyx_f_6Energy_ligand_ligand_gradient(__Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_ligand_qij, __Pyx_memviewslice __pyx_v_ligand_dljr, __Pyx_memviewslice __pyx_v_ligand_dljep, __Pyx_memviewslice __pyx_v_ligand_sol_prefactor, __Pyx_memviewslice __pyx_v_ligand_lklam, __Pyx_memviewslice __pyx_v_ligand_nonbonded, __Pyx_memviewslice __pyx_v_ligand_nonbondedWeights, double __pyx_v_ligand_coupling, __Pyx_memviewslice __pyx_v_ligand_weights, __Pyx_memviewslice __pyx_v_gradient_vector) {
  int __pyx_v_N;
  int __pyx_v_i;
  int __pyx_v_j;
  double __pyx_v_dxij;
  double __pyx_v_dyij;
  double __pyx_v_dzij;
  double __pyx_v_dij;
  double __pyx_v_dlj_dij;
  double __pyx_v_dlj_dij3;
  double __pyx_v_dlj_dij6;
  double __pyx_v_dlj_dij12;
  double __pyx_v_epsilon;
  double __pyx_v_s;
  double __pyx_v_s_p;
  double __pyx_v_sol_expfactor_i;
  double __pyx_v_sol_expfactor_j;
  double __pyx_v_rep;
  double __pyx_v_atr;
  double __pyx_v_col;
  double __pyx_v_sol;
  double __pyx_v_grad_magnititude;
  int __pyx_v_pair;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ligand_ligand_gradient", 0);
  <span class='trace'>__Pyx_TraceCall</span>("ligand_ligand_gradient", __pyx_f[0], 935, 0, <span class='error_goto'>__PYX_ERR(0, 935, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("Energy.ligand_ligand_gradient", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0">&#xA0;<span class="">0936</span>:                                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0937</span>:                                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0938</span>:                                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0939</span>:                                         <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0940</span>:                                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0941</span>:                                         <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0942</span>:                                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0943</span>:                                         <span class="n">double</span> <span class="n">ligand_coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0944</span>:                                         <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_weights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0945</span>:                                         <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">gradient_vector</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0946</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0947</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">ligand_nonbonded</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_ligand_nonbonded.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">0948</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0949</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dxij</span><span class="p">,</span> <span class="nf">dyij</span><span class="p">,</span> <span class="nf">dzij</span><span class="p">,</span> <span class="nf">dij</span><span class="p">,</span> <span class="nf">dlj</span><span class="p">,</span> <span class="nf">dlj_dij</span><span class="p">,</span> <span class="nf">dlj_dij3</span><span class="p">,</span> <span class="nf">dlj_dij6</span><span class="p">,</span> <span class="nf">dlj_dij12</span><span class="p">,</span> <span class="nf">epsilon</span><span class="p">,</span> <span class="nf">s</span><span class="p">,</span> <span class="nf">s_p</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0950</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sol_expfactor_i</span><span class="p">,</span> <span class="nf">sol_expfactor_j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0951</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">rep</span><span class="p">,</span> <span class="nf">atr</span><span class="p">,</span> <span class="nf">col</span><span class="p">,</span> <span class="nf">sol</span><span class="p">,</span> <span class="nf">grad_magnititude</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0952</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0953</span>:     <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_pair = __pyx_t_3;
</pre><pre class="cython line score-0">&#xA0;<span class="">0954</span>:             <span class="c"># Assuming fist element in pair is i and the other is j</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0955</span>:             <span class="n">i</span> <span class="o">=</span> <span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_pair;
    __pyx_t_5 = 0;
    __pyx_v_i = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_4 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_nonbonded.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0956</span>:             <span class="n">j</span> <span class="o">=</span> <span class="n">ligand_nonbonded</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_pair;
    __pyx_t_4 = 1;
    __pyx_v_j = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_nonbonded.data + __pyx_t_5 * __pyx_v_ligand_nonbonded.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_nonbonded.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0957</span>:             <span class="n">dxij</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_i;
    __pyx_t_7 = 0;
    __pyx_v_dxij = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_6 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0958</span>:             <span class="n">dyij</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_j;
    __pyx_t_6 = 1;
    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = 1;
    __pyx_v_dyij = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_7 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_6 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_5 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0959</span>:             <span class="n">dzij</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = 2;
    __pyx_t_6 = __pyx_v_i;
    __pyx_t_7 = 2;
    __pyx_v_dzij = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_6 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0960</span>:             <span class="n">dij</span> <span class="o">=</span> <span class="n">dxij</span> <span class="o">*</span> <span class="n">dxij</span> <span class="o">+</span> <span class="n">dyij</span> <span class="o">*</span> <span class="n">dyij</span> <span class="o">+</span> <span class="n">dzij</span> <span class="o">*</span> <span class="n">dzij</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dij = (((__pyx_v_dxij * __pyx_v_dxij) + (__pyx_v_dyij * __pyx_v_dyij)) + (__pyx_v_dzij * __pyx_v_dzij));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0961</span>:             <span class="n">dij</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dij</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dij = sqrt(__pyx_v_dij);
</pre><pre class="cython line score-0">&#xA0;<span class="">0962</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0963</span>:             <span class="c">#dlj = ligand_dljr[pair]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0964</span>:             <span class="c">#eij = ligand_dljep[pair]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">0965</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0966</span>:             <span class="c"># Compute rep gradient magnitude</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0967</span>:             <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_pair;
    __pyx_t_8 = ((__pyx_v_dij &lt;= (0.6 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_7 * __pyx_v_ligand_dljr.strides[0]) ))))) != 0);
    if (__pyx_t_8) {
/* â€¦ */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">0968</span>:                 <span class="c"># constant, replacing dij = 0.6*dljr</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0969</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="mf">1</span><span class="o">/</span><span class="mf">0.6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij = (1.0 / 0.6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0970</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0971</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0972</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0973</span>:                 <span class="n">rep</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">12</span> <span class="o">*</span> <span class="n">ligand_dljep</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mf">0.6</span> <span class="o">*</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="n">dlj_dij6</span><span class="p">)</span> <span class="c">#- (dlj_dij*dij)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_7 = __pyx_v_pair;
      __pyx_t_6 = __pyx_v_pair;
      __pyx_v_rep = (((-12.0 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljep.data + __pyx_t_7 * __pyx_v_ligand_dljep.strides[0]) )))) / (0.6 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) ))))) * (__pyx_v_dlj_dij12 - __pyx_v_dlj_dij6));
</pre><pre class="cython line score-0">&#xA0;<span class="">0974</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0975</span>:             <span class="k">elif</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_v_pair;
    __pyx_t_9 = (((0.6 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) )))) &lt; __pyx_v_dij) != 0);
    if (__pyx_t_9) {
    } else {
      __pyx_t_8 = __pyx_t_9;
      goto __pyx_L6_bool_binop_done;
    }
    __pyx_t_6 = __pyx_v_pair;
    __pyx_t_9 = ((__pyx_v_dij &lt;= (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) )))) != 0);
    __pyx_t_8 = __pyx_t_9;
    __pyx_L6_bool_binop_done:;
    if (__pyx_t_8) {
/* â€¦ */
      goto __pyx_L5;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0976</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span></pre>
<pre class='cython code score-0 '>      __pyx_t_6 = __pyx_v_pair;
      __pyx_v_dlj_dij = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) ))) / __pyx_v_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0977</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0978</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0979</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0980</span>:                 <span class="n">rep</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">12</span> <span class="o">*</span> <span class="n">ligand_dljep</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="n">dlj_dij6</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_6 = __pyx_v_pair;
      __pyx_v_rep = (((-12.0 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljep.data + __pyx_t_6 * __pyx_v_ligand_dljep.strides[0]) )))) / __pyx_v_dij) * (__pyx_v_dlj_dij12 - __pyx_v_dlj_dij6));
</pre><pre class="cython line score-0">&#xA0;<span class="">0981</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0982</span>:             <span class="k">elif</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dij</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_v_pair;
    __pyx_t_8 = (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) ))) &lt; __pyx_v_dij) != 0);
    if (__pyx_t_8) {
/* â€¦ */
    }
    __pyx_L5:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0983</span>:                 <span class="n">rep</span> <span class="o">=</span>  <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_rep = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0984</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">0985</span>:             <span class="c"># Compute atr</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0986</span>:             <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_v_pair;
    __pyx_t_8 = ((__pyx_v_dij &lt;= (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) )))) != 0);
    if (__pyx_t_8) {
/* â€¦ */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">0987</span>:                 <span class="c">#atr = ligand_dljep[pair]</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0988</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_atr = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">0989</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0990</span>:             <span class="k">elif</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_v_pair;
    __pyx_t_9 = (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) ))) &lt; __pyx_v_dij) != 0);
    if (__pyx_t_9) {
    } else {
      __pyx_t_8 = __pyx_t_9;
      goto __pyx_L9_bool_binop_done;
    }
    __pyx_t_9 = ((__pyx_v_dij &lt;= 4.5) != 0);
    __pyx_t_8 = __pyx_t_9;
    __pyx_L9_bool_binop_done:;
    if (__pyx_t_8) {
/* â€¦ */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0991</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span></pre>
<pre class='cython code score-0 '>      __pyx_t_6 = __pyx_v_pair;
      __pyx_v_dlj_dij = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) ))) / __pyx_v_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0992</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0993</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0994</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0">&#xA0;<span class="">0995</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0996</span>:                 <span class="n">atr</span> <span class="o">=</span>  <span class="p">(</span><span class="o">-</span><span class="mf">12</span> <span class="o">*</span> <span class="n">ligand_dljep</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="n">dlj_dij6</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_6 = __pyx_v_pair;
      __pyx_v_atr = (((-12.0 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljep.data + __pyx_t_6 * __pyx_v_ligand_dljep.strides[0]) )))) / __pyx_v_dij) * (__pyx_v_dlj_dij12 - __pyx_v_dlj_dij6));
</pre><pre class="cython line score-0">&#xA0;<span class="">0997</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0998</span>:             <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">6.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((4.5 &lt; __pyx_v_dij) != 0);
    if (__pyx_t_9) {
    } else {
      __pyx_t_8 = __pyx_t_9;
      goto __pyx_L11_bool_binop_done;
    }
    __pyx_t_9 = ((__pyx_v_dij &lt;= 6.0) != 0);
    __pyx_t_8 = __pyx_t_9;
    __pyx_L11_bool_binop_done:;
    if (__pyx_t_8) {
/* â€¦ */
      goto __pyx_L8;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">0999</span>:                 <span class="n">dlj_dij</span> <span class="o">=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span></pre>
<pre class='cython code score-0 '>      __pyx_t_6 = __pyx_v_pair;
      __pyx_v_dlj_dij = ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) ))) / __pyx_v_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1000</span>:                 <span class="n">dlj_dij3</span> <span class="o">=</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span> <span class="o">*</span> <span class="n">dlj_dij</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij3 = ((__pyx_v_dlj_dij * __pyx_v_dlj_dij) * __pyx_v_dlj_dij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1001</span>:                 <span class="n">dlj_dij6</span> <span class="o">=</span> <span class="n">dlj_dij3</span> <span class="o">*</span> <span class="n">dlj_dij3</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij6 = (__pyx_v_dlj_dij3 * __pyx_v_dlj_dij3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1002</span>:                 <span class="n">dlj_dij12</span> <span class="o">=</span> <span class="n">dlj_dij6</span> <span class="o">*</span> <span class="n">dlj_dij6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dlj_dij12 = (__pyx_v_dlj_dij6 * __pyx_v_dlj_dij6);
</pre><pre class="cython line score-0">&#xA0;<span class="">1003</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1004</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="o">-</span><span class="mf">12</span> <span class="o">*</span> <span class="n">ligand_dljep</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">dij</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="n">dlj_dij6</span><span class="p">)</span> <span class="o">*</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">))</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>      __pyx_t_6 = __pyx_v_pair;
/* â€¦ */
      __pyx_v_atr = (((((-12.0 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljep.data + __pyx_t_6 * __pyx_v_ligand_dljep.strides[0]) )))) / __pyx_v_dij) * (__pyx_v_dlj_dij12 - __pyx_v_dlj_dij6)) * __pyx_f_6Energy_switch(__pyx_v_dij, 4.5, 6.0)) + (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljep.data + __pyx_t_7 * __pyx_v_ligand_dljep.strides[0]) ))) * (__pyx_v_dlj_dij12 - (2.0 * __pyx_v_dlj_dij6))) * __pyx_f_6Energy_switch_gradient(__pyx_v_dij, 4.5, 6.0)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1005</span>:                              <span class="p">(</span> <span class="n">ligand_dljep</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dij12</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2</span> <span class="o">*</span> <span class="n">dlj_dij6</span><span class="p">))</span> <span class="o">*</span> <span class="n">switch_gradient</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>      __pyx_t_7 = __pyx_v_pair;
</pre><pre class="cython line score-0">&#xA0;<span class="">1006</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1007</span>:             <span class="k">elif</span> <span class="mf">6.0</span> <span class="o">&lt;</span> <span class="n">dij</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((6.0 &lt; __pyx_v_dij) != 0);
    if (__pyx_t_8) {
/* â€¦ */
    }
    __pyx_L8:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1008</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_atr = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1009</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1010</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1011</span>:             <span class="c"># compute electrostatic</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1012</span>:             <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">6</span></pre>
<pre class='cython code score-0 '>    __pyx_v_epsilon = 6.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1013</span>:             <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">1.45</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = ((__pyx_v_dij &lt; 1.45) != 0);
    if (__pyx_t_8) {
/* â€¦ */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1014</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="o">-</span><span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.45</span> <span class="o">*</span> <span class="mf">1.45</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_7 = __pyx_v_pair;
      __pyx_v_col = ((-(*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_7 * __pyx_v_ligand_qij.strides[0]) )))) / ((1.45 * 1.45) * __pyx_v_epsilon));
</pre><pre class="cython line score-0">&#xA0;<span class="">1015</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1016</span>:             <span class="k">elif</span> <span class="mf">1.45</span> <span class="o">&lt;=</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">1.85</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((1.45 &lt;= __pyx_v_dij) != 0);
    if (__pyx_t_9) {
    } else {
      __pyx_t_8 = __pyx_t_9;
      goto __pyx_L14_bool_binop_done;
    }
    __pyx_t_9 = ((__pyx_v_dij &lt; 1.85) != 0);
    __pyx_t_8 = __pyx_t_9;
    __pyx_L14_bool_binop_done:;
    if (__pyx_t_8) {
/* â€¦ */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1017</span>:                 <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dij, 1.45, 1.85);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1018</span>:                 <span class="n">s_p</span> <span class="o">=</span> <span class="n">switch_gradient</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_s_p = __pyx_f_6Energy_switch_gradient(__pyx_v_dij, 1.45, 1.85);
</pre><pre class="cython line score-0">&#xA0;<span class="">1019</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1020</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.45</span> <span class="o">*</span> <span class="mf">1.45</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>      __pyx_t_7 = __pyx_v_pair;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1021</span>:                       <span class="p">((</span><span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span> <span class="p">(</span><span class="mf">1.45</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">))</span> <span class="o">*</span> <span class="n">s_p</span><span class="p">)</span> <span class="o">+</span>       \</pre>
<pre class='cython code score-0 '>      __pyx_t_6 = __pyx_v_pair;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1022</span>:                       <span class="p">((</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>      __pyx_t_5 = __pyx_v_pair;
/* â€¦ */
      __pyx_v_col = ((((((-(*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_7 * __pyx_v_ligand_qij.strides[0]) )))) / ((1.45 * 1.45) * __pyx_v_epsilon)) * __pyx_v_s) + (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_6 * __pyx_v_ligand_qij.strides[0]) ))) / (1.45 * __pyx_v_epsilon)) * __pyx_v_s_p)) + ((((-2.0 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_5 * __pyx_v_ligand_qij.strides[0]) )))) / __pyx_v_epsilon) * (1.0 / ((__pyx_v_dij * __pyx_v_dij) * __pyx_v_dij))) * (1.0 - __pyx_v_s))) + ((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_4 * __pyx_v_ligand_qij.strides[0]) ))) / __pyx_v_epsilon) * ((1.0 / (__pyx_v_dij * __pyx_v_dij)) - (1.0 / (5.5 * 5.5)))) * (-__pyx_v_s_p)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1023</span>:                       <span class="p">((</span><span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span><span class="o">/</span><span class="p">(</span><span class="mf">5.5</span> <span class="o">*</span> <span class="mf">5.5</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">s_p</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>      __pyx_t_4 = __pyx_v_pair;
</pre><pre class="cython line score-0">&#xA0;<span class="">1024</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1025</span>:             <span class="k">elif</span> <span class="mf">1.85</span> <span class="o">&lt;=</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((1.85 &lt;= __pyx_v_dij) != 0);
    if (__pyx_t_9) {
    } else {
      __pyx_t_8 = __pyx_t_9;
      goto __pyx_L16_bool_binop_done;
    }
    __pyx_t_9 = ((__pyx_v_dij &lt; 4.5) != 0);
    __pyx_t_8 = __pyx_t_9;
    __pyx_L16_bool_binop_done:;
    if (__pyx_t_8) {
/* â€¦ */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1026</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="p">))</span> <span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_4 = __pyx_v_pair;
      __pyx_v_col = (((-2.0 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_4 * __pyx_v_ligand_qij.strides[0]) )))) / __pyx_v_epsilon) * (1.0 / ((__pyx_v_dij * __pyx_v_dij) * __pyx_v_dij)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1027</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1028</span>:             <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;=</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;</span> <span class="mf">5.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = ((4.5 &lt;= __pyx_v_dij) != 0);
    if (__pyx_t_9) {
    } else {
      __pyx_t_8 = __pyx_t_9;
      goto __pyx_L18_bool_binop_done;
    }
    __pyx_t_9 = ((__pyx_v_dij &lt; 5.5) != 0);
    __pyx_t_8 = __pyx_t_9;
    __pyx_L18_bool_binop_done:;
    if (__pyx_t_8) {
/* â€¦ */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1029</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span> <span class="p">)</span> <span class="o">+</span>  \</pre>
<pre class='cython code score-0 '>      __pyx_t_4 = __pyx_v_pair;
/* â€¦ */
      __pyx_v_col = (((((-2.0 * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_4 * __pyx_v_ligand_qij.strides[0]) )))) / __pyx_v_epsilon) * (1.0 / ((__pyx_v_dij * __pyx_v_dij) * __pyx_v_dij))) * __pyx_v_s) + ((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_qij.data + __pyx_t_5 * __pyx_v_ligand_qij.strides[0]) ))) / __pyx_v_epsilon) * ((1.0 / (__pyx_v_dij * __pyx_v_dij)) - (1.0 / (5.5 * 5.5)))) * __pyx_f_6Energy_switch_gradient(__pyx_v_dij, 4.5, 5.5)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1030</span>:                       <span class="p">(</span> <span class="p">(</span><span class="n">ligand_qij</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span><span class="o">/</span><span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1</span><span class="o">/</span><span class="p">(</span><span class="n">dij</span><span class="o">*</span><span class="n">dij</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span><span class="o">/</span><span class="p">(</span><span class="mf">5.5</span><span class="o">*</span><span class="mf">5.5</span><span class="p">)))</span> <span class="o">*</span> <span class="n">switch_gradient</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">)</span> <span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_5 = __pyx_v_pair;
</pre><pre class="cython line score-0">&#xA0;<span class="">1031</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1032</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1033</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_col = 0.0;
    }
    __pyx_L13:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1034</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1035</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1036</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1037</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1038</span>:             <span class="c"># compute solvation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1039</span>:             <span class="n">sol</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sol = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1040</span>:             <span class="k">if</span> <span class="n">ligand_weights</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = 3;
    __pyx_t_8 = (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_weights.data + __pyx_t_5 * __pyx_v_ligand_weights.strides[0]) ))) != 0.0) != 0);
    if (__pyx_t_8) {
/* â€¦ */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1041</span>:                 <span class="k">if</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_5 = __pyx_v_pair;
      __pyx_t_8 = ((__pyx_v_dij &lt;= ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_5 * __pyx_v_ligand_dljr.strides[0]) ))) - 0.3)) != 0);
      if (__pyx_t_8) {
/* â€¦ */
        goto __pyx_L21;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1042</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1043</span>:                     <span class="c">#sol += -ligand_sol_prefactor[pair, 0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1044</span>:                     <span class="c">#sol += -ligand_sol_prefactor[pair, 1]</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1045</span>:                     <span class="n">sol</span> <span class="o">+=</span><span class="mf">0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_sol = (__pyx_v_sol + 0.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">1046</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1047</span>:                 <span class="k">elif</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_5 = __pyx_v_pair;
      __pyx_t_9 = ((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_5 * __pyx_v_ligand_dljr.strides[0]) ))) - 0.3) &lt; __pyx_v_dij) != 0);
      if (__pyx_t_9) {
      } else {
        __pyx_t_8 = __pyx_t_9;
        goto __pyx_L22_bool_binop_done;
      }
      __pyx_t_5 = __pyx_v_pair;
      __pyx_t_9 = ((__pyx_v_dij &lt;= ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_5 * __pyx_v_ligand_dljr.strides[0]) ))) + 0.2)) != 0);
      __pyx_t_8 = __pyx_t_9;
      __pyx_L22_bool_binop_done:;
      if (__pyx_t_8) {
/* â€¦ */
        goto __pyx_L21;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1048</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1049</span>:                     <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_5 = __pyx_v_pair;
        __pyx_t_4 = __pyx_v_pair;
        __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dij, ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_5 * __pyx_v_ligand_dljr.strides[0]) ))) - 0.3), ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_4 * __pyx_v_ligand_dljr.strides[0]) ))) + 0.2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1050</span>:                     <span class="n">s_p</span> <span class="o">=</span> <span class="n">switch_gradient</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_pair;
        __pyx_t_5 = __pyx_v_pair;
        __pyx_v_s_p = __pyx_f_6Energy_switch_gradient(__pyx_v_dij, ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_4 * __pyx_v_ligand_dljr.strides[0]) ))) - 0.3), ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_5 * __pyx_v_ligand_dljr.strides[0]) ))) + 0.2));
</pre><pre class="cython line score-0">&#xA0;<span class="">1051</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1052</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_5 = __pyx_v_pair;
        __pyx_t_4 = __pyx_v_i;
        __pyx_v_sol_expfactor_i = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_5 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_4 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1053</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_pair;
        __pyx_t_5 = __pyx_v_j;
        __pyx_v_sol_expfactor_j = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_4 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_5 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1054</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1055</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_p</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>        __pyx_t_5 = __pyx_v_pair;
        __pyx_t_4 = 0;
/* â€¦ */
        __pyx_v_sol = (__pyx_v_sol + ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_5 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * __pyx_v_s_p) + ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_6 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * ((-2.0 * (__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_10 * __pyx_v_ligand_dljr.strides[0]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_11 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_12 * __pyx_v_ligand_lklam.strides[0]) )))))) * (1.0 - __pyx_v_s))) + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_13 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * (-__pyx_v_s_p))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1056</span>:                            <span class="p">((</span><span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>        __pyx_t_6 = __pyx_v_pair;
        __pyx_t_7 = 0;
        __pyx_t_10 = __pyx_v_pair;
        __pyx_t_11 = __pyx_v_i;
        __pyx_t_12 = __pyx_v_i;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1057</span>:                            <span class="p">(</span><span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span>  <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">s_p</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_13 = __pyx_v_pair;
        __pyx_t_14 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1058</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1059</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_p</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>        __pyx_t_14 = __pyx_v_pair;
        __pyx_t_13 = 1;
/* â€¦ */
        __pyx_v_sol = (__pyx_v_sol + ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_14 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * __pyx_v_s_p) + ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_12 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * ((-2.0 * (__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_10 * __pyx_v_ligand_dljr.strides[0]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_7 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_6 * __pyx_v_ligand_lklam.strides[0]) )))))) * (1.0 - __pyx_v_s))) + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_4 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * (-__pyx_v_s_p))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1060</span>:                            <span class="p">((</span><span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span><span class="n">s</span><span class="p">))</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>        __pyx_t_12 = __pyx_v_pair;
        __pyx_t_11 = 1;
        __pyx_t_10 = __pyx_v_pair;
        __pyx_t_7 = __pyx_v_j;
        __pyx_t_6 = __pyx_v_j;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1061</span>:                            <span class="p">(</span><span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span>  <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">s_p</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_pair;
        __pyx_t_5 = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">1062</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1063</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1064</span>:                 <span class="k">elif</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_5 = __pyx_v_pair;
      __pyx_t_9 = ((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_5 * __pyx_v_ligand_dljr.strides[0]) ))) + 0.2) &lt; __pyx_v_dij) != 0);
      if (__pyx_t_9) {
      } else {
        __pyx_t_8 = __pyx_t_9;
        goto __pyx_L24_bool_binop_done;
      }
      __pyx_t_9 = ((__pyx_v_dij &lt;= 4.5) != 0);
      __pyx_t_8 = __pyx_t_9;
      __pyx_L24_bool_binop_done:;
      if (__pyx_t_8) {
/* â€¦ */
        goto __pyx_L21;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1065</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_5 = __pyx_v_pair;
        __pyx_t_4 = __pyx_v_i;
        __pyx_v_sol_expfactor_i = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_5 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_4 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1066</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_pair;
        __pyx_t_5 = __pyx_v_j;
        __pyx_v_sol_expfactor_j = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_4 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_5 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1067</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1068</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span> <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_5 = __pyx_v_pair;
        __pyx_t_4 = 0;
        __pyx_t_6 = __pyx_v_pair;
        __pyx_t_7 = __pyx_v_i;
        __pyx_t_10 = __pyx_v_i;
        __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_5 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * ((-2.0 * (__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_7 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_10 * __pyx_v_ligand_lklam.strides[0]) )))))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1069</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span> <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span> <span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_pair;
        __pyx_t_7 = 1;
        __pyx_t_6 = __pyx_v_pair;
        __pyx_t_4 = __pyx_v_j;
        __pyx_t_5 = __pyx_v_j;
        __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_10 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * ((-2.0 * (__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_4 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_5 * __pyx_v_ligand_lklam.strides[0]) )))))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1070</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1071</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1072</span>:                 <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;</span> <span class="n">dij</span> <span class="ow">and</span> <span class="n">dij</span> <span class="o">&lt;=</span> <span class="mf">6.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = ((4.5 &lt; __pyx_v_dij) != 0);
      if (__pyx_t_9) {
      } else {
        __pyx_t_8 = __pyx_t_9;
        goto __pyx_L26_bool_binop_done;
      }
      __pyx_t_9 = ((__pyx_v_dij &lt;= 6.0) != 0);
      __pyx_t_8 = __pyx_t_9;
      __pyx_L26_bool_binop_done:;
      if (__pyx_t_8) {
/* â€¦ */
        goto __pyx_L21;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1073</span>:                     <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dij, 4.5, 6.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1074</span>:                     <span class="n">s_p</span> <span class="o">=</span> <span class="n">switch_gradient</span><span class="p">(</span><span class="n">dij</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_v_s_p = __pyx_f_6Energy_switch_gradient(__pyx_v_dij, 4.5, 6.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">1075</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1076</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_5 = __pyx_v_pair;
        __pyx_t_4 = __pyx_v_i;
        __pyx_v_sol_expfactor_i = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_5 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_4 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1077</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_pair;
        __pyx_t_5 = __pyx_v_j;
        __pyx_v_sol_expfactor_j = ((__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_4 * __pyx_v_ligand_dljr.strides[0]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_5 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1078</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1079</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span> <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>        __pyx_t_5 = __pyx_v_pair;
        __pyx_t_4 = 0;
        __pyx_t_6 = __pyx_v_pair;
        __pyx_t_7 = __pyx_v_i;
        __pyx_t_10 = __pyx_v_i;
/* â€¦ */
        __pyx_v_sol = (__pyx_v_sol + (((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_5 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * ((-2.0 * (__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_6 * __pyx_v_ligand_dljr.strides[0]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_7 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_10 * __pyx_v_ligand_lklam.strides[0]) )))))) * __pyx_v_s) + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_11 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_12 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * __pyx_v_s_p)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1080</span>:                            <span class="p">(</span> <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="n">s_p</span> <span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_pair;
        __pyx_t_12 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1081</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1082</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1083</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span> <span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dij</span> <span class="o">-</span> <span class="n">ligand_dljr</span><span class="p">[</span><span class="n">pair</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>        __pyx_t_12 = __pyx_v_pair;
        __pyx_t_11 = 1;
        __pyx_t_10 = __pyx_v_pair;
        __pyx_t_7 = __pyx_v_j;
        __pyx_t_6 = __pyx_v_j;
/* â€¦ */
        __pyx_v_sol = (__pyx_v_sol + (((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_12 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * ((-2.0 * (__pyx_v_dij - (*((double *) ( /* dim=0 */ (__pyx_v_ligand_dljr.data + __pyx_t_10 * __pyx_v_ligand_dljr.strides[0]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_7 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_6 * __pyx_v_ligand_lklam.strides[0]) )))))) * __pyx_v_s) + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_sol_prefactor.data + __pyx_t_4 * __pyx_v_ligand_sol_prefactor.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_sol_prefactor.strides[1]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * __pyx_v_s_p)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1084</span>:                            <span class="p">(</span><span class="n">ligand_sol_prefactor</span><span class="p">[</span><span class="n">pair</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="n">s_p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_pair;
        __pyx_t_5 = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">1085</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1086</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1087</span>:                     <span class="n">sol</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_v_sol = 0.0;
      }
      __pyx_L21:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1088</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1089</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1090</span>:             <span class="n">grad_magnititude</span> <span class="o">=</span> <span class="n">ligand_coupling</span> <span class="o">*</span> <span class="n">ligand_nonbondedWeights</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ligand_weights</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rep</span> <span class="o">+</span> <span class="n">ligand_weights</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">atr</span> <span class="o">+</span> <span class="n">ligand_weights</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">col</span> <span class="o">+</span> <span class="n">ligand_weights</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">sol</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_pair;
    __pyx_t_4 = 0;
    __pyx_t_6 = 1;
    __pyx_t_7 = 2;
    __pyx_t_10 = 3;
    __pyx_v_grad_magnititude = ((__pyx_v_ligand_coupling * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_nonbondedWeights.data + __pyx_t_5 * __pyx_v_ligand_nonbondedWeights.strides[0]) )))) * (((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_weights.data + __pyx_t_4 * __pyx_v_ligand_weights.strides[0]) ))) * __pyx_v_rep) + ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_weights.data + __pyx_t_6 * __pyx_v_ligand_weights.strides[0]) ))) * __pyx_v_atr)) + ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_weights.data + __pyx_t_7 * __pyx_v_ligand_weights.strides[0]) ))) * __pyx_v_col)) + ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_weights.data + __pyx_t_10 * __pyx_v_ligand_weights.strides[0]) ))) * __pyx_v_sol)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1091</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1092</span>:             <span class="c"># Set forces for atom j</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1093</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">dxij</span> <span class="o">*</span> <span class="n">grad_magnititude</span><span class="p">)</span><span class="o">/</span><span class="n">dij</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_v_j;
    __pyx_t_7 = 0;
    __pyx_t_6 = __pyx_v_j;
    __pyx_t_4 = 0;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_6 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_4 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_10 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_7 * __pyx_v_gradient_vector.strides[1]) ))) + ((__pyx_v_dxij * __pyx_v_grad_magnititude) / __pyx_v_dij));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1094</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">dyij</span> <span class="o">*</span> <span class="n">grad_magnititude</span><span class="p">)</span><span class="o">/</span><span class="n">dij</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_j;
    __pyx_t_10 = 1;
    __pyx_t_4 = __pyx_v_j;
    __pyx_t_6 = 1;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_4 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_6 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_7 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_10 * __pyx_v_gradient_vector.strides[1]) ))) + ((__pyx_v_dyij * __pyx_v_grad_magnititude) / __pyx_v_dij));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1095</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">dzij</span> <span class="o">*</span> <span class="n">grad_magnititude</span><span class="p">)</span><span class="o">/</span><span class="n">dij</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_v_j;
    __pyx_t_7 = 2;
    __pyx_t_6 = __pyx_v_j;
    __pyx_t_4 = 2;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_6 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_4 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_10 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_7 * __pyx_v_gradient_vector.strides[1]) ))) + ((__pyx_v_dzij * __pyx_v_grad_magnititude) / __pyx_v_dij));
</pre><pre class="cython line score-0">&#xA0;<span class="">1096</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1097</span>:             <span class="c"># For atom i we use -dxij</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1098</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="n">dxij</span>  <span class="o">*</span> <span class="n">grad_magnititude</span><span class="p">)</span><span class="o">/</span><span class="n">dij</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_i;
    __pyx_t_10 = 0;
    __pyx_t_4 = __pyx_v_i;
    __pyx_t_6 = 0;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_4 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_6 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_7 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_10 * __pyx_v_gradient_vector.strides[1]) ))) + (((-__pyx_v_dxij) * __pyx_v_grad_magnititude) / __pyx_v_dij));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1099</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="n">dyij</span>  <span class="o">*</span> <span class="n">grad_magnititude</span><span class="p">)</span><span class="o">/</span><span class="n">dij</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_v_i;
    __pyx_t_7 = 1;
    __pyx_t_6 = __pyx_v_i;
    __pyx_t_4 = 1;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_6 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_4 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_10 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_7 * __pyx_v_gradient_vector.strides[1]) ))) + (((-__pyx_v_dyij) * __pyx_v_grad_magnititude) / __pyx_v_dij));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1100</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="n">dzij</span>  <span class="o">*</span> <span class="n">grad_magnititude</span><span class="p">)</span><span class="o">/</span><span class="n">dij</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_i;
    __pyx_t_10 = 2;
    __pyx_t_4 = __pyx_v_i;
    __pyx_t_6 = 2;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_4 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_6 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_7 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_10 * __pyx_v_gradient_vector.strides[1]) ))) + (((-__pyx_v_dzij) * __pyx_v_grad_magnititude) / __pyx_v_dij));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1101</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1102</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1103</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1104</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1105</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1106</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-164" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1107</span>: <span class="k">def</span> <span class="nf">ligand_environment_gradient</span><span class="p">(</span><span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-164 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_17ligand_environment_gradient(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_6Energy_17ligand_environment_gradient = {"ligand_environment_gradient", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_17ligand_environment_gradient, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6Energy_17ligand_environment_gradient(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_ligand_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_mask = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_qij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_dljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_dljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environmen_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_sideChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_mainChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_sideChainCoupling;
  double __pyx_v_mainChainCoupling;
  __Pyx_memviewslice __pyx_v_ligand_environment_weights = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_gradient_vector = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ligand_environment_gradient (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ligand_xyz,&amp;__pyx_n_s_environment_xyz,&amp;__pyx_n_s_ligand_mask,&amp;__pyx_n_s_ligand_environment_qij,&amp;__pyx_n_s_ligand_environment_dljr,&amp;__pyx_n_s_ligand_environment_dljep,&amp;__pyx_n_s_ligand_environment_sol_prefactor,&amp;__pyx_n_s_ligand_lklam,&amp;__pyx_n_s_environmen_lklam,&amp;__pyx_n_s_environment_sideChainFalgs,&amp;__pyx_n_s_environment_mainChainFalgs,&amp;__pyx_n_s_sideChainCoupling,&amp;__pyx_n_s_mainChainCoupling,&amp;__pyx_n_s_ligand_environment_weights,&amp;__pyx_n_s_gradient_vector,0};
    PyObject* values[15] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_xyz)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_xyz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 1); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_mask)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 2); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_qij)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 3); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_dljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 4); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_dljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 5); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_sol_prefactor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 6); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 7); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environmen_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 8); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_sideChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 9); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_mainChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 10); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sideChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 11); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mainChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 12); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_weights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 13); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_gradient_vector)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, 14); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "ligand_environment_gradient") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 15) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
      values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
      values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
      values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
      values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
    }
    __pyx_v_ligand_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_xyz.memview)) __PYX_ERR(0, 1107, __pyx_L3_error)</span>
    __pyx_v_environment_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_xyz.memview)) __PYX_ERR(0, 1108, __pyx_L3_error)</span>
    __pyx_v_ligand_mask = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_mask.memview)) __PYX_ERR(0, 1109, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_qij = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_qij.memview)) __PYX_ERR(0, 1110, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_dljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_dljr.memview)) __PYX_ERR(0, 1111, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_dljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_dljep.memview)) __PYX_ERR(0, 1112, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_sol_prefactor = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(values[6], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_sol_prefactor.memview)) __PYX_ERR(0, 1113, __pyx_L3_error)</span>
    __pyx_v_ligand_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[7], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lklam.memview)) __PYX_ERR(0, 1114, __pyx_L3_error)</span>
    __pyx_v_environmen_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[8], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environmen_lklam.memview)) __PYX_ERR(0, 1115, __pyx_L3_error)</span>
    __pyx_v_environment_sideChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[9], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_sideChainFalgs.memview)) __PYX_ERR(0, 1116, __pyx_L3_error)</span>
    __pyx_v_environment_mainChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[10], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_mainChainFalgs.memview)) __PYX_ERR(0, 1117, __pyx_L3_error)</span>
    __pyx_v_sideChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[11]); if (unlikely((__pyx_v_sideChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1118, __pyx_L3_error)</span>
    __pyx_v_mainChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[12]); if (unlikely((__pyx_v_mainChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1119, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_weights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[13], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_weights.memview)) __PYX_ERR(0, 1120, __pyx_L3_error)</span>
    __pyx_v_gradient_vector = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[14], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_gradient_vector.memview)) __PYX_ERR(0, 1121, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("ligand_environment_gradient", 1, 15, 15, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.ligand_environment_gradient", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_16ligand_environment_gradient(__pyx_self, __pyx_v_ligand_xyz, __pyx_v_environment_xyz, __pyx_v_ligand_mask, __pyx_v_ligand_environment_qij, __pyx_v_ligand_environment_dljr, __pyx_v_ligand_environment_dljep, __pyx_v_ligand_environment_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_environmen_lklam, __pyx_v_environment_sideChainFalgs, __pyx_v_environment_mainChainFalgs, __pyx_v_sideChainCoupling, __pyx_v_mainChainCoupling, __pyx_v_ligand_environment_weights, __pyx_v_gradient_vector);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_16ligand_environment_gradient(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_environment_xyz, __Pyx_memviewslice __pyx_v_ligand_mask, __Pyx_memviewslice __pyx_v_ligand_environment_qij, __Pyx_memviewslice __pyx_v_ligand_environment_dljr, __Pyx_memviewslice __pyx_v_ligand_environment_dljep, __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor, __Pyx_memviewslice __pyx_v_ligand_lklam, __Pyx_memviewslice __pyx_v_environmen_lklam, __Pyx_memviewslice __pyx_v_environment_sideChainFalgs, __Pyx_memviewslice __pyx_v_environment_mainChainFalgs, double __pyx_v_sideChainCoupling, double __pyx_v_mainChainCoupling, __Pyx_memviewslice __pyx_v_ligand_environment_weights, __Pyx_memviewslice __pyx_v_gradient_vector) {
  int __pyx_v_N;
  int __pyx_v_M;
  int __pyx_v_i;
  int __pyx_v_j;
  double __pyx_v_dxji;
  double __pyx_v_dyji;
  double __pyx_v_dzji;
  double __pyx_v_dji;
  double __pyx_v_dlj_dji;
  double __pyx_v_dlj_dji3;
  double __pyx_v_dlj_dji6;
  double __pyx_v_dlj_dji12;
  double __pyx_v_epsilon;
  double __pyx_v_s;
  double __pyx_v_sol_expfactor_i;
  double __pyx_v_sol_expfactor_j;
  double __pyx_v_coupling;
  double __pyx_v_rep;
  double __pyx_v_atr;
  double __pyx_v_col;
  double __pyx_v_sol;
  double __pyx_v_grad_magnititude;
  double __pyx_v_s_p;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__9)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("ligand_environment_gradient", 0);
  <span class='trace'>__Pyx_TraceCall</span>("ligand_environment_gradient", __pyx_f[0], 1107, 0, <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.ligand_environment_gradient", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_mask, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_qij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_dljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_dljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_sol_prefactor, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environmen_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_sideChainFalgs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_mainChainFalgs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_weights, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_gradient_vector, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__40 = <span class='py_c_api'>PyTuple_Pack</span>(39, __pyx_n_s_ligand_xyz, __pyx_n_s_environment_xyz, __pyx_n_s_ligand_mask, __pyx_n_s_ligand_environment_qij, __pyx_n_s_ligand_environment_dljr, __pyx_n_s_ligand_environment_dljep, __pyx_n_s_ligand_environment_sol_prefactor, __pyx_n_s_ligand_lklam, __pyx_n_s_environmen_lklam, __pyx_n_s_environment_sideChainFalgs, __pyx_n_s_environment_mainChainFalgs, __pyx_n_s_sideChainCoupling, __pyx_n_s_mainChainCoupling, __pyx_n_s_ligand_environment_weights, __pyx_n_s_gradient_vector, __pyx_n_s_N, __pyx_n_s_M, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_dxji, __pyx_n_s_dyji, __pyx_n_s_dzji, __pyx_n_s_dji, __pyx_n_s_dlj, __pyx_n_s_dlj_dji, __pyx_n_s_dlj_dji3, __pyx_n_s_dlj_dji6, __pyx_n_s_dlj_dji12, __pyx_n_s_epsilon, __pyx_n_s_s, __pyx_n_s_sol_expfactor_i, __pyx_n_s_sol_expfactor_j, __pyx_n_s_coupling, __pyx_n_s_rep, __pyx_n_s_atr, __pyx_n_s_col, __pyx_n_s_sol, __pyx_n_s_grad_magnititude, __pyx_n_s_s_p);<span class='error_goto'> if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 1107, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__40);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__40);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_17ligand_environment_gradient, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1107, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_ligand_environment_gradient, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1107, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__9 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(15, 0, 39, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_ligand_environment_gradient, 1107, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__9)) __PYX_ERR(0, 1107, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">1108</span>:                                <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1109</span>:                                <span class="n">double</span><span class="p">[:]</span> <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1110</span>:                                <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1111</span>:                                <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1112</span>:                                <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1113</span>:                                <span class="n">double</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1114</span>:                                <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1115</span>:                                <span class="n">double</span> <span class="p">[:]</span> <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1116</span>:                                <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1117</span>:                                <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1118</span>:                                <span class="n">double</span> <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1119</span>:                                <span class="n">double</span> <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1120</span>:                                <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_environment_weights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1121</span>:                                <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">gradient_vector</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1122</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1123</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_ligand_xyz.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1124</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">M</span> <span class="o">=</span> <span class="n">environment_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_M = (__pyx_v_environment_xyz.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">1125</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1126</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dxji</span><span class="p">,</span> <span class="nf">dyji</span><span class="p">,</span> <span class="nf">dzji</span><span class="p">,</span> <span class="nf">dji</span><span class="p">,</span> <span class="nf">dlj</span><span class="p">,</span> <span class="nf">dlj_dji</span><span class="p">,</span> <span class="nf">dlj_dji3</span><span class="p">,</span> <span class="nf">dlj_dji6</span><span class="p">,</span> <span class="nf">dlj_dji12</span><span class="p">,</span> <span class="nf">epsilon</span><span class="p">,</span> <span class="nf">s</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1127</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">sol_expfactor_i</span><span class="p">,</span> <span class="nf">sol_expfactor_j</span><span class="p">,</span> <span class="nf">coupling</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1128</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">rep</span><span class="p">,</span> <span class="nf">atr</span><span class="p">,</span> <span class="nf">col</span><span class="p">,</span> <span class="nf">sol</span><span class="p">,</span> <span class="nf">grad_magnititude</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1129</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1130</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_i = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1131</span>:         <span class="k">if</span> <span class="n">ligand_mask</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_mask.data + __pyx_t_4 * __pyx_v_ligand_mask.strides[0]) ))) == 0.0) != 0);
    if (__pyx_t_5) {
/* â€¦ */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1132</span>:             <span class="k">continue</span></pre>
<pre class='cython code score-0 '>      goto __pyx_L3_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">1133</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1134</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_v_M;
    __pyx_t_7 = __pyx_t_6;
    for (__pyx_t_8 = 0; __pyx_t_8 &lt; __pyx_t_7; __pyx_t_8+=1) {
      __pyx_v_j = __pyx_t_8;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1135</span>:             <span class="n">coupling</span> <span class="o">=</span> <span class="p">(</span><span class="n">environment_sideChainFalgs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">sideChainCoupling</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">environment_mainChainFalgs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">mainChainCoupling</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_4 = __pyx_v_j;
      __pyx_t_9 = __pyx_v_j;
      __pyx_v_coupling = (((*((int *) ( /* dim=0 */ (__pyx_v_environment_sideChainFalgs.data + __pyx_t_4 * __pyx_v_environment_sideChainFalgs.strides[0]) ))) * __pyx_v_sideChainCoupling) + ((*((int *) ( /* dim=0 */ (__pyx_v_environment_mainChainFalgs.data + __pyx_t_9 * __pyx_v_environment_mainChainFalgs.strides[0]) ))) * __pyx_v_mainChainCoupling));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1136</span>:             <span class="k">if</span> <span class="n">coupling</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_5 = ((__pyx_v_coupling == 0.0) != 0);
      if (__pyx_t_5) {
/* â€¦ */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1137</span>:                 <span class="k">continue</span></pre>
<pre class='cython code score-0 '>        goto __pyx_L6_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">1138</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1139</span>:             <span class="c"># The vector element are computed wrt ligand</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1140</span>:             <span class="n">dxji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">environment_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_i;
      __pyx_t_4 = 0;
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_11 = 0;
      __pyx_v_dxji = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_9 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_environment_xyz.data + __pyx_t_10 * __pyx_v_environment_xyz.strides[0]) ) + __pyx_t_11 * __pyx_v_environment_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1141</span>:             <span class="n">dyji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">environment_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_i;
      __pyx_t_10 = 1;
      __pyx_t_4 = __pyx_v_j;
      __pyx_t_9 = 1;
      __pyx_v_dyji = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_11 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_environment_xyz.data + __pyx_t_4 * __pyx_v_environment_xyz.strides[0]) ) + __pyx_t_9 * __pyx_v_environment_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1142</span>:             <span class="n">dzji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">environment_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_i;
      __pyx_t_4 = 2;
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_11 = 2;
      __pyx_v_dzji = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_9 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_environment_xyz.data + __pyx_t_10 * __pyx_v_environment_xyz.strides[0]) ) + __pyx_t_11 * __pyx_v_environment_xyz.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1143</span>:             <span class="c">#if j == 1591 and i == 26:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1144</span>:             <span class="c">#    print(&#39;BBB_ coord lig, env&#39;, np.array(ligand_xyz[i]), np.array(environment_xyz[j]))</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1145</span>:             <span class="n">dji</span> <span class="o">=</span> <span class="n">dxji</span> <span class="o">*</span> <span class="n">dxji</span> <span class="o">+</span> <span class="n">dyji</span> <span class="o">*</span> <span class="n">dyji</span> <span class="o">+</span> <span class="n">dzji</span> <span class="o">*</span> <span class="n">dzji</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dji = (((__pyx_v_dxji * __pyx_v_dxji) + (__pyx_v_dyji * __pyx_v_dyji)) + (__pyx_v_dzji * __pyx_v_dzji));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1146</span>:             <span class="n">dji</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dji = sqrt(__pyx_v_dji);
</pre><pre class="cython line score-0">&#xA0;<span class="">1147</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1148</span>:             <span class="c"># Compute rep gradient magnitude</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1149</span>:             <span class="k">if</span> <span class="n">dji</span> <span class="o">&lt;=</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_i;
      __pyx_t_10 = __pyx_v_j;
      __pyx_t_5 = ((__pyx_v_dji &lt;= (0.6 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[1]) ))))) != 0);
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L9;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1150</span>:                 <span class="c"># constant, replacing dji = 0.6*dljr</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1151</span>:                 <span class="n">dlj_dji</span> <span class="o">=</span> <span class="mf">1</span> <span class="o">/</span> <span class="mf">0.6</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji = (1.0 / 0.6);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1152</span>:                 <span class="n">dlj_dji3</span> <span class="o">=</span> <span class="n">dlj_dji</span> <span class="o">*</span> <span class="n">dlj_dji</span> <span class="o">*</span> <span class="n">dlj_dji</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji3 = ((__pyx_v_dlj_dji * __pyx_v_dlj_dji) * __pyx_v_dlj_dji);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1153</span>:                 <span class="n">dlj_dji6</span> <span class="o">=</span> <span class="n">dlj_dji3</span> <span class="o">*</span> <span class="n">dlj_dji3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji6 = (__pyx_v_dlj_dji3 * __pyx_v_dlj_dji3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1154</span>:                 <span class="n">dlj_dji12</span> <span class="o">=</span> <span class="n">dlj_dji6</span> <span class="o">*</span> <span class="n">dlj_dji6</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji12 = (__pyx_v_dlj_dji6 * __pyx_v_dlj_dji6);
</pre><pre class="cython line score-0">&#xA0;<span class="">1155</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1156</span>:                 <span class="n">rep</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mf">12</span> <span class="o">*</span> <span class="n">ligand_environment_dljep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.6</span> <span class="o">*</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dji12</span> <span class="o">-</span> <span class="n">dlj_dji6</span><span class="p">)</span>  <span class="c"># - (dlj_dji*dji)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_i;
        __pyx_t_11 = __pyx_v_j;
        __pyx_t_4 = __pyx_v_i;
        __pyx_t_9 = __pyx_v_j;
        __pyx_v_rep = (((-12.0 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljep.data + __pyx_t_10 * __pyx_v_ligand_environment_dljep.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljep.strides[1]) )))) / (0.6 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[1]) ))))) * (__pyx_v_dlj_dji12 - __pyx_v_dlj_dji6));
</pre><pre class="cython line score-0">&#xA0;<span class="">1157</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1158</span>:             <span class="k">elif</span> <span class="mf">0.6</span> <span class="o">*</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dji</span> <span class="ow">and</span> <span class="n">dji</span> <span class="o">&lt;=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_i;
      __pyx_t_4 = __pyx_v_j;
      __pyx_t_12 = (((0.6 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[1]) )))) &lt; __pyx_v_dji) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_4 = __pyx_v_i;
      __pyx_t_9 = __pyx_v_j;
      __pyx_t_12 = ((__pyx_v_dji &lt;= (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[1]) )))) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L10_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L9;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1159</span>:                 <span class="n">dlj_dji</span> <span class="o">=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">dji</span></pre>
<pre class='cython code score-0 '>        __pyx_t_9 = __pyx_v_i;
        __pyx_t_4 = __pyx_v_j;
        __pyx_v_dlj_dji = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[1]) ))) / __pyx_v_dji);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1160</span>:                 <span class="n">dlj_dji3</span> <span class="o">=</span> <span class="n">dlj_dji</span> <span class="o">*</span> <span class="n">dlj_dji</span> <span class="o">*</span> <span class="n">dlj_dji</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji3 = ((__pyx_v_dlj_dji * __pyx_v_dlj_dji) * __pyx_v_dlj_dji);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1161</span>:                 <span class="n">dlj_dji6</span> <span class="o">=</span> <span class="n">dlj_dji3</span> <span class="o">*</span> <span class="n">dlj_dji3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji6 = (__pyx_v_dlj_dji3 * __pyx_v_dlj_dji3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1162</span>:                 <span class="n">dlj_dji12</span> <span class="o">=</span> <span class="n">dlj_dji6</span> <span class="o">*</span> <span class="n">dlj_dji6</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji12 = (__pyx_v_dlj_dji6 * __pyx_v_dlj_dji6);
</pre><pre class="cython line score-0">&#xA0;<span class="">1163</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1164</span>:                 <span class="n">rep</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">12</span> <span class="o">*</span> <span class="n">ligand_environment_dljep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">dji</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dji12</span> <span class="o">-</span> <span class="n">dlj_dji6</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_i;
        __pyx_t_9 = __pyx_v_j;
        __pyx_v_rep = (((-12.0 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljep.data + __pyx_t_4 * __pyx_v_ligand_environment_dljep.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_dljep.strides[1]) )))) / __pyx_v_dji) * (__pyx_v_dlj_dji12 - __pyx_v_dlj_dji6));
</pre><pre class="cython line score-0">&#xA0;<span class="">1165</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1166</span>:             <span class="k">elif</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dji</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_i;
      __pyx_t_4 = __pyx_v_j;
      __pyx_t_5 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[1]) ))) &lt; __pyx_v_dji) != 0);
      if (__pyx_t_5) {
/* â€¦ */
      }
      __pyx_L9:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1167</span>:                 <span class="n">rep</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_rep = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1168</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1169</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1170</span>:             <span class="c"># Compute atr</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1171</span>:             <span class="k">if</span> <span class="n">dji</span> <span class="o">&lt;=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_4 = __pyx_v_i;
      __pyx_t_9 = __pyx_v_j;
      __pyx_t_5 = ((__pyx_v_dji &lt;= (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[1]) )))) != 0);
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L12;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1172</span>:                 <span class="c">#atr = ligand_environment_dljr[i, j]</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1173</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_atr = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1174</span>:             <span class="k">elif</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dji</span> <span class="ow">and</span> <span class="n">dji</span> <span class="o">&lt;=</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_i;
      __pyx_t_4 = __pyx_v_j;
      __pyx_t_12 = (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[1]) ))) &lt; __pyx_v_dji) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L13_bool_binop_done;
      }
      __pyx_t_12 = ((__pyx_v_dji &lt;= 4.5) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L13_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L12;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1175</span>:                 <span class="n">dlj_dji</span> <span class="o">=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">dji</span></pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_i;
        __pyx_t_9 = __pyx_v_j;
        __pyx_v_dlj_dji = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[1]) ))) / __pyx_v_dji);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1176</span>:                 <span class="n">dlj_dji3</span> <span class="o">=</span> <span class="n">dlj_dji</span> <span class="o">*</span> <span class="n">dlj_dji</span> <span class="o">*</span> <span class="n">dlj_dji</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji3 = ((__pyx_v_dlj_dji * __pyx_v_dlj_dji) * __pyx_v_dlj_dji);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1177</span>:                 <span class="n">dlj_dji6</span> <span class="o">=</span> <span class="n">dlj_dji3</span> <span class="o">*</span> <span class="n">dlj_dji3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji6 = (__pyx_v_dlj_dji3 * __pyx_v_dlj_dji3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1178</span>:                 <span class="n">dlj_dji12</span> <span class="o">=</span> <span class="n">dlj_dji6</span> <span class="o">*</span> <span class="n">dlj_dji6</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji12 = (__pyx_v_dlj_dji6 * __pyx_v_dlj_dji6);
</pre><pre class="cython line score-0">&#xA0;<span class="">1179</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1180</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">12</span> <span class="o">*</span> <span class="n">ligand_environment_dljep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">/</span> <span class="n">dji</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dji12</span> <span class="o">-</span> <span class="n">dlj_dji6</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_9 = __pyx_v_i;
        __pyx_t_4 = __pyx_v_j;
        __pyx_v_atr = (((-12.0 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljep.data + __pyx_t_9 * __pyx_v_ligand_environment_dljep.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_dljep.strides[1]) )))) / __pyx_v_dji) * (__pyx_v_dlj_dji12 - __pyx_v_dlj_dji6));
</pre><pre class="cython line score-0">&#xA0;<span class="">1181</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1182</span>:             <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;</span> <span class="n">dji</span> <span class="ow">and</span> <span class="n">dji</span> <span class="o">&lt;=</span> <span class="mf">6.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = ((4.5 &lt; __pyx_v_dji) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L15_bool_binop_done;
      }
      __pyx_t_12 = ((__pyx_v_dji &lt;= 6.0) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L15_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L12;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1183</span>:                 <span class="n">dlj_dji</span> <span class="o">=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">dji</span></pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_i;
        __pyx_t_9 = __pyx_v_j;
        __pyx_v_dlj_dji = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[1]) ))) / __pyx_v_dji);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1184</span>:                 <span class="n">dlj_dji3</span> <span class="o">=</span> <span class="n">dlj_dji</span> <span class="o">*</span> <span class="n">dlj_dji</span> <span class="o">*</span> <span class="n">dlj_dji</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji3 = ((__pyx_v_dlj_dji * __pyx_v_dlj_dji) * __pyx_v_dlj_dji);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1185</span>:                 <span class="n">dlj_dji6</span> <span class="o">=</span> <span class="n">dlj_dji3</span> <span class="o">*</span> <span class="n">dlj_dji3</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji6 = (__pyx_v_dlj_dji3 * __pyx_v_dlj_dji3);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1186</span>:                 <span class="n">dlj_dji12</span> <span class="o">=</span> <span class="n">dlj_dji6</span> <span class="o">*</span> <span class="n">dlj_dji6</span></pre>
<pre class='cython code score-0 '>        __pyx_v_dlj_dji12 = (__pyx_v_dlj_dji6 * __pyx_v_dlj_dji6);
</pre><pre class="cython line score-0">&#xA0;<span class="">1187</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1188</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="p">(((</span><span class="o">-</span><span class="mf">12</span> <span class="o">*</span> <span class="n">ligand_environment_dljep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">dji</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dji12</span> <span class="o">-</span> <span class="n">dlj_dji6</span><span class="p">)</span> <span class="o">*</span> <span class="n">switch</span><span class="p">(</span><span class="n">dji</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">))</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>        __pyx_t_9 = __pyx_v_i;
        __pyx_t_4 = __pyx_v_j;
/* â€¦ */
        __pyx_v_atr = (((((-12.0 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljep.data + __pyx_t_9 * __pyx_v_ligand_environment_dljep.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_dljep.strides[1]) )))) / __pyx_v_dji) * (__pyx_v_dlj_dji12 - __pyx_v_dlj_dji6)) * __pyx_f_6Energy_switch(__pyx_v_dji, 4.5, 6.0)) + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljep.data + __pyx_t_11 * __pyx_v_ligand_environment_dljep.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_dljep.strides[1]) ))) * (__pyx_v_dlj_dji12 - (2.0 * __pyx_v_dlj_dji6))) * __pyx_f_6Energy_switch_gradient(__pyx_v_dji, 4.5, 6.0)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1189</span>:                         <span class="p">(</span><span class="n">ligand_environment_dljep</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">dlj_dji12</span> <span class="o">-</span> <span class="p">(</span><span class="mf">2</span> <span class="o">*</span> <span class="n">dlj_dji6</span><span class="p">))</span> <span class="o">*</span> <span class="n">switch_gradient</span><span class="p">(</span><span class="n">dji</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_i;
        __pyx_t_10 = __pyx_v_j;
</pre><pre class="cython line score-0">&#xA0;<span class="">1190</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1191</span>:             <span class="k">elif</span> <span class="mf">6.0</span> <span class="o">&lt;</span> <span class="n">dji</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_5 = ((6.0 &lt; __pyx_v_dji) != 0);
      if (__pyx_t_5) {
/* â€¦ */
      }
      __pyx_L12:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1192</span>:                 <span class="n">atr</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_atr = 0.0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1193</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1194</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1195</span>:             <span class="c"># compute electrostatic</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1196</span>:             <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">6</span></pre>
<pre class='cython code score-0 '>      __pyx_v_epsilon = 6.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1197</span>:             <span class="k">if</span> <span class="n">dji</span> <span class="o">&lt;</span> <span class="mf">1.45</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_5 = ((__pyx_v_dji &lt; 1.45) != 0);
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1198</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="o">-</span><span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.45</span> <span class="o">*</span> <span class="mf">1.45</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_t_10 = __pyx_v_i;
        __pyx_t_11 = __pyx_v_j;
        __pyx_v_col = ((-(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_10 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_qij.strides[1]) )))) / ((1.45 * 1.45) * __pyx_v_epsilon));
</pre><pre class="cython line score-0">&#xA0;<span class="">1199</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1200</span>:             <span class="k">elif</span> <span class="mf">1.45</span> <span class="o">&lt;=</span> <span class="n">dji</span> <span class="ow">and</span> <span class="n">dji</span> <span class="o">&lt;</span> <span class="mf">1.85</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = ((1.45 &lt;= __pyx_v_dji) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L18_bool_binop_done;
      }
      __pyx_t_12 = ((__pyx_v_dji &lt; 1.85) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L18_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1201</span>:                 <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dji</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dji, 1.45, 1.85);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1202</span>:                 <span class="n">s_p</span> <span class="o">=</span> <span class="n">switch_gradient</span><span class="p">(</span><span class="n">dji</span><span class="p">,</span> <span class="mf">1.45</span><span class="p">,</span> <span class="mf">1.85</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        __pyx_v_s_p = __pyx_f_6Energy_switch_gradient(__pyx_v_dji, 1.45, 1.85);
</pre><pre class="cython line score-0">&#xA0;<span class="">1203</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1204</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.45</span> <span class="o">*</span> <span class="mf">1.45</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_i;
        __pyx_t_10 = __pyx_v_j;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1205</span>:                       <span class="p">((</span><span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.45</span> <span class="o">*</span> <span class="n">epsilon</span><span class="p">))</span> <span class="o">*</span> <span class="n">s_p</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>        __pyx_t_4 = __pyx_v_i;
        __pyx_t_9 = __pyx_v_j;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1206</span>:                       <span class="p">((</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dji</span> <span class="o">*</span> <span class="n">dji</span> <span class="o">*</span> <span class="n">dji</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>        __pyx_t_13 = __pyx_v_i;
        __pyx_t_14 = __pyx_v_j;
/* â€¦ */
        __pyx_v_col = ((((((-(*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_11 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_10 * __pyx_v_ligand_environment_qij.strides[1]) )))) / ((1.45 * 1.45) * __pyx_v_epsilon)) * __pyx_v_s) + (((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_4 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_qij.strides[1]) ))) / (1.45 * __pyx_v_epsilon)) * __pyx_v_s_p)) + ((((-2.0 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_13 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_environment_qij.strides[1]) )))) / __pyx_v_epsilon) * (1.0 / ((__pyx_v_dji * __pyx_v_dji) * __pyx_v_dji))) * (1.0 - __pyx_v_s))) + ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_15 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_16 * __pyx_v_ligand_environment_qij.strides[1]) ))) / __pyx_v_epsilon) * ((1.0 / (__pyx_v_dji * __pyx_v_dji)) - (1.0 / (5.5 * 5.5)))) * (-__pyx_v_s_p)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1207</span>:                       <span class="p">((</span><span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dji</span> <span class="o">*</span> <span class="n">dji</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">5.5</span> <span class="o">*</span> <span class="mf">5.5</span><span class="p">)))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">s_p</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_15 = __pyx_v_i;
        __pyx_t_16 = __pyx_v_j;
</pre><pre class="cython line score-0">&#xA0;<span class="">1208</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1209</span>:             <span class="k">elif</span> <span class="mf">1.85</span> <span class="o">&lt;=</span> <span class="n">dji</span> <span class="ow">and</span> <span class="n">dji</span> <span class="o">&lt;</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = ((1.85 &lt;= __pyx_v_dji) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L20_bool_binop_done;
      }
      __pyx_t_12 = ((__pyx_v_dji &lt; 4.5) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L20_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1210</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dji</span> <span class="o">*</span> <span class="n">dji</span> <span class="o">*</span> <span class="n">dji</span><span class="p">)))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_16 = __pyx_v_i;
        __pyx_t_15 = __pyx_v_j;
        __pyx_v_col = (((-2.0 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_16 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_15 * __pyx_v_ligand_environment_qij.strides[1]) )))) / __pyx_v_epsilon) * (1.0 / ((__pyx_v_dji * __pyx_v_dji) * __pyx_v_dji)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1211</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1212</span>:             <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;=</span> <span class="n">dji</span> <span class="ow">and</span> <span class="n">dji</span> <span class="o">&lt;</span> <span class="mf">5.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_12 = ((4.5 &lt;= __pyx_v_dji) != 0);
      if (__pyx_t_12) {
      } else {
        __pyx_t_5 = __pyx_t_12;
        goto __pyx_L22_bool_binop_done;
      }
      __pyx_t_12 = ((__pyx_v_dji &lt; 5.5) != 0);
      __pyx_t_5 = __pyx_t_12;
      __pyx_L22_bool_binop_done:;
      if (__pyx_t_5) {
/* â€¦ */
        goto __pyx_L17;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1213</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dji</span> <span class="o">*</span> <span class="n">dji</span> <span class="o">*</span> <span class="n">dji</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>        __pyx_t_15 = __pyx_v_i;
        __pyx_t_16 = __pyx_v_j;
/* â€¦ */
        __pyx_v_col = (((((-2.0 * (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_15 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_16 * __pyx_v_ligand_environment_qij.strides[1]) )))) / __pyx_v_epsilon) * (1.0 / ((__pyx_v_dji * __pyx_v_dji) * __pyx_v_dji))) * __pyx_v_s) + ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_qij.data + __pyx_t_14 * __pyx_v_ligand_environment_qij.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_qij.strides[1]) ))) / __pyx_v_epsilon) * ((1.0 / (__pyx_v_dji * __pyx_v_dji)) - (1.0 / (5.5 * 5.5)))) * __pyx_f_6Energy_switch_gradient(__pyx_v_dji, 4.5, 5.5)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1214</span>:                       <span class="p">((</span><span class="n">ligand_environment_qij</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">epsilon</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">dji</span> <span class="o">*</span> <span class="n">dji</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">5.5</span> <span class="o">*</span> <span class="mf">5.5</span><span class="p">)))</span> <span class="o">*</span> <span class="n">switch_gradient</span><span class="p">(</span><span class="n">dji</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>        __pyx_t_14 = __pyx_v_i;
        __pyx_t_13 = __pyx_v_j;
</pre><pre class="cython line score-0">&#xA0;<span class="">1215</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1216</span>:             <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1217</span>:                 <span class="n">col</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      /*else*/ {
        __pyx_v_col = 0.0;
      }
      __pyx_L17:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1218</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1219</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1220</span>:             <span class="c"># compute solvation</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1221</span>:             <span class="n">sol</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>      __pyx_v_sol = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1222</span>:             <span class="k">if</span> <span class="n">ligand_environment_weights</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_13 = 3;
      __pyx_t_5 = (((*((double *) ( /* dim=0 */ (__pyx_v_ligand_environment_weights.data + __pyx_t_13 * __pyx_v_ligand_environment_weights.strides[0]) ))) != 0.0) != 0);
      if (__pyx_t_5) {
/* â€¦ */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1223</span>:                 <span class="k">if</span> <span class="n">dji</span> <span class="o">&lt;=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_13 = __pyx_v_i;
        __pyx_t_14 = __pyx_v_j;
        __pyx_t_5 = ((__pyx_v_dji &lt;= ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_13 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_environment_dljr.strides[1]) ))) - 0.3)) != 0);
        if (__pyx_t_5) {
/* â€¦ */
          goto __pyx_L25;
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">1224</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1225</span>:                     <span class="c">#sol += -ligand_environment_sol_prefactor[i, j, 0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1226</span>:                     <span class="c">#sol += -ligand_environment_sol_prefactor[i, j, 1]</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1227</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>          __pyx_v_sol = (__pyx_v_sol + 0.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">1228</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1229</span>:                 <span class="k">elif</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span> <span class="o">&lt;</span> <span class="n">dji</span> <span class="ow">and</span> <span class="n">dji</span> <span class="o">&lt;=</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_14 = __pyx_v_i;
        __pyx_t_13 = __pyx_v_j;
        __pyx_t_12 = ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_14 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_dljr.strides[1]) ))) - 0.3) &lt; __pyx_v_dji) != 0);
        if (__pyx_t_12) {
        } else {
          __pyx_t_5 = __pyx_t_12;
          goto __pyx_L26_bool_binop_done;
        }
        __pyx_t_13 = __pyx_v_i;
        __pyx_t_14 = __pyx_v_j;
        __pyx_t_12 = ((__pyx_v_dji &lt;= ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_13 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_environment_dljr.strides[1]) ))) + 0.2)) != 0);
        __pyx_t_5 = __pyx_t_12;
        __pyx_L26_bool_binop_done:;
        if (__pyx_t_5) {
/* â€¦ */
          goto __pyx_L25;
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">1230</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1231</span>:                     <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dji</span><span class="p">,</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_t_14 = __pyx_v_i;
          __pyx_t_13 = __pyx_v_j;
          __pyx_t_16 = __pyx_v_i;
          __pyx_t_15 = __pyx_v_j;
          __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dji, ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_14 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_dljr.strides[1]) ))) - 0.3), ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_16 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_15 * __pyx_v_ligand_environment_dljr.strides[1]) ))) + 0.2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1232</span>:                     <span class="n">s_p</span> <span class="o">=</span> <span class="n">switch_gradient</span><span class="p">(</span><span class="n">dji</span><span class="p">,</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_t_15 = __pyx_v_i;
          __pyx_t_16 = __pyx_v_j;
          __pyx_t_13 = __pyx_v_i;
          __pyx_t_14 = __pyx_v_j;
          __pyx_v_s_p = __pyx_f_6Energy_switch_gradient(__pyx_v_dji, ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_15 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_16 * __pyx_v_ligand_environment_dljr.strides[1]) ))) - 0.3), ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_13 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_environment_dljr.strides[1]) ))) + 0.2));
</pre><pre class="cython line score-0">&#xA0;<span class="">1233</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1234</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_14 = __pyx_v_i;
          __pyx_t_13 = __pyx_v_j;
          __pyx_t_16 = __pyx_v_i;
          __pyx_v_sol_expfactor_i = ((__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_14 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_16 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1235</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_16 = __pyx_v_i;
          __pyx_t_13 = __pyx_v_j;
          __pyx_t_14 = __pyx_v_j;
          __pyx_v_sol_expfactor_j = ((__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_16 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_14 * __pyx_v_environmen_lklam.strides[0]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1236</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1237</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_p</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>          __pyx_t_14 = __pyx_v_i;
          __pyx_t_13 = __pyx_v_j;
          __pyx_t_16 = 0;
/* â€¦ */
          __pyx_v_sol = (__pyx_v_sol + ((((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_14 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_16 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * __pyx_v_s_p) + ((((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_15 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_4 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * ((-2.0 * (__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_11 * __pyx_v_ligand_environment_dljr.strides[1]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_17 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_18 * __pyx_v_ligand_lklam.strides[0]) )))))) * (1.0 - __pyx_v_s))) + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_19 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_20 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_21 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * (-__pyx_v_s_p))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1238</span>:                            <span class="p">((</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>          __pyx_t_15 = __pyx_v_i;
          __pyx_t_9 = __pyx_v_j;
          __pyx_t_4 = 0;
          __pyx_t_10 = __pyx_v_i;
          __pyx_t_11 = __pyx_v_j;
          __pyx_t_17 = __pyx_v_i;
          __pyx_t_18 = __pyx_v_i;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1239</span>:                            <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">s_p</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>          __pyx_t_19 = __pyx_v_i;
          __pyx_t_20 = __pyx_v_j;
          __pyx_t_21 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1240</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1241</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">s_p</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>          __pyx_t_21 = __pyx_v_i;
          __pyx_t_20 = __pyx_v_j;
          __pyx_t_19 = 1;
/* â€¦ */
          __pyx_v_sol = (__pyx_v_sol + ((((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_21 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_20 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_19 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * __pyx_v_s_p) + ((((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_18 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_17 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_11 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * ((-2.0 * (__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[1]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_9 * __pyx_v_environmen_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_15 * __pyx_v_environmen_lklam.strides[0]) )))))) * (1.0 - __pyx_v_s))) + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_16 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_14 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * (-__pyx_v_s_p))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1242</span>:                            <span class="p">((</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1</span> <span class="o">-</span> <span class="n">s</span><span class="p">))</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>          __pyx_t_18 = __pyx_v_i;
          __pyx_t_17 = __pyx_v_j;
          __pyx_t_11 = 1;
          __pyx_t_10 = __pyx_v_i;
          __pyx_t_4 = __pyx_v_j;
          __pyx_t_9 = __pyx_v_j;
          __pyx_t_15 = __pyx_v_j;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1243</span>:                            <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">s_p</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>          __pyx_t_16 = __pyx_v_i;
          __pyx_t_13 = __pyx_v_j;
          __pyx_t_14 = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">1244</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1245</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1246</span>:                 <span class="k">elif</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span> <span class="o">&lt;</span> <span class="n">dji</span> <span class="ow">and</span> <span class="n">dji</span> <span class="o">&lt;=</span> <span class="mf">4.5</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_14 = __pyx_v_i;
        __pyx_t_13 = __pyx_v_j;
        __pyx_t_12 = ((((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_14 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_environment_dljr.strides[1]) ))) + 0.2) &lt; __pyx_v_dji) != 0);
        if (__pyx_t_12) {
        } else {
          __pyx_t_5 = __pyx_t_12;
          goto __pyx_L28_bool_binop_done;
        }
        __pyx_t_12 = ((__pyx_v_dji &lt;= 4.5) != 0);
        __pyx_t_5 = __pyx_t_12;
        __pyx_L28_bool_binop_done:;
        if (__pyx_t_5) {
/* â€¦ */
          goto __pyx_L25;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1247</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_13 = __pyx_v_i;
          __pyx_t_14 = __pyx_v_j;
          __pyx_t_16 = __pyx_v_i;
          __pyx_v_sol_expfactor_i = ((__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_13 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_16 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1248</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_16 = __pyx_v_i;
          __pyx_t_14 = __pyx_v_j;
          __pyx_t_13 = __pyx_v_j;
          __pyx_v_sol_expfactor_j = ((__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_16 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_13 * __pyx_v_environmen_lklam.strides[0]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1249</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1250</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span></pre>
<pre class='cython code score-0 '>          __pyx_t_13 = __pyx_v_i;
          __pyx_t_14 = __pyx_v_j;
          __pyx_t_16 = 0;
          __pyx_t_15 = __pyx_v_i;
          __pyx_t_9 = __pyx_v_j;
          __pyx_t_4 = __pyx_v_i;
          __pyx_t_10 = __pyx_v_i;
          __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_13 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_16 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * ((-2.0 * (__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_15 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[1]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_4 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_10 * __pyx_v_ligand_lklam.strides[0]) )))))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1251</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span></pre>
<pre class='cython code score-0 '>          __pyx_t_10 = __pyx_v_i;
          __pyx_t_4 = __pyx_v_j;
          __pyx_t_9 = 1;
          __pyx_t_15 = __pyx_v_i;
          __pyx_t_16 = __pyx_v_j;
          __pyx_t_14 = __pyx_v_j;
          __pyx_t_13 = __pyx_v_j;
          __pyx_v_sol = (__pyx_v_sol + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_10 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_9 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * ((-2.0 * (__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_15 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_16 * __pyx_v_ligand_environment_dljr.strides[1]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_14 * __pyx_v_environmen_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_13 * __pyx_v_environmen_lklam.strides[0]) )))))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1252</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1253</span>:                 <span class="k">elif</span> <span class="mf">4.5</span> <span class="o">&lt;</span> <span class="n">dji</span> <span class="ow">and</span> <span class="n">dji</span> <span class="o">&lt;=</span> <span class="mf">6.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = ((4.5 &lt; __pyx_v_dji) != 0);
        if (__pyx_t_12) {
        } else {
          __pyx_t_5 = __pyx_t_12;
          goto __pyx_L30_bool_binop_done;
        }
        __pyx_t_12 = ((__pyx_v_dji &lt;= 6.0) != 0);
        __pyx_t_5 = __pyx_t_12;
        __pyx_L30_bool_binop_done:;
        if (__pyx_t_5) {
/* â€¦ */
          goto __pyx_L25;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1254</span>:                     <span class="n">s</span> <span class="o">=</span> <span class="n">switch</span><span class="p">(</span><span class="n">dji</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_s = __pyx_f_6Energy_switch(__pyx_v_dji, 4.5, 6.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1255</span>:                     <span class="n">s_p</span> <span class="o">=</span> <span class="n">switch_gradient</span><span class="p">(</span><span class="n">dji</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_v_s_p = __pyx_f_6Energy_switch_gradient(__pyx_v_dji, 4.5, 6.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">1256</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1257</span>:                     <span class="n">sol_expfactor_i</span> <span class="o">=</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_13 = __pyx_v_i;
          __pyx_t_14 = __pyx_v_j;
          __pyx_t_16 = __pyx_v_i;
          __pyx_v_sol_expfactor_i = ((__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_13 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_16 * __pyx_v_ligand_lklam.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1258</span>:                     <span class="n">sol_expfactor_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_16 = __pyx_v_i;
          __pyx_t_14 = __pyx_v_j;
          __pyx_t_13 = __pyx_v_j;
          __pyx_v_sol_expfactor_j = ((__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_16 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_environment_dljr.strides[1]) )))) / (*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_13 * __pyx_v_environmen_lklam.strides[0]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1259</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1260</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ligand_lklam</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>          __pyx_t_13 = __pyx_v_i;
          __pyx_t_14 = __pyx_v_j;
          __pyx_t_16 = 0;
          __pyx_t_15 = __pyx_v_i;
          __pyx_t_9 = __pyx_v_j;
          __pyx_t_4 = __pyx_v_i;
          __pyx_t_10 = __pyx_v_i;
/* â€¦ */
          __pyx_v_sol = (__pyx_v_sol + (((((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_13 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_16 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * ((-2.0 * (__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_15 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_9 * __pyx_v_ligand_environment_dljr.strides[1]) ))))) / ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_4 * __pyx_v_ligand_lklam.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_ligand_lklam.data + __pyx_t_10 * __pyx_v_ligand_lklam.strides[0]) )))))) * __pyx_v_s) + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_11 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_17 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_18 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_i * __pyx_v_sol_expfactor_i)))) * __pyx_v_s_p)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1261</span>:                            <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_i</span> <span class="o">*</span> <span class="n">sol_expfactor_i</span><span class="p">))</span> <span class="o">*</span> <span class="n">s_p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_t_11 = __pyx_v_i;
          __pyx_t_17 = __pyx_v_j;
          __pyx_t_18 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1262</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1263</span>:                     <span class="n">sol</span> <span class="o">+=</span> <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">dji</span> <span class="o">-</span> <span class="n">ligand_environment_dljr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">environmen_lklam</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span> \</pre>
<pre class='cython code score-0 '>          __pyx_t_18 = __pyx_v_i;
          __pyx_t_17 = __pyx_v_j;
          __pyx_t_11 = 1;
          __pyx_t_10 = __pyx_v_i;
          __pyx_t_4 = __pyx_v_j;
          __pyx_t_9 = __pyx_v_j;
          __pyx_t_15 = __pyx_v_j;
/* â€¦ */
          __pyx_v_sol = (__pyx_v_sol + (((((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_18 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_17 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_11 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * (((-2.0 * (__pyx_v_dji - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_dljr.data + __pyx_t_10 * __pyx_v_ligand_environment_dljr.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_environment_dljr.strides[1]) ))))) / (*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_9 * __pyx_v_environmen_lklam.strides[0]) )))) * (*((double *) ( /* dim=0 */ (__pyx_v_environmen_lklam.data + __pyx_t_15 * __pyx_v_environmen_lklam.strides[0]) ))))) * __pyx_v_s) + (((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_environment_sol_prefactor.data + __pyx_t_16 * __pyx_v_ligand_environment_sol_prefactor.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_environment_sol_prefactor.strides[1]) ) + __pyx_t_13 * __pyx_v_ligand_environment_sol_prefactor.strides[2]) ))) * exp((-1.0 * (__pyx_v_sol_expfactor_j * __pyx_v_sol_expfactor_j)))) * __pyx_v_s_p)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1264</span>:                            <span class="p">(</span><span class="n">ligand_environment_sol_prefactor</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1</span> <span class="o">*</span> <span class="p">(</span><span class="n">sol_expfactor_j</span> <span class="o">*</span> <span class="n">sol_expfactor_j</span><span class="p">))</span> <span class="o">*</span> <span class="n">s_p</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>          __pyx_t_16 = __pyx_v_i;
          __pyx_t_14 = __pyx_v_j;
          __pyx_t_13 = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">1265</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1266</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1267</span>:                     <span class="n">sol</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>        /*else*/ {
          __pyx_v_sol = 0.0;
        }
        __pyx_L25:;
</pre><pre class="cython line score-0">&#xA0;<span class="">1268</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1269</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1270</span>:             <span class="c">#if rep &gt; 1000 or atr &gt; 1000 or col &gt; 1000 or sol &gt; 1000 or dji ==0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1271</span>:             <span class="c">#    print(&#39;BBB ligand_environment_gradient componenet&#39;, rep, atr, col, sol, dxji, dyji, dzji, dji)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1272</span>:             <span class="c">#    print(&#39;BBB found 0 distance&#39;, i, j, dji)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1273</span>:             <span class="c">#    return</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1274</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1275</span>:             <span class="n">grad_magnititude</span> <span class="o">=</span> <span class="n">coupling</span> <span class="o">*</span> <span class="p">(</span><span class="n">ligand_environment_weights</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rep</span> <span class="o">+</span> <span class="n">ligand_environment_weights</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">atr</span> <span class="o">+</span> <span class="n">ligand_environment_weights</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">col</span> <span class="o">+</span> <span class="n">ligand_environment_weights</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">sol</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_13 = 0;
      __pyx_t_14 = 1;
      __pyx_t_16 = 2;
      __pyx_t_15 = 3;
      __pyx_v_grad_magnititude = (__pyx_v_coupling * (((((*((double *) ( /* dim=0 */ (__pyx_v_ligand_environment_weights.data + __pyx_t_13 * __pyx_v_ligand_environment_weights.strides[0]) ))) * __pyx_v_rep) + ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_environment_weights.data + __pyx_t_14 * __pyx_v_ligand_environment_weights.strides[0]) ))) * __pyx_v_atr)) + ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_environment_weights.data + __pyx_t_16 * __pyx_v_ligand_environment_weights.strides[0]) ))) * __pyx_v_col)) + ((*((double *) ( /* dim=0 */ (__pyx_v_ligand_environment_weights.data + __pyx_t_15 * __pyx_v_ligand_environment_weights.strides[0]) ))) * __pyx_v_sol)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1276</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1277</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1278</span>:             <span class="c"># Set forces for atom i (ligand)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1279</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">dxji</span> <span class="o">*</span> <span class="n">grad_magnititude</span><span class="p">)</span> <span class="o">/</span> <span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_15 = __pyx_v_i;
      __pyx_t_16 = 0;
      __pyx_t_14 = __pyx_v_i;
      __pyx_t_13 = 0;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_14 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_13 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_15 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_16 * __pyx_v_gradient_vector.strides[1]) ))) + ((__pyx_v_dxji * __pyx_v_grad_magnititude) / __pyx_v_dji));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1280</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">dyji</span> <span class="o">*</span> <span class="n">grad_magnititude</span><span class="p">)</span> <span class="o">/</span> <span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = __pyx_v_i;
      __pyx_t_15 = 1;
      __pyx_t_13 = __pyx_v_i;
      __pyx_t_14 = 1;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_13 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_14 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_16 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_15 * __pyx_v_gradient_vector.strides[1]) ))) + ((__pyx_v_dyji * __pyx_v_grad_magnititude) / __pyx_v_dji));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1281</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">dzji</span> <span class="o">*</span> <span class="n">grad_magnititude</span><span class="p">)</span> <span class="o">/</span> <span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_t_15 = __pyx_v_i;
      __pyx_t_16 = 2;
      __pyx_t_14 = __pyx_v_i;
      __pyx_t_13 = 2;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_14 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_13 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_15 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_16 * __pyx_v_gradient_vector.strides[1]) ))) + ((__pyx_v_dzji * __pyx_v_grad_magnititude) / __pyx_v_dji));
      __pyx_L6_continue:;
    }
    __pyx_L3_continue:;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1282</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1283</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1284</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1285</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1286</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1287</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1288</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-71" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1289</span>: <span class="k">def</span> <span class="nf">bond_gradient</span><span class="p">(</span><span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-71 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_19bond_gradient(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6Energy_18bond_gradient[] = "\n    Computes the gradient of bond potential\n    ";
static PyMethodDef __pyx_mdef_6Energy_19bond_gradient = {"bond_gradient", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_19bond_gradient, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6Energy_18bond_gradient};
static PyObject *__pyx_pw_6Energy_19bond_gradient(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_ligand_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_bond_atomIndex = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_equilibrium_distance = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_force_constance = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_gradient_vector = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("bond_gradient (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ligand_xyz,&amp;__pyx_n_s_bond_atomIndex,&amp;__pyx_n_s_equilibrium_distance,&amp;__pyx_n_s_force_constance,&amp;__pyx_n_s_gradient_vector,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_xyz)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_bond_atomIndex)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bond_gradient", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 1289, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_equilibrium_distance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bond_gradient", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 1289, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_force_constance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bond_gradient", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 1289, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_gradient_vector)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bond_gradient", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 1289, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "bond_gradient") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1289, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_ligand_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_xyz.memview)) __PYX_ERR(0, 1289, __pyx_L3_error)</span>
    __pyx_v_bond_atomIndex = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_bond_atomIndex.memview)) __PYX_ERR(0, 1290, __pyx_L3_error)</span>
    __pyx_v_equilibrium_distance = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_equilibrium_distance.memview)) __PYX_ERR(0, 1291, __pyx_L3_error)</span>
    __pyx_v_force_constance = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_force_constance.memview)) __PYX_ERR(0, 1292, __pyx_L3_error)</span>
    __pyx_v_gradient_vector = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_gradient_vector.memview)) __PYX_ERR(0, 1293, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("bond_gradient", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 1289, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.bond_gradient", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_18bond_gradient(__pyx_self, __pyx_v_ligand_xyz, __pyx_v_bond_atomIndex, __pyx_v_equilibrium_distance, __pyx_v_force_constance, __pyx_v_gradient_vector);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_18bond_gradient(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_bond_atomIndex, __Pyx_memviewslice __pyx_v_equilibrium_distance, __Pyx_memviewslice __pyx_v_force_constance, __Pyx_memviewslice __pyx_v_gradient_vector) {
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_ibond;
  int __pyx_v_N;
  double __pyx_v_dxji;
  double __pyx_v_dyji;
  double __pyx_v_dzji;
  double __pyx_v_dji;
  double __pyx_v_g;
  PyObject *__pyx_v_d = NULL;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__10)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("bond_gradient", 0);
  <span class='trace'>__Pyx_TraceCall</span>("bond_gradient", __pyx_f[0], 1289, 0, <span class='error_goto'>__PYX_ERR(0, 1289, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.bond_gradient", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_d);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_bond_atomIndex, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_equilibrium_distance, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_force_constance, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_gradient_vector, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__41 = <span class='py_c_api'>PyTuple_Pack</span>(15, __pyx_n_s_ligand_xyz, __pyx_n_s_bond_atomIndex, __pyx_n_s_equilibrium_distance, __pyx_n_s_force_constance, __pyx_n_s_gradient_vector, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_ibond, __pyx_n_s_N, __pyx_n_s_dxji, __pyx_n_s_dyji, __pyx_n_s_dzji, __pyx_n_s_dji, __pyx_n_s_g, __pyx_n_s_d);<span class='error_goto'> if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 1289, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__41);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__41);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_19bond_gradient, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1289, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_bond_gradient, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1289, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__10 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(5, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__41, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_bond_gradient, 1289, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__10)) __PYX_ERR(0, 1289, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">1290</span>:                   <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">bond_atomIndex</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1291</span>:                   <span class="n">double</span> <span class="p">[:]</span> <span class="n">equilibrium_distance</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1292</span>:                   <span class="n">double</span> <span class="p">[:]</span> <span class="n">force_constance</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1293</span>:                   <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">gradient_vector</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1294</span>:     <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1295</span>: <span class="sd">    Computes the gradient of bond potential</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1296</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1297</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">ibond</span><span class="p">,</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">bond_atomIndex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_bond_atomIndex.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">1298</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dxji</span><span class="p">,</span> <span class="nf">dyji</span><span class="p">,</span> <span class="nf">dzji</span><span class="p">,</span> <span class="nf">dji</span><span class="p">,</span> <span class="nf">g</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1299</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1300</span>:     <span class="k">for</span> <span class="n">ibond</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_ibond = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1301</span>:             <span class="n">i</span> <span class="o">=</span> <span class="n">bond_atomIndex</span><span class="p">[</span><span class="n">ibond</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_ibond;
    __pyx_t_5 = 0;
    __pyx_v_i = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_bond_atomIndex.data + __pyx_t_4 * __pyx_v_bond_atomIndex.strides[0]) ) + __pyx_t_5 * __pyx_v_bond_atomIndex.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1302</span>:             <span class="n">j</span> <span class="o">=</span> <span class="n">bond_atomIndex</span><span class="p">[</span><span class="n">ibond</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_ibond;
    __pyx_t_4 = 1;
    __pyx_v_j = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_bond_atomIndex.data + __pyx_t_5 * __pyx_v_bond_atomIndex.strides[0]) ) + __pyx_t_4 * __pyx_v_bond_atomIndex.strides[1]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">1303</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1304</span>:             <span class="n">dxji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = 0;
    __pyx_t_6 = __pyx_v_j;
    __pyx_t_7 = 0;
    __pyx_v_dxji = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_6 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1305</span>:             <span class="n">dyji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_i;
    __pyx_t_6 = 1;
    __pyx_t_5 = __pyx_v_j;
    __pyx_t_4 = 1;
    __pyx_v_dyji = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_7 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_6 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_5 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1306</span>:             <span class="n">dzji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = 2;
    __pyx_t_6 = __pyx_v_j;
    __pyx_t_7 = 2;
    __pyx_v_dzji = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_6 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1307</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1308</span>:             <span class="n">dji</span> <span class="o">=</span> <span class="n">dxji</span> <span class="o">*</span> <span class="n">dxji</span> <span class="o">+</span> <span class="n">dyji</span> <span class="o">*</span> <span class="n">dyji</span> <span class="o">+</span> <span class="n">dzji</span> <span class="o">*</span> <span class="n">dzji</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dji = (((__pyx_v_dxji * __pyx_v_dxji) + (__pyx_v_dyji * __pyx_v_dyji)) + (__pyx_v_dzji * __pyx_v_dzji));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1309</span>:             <span class="n">dji</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dji = sqrt(__pyx_v_dji);
</pre><pre class="cython line score-0">&#xA0;<span class="">1310</span>:             <span class="c">#if i == 16 and j == 39:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1311</span>:             <span class="c">#    print(&#39;BBB O5 H16 dji&#39;, dji)</span></pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1312</span>:             <span class="n">d</span> <span class="o">=</span> <span class="n">dji</span> <span class="o">-</span> <span class="n">equilibrium_distance</span><span class="p">[</span><span class="n">ibond</span><span class="p">]</span></pre>
<pre class='cython code score-6 '>    __pyx_t_7 = __pyx_v_ibond;
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_dji - (*((double *) ( /* dim=0 */ (__pyx_v_equilibrium_distance.data + __pyx_t_7 * __pyx_v_equilibrium_distance.strides[0]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1312, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_d, __pyx_t_8);
    __pyx_t_8 = 0;
</pre><pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1313</span>:             <span class="n">g</span> <span class="o">=</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">force_constance</span><span class="p">[</span><span class="n">ibond</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span></pre>
<pre class='cython code score-22 '>    __pyx_t_7 = __pyx_v_ibond;
    __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>((2.0 * (*((double *) ( /* dim=0 */ (__pyx_v_force_constance.data + __pyx_t_7 * __pyx_v_force_constance.strides[0]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1313, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_9 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_8, __pyx_v_d);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1313, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_10 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_9); if (unlikely((__pyx_t_10 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1313, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_v_g = __pyx_t_10;
</pre><pre class="cython line score-0">&#xA0;<span class="">1314</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1315</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">dxji</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_i;
    __pyx_t_6 = 0;
    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = 0;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_5 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_4 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_7 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_6 * __pyx_v_gradient_vector.strides[1]) ))) + ((__pyx_v_dxji * __pyx_v_g) / __pyx_v_dji));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1316</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">dxji</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_v_i;
    __pyx_t_7 = 1;
    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = 1;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_4 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_5 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_6 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_7 * __pyx_v_gradient_vector.strides[1]) ))) + ((__pyx_v_dxji * __pyx_v_g) / __pyx_v_dji));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1317</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">dxji</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_i;
    __pyx_t_6 = 2;
    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = 2;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_5 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_4 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_7 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_6 * __pyx_v_gradient_vector.strides[1]) ))) + ((__pyx_v_dxji * __pyx_v_g) / __pyx_v_dji));
</pre><pre class="cython line score-0">&#xA0;<span class="">1318</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1319</span>:             <span class="c"># For atom j we use -dxji</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1320</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="n">dxji</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_v_j;
    __pyx_t_7 = 0;
    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = 0;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_4 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_5 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_6 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_7 * __pyx_v_gradient_vector.strides[1]) ))) + (((-__pyx_v_dxji) * __pyx_v_g) / __pyx_v_dji));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1321</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="n">dxji</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_j;
    __pyx_t_6 = 1;
    __pyx_t_5 = __pyx_v_j;
    __pyx_t_4 = 1;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_5 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_4 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_7 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_6 * __pyx_v_gradient_vector.strides[1]) ))) + (((-__pyx_v_dxji) * __pyx_v_g) / __pyx_v_dji));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1322</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="o">-</span><span class="n">dxji</span> <span class="o">*</span> <span class="n">g</span><span class="p">)</span> <span class="o">/</span> <span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_v_j;
    __pyx_t_7 = 2;
    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = 2;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_4 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_5 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_6 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_7 * __pyx_v_gradient_vector.strides[1]) ))) + (((-__pyx_v_dxji) * __pyx_v_g) / __pyx_v_dji));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1323</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1324</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1325</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1326</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1327</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1328</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1329</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-78" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1330</span>: <span class="k">def</span> <span class="nf">angle_gradient</span><span class="p">(</span><span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class='cython code score-78 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_21angle_gradient(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6Energy_20angle_gradient[] = "\n    Computes bond potential\n    ";
static PyMethodDef __pyx_mdef_6Energy_21angle_gradient = {"angle_gradient", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_21angle_gradient, METH_VARARGS|METH_KEYWORDS, __pyx_doc_6Energy_20angle_gradient};
static PyObject *__pyx_pw_6Energy_21angle_gradient(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_ligand_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_angle_atomIndex = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_equilibrium_angle = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_force_constance = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_gradient_vector = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angle_gradient (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_ligand_xyz,&amp;__pyx_n_s_angle_atomIndex,&amp;__pyx_n_s_equilibrium_angle,&amp;__pyx_n_s_force_constance,&amp;__pyx_n_s_gradient_vector,0};
    PyObject* values[5] = {0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_xyz)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_angle_atomIndex)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle_gradient", 1, 5, 5, 1); <span class='error_goto'>__PYX_ERR(0, 1330, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_equilibrium_angle)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle_gradient", 1, 5, 5, 2); <span class='error_goto'>__PYX_ERR(0, 1330, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_force_constance)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle_gradient", 1, 5, 5, 3); <span class='error_goto'>__PYX_ERR(0, 1330, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_gradient_vector)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle_gradient", 1, 5, 5, 4); <span class='error_goto'>__PYX_ERR(0, 1330, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "angle_gradient") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1330, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 5) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
    }
    __pyx_v_ligand_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_xyz.memview)) __PYX_ERR(0, 1330, __pyx_L3_error)</span>
    __pyx_v_angle_atomIndex = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_angle_atomIndex.memview)) __PYX_ERR(0, 1331, __pyx_L3_error)</span>
    __pyx_v_equilibrium_angle = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_equilibrium_angle.memview)) __PYX_ERR(0, 1332, __pyx_L3_error)</span>
    __pyx_v_force_constance = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_force_constance.memview)) __PYX_ERR(0, 1333, __pyx_L3_error)</span>
    __pyx_v_gradient_vector = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_gradient_vector.memview)) __PYX_ERR(0, 1334, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("angle_gradient", 1, 5, 5, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 1330, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.angle_gradient", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_20angle_gradient(__pyx_self, __pyx_v_ligand_xyz, __pyx_v_angle_atomIndex, __pyx_v_equilibrium_angle, __pyx_v_force_constance, __pyx_v_gradient_vector);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_20angle_gradient(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_angle_atomIndex, __Pyx_memviewslice __pyx_v_equilibrium_angle, __Pyx_memviewslice __pyx_v_force_constance, __Pyx_memviewslice __pyx_v_gradient_vector) {
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_iangle;
  int __pyx_v_N;
  double __pyx_v_dji;
  double __pyx_v_djk;
  double __pyx_v_djidjk;
  double __pyx_v_djidjk_n;
  double __pyx_v_teta;
  double __pyx_v_dteta;
  double __pyx_v_sn;
  double __pyx_v_g;
  double __pyx_v_dji2inv;
  CYTHON_UNUSED double __pyx_v_djk2inv;
  double __pyx_v_gxi;
  double __pyx_v_gyi;
  double __pyx_v_gzi;
  double __pyx_v_gxk;
  double __pyx_v_gyk;
  double __pyx_v_gzk;
  PyObject *__pyx_v_k = NULL;
  PyObject *__pyx_v_dxji = NULL;
  PyObject *__pyx_v_dyji = NULL;
  PyObject *__pyx_v_dzji = NULL;
  PyObject *__pyx_v_dxjk = NULL;
  PyObject *__pyx_v_dyjk = NULL;
  PyObject *__pyx_v_dzjk = NULL;
  CYTHON_UNUSED long __pyx_v_djdjidjk_nidjk;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__11)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("angle_gradient", 0);
  <span class='trace'>__Pyx_TraceCall</span>("angle_gradient", __pyx_f[0], 1330, 0, <span class='error_goto'>__PYX_ERR(0, 1330, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.angle_gradient", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_k);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dxji);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dyji);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dzji);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dxjk);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dyjk);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dzjk);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_angle_atomIndex, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_equilibrium_angle, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_force_constance, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_gradient_vector, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__42 = <span class='py_c_api'>PyTuple_Pack</span>(36, __pyx_n_s_ligand_xyz, __pyx_n_s_angle_atomIndex, __pyx_n_s_equilibrium_angle, __pyx_n_s_force_constance, __pyx_n_s_gradient_vector, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_iangle, __pyx_n_s_N, __pyx_n_s_dx, __pyx_n_s_dy, __pyx_n_s_dz, __pyx_n_s_dji, __pyx_n_s_djk, __pyx_n_s_djidjk, __pyx_n_s_djidjk_n, __pyx_n_s_teta, __pyx_n_s_dteta, __pyx_n_s_sn, __pyx_n_s_g, __pyx_n_s_dji2inv, __pyx_n_s_djk2inv, __pyx_n_s_gxi, __pyx_n_s_gyi, __pyx_n_s_gzi, __pyx_n_s_gxk, __pyx_n_s_gyk, __pyx_n_s_gzk, __pyx_n_s_k, __pyx_n_s_dxji, __pyx_n_s_dyji, __pyx_n_s_dzji, __pyx_n_s_dxjk, __pyx_n_s_dyjk, __pyx_n_s_dzjk, __pyx_n_s_djdjidjk_nidjk);<span class='error_goto'> if (unlikely(!__pyx_tuple__42)) __PYX_ERR(0, 1330, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__42);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__42);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_21angle_gradient, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1330, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_angle_gradient, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1330, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__11 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(5, 0, 36, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__42, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_angle_gradient, 1330, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__11)) __PYX_ERR(0, 1330, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">1331</span>:                   <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">angle_atomIndex</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1332</span>:                   <span class="n">double</span> <span class="p">[:]</span> <span class="n">equilibrium_angle</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1333</span>:                   <span class="n">double</span> <span class="p">[:]</span> <span class="n">force_constance</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1334</span>:                   <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">gradient_vector</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1335</span>:     <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1336</span>: <span class="sd">    Computes bond potential</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1337</span>: <span class="sd">    &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1338</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">iangle</span><span class="p">,</span> <span class="nf">N</span> <span class="o">=</span> <span class="n">angle_atomIndex</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_N = (__pyx_v_angle_atomIndex.shape[0]);
</pre><pre class="cython line score-0">&#xA0;<span class="">1339</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dx</span><span class="p">,</span> <span class="nf">dy</span><span class="p">,</span> <span class="nf">dz</span><span class="p">,</span> <span class="nf">dji</span><span class="p">,</span> <span class="nf">djk</span><span class="p">,</span> <span class="nf">djidjk</span><span class="p">,</span> <span class="nf">djidjk_n</span><span class="p">,</span> <span class="nf">teta</span><span class="p">,</span> <span class="nf">dteta</span><span class="p">,</span> <span class="nf">sn</span><span class="p">,</span> <span class="nf">g</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1340</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">dji2inv</span><span class="p">,</span> <span class="nf">djk2inv</span><span class="p">,</span> <span class="nf">gxi</span><span class="p">,</span> <span class="nf">gyi</span><span class="p">,</span> <span class="nf">gzi</span><span class="p">,</span> <span class="nf">gxk</span><span class="p">,</span> <span class="nf">gyk</span><span class="p">,</span> <span class="nf">gzk</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1341</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1342</span>:     <span class="k">for</span> <span class="n">iangle</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_N;
  __pyx_t_2 = __pyx_t_1;
  for (__pyx_t_3 = 0; __pyx_t_3 &lt; __pyx_t_2; __pyx_t_3+=1) {
    __pyx_v_iangle = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1343</span>:             <span class="n">i</span> <span class="o">=</span> <span class="n">angle_atomIndex</span><span class="p">[</span><span class="n">iangle</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_iangle;
    __pyx_t_5 = 0;
    __pyx_v_i = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_angle_atomIndex.data + __pyx_t_4 * __pyx_v_angle_atomIndex.strides[0]) ) + __pyx_t_5 * __pyx_v_angle_atomIndex.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1344</span>:             <span class="n">j</span> <span class="o">=</span> <span class="n">angle_atomIndex</span><span class="p">[</span><span class="n">iangle</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_iangle;
    __pyx_t_4 = 1;
    __pyx_v_j = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_angle_atomIndex.data + __pyx_t_5 * __pyx_v_angle_atomIndex.strides[0]) ) + __pyx_t_4 * __pyx_v_angle_atomIndex.strides[1]) )));
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1345</span>:             <span class="n">k</span> <span class="o">=</span> <span class="n">angle_atomIndex</span><span class="p">[</span><span class="n">iangle</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-3 '>    __pyx_t_4 = __pyx_v_iangle;
    __pyx_t_5 = 2;
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_angle_atomIndex.data + __pyx_t_4 * __pyx_v_angle_atomIndex.strides[0]) ) + __pyx_t_5 * __pyx_v_angle_atomIndex.strides[1]) ))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1345, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_k, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1346</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1347</span>:             <span class="n">dxji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-6 '>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = 0;
    __pyx_t_7 = __pyx_v_j;
    __pyx_t_8 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_5 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_7 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1347, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dxji, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1348</span>:             <span class="n">dyji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-6 '>    __pyx_t_8 = __pyx_v_i;
    __pyx_t_7 = 1;
    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = 1;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_8 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1348, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dyji, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1349</span>:             <span class="n">dzji</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-6 '>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = 2;
    __pyx_t_7 = __pyx_v_j;
    __pyx_t_8 = 2;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_5 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_7 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1349, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dzji, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1350</span>: </pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1351</span>:             <span class="n">dxjk</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1351, __pyx_L1_error)</span>
    __pyx_t_8 = __pyx_t_9;
    __pyx_t_7 = 0;
    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_8 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1351, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dxjk, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1352</span>:             <span class="n">dyjk</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1352, __pyx_L1_error)</span>
    __pyx_t_5 = __pyx_t_9;
    __pyx_t_4 = 1;
    __pyx_t_7 = __pyx_v_j;
    __pyx_t_8 = 1;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_5 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_4 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_7 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_8 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1352, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dyjk, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1353</span>:             <span class="n">dzjk</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-13 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1353, __pyx_L1_error)</span>
    __pyx_t_8 = __pyx_t_9;
    __pyx_t_7 = 2;
    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = 2;
    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_8 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_7 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_4 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_5 * __pyx_v_ligand_xyz.strides[1]) )))));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1353, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_dzjk, __pyx_t_6);
    __pyx_t_6 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1354</span>: </pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1355</span>:             <span class="n">dji</span> <span class="o">=</span> <span class="n">dxji</span> <span class="o">*</span> <span class="n">dxji</span> <span class="o">+</span> <span class="n">dyji</span> <span class="o">*</span> <span class="n">dyji</span> <span class="o">+</span> <span class="n">dzji</span> <span class="o">*</span> <span class="n">dzji</span></pre>
<pre class='cython code score-40 '>    __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dxji, __pyx_v_dxji);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1355, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dyji, __pyx_v_dyji);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1355, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_11 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_6, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1355, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dzji, __pyx_v_dzji);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1355, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_11, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1355, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1355, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_dji = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1356</span>:             <span class="n">dji</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dji = sqrt(__pyx_v_dji);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1357</span>:             <span class="n">dji2inv</span> <span class="o">=</span> <span class="mf">1</span><span class="o">/</span><span class="p">(</span><span class="n">dji</span><span class="o">*</span><span class="n">dji</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dji2inv = (1.0 / (__pyx_v_dji * __pyx_v_dji));
</pre><pre class="cython line score-0">&#xA0;<span class="">1358</span>: </pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1359</span>:             <span class="n">djk</span> <span class="o">=</span> <span class="n">dxjk</span> <span class="o">*</span> <span class="n">dxjk</span> <span class="o">+</span> <span class="n">dyjk</span> <span class="o">*</span> <span class="n">dyjk</span> <span class="o">+</span> <span class="n">dzjk</span> <span class="o">*</span> <span class="n">dzjk</span></pre>
<pre class='cython code score-40 '>    __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dxjk, __pyx_v_dxjk);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1359, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dyjk, __pyx_v_dyjk);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1359, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_11 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_6, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1359, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dzjk, __pyx_v_dzjk);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1359, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_11, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1359, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1359, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_djk = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1360</span>:             <span class="n">djk</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">djk</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_djk = sqrt(__pyx_v_djk);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1361</span>:             <span class="n">djk2inv</span> <span class="o">=</span> <span class="mf">1</span><span class="o">/</span><span class="p">(</span><span class="n">djk</span><span class="o">*</span><span class="n">djk</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_djk2inv = (1.0 / (__pyx_v_djk * __pyx_v_djk));
</pre><pre class="cython line score-0">&#xA0;<span class="">1362</span>: </pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1363</span>:             <span class="n">djidjk</span> <span class="o">=</span> <span class="n">dxji</span> <span class="o">*</span> <span class="n">dxjk</span> <span class="o">+</span> <span class="n">dyji</span> <span class="o">*</span> <span class="n">dyjk</span> <span class="o">+</span> <span class="n">dzji</span> <span class="o">*</span> <span class="n">dzjk</span></pre>
<pre class='cython code score-40 '>    __pyx_t_6 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dxji, __pyx_v_dxjk);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1363, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dyji, __pyx_v_dyjk);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1363, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_11 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_6, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1363, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_dzji, __pyx_v_dzjk);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1363, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Add</span>(__pyx_t_11, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1363, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1363, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_djidjk = __pyx_t_12;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1364</span>:             <span class="n">djidjk_n</span> <span class="o">=</span> <span class="n">djidjk</span> <span class="o">/</span> <span class="p">(</span><span class="n">dji</span> <span class="o">*</span> <span class="n">djk</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_djidjk_n = (__pyx_v_djidjk / (__pyx_v_dji * __pyx_v_djk));
</pre><pre class="cython line score-0">&#xA0;<span class="">1365</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1366</span>:             <span class="k">if</span> <span class="n">djidjk_n</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span> <span class="n">djidjk_n</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = ((__pyx_v_djidjk_n &gt; 1.0) != 0);
    if (__pyx_t_13) {
      __pyx_v_djidjk_n = 1.0;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1367</span>:             <span class="k">if</span> <span class="n">djidjk_n</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span> <span class="n">djdjidjk_nidjk</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = ((__pyx_v_djidjk_n &lt; -1.0) != 0);
    if (__pyx_t_13) {
      __pyx_v_djdjidjk_nidjk = -1L;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1368</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1369</span>:             <span class="n">teta</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">djidjk_n</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_teta = acos(__pyx_v_djidjk_n);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1370</span>:             <span class="n">dteta</span> <span class="o">=</span> <span class="n">teta</span> <span class="o">-</span> <span class="n">equilibrium_angle</span><span class="p">[</span><span class="n">iangle</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_iangle;
    __pyx_v_dteta = (__pyx_v_teta - (*((double *) ( /* dim=0 */ (__pyx_v_equilibrium_angle.data + __pyx_t_5 * __pyx_v_equilibrium_angle.strides[0]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1371</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1372</span>:             <span class="n">sn</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">teta</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sn = sin(__pyx_v_teta);
</pre><pre class="cython line score-0">&#xA0;<span class="">1373</span>:             <span class="c"># To avoid zero division</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1374</span>:             <span class="k">if</span> <span class="n">sn</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span> <span class="n">sn</span> <span class="o">=</span> <span class="mf">0.000000001</span></pre>
<pre class='cython code score-0 '>    __pyx_t_13 = ((__pyx_v_sn == 0.0) != 0);
    if (__pyx_t_13) {
      __pyx_v_sn = 0.000000001;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1375</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1376</span>:             <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">2</span> <span class="o">*</span> <span class="n">force_constance</span><span class="p">[</span><span class="n">iangle</span><span class="p">]</span> <span class="o">*</span> <span class="n">dteta</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sn</span> <span class="o">*</span> <span class="n">dji</span> <span class="o">*</span> <span class="n">djk</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_iangle;
    __pyx_v_g = (((-2.0 * (*((double *) ( /* dim=0 */ (__pyx_v_force_constance.data + __pyx_t_5 * __pyx_v_force_constance.strides[0]) )))) * __pyx_v_dteta) / ((__pyx_v_sn * __pyx_v_dji) * __pyx_v_djk));
</pre><pre class="cython line score-0">&#xA0;<span class="">1377</span>: </pre>
<pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1378</span>:             <span class="n">gxi</span> <span class="o">=</span> <span class="n">dxjk</span> <span class="o">-</span> <span class="p">(</span><span class="n">djidjk</span> <span class="o">*</span> <span class="n">dji2inv</span> <span class="o">*</span> <span class="n">dxji</span><span class="p">)</span></pre>
<pre class='cython code score-28 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_djidjk * __pyx_v_dji2inv));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1378, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_v_dxji);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1378, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_dxjk, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1378, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1378, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_gxi = __pyx_t_12;
</pre><pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1379</span>:             <span class="n">gyi</span> <span class="o">=</span> <span class="n">dyjk</span> <span class="o">-</span> <span class="p">(</span><span class="n">djidjk</span> <span class="o">*</span> <span class="n">dji2inv</span> <span class="o">*</span> <span class="n">dyji</span><span class="p">)</span></pre>
<pre class='cython code score-28 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_djidjk * __pyx_v_dji2inv));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1379, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_v_dyji);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1379, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_dyjk, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1379, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1379, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_gyi = __pyx_t_12;
</pre><pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1380</span>:             <span class="n">gzi</span> <span class="o">=</span> <span class="n">dzjk</span> <span class="o">-</span> <span class="p">(</span><span class="n">djidjk</span> <span class="o">*</span> <span class="n">dji2inv</span> <span class="o">*</span> <span class="n">dzji</span><span class="p">)</span></pre>
<pre class='cython code score-28 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_djidjk * __pyx_v_dji2inv));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1380, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_v_dzji);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1380, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_dzjk, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1380, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1380, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_gzi = __pyx_t_12;
</pre><pre class="cython line score-0">&#xA0;<span class="">1381</span>: </pre>
<pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1382</span>:             <span class="n">gxk</span> <span class="o">=</span> <span class="n">dxji</span> <span class="o">-</span> <span class="p">(</span><span class="n">djidjk</span> <span class="o">*</span> <span class="n">dji2inv</span> <span class="o">*</span> <span class="n">dxjk</span><span class="p">)</span></pre>
<pre class='cython code score-28 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_djidjk * __pyx_v_dji2inv));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1382, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_v_dxjk);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1382, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_dxji, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1382, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1382, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_gxk = __pyx_t_12;
</pre><pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1383</span>:             <span class="n">gyk</span> <span class="o">=</span> <span class="n">dyji</span> <span class="o">-</span> <span class="p">(</span><span class="n">djidjk</span> <span class="o">*</span> <span class="n">dji2inv</span> <span class="o">*</span> <span class="n">dyjk</span><span class="p">)</span></pre>
<pre class='cython code score-28 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_djidjk * __pyx_v_dji2inv));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1383, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_v_dyjk);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1383, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_dyji, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1383, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1383, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_gyk = __pyx_t_12;
</pre><pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1384</span>:             <span class="n">gzk</span> <span class="o">=</span> <span class="n">dzji</span> <span class="o">-</span> <span class="p">(</span><span class="n">djidjk</span> <span class="o">*</span> <span class="n">dji2inv</span> <span class="o">*</span> <span class="n">dzjk</span><span class="p">)</span></pre>
<pre class='cython code score-28 '>    __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_v_djidjk * __pyx_v_dji2inv));<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1384, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_10 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_t_6, __pyx_v_dzjk);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1384, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_dzji, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1384, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_12 = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(__pyx_t_6); if (unlikely((__pyx_t_12 == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1384, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_v_gzk = __pyx_t_12;
</pre><pre class="cython line score-0">&#xA0;<span class="">1385</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1386</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">gxi</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = 0;
    __pyx_t_7 = __pyx_v_i;
    __pyx_t_8 = 0;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_7 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_8 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_5 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_4 * __pyx_v_gradient_vector.strides[1]) ))) + (__pyx_v_g * __pyx_v_gxi));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1387</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">gyi</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_i;
    __pyx_t_5 = 1;
    __pyx_t_8 = __pyx_v_i;
    __pyx_t_7 = 1;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_8 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_7 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_4 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_5 * __pyx_v_gradient_vector.strides[1]) ))) + (__pyx_v_g * __pyx_v_gyi));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1388</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">gzi</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_i;
    __pyx_t_4 = 2;
    __pyx_t_7 = __pyx_v_i;
    __pyx_t_8 = 2;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_7 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_8 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_5 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_4 * __pyx_v_gradient_vector.strides[1]) ))) + (__pyx_v_g * __pyx_v_gzi));
</pre><pre class="cython line score-0">&#xA0;<span class="">1389</span>: </pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1390</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">gxk</span><span class="p">)</span></pre>
<pre class='cython code score-14 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1390, __pyx_L1_error)</span>
    __pyx_t_4 = __pyx_t_9;
    __pyx_t_5 = 0;
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_14 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1390, __pyx_L1_error)</span>
    __pyx_t_8 = __pyx_t_14;
    __pyx_t_7 = 0;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_8 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_7 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_4 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_5 * __pyx_v_gradient_vector.strides[1]) ))) + (__pyx_v_g * __pyx_v_gxk));
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1391</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">gyk</span><span class="p">)</span></pre>
<pre class='cython code score-14 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1391, __pyx_L1_error)</span>
    __pyx_t_5 = __pyx_t_9;
    __pyx_t_4 = 1;
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_14 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1391, __pyx_L1_error)</span>
    __pyx_t_7 = __pyx_t_14;
    __pyx_t_8 = 1;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_7 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_8 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_5 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_4 * __pyx_v_gradient_vector.strides[1]) ))) + (__pyx_v_g * __pyx_v_gyk));
</pre><pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1392</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="n">gzk</span><span class="p">)</span></pre>
<pre class='cython code score-14 '>    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1392, __pyx_L1_error)</span>
    __pyx_t_4 = __pyx_t_9;
    __pyx_t_5 = 2;
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyIndex_AsSsize_t</span>(__pyx_v_k); if (unlikely((__pyx_t_14 == (Py_ssize_t)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1392, __pyx_L1_error)</span>
    __pyx_t_8 = __pyx_t_14;
    __pyx_t_7 = 2;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_8 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_7 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_4 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_5 * __pyx_v_gradient_vector.strides[1]) ))) + (__pyx_v_g * __pyx_v_gzk));
</pre><pre class="cython line score-0">&#xA0;<span class="">1393</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1394</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">gxi</span> <span class="o">+</span> <span class="n">gxk</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_j;
    __pyx_t_4 = 0;
    __pyx_t_7 = __pyx_v_j;
    __pyx_t_8 = 0;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_7 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_8 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_5 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_4 * __pyx_v_gradient_vector.strides[1]) ))) - (__pyx_v_g * (__pyx_v_gxi + __pyx_v_gxk)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1395</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">gxi</span> <span class="o">+</span> <span class="n">gxk</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = __pyx_v_j;
    __pyx_t_5 = 1;
    __pyx_t_8 = __pyx_v_j;
    __pyx_t_7 = 1;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_8 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_7 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_4 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_5 * __pyx_v_gradient_vector.strides[1]) ))) - (__pyx_v_g * (__pyx_v_gxi + __pyx_v_gxk)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1396</span>:             <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">gradient_vector</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="p">(</span><span class="n">gxi</span> <span class="o">+</span> <span class="n">gxk</span><span class="p">))</span></pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_j;
    __pyx_t_4 = 2;
    __pyx_t_7 = __pyx_v_j;
    __pyx_t_8 = 2;
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_7 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_8 * __pyx_v_gradient_vector.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_gradient_vector.data + __pyx_t_5 * __pyx_v_gradient_vector.strides[0]) ) + __pyx_t_4 * __pyx_v_gradient_vector.strides[1]) ))) - (__pyx_v_g * (__pyx_v_gxi + __pyx_v_gxk)));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1397</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1398</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1399</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1400</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1401</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1402</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1403</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1404</span>: <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">double</span> <span class="nf">switch_gradient</span><span class="p">(</span><span class="n">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">double</span> <span class="nb">min</span><span class="p">,</span> <span class="n">double</span> <span class="nb">max</span><span class="p">):</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE double __pyx_f_6Energy_switch_gradient(double __pyx_v_x, double __pyx_v_min, double __pyx_v_max) {
  double __pyx_v_r2;
  double __pyx_v_a2;
  double __pyx_v_b2_a2;
  double __pyx_v_b2;
  double __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("switch_gradient", 0);
  <span class='trace'>__Pyx_TraceCall</span>("switch_gradient", __pyx_f[0], 1404, 0, <span class='error_goto'>__PYX_ERR(0, 1404, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("Energy.switch_gradient", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">1405</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">r2</span><span class="p">,</span> <span class="nf">a2</span><span class="p">,</span> <span class="nf">b2_a2</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1406</span>:     <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_x &lt; __pyx_v_min) != 0);
  if (__pyx_t_1) {
/* â€¦ */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1407</span>:         <span class="k">return</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>    __pyx_r = 1.0;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1408</span>:     <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((__pyx_v_x &gt; __pyx_v_max) != 0);
  if (__pyx_t_1) {
/* â€¦ */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1409</span>:         <span class="k">return</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>    __pyx_r = 0.0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">1410</span>:     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1411</span>:         <span class="n">r2</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span></pre>
<pre class='cython code score-0 '>  /*else*/ {
    __pyx_v_r2 = (__pyx_v_x * __pyx_v_x);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1412</span>:         <span class="n">a2</span> <span class="o">=</span>  <span class="nb">min</span> <span class="o">*</span> <span class="nb">min</span></pre>
<pre class='cython code score-0 '>    __pyx_v_a2 = (__pyx_v_min * __pyx_v_min);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1413</span>:         <span class="n">b2</span> <span class="o">=</span> <span class="nb">max</span> <span class="o">*</span> <span class="nb">max</span></pre>
<pre class='cython code score-0 '>    __pyx_v_b2 = (__pyx_v_max * __pyx_v_max);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1414</span>:         <span class="n">b2_a2</span> <span class="o">=</span> <span class="n">b2</span> <span class="o">-</span> <span class="n">a2</span></pre>
<pre class='cython code score-0 '>    __pyx_v_b2_a2 = (__pyx_v_b2 - __pyx_v_a2);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1415</span>:         <span class="k">return</span> <span class="p">(</span><span class="mf">12</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">a2</span> <span class="o">-</span> <span class="n">r2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">b2</span> <span class="o">-</span> <span class="n">r2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">b2_a2</span><span class="o">*</span><span class="n">b2_a2</span><span class="o">*</span><span class="n">b2_a2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_r = ((((12.0 * __pyx_v_x) * (__pyx_v_a2 - __pyx_v_r2)) * (__pyx_v_b2 - __pyx_v_r2)) / ((__pyx_v_b2_a2 * __pyx_v_b2_a2) * __pyx_v_b2_a2));
    goto __pyx_L0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1416</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1417</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1418</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1419</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1420</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1421</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1422</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-257" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1423</span>: <span class="k">def</span> <span class="nf">grid_search</span><span class="p">(</span><span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">grid</span><span class="p">,</span></pre>
<pre class='cython code score-257 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_23grid_search(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_6Energy_23grid_search = {"grid_search", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_23grid_search, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6Energy_23grid_search(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_grid = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_qij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_dljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_dljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_sol_prefactor = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_nonbonded = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_nonbondedWeights = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_ligand_coupling;
  __Pyx_memviewslice __pyx_v_ligand_weights = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_mask = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_sideChainsChiXYZIndices = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_sideChainSubTreeMasks = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_qij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_dljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_dljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environmen_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_sideChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_mainChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_sideChainCoupling;
  double __pyx_v_mainChainCoupling;
  __Pyx_memviewslice __pyx_v_ligand_environment_weights = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("grid_search (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_grid,&amp;__pyx_n_s_ligand_xyz,&amp;__pyx_n_s_environment_xyz,&amp;__pyx_n_s_ligand_qij,&amp;__pyx_n_s_ligand_dljr,&amp;__pyx_n_s_ligand_dljep,&amp;__pyx_n_s_ligand_sol_prefactor,&amp;__pyx_n_s_ligand_lklam,&amp;__pyx_n_s_ligand_nonbonded,&amp;__pyx_n_s_ligand_nonbondedWeights,&amp;__pyx_n_s_ligand_coupling,&amp;__pyx_n_s_ligand_weights,&amp;__pyx_n_s_ligand_mask,&amp;__pyx_n_s_sideChainsChiXYZIndices,&amp;__pyx_n_s_sideChainSubTreeMasks,&amp;__pyx_n_s_ligand_environment_qij,&amp;__pyx_n_s_ligand_environment_dljr,&amp;__pyx_n_s_ligand_environment_dljep,&amp;__pyx_n_s_ligand_environment_sol_prefactor,&amp;__pyx_n_s_environmen_lklam,&amp;__pyx_n_s_environment_sideChainFalgs,&amp;__pyx_n_s_environment_mainChainFalgs,&amp;__pyx_n_s_sideChainCoupling,&amp;__pyx_n_s_mainChainCoupling,&amp;__pyx_n_s_ligand_environment_weights,0};
    PyObject* values[25] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 25: values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
        CYTHON_FALLTHROUGH;
        case 24: values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
        CYTHON_FALLTHROUGH;
        case 23: values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
        CYTHON_FALLTHROUGH;
        case 22: values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
        CYTHON_FALLTHROUGH;
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_grid)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_xyz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 1); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_xyz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 2); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_qij)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 3); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_dljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 4); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_dljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 5); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_sol_prefactor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 6); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 7); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_nonbonded)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 8); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_nonbondedWeights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 9); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_coupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 10); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_weights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 11); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_mask)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 12); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sideChainsChiXYZIndices)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 13); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sideChainSubTreeMasks)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 14); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_qij)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 15); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (likely((values[16] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_dljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 16); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (likely((values[17] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_dljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 17); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (likely((values[18] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_sol_prefactor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 18); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (likely((values[19] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environmen_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 19); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (likely((values[20] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_sideChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 20); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 21:
        if (likely((values[21] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_mainChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 21); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 22:
        if (likely((values[22] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sideChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 22); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 23:
        if (likely((values[23] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mainChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 23); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 24:
        if (likely((values[24] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_weights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, 24); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "grid_search") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 25) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
      values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
      values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
      values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
      values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
      values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
      values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
      values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
      values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
      values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
      values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
      values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
      values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
      values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
      values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
    }
    __pyx_v_grid = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_grid.memview)) __PYX_ERR(0, 1423, __pyx_L3_error)</span>
    __pyx_v_ligand_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_xyz.memview)) __PYX_ERR(0, 1424, __pyx_L3_error)</span>
    __pyx_v_environment_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_xyz.memview)) __PYX_ERR(0, 1425, __pyx_L3_error)</span>
    __pyx_v_ligand_qij = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_qij.memview)) __PYX_ERR(0, 1427, __pyx_L3_error)</span>
    __pyx_v_ligand_dljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_dljr.memview)) __PYX_ERR(0, 1428, __pyx_L3_error)</span>
    __pyx_v_ligand_dljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_dljep.memview)) __PYX_ERR(0, 1429, __pyx_L3_error)</span>
    __pyx_v_ligand_sol_prefactor = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[6], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_sol_prefactor.memview)) __PYX_ERR(0, 1430, __pyx_L3_error)</span>
    __pyx_v_ligand_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[7], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lklam.memview)) __PYX_ERR(0, 1431, __pyx_L3_error)</span>
    __pyx_v_ligand_nonbonded = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[8], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_nonbonded.memview)) __PYX_ERR(0, 1432, __pyx_L3_error)</span>
    __pyx_v_ligand_nonbondedWeights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[9], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_nonbondedWeights.memview)) __PYX_ERR(0, 1433, __pyx_L3_error)</span>
    __pyx_v_ligand_coupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]); if (unlikely((__pyx_v_ligand_coupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1434, __pyx_L3_error)</span>
    __pyx_v_ligand_weights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[11], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_weights.memview)) __PYX_ERR(0, 1435, __pyx_L3_error)</span>
    __pyx_v_ligand_mask = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[12], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_mask.memview)) __PYX_ERR(0, 1437, __pyx_L3_error)</span>
    __pyx_v_sideChainsChiXYZIndices = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[13], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_sideChainsChiXYZIndices.memview)) __PYX_ERR(0, 1438, __pyx_L3_error)</span>
    __pyx_v_sideChainSubTreeMasks = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[14], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_sideChainSubTreeMasks.memview)) __PYX_ERR(0, 1439, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_qij = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[15], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_qij.memview)) __PYX_ERR(0, 1441, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_dljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[16], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_dljr.memview)) __PYX_ERR(0, 1442, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_dljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[17], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_dljep.memview)) __PYX_ERR(0, 1443, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_sol_prefactor = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(values[18], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_sol_prefactor.memview)) __PYX_ERR(0, 1444, __pyx_L3_error)</span>
    __pyx_v_environmen_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[19], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environmen_lklam.memview)) __PYX_ERR(0, 1445, __pyx_L3_error)</span>
    __pyx_v_environment_sideChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[20], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_sideChainFalgs.memview)) __PYX_ERR(0, 1446, __pyx_L3_error)</span>
    __pyx_v_environment_mainChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[21], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_mainChainFalgs.memview)) __PYX_ERR(0, 1447, __pyx_L3_error)</span>
    __pyx_v_sideChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[22]); if (unlikely((__pyx_v_sideChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1448, __pyx_L3_error)</span>
    __pyx_v_mainChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[23]); if (unlikely((__pyx_v_mainChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1449, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_weights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[24], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_weights.memview)) __PYX_ERR(0, 1450, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search", 1, 25, 25, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.grid_search", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_22grid_search(__pyx_self, __pyx_v_grid, __pyx_v_ligand_xyz, __pyx_v_environment_xyz, __pyx_v_ligand_qij, __pyx_v_ligand_dljr, __pyx_v_ligand_dljep, __pyx_v_ligand_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_ligand_nonbonded, __pyx_v_ligand_nonbondedWeights, __pyx_v_ligand_coupling, __pyx_v_ligand_weights, __pyx_v_ligand_mask, __pyx_v_sideChainsChiXYZIndices, __pyx_v_sideChainSubTreeMasks, __pyx_v_ligand_environment_qij, __pyx_v_ligand_environment_dljr, __pyx_v_ligand_environment_dljep, __pyx_v_ligand_environment_sol_prefactor, __pyx_v_environmen_lklam, __pyx_v_environment_sideChainFalgs, __pyx_v_environment_mainChainFalgs, __pyx_v_sideChainCoupling, __pyx_v_mainChainCoupling, __pyx_v_ligand_environment_weights);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_22grid_search(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_grid, __Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_environment_xyz, __Pyx_memviewslice __pyx_v_ligand_qij, __Pyx_memviewslice __pyx_v_ligand_dljr, __Pyx_memviewslice __pyx_v_ligand_dljep, __Pyx_memviewslice __pyx_v_ligand_sol_prefactor, __Pyx_memviewslice __pyx_v_ligand_lklam, __Pyx_memviewslice __pyx_v_ligand_nonbonded, __Pyx_memviewslice __pyx_v_ligand_nonbondedWeights, double __pyx_v_ligand_coupling, __Pyx_memviewslice __pyx_v_ligand_weights, __Pyx_memviewslice __pyx_v_ligand_mask, __Pyx_memviewslice __pyx_v_sideChainsChiXYZIndices, __Pyx_memviewslice __pyx_v_sideChainSubTreeMasks, __Pyx_memviewslice __pyx_v_ligand_environment_qij, __Pyx_memviewslice __pyx_v_ligand_environment_dljr, __Pyx_memviewslice __pyx_v_ligand_environment_dljep, __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor, __Pyx_memviewslice __pyx_v_environmen_lklam, __Pyx_memviewslice __pyx_v_environment_sideChainFalgs, __Pyx_memviewslice __pyx_v_environment_mainChainFalgs, double __pyx_v_sideChainCoupling, double __pyx_v_mainChainCoupling, __Pyx_memviewslice __pyx_v_ligand_environment_weights) {
  int __pyx_v_grid_N;
  int __pyx_v_grid_M;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  __Pyx_memviewslice __pyx_v_xyz_tm = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_u_ji[3];
  double __pyx_v_u_jk[3];
  double __pyx_v_u_lk[3];
  double __pyx_v_n_ijk[3];
  double __pyx_v_n_jkl[3];
  double __pyx_v_nn_cross[3];
  double __pyx_v_p[3];
  double __pyx_v_rotation_vector[3];
  double __pyx_v_q[4];
  double __pyx_v_n_ijk_nrom;
  double __pyx_v_n_jkl_norm;
  double __pyx_v_nn_dot;
  double __pyx_v_sign;
  double __pyx_v_rotation_vector_norm;
  __Pyx_memviewslice __pyx_v_torsion_current = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_rot_angle;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__12)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("grid_search", 0);
  <span class='trace'>__Pyx_TraceCall</span>("grid_search", __pyx_f[0], 1423, 0, <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.grid_search", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_xyz_tm, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_torsion_current, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_grid, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_qij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_dljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_dljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_sol_prefactor, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_nonbonded, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_nonbondedWeights, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_weights, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_mask, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_sideChainsChiXYZIndices, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_sideChainSubTreeMasks, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_qij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_dljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_dljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_sol_prefactor, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environmen_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_sideChainFalgs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_mainChainFalgs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_weights, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__43 = <span class='py_c_api'>PyTuple_Pack</span>(47, __pyx_n_s_grid, __pyx_n_s_ligand_xyz, __pyx_n_s_environment_xyz, __pyx_n_s_ligand_qij, __pyx_n_s_ligand_dljr, __pyx_n_s_ligand_dljep, __pyx_n_s_ligand_sol_prefactor, __pyx_n_s_ligand_lklam, __pyx_n_s_ligand_nonbonded, __pyx_n_s_ligand_nonbondedWeights, __pyx_n_s_ligand_coupling, __pyx_n_s_ligand_weights, __pyx_n_s_ligand_mask, __pyx_n_s_sideChainsChiXYZIndices, __pyx_n_s_sideChainSubTreeMasks, __pyx_n_s_ligand_environment_qij, __pyx_n_s_ligand_environment_dljr, __pyx_n_s_ligand_environment_dljep, __pyx_n_s_ligand_environment_sol_prefactor, __pyx_n_s_environmen_lklam, __pyx_n_s_environment_sideChainFalgs, __pyx_n_s_environment_mainChainFalgs, __pyx_n_s_sideChainCoupling, __pyx_n_s_mainChainCoupling, __pyx_n_s_ligand_environment_weights, __pyx_n_s_grid_N, __pyx_n_s_grid_M, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_xyz_tm, __pyx_n_s_u_ji, __pyx_n_s_u_jk, __pyx_n_s_u_lk, __pyx_n_s_n_ijk, __pyx_n_s_n_jkl, __pyx_n_s_nn_cross, __pyx_n_s_p, __pyx_n_s_rotation_vector, __pyx_n_s_q, __pyx_n_s_n_ijk_nrom, __pyx_n_s_n_jkl_norm, __pyx_n_s_nn_dot, __pyx_n_s_sign, __pyx_n_s_rotation_vector_norm, __pyx_n_s_torsion_current, __pyx_n_s_rot_angle);<span class='error_goto'> if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 1423, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__43);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__43);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_23grid_search, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1423, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_grid_search, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1423, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__12 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(25, 0, 47, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__43, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_grid_search, 1423, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__12)) __PYX_ERR(0, 1423, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">1424</span>:                 <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1425</span>:                 <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1426</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1427</span>:                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1428</span>:                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1429</span>:                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1430</span>:                 <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1431</span>:                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1432</span>:                 <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1433</span>:                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1434</span>:                 <span class="n">double</span> <span class="n">ligand_coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1435</span>:                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_weights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1436</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1437</span>:                 <span class="n">double</span><span class="p">[:]</span> <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1438</span>:                 <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1439</span>:                 <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">sideChainSubTreeMasks</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1440</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1441</span>:                 <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1442</span>:                 <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1443</span>:                 <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1444</span>:                 <span class="n">double</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1445</span>:                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1446</span>:                 <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1447</span>:                 <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1448</span>:                 <span class="n">double</span> <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1449</span>:                 <span class="n">double</span> <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1450</span>:                 <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_environment_weights</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1451</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1452</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">grid_N</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_grid_N = (__pyx_v_grid.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1453</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">grid_M</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_grid_M = (__pyx_v_grid.shape[1]);
</pre><pre class="cython line score-0">&#xA0;<span class="">1454</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">k</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1455</span>:     <span class="c">#print(&#39;BB ----- &#39;, ligand_xyz.shape)</span></pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1456</span>:     <span class="k">cdef</span> <span class="kt">double</span> [<span class="p">:,</span> <span class="p">:]</span> <span class="n">xyz_tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ligand_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">],</span> <span class="n">ligand_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]))</span></pre>
<pre class='cython code score-40 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1456, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1456, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_ligand_xyz.shape[0]));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1456, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_ligand_xyz.shape[1]));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1456, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1456, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_4);
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1456, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 1456, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_xyz_tm = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">1457</span>:     <span class="c">#cdef double [:, :] rotation_vectors = np.zeros((sideChainsChiXYZIndices.shape[0], 3))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1458</span>:     <span class="k">cdef</span> <span class="kt">double</span> [3] <span class="nf">u_ji</span><span class="p">,</span> <span class="nf">u_jk</span><span class="p">,</span> <span class="nf">u_lk</span><span class="p">,</span> <span class="nf">n_ijk</span><span class="p">,</span> <span class="nf">n_jkl</span><span class="p">,</span> <span class="nf">nn_cross</span><span class="p">,</span> <span class="nf">p</span><span class="p">,</span> <span class="nf">rotation_vector</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1459</span>:     <span class="k">cdef</span> <span class="kt">double</span> [4] <span class="nf">q</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1460</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">n_ijk_nrom</span><span class="p">,</span> <span class="nf">n_jkl_norm</span><span class="p">,</span> <span class="nf">nn_dot</span><span class="p">,</span> <span class="nf">sign</span><span class="p">,</span> <span class="nf">rotation_vector_norm</span></pre>
<pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1461</span>:     <span class="k">cdef</span> <span class="kt">double</span> [<span class="p">:]</span> <span class="n">torsion_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sideChainsChiXYZIndices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span></pre>
<pre class='cython code score-28 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1461, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1461, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_sideChainsChiXYZIndices.shape[0]));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1461, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_1 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_4, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1461, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 1461, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_torsion_current = __pyx_t_7;
  __pyx_t_7.memview = NULL;
  __pyx_t_7.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">1462</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">rot_angle</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1463</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1464</span>:     <span class="c"># Get the current torsion vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1465</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sideChainsChiXYZIndices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (__pyx_v_sideChainsChiXYZIndices.shape[0]);
  __pyx_t_9 = __pyx_t_8;
  for (__pyx_t_10 = 0; __pyx_t_10 &lt; __pyx_t_9; __pyx_t_10+=1) {
    __pyx_v_i = __pyx_t_10;
</pre><pre class="cython line score-0">&#xA0;<span class="">1466</span>:         <span class="c">#print(&#39;BBB Cord i:&#39;, ligand_xyz[sideChainsChiXYZIndices[i, 0], 0], ligand_xyz[sideChainsChiXYZIndices[i, 0], 1], ligand_xyz[sideChainsChiXYZIndices[i, 0], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1467</span>:         <span class="c">#print(&#39;BBB Cord j:&#39;, ligand_xyz[sideChainsChiXYZIndices[i, 1], 0], ligand_xyz[sideChainsChiXYZIndices[i, 1], 1], ligand_xyz[sideChainsChiXYZIndices[i, 1], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1468</span>:         <span class="c">#print(&#39;BBB Cord k:&#39;, ligand_xyz[sideChainsChiXYZIndices[i, 2], 0], ligand_xyz[sideChainsChiXYZIndices[i, 2], 1], ligand_xyz[sideChainsChiXYZIndices[i, 2], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1469</span>:         <span class="c">#print(&#39;BBB Cord l:&#39;, ligand_xyz[sideChainsChiXYZIndices[i, 3], 0], ligand_xyz[sideChainsChiXYZIndices[i, 3], 1], ligand_xyz[sideChainsChiXYZIndices[i, 3], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1470</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1471</span>:         <span class="n">u_ji</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = 0;
    __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_14 = 0;
    __pyx_t_15 = __pyx_v_i;
    __pyx_t_16 = 1;
    __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_18 = 0;
    (__pyx_v_u_ji[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_13 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_17 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_18 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1472</span>:         <span class="n">u_ji</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_16 = __pyx_v_i;
    __pyx_t_15 = 0;
    __pyx_t_18 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_17 = 1;
    __pyx_t_12 = __pyx_v_i;
    __pyx_t_11 = 1;
    __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_13 = 1;
    (__pyx_v_u_ji[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_18 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_17 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_14 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1473</span>:         <span class="n">u_ji</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = 0;
    __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_14 = 2;
    __pyx_t_15 = __pyx_v_i;
    __pyx_t_16 = 1;
    __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_18 = 2;
    (__pyx_v_u_ji[2]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_13 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_17 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_18 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1474</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1475</span>:         <span class="n">u_jk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_16 = __pyx_v_i;
    __pyx_t_15 = 2;
    __pyx_t_18 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_17 = 0;
    __pyx_t_12 = __pyx_v_i;
    __pyx_t_11 = 1;
    __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_13 = 0;
    (__pyx_v_u_jk[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_18 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_17 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_14 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1476</span>:         <span class="n">u_jk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = 2;
    __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_14 = 1;
    __pyx_t_15 = __pyx_v_i;
    __pyx_t_16 = 1;
    __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_18 = 1;
    (__pyx_v_u_jk[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_13 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_17 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_18 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1477</span>:         <span class="n">u_jk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_16 = __pyx_v_i;
    __pyx_t_15 = 2;
    __pyx_t_18 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_17 = 2;
    __pyx_t_12 = __pyx_v_i;
    __pyx_t_11 = 1;
    __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_13 = 2;
    (__pyx_v_u_jk[2]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_18 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_17 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_14 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1478</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1479</span>:         <span class="n">u_lk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">3</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = 2;
    __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_14 = 0;
    __pyx_t_15 = __pyx_v_i;
    __pyx_t_16 = 3;
    __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_18 = 0;
    (__pyx_v_u_lk[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_13 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_17 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_18 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1480</span>:         <span class="n">u_lk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">3</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_16 = __pyx_v_i;
    __pyx_t_15 = 2;
    __pyx_t_18 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_17 = 1;
    __pyx_t_12 = __pyx_v_i;
    __pyx_t_11 = 3;
    __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_13 = 1;
    (__pyx_v_u_lk[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_18 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_17 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_14 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1481</span>:         <span class="n">u_lk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">3</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = 2;
    __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_14 = 2;
    __pyx_t_15 = __pyx_v_i;
    __pyx_t_16 = 3;
    __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_18 = 2;
    (__pyx_v_u_lk[2]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_13 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_17 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_18 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1482</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1483</span>:         <span class="c">#print(&#39;BBB&#39;, u_ji)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1484</span>:         <span class="c">#print(&#39;BBB&#39;, u_jk)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1485</span>:         <span class="c">#print(&#39;BBB&#39;, u_lk)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1486</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1487</span>:         <span class="n">n_ijk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_ji</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">u_ji</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_ijk[0]) = (((__pyx_v_u_ji[1]) * (__pyx_v_u_jk[2])) - ((__pyx_v_u_ji[2]) * (__pyx_v_u_jk[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1488</span>:         <span class="n">n_ijk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_ji</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">u_ji</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_ijk[1]) = (((__pyx_v_u_ji[2]) * (__pyx_v_u_jk[0])) - ((__pyx_v_u_ji[0]) * (__pyx_v_u_jk[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1489</span>:         <span class="n">n_ijk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_ji</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u_ji</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_ijk[2]) = (((__pyx_v_u_ji[0]) * (__pyx_v_u_jk[1])) - ((__pyx_v_u_ji[1]) * (__pyx_v_u_jk[0])));
</pre><pre class="cython line score-0">&#xA0;<span class="">1490</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1491</span>:         <span class="n">n_jkl</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_lk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_lk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_jkl[0]) = (((__pyx_v_u_jk[1]) * (__pyx_v_u_lk[2])) - ((__pyx_v_u_jk[2]) * (__pyx_v_u_lk[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1492</span>:         <span class="n">n_jkl</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_lk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_lk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_jkl[1]) = (((__pyx_v_u_jk[2]) * (__pyx_v_u_lk[0])) - ((__pyx_v_u_jk[0]) * (__pyx_v_u_lk[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1493</span>:         <span class="n">n_jkl</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_lk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_lk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_jkl[2]) = (((__pyx_v_u_jk[0]) * (__pyx_v_u_lk[1])) - ((__pyx_v_u_jk[1]) * (__pyx_v_u_lk[0])));
</pre><pre class="cython line score-0">&#xA0;<span class="">1494</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1495</span>:         <span class="n">n_ijk_nrom</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n_ijk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_ijk_nrom = sqrt(((((__pyx_v_n_ijk[0]) * (__pyx_v_n_ijk[0])) + ((__pyx_v_n_ijk[1]) * (__pyx_v_n_ijk[1]))) + ((__pyx_v_n_ijk[2]) * (__pyx_v_n_ijk[2]))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1496</span>:         <span class="n">n_jkl_norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n_jkl</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_jkl_norm = sqrt(((((__pyx_v_n_jkl[0]) * (__pyx_v_n_jkl[0])) + ((__pyx_v_n_jkl[1]) * (__pyx_v_n_jkl[1]))) + ((__pyx_v_n_jkl[2]) * (__pyx_v_n_jkl[2]))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1497</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1498</span>:         <span class="n">n_ijk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">n_ijk_nrom</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_ijk[0]) = ((__pyx_v_n_ijk[0]) / __pyx_v_n_ijk_nrom);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1499</span>:         <span class="n">n_ijk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">n_ijk_nrom</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_ijk[1]) = ((__pyx_v_n_ijk[1]) / __pyx_v_n_ijk_nrom);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1500</span>:         <span class="n">n_ijk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">n_ijk_nrom</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_ijk[2]) = ((__pyx_v_n_ijk[2]) / __pyx_v_n_ijk_nrom);
</pre><pre class="cython line score-0">&#xA0;<span class="">1501</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1502</span>:         <span class="n">n_jkl</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">n_jkl_norm</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_jkl[0]) = ((__pyx_v_n_jkl[0]) / __pyx_v_n_jkl_norm);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1503</span>:         <span class="n">n_jkl</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">n_jkl_norm</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_jkl[1]) = ((__pyx_v_n_jkl[1]) / __pyx_v_n_jkl_norm);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1504</span>:         <span class="n">n_jkl</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">n_jkl_norm</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_n_jkl[2]) = ((__pyx_v_n_jkl[2]) / __pyx_v_n_jkl_norm);
</pre><pre class="cython line score-0">&#xA0;<span class="">1505</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1506</span>:         <span class="c">#print(&#39;BBB&#39;, n_ijk)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1507</span>:         <span class="c">#print(&#39;BBB&#39;, n_jkl)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1508</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1509</span>:         <span class="n">nn_dot</span> <span class="o">=</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_v_nn_dot = ((((__pyx_v_n_ijk[0]) * (__pyx_v_n_jkl[0])) + ((__pyx_v_n_ijk[1]) * (__pyx_v_n_jkl[1]))) + ((__pyx_v_n_ijk[2]) * (__pyx_v_n_jkl[2])));
</pre><pre class="cython line score-0">&#xA0;<span class="">1510</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1511</span>:         <span class="n">nn_cross</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_nn_cross[0]) = (((__pyx_v_n_ijk[1]) * (__pyx_v_n_jkl[2])) - ((__pyx_v_n_ijk[2]) * (__pyx_v_n_jkl[1])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1512</span>:         <span class="n">nn_cross</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_nn_cross[1]) = (((__pyx_v_n_ijk[2]) * (__pyx_v_n_jkl[0])) - ((__pyx_v_n_ijk[0]) * (__pyx_v_n_jkl[2])));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1513</span>:         <span class="n">nn_cross</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">n_ijk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_jkl</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    (__pyx_v_nn_cross[2]) = (((__pyx_v_n_ijk[0]) * (__pyx_v_n_jkl[1])) - ((__pyx_v_n_ijk[1]) * (__pyx_v_n_jkl[0])));
</pre><pre class="cython line score-0">&#xA0;<span class="">1514</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1515</span>:         <span class="c"># Correct for precision error</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1516</span>:         <span class="k">if</span> <span class="n">nn_dot</span> <span class="o">&gt;</span> <span class="mf">1</span><span class="p">:</span> <span class="n">nn_dot</span> <span class="o">=</span> <span class="mf">1.0</span></pre>
<pre class='cython code score-0 '>    __pyx_t_19 = ((__pyx_v_nn_dot &gt; 1.0) != 0);
    if (__pyx_t_19) {
      __pyx_v_nn_dot = 1.0;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1517</span>:         <span class="k">if</span> <span class="n">nn_dot</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1</span><span class="p">:</span> <span class="n">nn_dot</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span></pre>
<pre class='cython code score-0 '>    __pyx_t_19 = ((__pyx_v_nn_dot &lt; -1.0) != 0);
    if (__pyx_t_19) {
      __pyx_v_nn_dot = -1.0;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1518</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1519</span>:         <span class="c"># get the angle sign</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1520</span>:         <span class="n">sign</span> <span class="o">=</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">nn_cross</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">nn_cross</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">u_jk</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">nn_cross</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sign = ((((__pyx_v_u_jk[0]) * (__pyx_v_nn_cross[0])) + ((__pyx_v_u_jk[1]) * (__pyx_v_nn_cross[1]))) + ((__pyx_v_u_jk[2]) * (__pyx_v_nn_cross[2])));
</pre><pre class="cython line score-0">&#xA0;<span class="">1521</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1522</span>:         <span class="c"># Save current torsion angles</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1523</span>:         <span class="k">if</span> <span class="n">sign</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_19 = ((__pyx_v_sign &lt; 0.0) != 0);
    if (__pyx_t_19) {
/* â€¦ */
      goto __pyx_L7;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1524</span>:             <span class="n">torsion_current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">nn_dot</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">M_PI</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = __pyx_v_i;
      *((double *) ( /* dim=0 */ (__pyx_v_torsion_current.data + __pyx_t_16 * __pyx_v_torsion_current.strides[0]) )) = ((acos(__pyx_v_nn_dot) * (180.0 / M_PI)) * -1.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">1525</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1526</span>:             <span class="n">torsion_current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">nn_dot</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">M_PI</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_16 = __pyx_v_i;
      *((double *) ( /* dim=0 */ (__pyx_v_torsion_current.data + __pyx_t_16 * __pyx_v_torsion_current.strides[0]) )) = (acos(__pyx_v_nn_dot) * (180.0 / M_PI));
    }
    __pyx_L7:;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1527</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1528</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1529</span>:         <span class="c">#print(&#39;BBBB ----!!!&#39;, np.array(sideChainsChiXYZIndices[i, :]), np.array(torsion_current[i]))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1530</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1531</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_10 = __pyx_v_grid_N;
  __pyx_t_20 = __pyx_t_10;
  for (__pyx_t_21 = 0; __pyx_t_21 &lt; __pyx_t_20; __pyx_t_21+=1) {
    __pyx_v_i = __pyx_t_21;
</pre><pre class="cython line score-0">&#xA0;<span class="">1532</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1533</span>:         <span class="c"># Fil up the tem matrix</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1534</span>:         <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ligand_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_8 = (__pyx_v_ligand_xyz.shape[0]);
    __pyx_t_9 = __pyx_t_8;
    for (__pyx_t_22 = 0; __pyx_t_22 &lt; __pyx_t_9; __pyx_t_22+=1) {
      __pyx_v_k = __pyx_t_22;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1535</span>:             <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = __pyx_v_k;
      __pyx_t_15 = 0;
      __pyx_t_18 = __pyx_v_k;
      __pyx_t_17 = 0;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_18 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_17 * __pyx_v_xyz_tm.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_16 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_15 * __pyx_v_ligand_xyz.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1536</span>:             <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_15 = __pyx_v_k;
      __pyx_t_16 = 1;
      __pyx_t_17 = __pyx_v_k;
      __pyx_t_18 = 1;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_17 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_15 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_16 * __pyx_v_ligand_xyz.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1537</span>:             <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = __pyx_v_k;
      __pyx_t_15 = 2;
      __pyx_t_18 = __pyx_v_k;
      __pyx_t_17 = 2;
      *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_18 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_17 * __pyx_v_xyz_tm.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_16 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_15 * __pyx_v_ligand_xyz.strides[1]) )));
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1538</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1539</span>:         <span class="c"># iterate over torsion vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1540</span>:         <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_23 = (__pyx_v_grid_M - 1);
    __pyx_t_24 = __pyx_t_23;
    for (__pyx_t_22 = 0; __pyx_t_22 &lt; __pyx_t_24; __pyx_t_22+=1) {
      __pyx_v_j = __pyx_t_22;
</pre><pre class="cython line score-0">&#xA0;<span class="">1541</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1542</span>:             <span class="c"># Compute rotation angle for chi j</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1543</span>:             <span class="n">rot_angle</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">torsion_current</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_15 = __pyx_v_i;
      __pyx_t_16 = __pyx_v_j;
      __pyx_t_17 = __pyx_v_j;
      __pyx_v_rot_angle = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_15 * __pyx_v_grid.strides[0]) ) + __pyx_t_16 * __pyx_v_grid.strides[1]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_torsion_current.data + __pyx_t_17 * __pyx_v_torsion_current.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1544</span>:             <span class="k">if</span> <span class="n">rot_angle</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">180.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = ((__pyx_v_rot_angle &lt; -180.0) != 0);
      if (__pyx_t_19) {
/* â€¦ */
        goto __pyx_L14;
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1545</span>:                 <span class="n">rot_angle</span> <span class="o">+=</span> <span class="mf">360.0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_rot_angle = (__pyx_v_rot_angle + 360.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1546</span>:             <span class="k">elif</span> <span class="n">rot_angle</span> <span class="o">&gt;=</span> <span class="mf">180.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_19 = ((__pyx_v_rot_angle &gt;= 180.0) != 0);
      if (__pyx_t_19) {
/* â€¦ */
      }
      __pyx_L14:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1547</span>:                 <span class="n">rot_angle</span> <span class="o">-=</span> <span class="mf">360.0</span></pre>
<pre class='cython code score-0 '>        __pyx_v_rot_angle = (__pyx_v_rot_angle - 360.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">1548</span>:             <span class="c"># Convert to radian</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1549</span>:             <span class="n">rot_angle</span> <span class="o">*=</span> <span class="p">(</span><span class="n">M_PI</span> <span class="o">/</span> <span class="mf">180</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_rot_angle = (__pyx_v_rot_angle * (M_PI / 180.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1550</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1551</span>:             <span class="c"># Compute rotation vectors</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1552</span>:             <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_17 = __pyx_v_j;
      __pyx_t_16 = 2;
      __pyx_t_15 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_17 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
      __pyx_t_18 = 0;
      __pyx_t_12 = __pyx_v_j;
      __pyx_t_11 = 1;
      __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
      __pyx_t_13 = 0;
      (__pyx_v_rotation_vector[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_15 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_14 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_13 * __pyx_v_xyz_tm.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1553</span>:             <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_11 = __pyx_v_j;
      __pyx_t_12 = 2;
      __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
      __pyx_t_14 = 1;
      __pyx_t_16 = __pyx_v_j;
      __pyx_t_17 = 1;
      __pyx_t_18 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_17 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
      __pyx_t_15 = 1;
      (__pyx_v_rotation_vector[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_13 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_14 * __pyx_v_xyz_tm.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_18 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_15 * __pyx_v_xyz_tm.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1554</span>:             <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      __pyx_t_17 = __pyx_v_j;
      __pyx_t_16 = 2;
      __pyx_t_15 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_17 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
      __pyx_t_18 = 2;
      __pyx_t_12 = __pyx_v_j;
      __pyx_t_11 = 1;
      __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
      __pyx_t_13 = 2;
      (__pyx_v_rotation_vector[2]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_15 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_14 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_13 * __pyx_v_xyz_tm.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1555</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1556</span>:             <span class="n">rotation_vector_norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">rotation_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>      __pyx_v_rotation_vector_norm = sqrt(((((__pyx_v_rotation_vector[0]) * (__pyx_v_rotation_vector[0])) + ((__pyx_v_rotation_vector[1]) * (__pyx_v_rotation_vector[1]))) + ((__pyx_v_rotation_vector[2]) * (__pyx_v_rotation_vector[2]))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1557</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1558</span>:             <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">rotation_vector_norm</span></pre>
<pre class='cython code score-0 '>      (__pyx_v_rotation_vector[0]) = ((__pyx_v_rotation_vector[0]) / __pyx_v_rotation_vector_norm);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1559</span>:             <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">rotation_vector_norm</span></pre>
<pre class='cython code score-0 '>      (__pyx_v_rotation_vector[1]) = ((__pyx_v_rotation_vector[1]) / __pyx_v_rotation_vector_norm);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1560</span>:             <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">rotation_vector_norm</span></pre>
<pre class='cython code score-0 '>      (__pyx_v_rotation_vector[2]) = ((__pyx_v_rotation_vector[2]) / __pyx_v_rotation_vector_norm);
</pre><pre class="cython line score-0">&#xA0;<span class="">1561</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1562</span>:             <span class="c"># compute the rotation quaternion</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1563</span>:             <span class="n">rot_angle</span> <span class="o">*=</span> <span class="mf">0.5</span></pre>
<pre class='cython code score-0 '>      __pyx_v_rot_angle = (__pyx_v_rot_angle * 0.5);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1564</span>:             <span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">rot_angle</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      (__pyx_v_q[0]) = cos(__pyx_v_rot_angle);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1565</span>:             <span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">rot_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      (__pyx_v_q[1]) = (sin(__pyx_v_rot_angle) * (__pyx_v_rotation_vector[0]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1566</span>:             <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">rot_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      (__pyx_v_q[2]) = (sin(__pyx_v_rot_angle) * (__pyx_v_rotation_vector[1]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1567</span>:             <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">rot_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">rotation_vector</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>      (__pyx_v_q[3]) = (sin(__pyx_v_rot_angle) * (__pyx_v_rotation_vector[2]));
</pre><pre class="cython line score-0">&#xA0;<span class="">1568</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1569</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1570</span>:             <span class="c"># Rotate the subtree</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1571</span>:             <span class="c">#print(j, np.array(sideChainSubTreeMasks[j, :]))</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1572</span>:             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xyz_tm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = (__pyx_v_xyz_tm.shape[0]);
      __pyx_t_9 = __pyx_t_8;
      for (__pyx_t_25 = 0; __pyx_t_25 &lt; __pyx_t_9; __pyx_t_25+=1) {
        __pyx_v_k = __pyx_t_25;
</pre><pre class="cython line score-0">&#xA0;<span class="">1573</span>:                 <span class="c"># Operate only on the subtree atoms for chi j</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1574</span>:                 <span class="k">if</span> <span class="n">sideChainSubTreeMasks</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_11 = __pyx_v_j;
        __pyx_t_12 = __pyx_v_k;
        __pyx_t_19 = (((*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainSubTreeMasks.data + __pyx_t_11 * __pyx_v_sideChainSubTreeMasks.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainSubTreeMasks.strides[1]) ))) == 0) != 0);
        if (__pyx_t_19) {
/* â€¦ */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1575</span>:                     <span class="k">continue</span></pre>
<pre class='cython code score-0 '>          goto __pyx_L15_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">1576</span>:                 <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1577</span>:                     <span class="c">#Translate point to new coordinate system (rotation vector)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1578</span>:                     <span class="n">p</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>        /*else*/ {
          __pyx_t_12 = __pyx_v_k;
          __pyx_t_11 = 0;
          __pyx_t_13 = __pyx_v_j;
          __pyx_t_14 = 1;
          __pyx_t_16 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_13 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_14 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
          __pyx_t_17 = 0;
          (__pyx_v_p[0]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_12 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_11 * __pyx_v_xyz_tm.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_16 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_17 * __pyx_v_xyz_tm.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1579</span>:                     <span class="n">p</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_14 = __pyx_v_k;
          __pyx_t_13 = 1;
          __pyx_t_17 = __pyx_v_j;
          __pyx_t_16 = 1;
          __pyx_t_11 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_17 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
          __pyx_t_12 = 1;
          (__pyx_v_p[1]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_14 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_13 * __pyx_v_xyz_tm.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_11 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_12 * __pyx_v_xyz_tm.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1580</span>:                     <span class="n">p</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_16 = __pyx_v_k;
          __pyx_t_17 = 2;
          __pyx_t_12 = __pyx_v_j;
          __pyx_t_11 = 1;
          __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
          __pyx_t_14 = 2;
          (__pyx_v_p[2]) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_16 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_17 * __pyx_v_xyz_tm.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_13 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_14 * __pyx_v_xyz_tm.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1581</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1582</span>:                     <span class="c"># rotate</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1583</span>:                     <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">])</span> <span class="o">+</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">])</span> <span class="o">+</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>          __pyx_t_11 = __pyx_v_k;
          __pyx_t_12 = 0;
          *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_11 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_12 * __pyx_v_xyz_tm.strides[1]) )) = ((((__pyx_v_p[0]) * (((((__pyx_v_q[0]) * (__pyx_v_q[0])) + ((__pyx_v_q[1]) * (__pyx_v_q[1]))) - ((__pyx_v_q[2]) * (__pyx_v_q[2]))) - ((__pyx_v_q[3]) * (__pyx_v_q[3])))) + ((2.0 * (__pyx_v_p[1])) * (((__pyx_v_q[1]) * (__pyx_v_q[2])) - ((__pyx_v_q[0]) * (__pyx_v_q[3]))))) + ((2.0 * (__pyx_v_p[2])) * (((__pyx_v_q[0]) * (__pyx_v_q[2])) + ((__pyx_v_q[1]) * (__pyx_v_q[3])))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1584</span>:                     <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span> <span class="o">+</span>  <span class="n">p</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">])</span> <span class="o">+</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>          __pyx_t_12 = __pyx_v_k;
          __pyx_t_11 = 1;
          *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_12 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_11 * __pyx_v_xyz_tm.strides[1]) )) = ((((2.0 * (__pyx_v_p[0])) * (((__pyx_v_q[0]) * (__pyx_v_q[3])) + ((__pyx_v_q[1]) * (__pyx_v_q[2])))) + ((__pyx_v_p[1]) * (((((__pyx_v_q[0]) * (__pyx_v_q[0])) - ((__pyx_v_q[1]) * (__pyx_v_q[1]))) + ((__pyx_v_q[2]) * (__pyx_v_q[2]))) - ((__pyx_v_q[3]) * (__pyx_v_q[3]))))) + ((2.0 * (__pyx_v_p[2])) * (((__pyx_v_q[2]) * (__pyx_v_q[3])) - ((__pyx_v_q[0]) * (__pyx_v_q[1])))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1585</span>:                     <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">])</span> <span class="o">+</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">q</span><span class="p">[</span><span class="mf">3</span><span class="p">])</span></pre>
<pre class='cython code score-0 '>          __pyx_t_11 = __pyx_v_k;
          __pyx_t_12 = 2;
          *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_11 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_12 * __pyx_v_xyz_tm.strides[1]) )) = ((((2.0 * (__pyx_v_p[0])) * (((__pyx_v_q[1]) * (__pyx_v_q[3])) - ((__pyx_v_q[0]) * (__pyx_v_q[2])))) + ((2.0 * (__pyx_v_p[1])) * (((__pyx_v_q[0]) * (__pyx_v_q[1])) + ((__pyx_v_q[2]) * (__pyx_v_q[3]))))) + ((__pyx_v_p[2]) * (((((__pyx_v_q[0]) * (__pyx_v_q[0])) - ((__pyx_v_q[1]) * (__pyx_v_q[1]))) - ((__pyx_v_q[2]) * (__pyx_v_q[2]))) + ((__pyx_v_q[3]) * (__pyx_v_q[3])))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1586</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1587</span>:                     <span class="c"># translate back to the original coordinate system</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1588</span>:                     <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_12 = __pyx_v_k;
          __pyx_t_11 = 0;
          __pyx_t_14 = __pyx_v_j;
          __pyx_t_13 = 1;
          __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_14 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_13 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
          __pyx_t_16 = 0;
          __pyx_t_18 = __pyx_v_k;
          __pyx_t_15 = 0;
          *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_18 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_15 * __pyx_v_xyz_tm.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_12 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_11 * __pyx_v_xyz_tm.strides[1]) ))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_17 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_16 * __pyx_v_xyz_tm.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1589</span>:                     <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_13 = __pyx_v_k;
          __pyx_t_14 = 1;
          __pyx_t_16 = __pyx_v_j;
          __pyx_t_17 = 1;
          __pyx_t_11 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_17 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
          __pyx_t_12 = 1;
          __pyx_t_15 = __pyx_v_k;
          __pyx_t_18 = 1;
          *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_15 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_13 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_14 * __pyx_v_xyz_tm.strides[1]) ))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_11 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_12 * __pyx_v_xyz_tm.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1590</span>:                     <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>          __pyx_t_17 = __pyx_v_k;
          __pyx_t_16 = 2;
          __pyx_t_12 = __pyx_v_j;
          __pyx_t_11 = 1;
          __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
          __pyx_t_13 = 2;
          __pyx_t_18 = __pyx_v_k;
          __pyx_t_15 = 2;
          *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_18 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_15 * __pyx_v_xyz_tm.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_17 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_16 * __pyx_v_xyz_tm.strides[1]) ))) + (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_14 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_13 * __pyx_v_xyz_tm.strides[1]) ))));
        }
        __pyx_L15_continue:;
      }
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1591</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1592</span>:             <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1593</span>: <span class="sd">            #-----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1594</span>: <span class="sd">            #-----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1595</span>: <span class="sd">            #-----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1596</span>: <span class="sd">            print(&#39;ABBB Cord i:&#39;, xyz_tm[sideChainsChiXYZIndices[j, 0], 0], xyz_tm[sideChainsChiXYZIndices[j, 0], 1], xyz_tm[sideChainsChiXYZIndices[j, 0], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1597</span>: <span class="sd">            print(&#39;ABBB Cord j:&#39;, xyz_tm[sideChainsChiXYZIndices[j, 1], 0], xyz_tm[sideChainsChiXYZIndices[j, 1], 1], xyz_tm[sideChainsChiXYZIndices[j, 1], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1598</span>: <span class="sd">            print(&#39;ABBB Cord k:&#39;, xyz_tm[sideChainsChiXYZIndices[j, 2], 0], xyz_tm[sideChainsChiXYZIndices[j, 2], 1], xyz_tm[sideChainsChiXYZIndices[j, 2], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1599</span>: <span class="sd">            print(&#39;ABBB Cord l:&#39;, xyz_tm[sideChainsChiXYZIndices[j, 3], 0], xyz_tm[sideChainsChiXYZIndices[j, 3], 1], xyz_tm[sideChainsChiXYZIndices[j, 3], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1600</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1601</span>: <span class="sd">            u_ji[0] = xyz_tm[sideChainsChiXYZIndices[j, 0], 0] - xyz_tm[sideChainsChiXYZIndices[j, 1], 0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1602</span>: <span class="sd">            u_ji[1] = xyz_tm[sideChainsChiXYZIndices[j, 0], 1] - xyz_tm[sideChainsChiXYZIndices[j, 1], 1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1603</span>: <span class="sd">            u_ji[2] = xyz_tm[sideChainsChiXYZIndices[j, 0], 2] - xyz_tm[sideChainsChiXYZIndices[j, 1], 2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1604</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1605</span>: <span class="sd">            u_jk[0] = xyz_tm[sideChainsChiXYZIndices[j, 2], 0] - xyz_tm[sideChainsChiXYZIndices[j, 1], 0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1606</span>: <span class="sd">            u_jk[1] = xyz_tm[sideChainsChiXYZIndices[j, 2], 1] - xyz_tm[sideChainsChiXYZIndices[j, 1], 1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1607</span>: <span class="sd">            u_jk[2] = xyz_tm[sideChainsChiXYZIndices[j, 2], 2] - xyz_tm[sideChainsChiXYZIndices[j, 1], 2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1608</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1609</span>: <span class="sd">            u_lk[0] = xyz_tm[sideChainsChiXYZIndices[j, 2], 0] - xyz_tm[sideChainsChiXYZIndices[j, 3], 0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1610</span>: <span class="sd">            u_lk[1] = xyz_tm[sideChainsChiXYZIndices[j, 2], 1] - xyz_tm[sideChainsChiXYZIndices[j, 3], 1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1611</span>: <span class="sd">            u_lk[2] = xyz_tm[sideChainsChiXYZIndices[j, 2], 2] - xyz_tm[sideChainsChiXYZIndices[j, 3], 2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1612</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1613</span>: <span class="sd">            n_ijk[0] = u_ji[1] * u_jk[2] - u_ji[2] * u_jk[1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1614</span>: <span class="sd">            n_ijk[1] = u_ji[2] * u_jk[0] - u_ji[0] * u_jk[2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1615</span>: <span class="sd">            n_ijk[2] = u_ji[0] * u_jk[1] - u_ji[1] * u_jk[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1616</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1617</span>: <span class="sd">            n_jkl[0] = u_jk[1] * u_lk[2] - u_jk[2] * u_lk[1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1618</span>: <span class="sd">            n_jkl[1] = u_jk[2] * u_lk[0] - u_jk[0] * u_lk[2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1619</span>: <span class="sd">            n_jkl[2] = u_jk[0] * u_lk[1] - u_jk[1] * u_lk[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1620</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1621</span>: <span class="sd">            n_ijk_nrom = sqrt(n_ijk[0] * n_ijk[0] + n_ijk[1] * n_ijk[1] + n_ijk[2] * n_ijk[2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1622</span>: <span class="sd">            n_jkl_norm = sqrt(n_jkl[0] * n_jkl[0] + n_jkl[1] * n_jkl[1] + n_jkl[2] * n_jkl[2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1623</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1624</span>: <span class="sd">            n_ijk[0] = n_ijk[0] / n_ijk_nrom</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1625</span>: <span class="sd">            n_ijk[1] = n_ijk[1] / n_ijk_nrom</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1626</span>: <span class="sd">            n_ijk[2] = n_ijk[2] / n_ijk_nrom</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1627</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1628</span>: <span class="sd">            n_jkl[0] = n_jkl[0] / n_jkl_norm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1629</span>: <span class="sd">            n_jkl[1] = n_jkl[1] / n_jkl_norm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1630</span>: <span class="sd">            n_jkl[2] = n_jkl[2] / n_jkl_norm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1631</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1632</span>: <span class="sd">            nn_dot = n_ijk[0] * n_jkl[0] + n_ijk[1] * n_jkl[1] + n_ijk[2] * n_jkl[2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1633</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1634</span>: <span class="sd">            nn_cross[0] = n_ijk[1] * n_jkl[2] - n_ijk[2] * n_jkl[1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1635</span>: <span class="sd">            nn_cross[1] = n_ijk[2] * n_jkl[0] - n_ijk[0] * n_jkl[2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1636</span>: <span class="sd">            nn_cross[2] = n_ijk[0] * n_jkl[1] - n_ijk[1] * n_jkl[0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1637</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1638</span>: <span class="sd">            # Correct for precision error</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1639</span>: <span class="sd">            if nn_dot &gt; 1: nn_dot = 1.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1640</span>: <span class="sd">            if nn_dot &lt; -1: nn_dot = -1.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1641</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1642</span>: <span class="sd">            # get the angle sign</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1643</span>: <span class="sd">            sign = u_jk[0] * nn_cross[0] + u_jk[1] * nn_cross[1] + u_jk[2] * nn_cross[2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1644</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1645</span>: <span class="sd">            # Save current torsion angles</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1646</span>: <span class="sd">            if sign &lt; 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1647</span>: <span class="sd">                print(i, j, &#39;current&#39;, acos(nn_dot) * (180.0 / M_PI) * -1, &#39;target&#39;, grid[i, j])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1648</span>: <span class="sd">            else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1649</span>: <span class="sd">                print(i, j, &#39;current&#39;, acos(nn_dot) * (180.0 / M_PI), &#39;target&#39;, grid[i, j])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1650</span>: <span class="sd">            # -----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1651</span>: <span class="sd">            # -----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1652</span>: <span class="sd">            # -----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1653</span>: <span class="sd">            &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1654</span>:         <span class="c">#print(np.array(grid[i, :]), np.array(torsion_current))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1655</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1656</span>:         <span class="c">#print(np.array(xyz_tm))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1657</span>:         <span class="c">#exit()</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1658</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1659</span>:         <span class="c"># Compute energy</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1660</span>:         <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = (__pyx_v_grid_M - 1);
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_11 * __pyx_v_grid.strides[0]) ) + __pyx_t_12 * __pyx_v_grid.strides[1]) )) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1661</span>:         <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ligand_ligand_reduced</span><span class="p">(</span><span class="n">xyz_tm</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_12 = __pyx_v_i;
    __pyx_t_11 = (__pyx_v_grid_M - 1);
/* â€¦ */
    __pyx_t_13 = __pyx_v_i;
    __pyx_t_14 = (__pyx_v_grid_M - 1);
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_13 * __pyx_v_grid.strides[0]) ) + __pyx_t_14 * __pyx_v_grid.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_12 * __pyx_v_grid.strides[0]) ) + __pyx_t_11 * __pyx_v_grid.strides[1]) ))) + __pyx_f_6Energy_ligand_ligand_reduced(__pyx_v_xyz_tm, __pyx_v_ligand_qij, __pyx_v_ligand_dljr, __pyx_v_ligand_dljep, __pyx_v_ligand_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_ligand_nonbonded, __pyx_v_ligand_nonbondedWeights, __pyx_v_ligand_coupling, __pyx_v_ligand_weights));
</pre><pre class="cython line score-0">&#xA0;<span class="">1662</span>:                                                      <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1663</span>:                                                      <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1664</span>:                                                      <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1665</span>:                                                      <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1666</span>:                                                      <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1667</span>:                                                      <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1668</span>:                                                      <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1669</span>:                                                      <span class="n">ligand_coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1670</span>:                                                      <span class="n">ligand_weights</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1671</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1672</span>:         <span class="c"># Compute ligand_environment Energy</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1673</span>:         <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ligand_environment_reduced</span><span class="p">(</span><span class="n">xyz_tm</span><span class="p">,</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = (__pyx_v_grid_M - 1);
/* â€¦ */
    __pyx_t_14 = __pyx_v_i;
    __pyx_t_13 = (__pyx_v_grid_M - 1);
    *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_14 * __pyx_v_grid.strides[0]) ) + __pyx_t_13 * __pyx_v_grid.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_11 * __pyx_v_grid.strides[0]) ) + __pyx_t_12 * __pyx_v_grid.strides[1]) ))) + __pyx_f_6Energy_ligand_environment_reduced(__pyx_v_xyz_tm, __pyx_v_environment_xyz, __pyx_v_ligand_mask, __pyx_v_ligand_environment_qij, __pyx_v_ligand_environment_dljr, __pyx_v_ligand_environment_dljep, __pyx_v_ligand_environment_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_environmen_lklam, __pyx_v_environment_sideChainFalgs, __pyx_v_environment_mainChainFalgs, __pyx_v_sideChainCoupling, __pyx_v_mainChainCoupling, __pyx_v_ligand_environment_weights));
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1674</span>:                                                           <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1675</span>:                                                           <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1676</span>:                                                           <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1677</span>:                                                           <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1678</span>:                                                           <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1679</span>:                                                           <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1680</span>:                                                           <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1681</span>:                                                           <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1682</span>:                                                           <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1683</span>:                                                           <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1684</span>:                                                           <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1685</span>:                                                           <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1686</span>:                                                           <span class="n">ligand_environment_weights</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1687</span>:         <span class="c">#print(&#39;BBB En: &#39;, np.array(grid[i, :]))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1688</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1689</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">boundscheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1690</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">wraparound</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1691</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">nonecheck</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1692</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">cdivision</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1693</span>: <span class="nd">@cython</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></pre>
<pre class="cython line score-270" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1694</span>: <span class="k">def</span> <span class="nf">grid_search_parallel</span><span class="p">(</span><span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">grid</span><span class="p">,</span></pre>
<pre class='cython code score-270 '>/* Python wrapper */
static PyObject *__pyx_pw_6Energy_25grid_search_parallel(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static PyMethodDef __pyx_mdef_6Energy_25grid_search_parallel = {"grid_search_parallel", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_6Energy_25grid_search_parallel, METH_VARARGS|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6Energy_25grid_search_parallel(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  __Pyx_memviewslice __pyx_v_grid = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_xyz = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_qij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_dljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_dljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_sol_prefactor = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_nonbonded = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_nonbondedWeights = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_ligand_coupling;
  __Pyx_memviewslice __pyx_v_ligand_weights = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_mask = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_sideChainsChiXYZIndices = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_sideChainSubTreeMasks = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_qij = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_dljr = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_dljep = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environmen_lklam = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_sideChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_environment_mainChainFalgs = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_sideChainCoupling;
  double __pyx_v_mainChainCoupling;
  __Pyx_memviewslice __pyx_v_ligand_environment_weights = { 0, 0, { 0 }, { 0 }, { 0 } };
  int __pyx_v_number_of_threads;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("grid_search_parallel (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_grid,&amp;__pyx_n_s_ligand_xyz,&amp;__pyx_n_s_environment_xyz,&amp;__pyx_n_s_ligand_qij,&amp;__pyx_n_s_ligand_dljr,&amp;__pyx_n_s_ligand_dljep,&amp;__pyx_n_s_ligand_sol_prefactor,&amp;__pyx_n_s_ligand_lklam,&amp;__pyx_n_s_ligand_nonbonded,&amp;__pyx_n_s_ligand_nonbondedWeights,&amp;__pyx_n_s_ligand_coupling,&amp;__pyx_n_s_ligand_weights,&amp;__pyx_n_s_ligand_mask,&amp;__pyx_n_s_sideChainsChiXYZIndices,&amp;__pyx_n_s_sideChainSubTreeMasks,&amp;__pyx_n_s_ligand_environment_qij,&amp;__pyx_n_s_ligand_environment_dljr,&amp;__pyx_n_s_ligand_environment_dljep,&amp;__pyx_n_s_ligand_environment_sol_prefactor,&amp;__pyx_n_s_environmen_lklam,&amp;__pyx_n_s_environment_sideChainFalgs,&amp;__pyx_n_s_environment_mainChainFalgs,&amp;__pyx_n_s_sideChainCoupling,&amp;__pyx_n_s_mainChainCoupling,&amp;__pyx_n_s_ligand_environment_weights,&amp;__pyx_n_s_number_of_threads,0};
    PyObject* values[26] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case 26: values[25] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 25);
        CYTHON_FALLTHROUGH;
        case 25: values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
        CYTHON_FALLTHROUGH;
        case 24: values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
        CYTHON_FALLTHROUGH;
        case 23: values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
        CYTHON_FALLTHROUGH;
        case 22: values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
        CYTHON_FALLTHROUGH;
        case 21: values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
        CYTHON_FALLTHROUGH;
        case 20: values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
        CYTHON_FALLTHROUGH;
        case 19: values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
        CYTHON_FALLTHROUGH;
        case 18: values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
        CYTHON_FALLTHROUGH;
        case 17: values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
        CYTHON_FALLTHROUGH;
        case 16: values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
        CYTHON_FALLTHROUGH;
        case 15: values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
        CYTHON_FALLTHROUGH;
        case 14: values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
        CYTHON_FALLTHROUGH;
        case 13: values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
        CYTHON_FALLTHROUGH;
        case 12: values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
        CYTHON_FALLTHROUGH;
        case 11: values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
        CYTHON_FALLTHROUGH;
        case 10: values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_grid)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_xyz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 1); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_xyz)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 2); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_qij)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 3); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_dljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 4); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_dljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 5); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_sol_prefactor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 6); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 7); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_nonbonded)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 8); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_nonbondedWeights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 9); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 10:
        if (likely((values[10] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_coupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 10); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 11:
        if (likely((values[11] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_weights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 11); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 12:
        if (likely((values[12] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_mask)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 12); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 13:
        if (likely((values[13] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sideChainsChiXYZIndices)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 13); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 14:
        if (likely((values[14] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sideChainSubTreeMasks)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 14); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 15:
        if (likely((values[15] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_qij)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 15); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 16:
        if (likely((values[16] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_dljr)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 16); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 17:
        if (likely((values[17] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_dljep)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 17); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 18:
        if (likely((values[18] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_sol_prefactor)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 18); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 19:
        if (likely((values[19] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environmen_lklam)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 19); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 20:
        if (likely((values[20] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_sideChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 20); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 21:
        if (likely((values[21] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_environment_mainChainFalgs)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 21); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 22:
        if (likely((values[22] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_sideChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 22); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 23:
        if (likely((values[23] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_mainChainCoupling)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 23); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 24:
        if (likely((values[24] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_ligand_environment_weights)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 24); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case 25:
        if (likely((values[25] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_number_of_threads)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, 25); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "grid_search_parallel") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 26) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
      values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
      values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
      values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
      values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
      values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
      values[9] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 9);
      values[10] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 10);
      values[11] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 11);
      values[12] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 12);
      values[13] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 13);
      values[14] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 14);
      values[15] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 15);
      values[16] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 16);
      values[17] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 17);
      values[18] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 18);
      values[19] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 19);
      values[20] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 20);
      values[21] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 21);
      values[22] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 22);
      values[23] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 23);
      values[24] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 24);
      values[25] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 25);
    }
    __pyx_v_grid = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[0], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_grid.memview)) __PYX_ERR(0, 1694, __pyx_L3_error)</span>
    __pyx_v_ligand_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[1], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_xyz.memview)) __PYX_ERR(0, 1695, __pyx_L3_error)</span>
    __pyx_v_environment_xyz = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[2], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_xyz.memview)) __PYX_ERR(0, 1696, __pyx_L3_error)</span>
    __pyx_v_ligand_qij = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[3], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_qij.memview)) __PYX_ERR(0, 1698, __pyx_L3_error)</span>
    __pyx_v_ligand_dljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[4], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_dljr.memview)) __PYX_ERR(0, 1699, __pyx_L3_error)</span>
    __pyx_v_ligand_dljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[5], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_dljep.memview)) __PYX_ERR(0, 1700, __pyx_L3_error)</span>
    __pyx_v_ligand_sol_prefactor = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[6], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_sol_prefactor.memview)) __PYX_ERR(0, 1701, __pyx_L3_error)</span>
    __pyx_v_ligand_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[7], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_lklam.memview)) __PYX_ERR(0, 1702, __pyx_L3_error)</span>
    __pyx_v_ligand_nonbonded = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[8], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_nonbonded.memview)) __PYX_ERR(0, 1703, __pyx_L3_error)</span>
    __pyx_v_ligand_nonbondedWeights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[9], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_nonbondedWeights.memview)) __PYX_ERR(0, 1704, __pyx_L3_error)</span>
    __pyx_v_ligand_coupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[10]); if (unlikely((__pyx_v_ligand_coupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1705, __pyx_L3_error)</span>
    __pyx_v_ligand_weights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[11], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_weights.memview)) __PYX_ERR(0, 1706, __pyx_L3_error)</span>
    __pyx_v_ligand_mask = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[12], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_mask.memview)) __PYX_ERR(0, 1708, __pyx_L3_error)</span>
    __pyx_v_sideChainsChiXYZIndices = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[13], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_sideChainsChiXYZIndices.memview)) __PYX_ERR(0, 1709, __pyx_L3_error)</span>
    __pyx_v_sideChainSubTreeMasks = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_int</span>(values[14], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_sideChainSubTreeMasks.memview)) __PYX_ERR(0, 1710, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_qij = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[15], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_qij.memview)) __PYX_ERR(0, 1712, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_dljr = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[16], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_dljr.memview)) __PYX_ERR(0, 1713, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_dljep = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(values[17], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_dljep.memview)) __PYX_ERR(0, 1714, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_sol_prefactor = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(values[18], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_sol_prefactor.memview)) __PYX_ERR(0, 1715, __pyx_L3_error)</span>
    __pyx_v_environmen_lklam = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[19], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environmen_lklam.memview)) __PYX_ERR(0, 1716, __pyx_L3_error)</span>
    __pyx_v_environment_sideChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[20], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_sideChainFalgs.memview)) __PYX_ERR(0, 1717, __pyx_L3_error)</span>
    __pyx_v_environment_mainChainFalgs = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(values[21], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_environment_mainChainFalgs.memview)) __PYX_ERR(0, 1718, __pyx_L3_error)</span>
    __pyx_v_sideChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[22]); if (unlikely((__pyx_v_sideChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1719, __pyx_L3_error)</span>
    __pyx_v_mainChainCoupling = __pyx_<span class='py_c_api'>PyFloat_AsDouble</span>(values[23]); if (unlikely((__pyx_v_mainChainCoupling == (double)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1720, __pyx_L3_error)</span>
    __pyx_v_ligand_environment_weights = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(values[24], PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_v_ligand_environment_weights.memview)) __PYX_ERR(0, 1721, __pyx_L3_error)</span>
    __pyx_v_number_of_threads = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(values[25]); if (unlikely((__pyx_v_number_of_threads == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 1722, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("grid_search_parallel", 1, 26, 26, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.grid_search_parallel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6Energy_24grid_search_parallel(__pyx_self, __pyx_v_grid, __pyx_v_ligand_xyz, __pyx_v_environment_xyz, __pyx_v_ligand_qij, __pyx_v_ligand_dljr, __pyx_v_ligand_dljep, __pyx_v_ligand_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_ligand_nonbonded, __pyx_v_ligand_nonbondedWeights, __pyx_v_ligand_coupling, __pyx_v_ligand_weights, __pyx_v_ligand_mask, __pyx_v_sideChainsChiXYZIndices, __pyx_v_sideChainSubTreeMasks, __pyx_v_ligand_environment_qij, __pyx_v_ligand_environment_dljr, __pyx_v_ligand_environment_dljep, __pyx_v_ligand_environment_sol_prefactor, __pyx_v_environmen_lklam, __pyx_v_environment_sideChainFalgs, __pyx_v_environment_mainChainFalgs, __pyx_v_sideChainCoupling, __pyx_v_mainChainCoupling, __pyx_v_ligand_environment_weights, __pyx_v_number_of_threads);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6Energy_24grid_search_parallel(CYTHON_UNUSED PyObject *__pyx_self, __Pyx_memviewslice __pyx_v_grid, __Pyx_memviewslice __pyx_v_ligand_xyz, __Pyx_memviewslice __pyx_v_environment_xyz, __Pyx_memviewslice __pyx_v_ligand_qij, __Pyx_memviewslice __pyx_v_ligand_dljr, __Pyx_memviewslice __pyx_v_ligand_dljep, __Pyx_memviewslice __pyx_v_ligand_sol_prefactor, __Pyx_memviewslice __pyx_v_ligand_lklam, __Pyx_memviewslice __pyx_v_ligand_nonbonded, __Pyx_memviewslice __pyx_v_ligand_nonbondedWeights, double __pyx_v_ligand_coupling, __Pyx_memviewslice __pyx_v_ligand_weights, __Pyx_memviewslice __pyx_v_ligand_mask, __Pyx_memviewslice __pyx_v_sideChainsChiXYZIndices, __Pyx_memviewslice __pyx_v_sideChainSubTreeMasks, __Pyx_memviewslice __pyx_v_ligand_environment_qij, __Pyx_memviewslice __pyx_v_ligand_environment_dljr, __Pyx_memviewslice __pyx_v_ligand_environment_dljep, __Pyx_memviewslice __pyx_v_ligand_environment_sol_prefactor, __Pyx_memviewslice __pyx_v_environmen_lklam, __Pyx_memviewslice __pyx_v_environment_sideChainFalgs, __Pyx_memviewslice __pyx_v_environment_mainChainFalgs, double __pyx_v_sideChainCoupling, double __pyx_v_mainChainCoupling, __Pyx_memviewslice __pyx_v_ligand_environment_weights, int __pyx_v_number_of_threads) {
  CYTHON_UNUSED int __pyx_v_grid_N;
  int __pyx_v_grid_M;
  int __pyx_v_ligand_xyz_N;
  int __pyx_v_ligand_xyz_M;
  int __pyx_v_i;
  int __pyx_v_j;
  int __pyx_v_k;
  int __pyx_v_tid;
  __Pyx_memviewslice __pyx_v_xyz_tm = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_u_ji_0;
  double __pyx_v_u_ji_1;
  double __pyx_v_u_ji_2;
  double __pyx_v_u_jk_0;
  double __pyx_v_u_jk_1;
  double __pyx_v_u_jk_2;
  double __pyx_v_u_lk_0;
  double __pyx_v_u_lk_1;
  double __pyx_v_u_lk_2;
  double __pyx_v_n_ijk_0;
  double __pyx_v_n_ijk_1;
  double __pyx_v_n_ijk_2;
  double __pyx_v_n_jkl_0;
  double __pyx_v_n_jkl_1;
  double __pyx_v_n_jkl_2;
  double __pyx_v_nn_cross_0;
  double __pyx_v_nn_cross_1;
  double __pyx_v_nn_cross_2;
  double __pyx_v_p0;
  double __pyx_v_p1;
  double __pyx_v_p2;
  double __pyx_v_rotation_vector_0;
  double __pyx_v_rotation_vector_1;
  double __pyx_v_rotation_vector_2;
  double __pyx_v_q0;
  double __pyx_v_q1;
  double __pyx_v_q2;
  double __pyx_v_q3;
  double __pyx_v_n_ijk_nrom;
  double __pyx_v_n_jkl_norm;
  double __pyx_v_nn_dot;
  double __pyx_v_sign;
  double __pyx_v_rotation_vector_norm;
  __Pyx_memviewslice __pyx_v_torsion_current = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_rot_angle;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='trace'>__Pyx_TraceFrameInit</span>(__pyx_codeobj__13)
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("grid_search_parallel", 0);
  <span class='trace'>__Pyx_TraceCall</span>("grid_search_parallel", __pyx_f[0], 1694, 0, <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L1_error)</span>);
/* â€¦ */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_6, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_31, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("Energy.grid_search_parallel", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_xyz_tm, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_torsion_current, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_grid, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_xyz, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_qij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_dljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_dljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_sol_prefactor, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_nonbonded, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_nonbondedWeights, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_weights, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_mask, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_sideChainsChiXYZIndices, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_sideChainSubTreeMasks, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_qij, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_dljr, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_dljep, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_sol_prefactor, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environmen_lklam, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_sideChainFalgs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_environment_mainChainFalgs, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_ligand_environment_weights, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* â€¦ */
  __pyx_tuple__44 = <span class='py_c_api'>PyTuple_Pack</span>(71, __pyx_n_s_grid, __pyx_n_s_ligand_xyz, __pyx_n_s_environment_xyz, __pyx_n_s_ligand_qij, __pyx_n_s_ligand_dljr, __pyx_n_s_ligand_dljep, __pyx_n_s_ligand_sol_prefactor, __pyx_n_s_ligand_lklam, __pyx_n_s_ligand_nonbonded, __pyx_n_s_ligand_nonbondedWeights, __pyx_n_s_ligand_coupling, __pyx_n_s_ligand_weights, __pyx_n_s_ligand_mask, __pyx_n_s_sideChainsChiXYZIndices, __pyx_n_s_sideChainSubTreeMasks, __pyx_n_s_ligand_environment_qij, __pyx_n_s_ligand_environment_dljr, __pyx_n_s_ligand_environment_dljep, __pyx_n_s_ligand_environment_sol_prefactor, __pyx_n_s_environmen_lklam, __pyx_n_s_environment_sideChainFalgs, __pyx_n_s_environment_mainChainFalgs, __pyx_n_s_sideChainCoupling, __pyx_n_s_mainChainCoupling, __pyx_n_s_ligand_environment_weights, __pyx_n_s_number_of_threads, __pyx_n_s_grid_N, __pyx_n_s_grid_M, __pyx_n_s_ligand_xyz_N, __pyx_n_s_ligand_xyz_M, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_k, __pyx_n_s_tid, __pyx_n_s_xyz_tm, __pyx_n_s_u_ji_0, __pyx_n_s_u_ji_1, __pyx_n_s_u_ji_2, __pyx_n_s_u_jk_0, __pyx_n_s_u_jk_1, __pyx_n_s_u_jk_2, __pyx_n_s_u_lk_0, __pyx_n_s_u_lk_1, __pyx_n_s_u_lk_2, __pyx_n_s_n_ijk_0, __pyx_n_s_n_ijk_1, __pyx_n_s_n_ijk_2, __pyx_n_s_n_jkl_0, __pyx_n_s_n_jkl_1, __pyx_n_s_n_jkl_2, __pyx_n_s_nn_cross_0, __pyx_n_s_nn_cross_1, __pyx_n_s_nn_cross_2, __pyx_n_s_p0, __pyx_n_s_p1, __pyx_n_s_p2, __pyx_n_s_rotation_vector_0, __pyx_n_s_rotation_vector_1, __pyx_n_s_rotation_vector_2, __pyx_n_s_q0, __pyx_n_s_q1, __pyx_n_s_q2, __pyx_n_s_q3, __pyx_n_s_n_ijk_nrom, __pyx_n_s_n_jkl_norm, __pyx_n_s_nn_dot, __pyx_n_s_sign, __pyx_n_s_rotation_vector_norm, __pyx_n_s_energy, __pyx_n_s_torsion_current, __pyx_n_s_rot_angle);<span class='error_goto'> if (unlikely(!__pyx_tuple__44)) __PYX_ERR(0, 1694, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple__44);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple__44);
/* â€¦ */
  __pyx_t_1 = PyCFunction_NewEx(&amp;__pyx_mdef_6Energy_25grid_search_parallel, NULL, __pyx_n_s_Energy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1694, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_grid_search_parallel, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1694, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_codeobj__13 = (PyObject*)<span class='pyx_c_api'>__Pyx_PyCode_New</span>(26, 0, 71, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__44, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_Energy_pyx, __pyx_n_s_grid_search_parallel, 1694, __pyx_empty_bytes);<span class='error_goto'> if (unlikely(!__pyx_codeobj__13)) __PYX_ERR(0, 1694, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">1695</span>:                          <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1696</span>:                          <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1697</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1698</span>:                          <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1699</span>:                          <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1700</span>:                          <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1701</span>:                          <span class="n">double</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1702</span>:                          <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1703</span>:                          <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1704</span>:                          <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1705</span>:                          <span class="n">double</span> <span class="n">ligand_coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1706</span>:                          <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_weights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1707</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1708</span>:                          <span class="n">double</span><span class="p">[:]</span> <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1709</span>:                          <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1710</span>:                          <span class="nb">int</span> <span class="p">[:,</span> <span class="p">:]</span> <span class="n">sideChainSubTreeMasks</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1711</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1712</span>:                          <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1713</span>:                          <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1714</span>:                          <span class="n">double</span><span class="p">[:,</span> <span class="p">:]</span> <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1715</span>:                          <span class="n">double</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1716</span>:                          <span class="n">double</span> <span class="p">[:]</span> <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1717</span>:                          <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1718</span>:                          <span class="nb">int</span> <span class="p">[:]</span> <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1719</span>:                          <span class="n">double</span> <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1720</span>:                          <span class="n">double</span> <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1721</span>:                          <span class="n">double</span> <span class="p">[:]</span> <span class="n">ligand_environment_weights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1722</span>:                          <span class="nb">int</span> <span class="n">number_of_threads</span><span class="p">):</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1723</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1724</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">grid_N</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_grid_N = (__pyx_v_grid.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1725</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">grid_M</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_grid_M = (__pyx_v_grid.shape[1]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1726</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ligand_xyz_N</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ligand_xyz_N = (__pyx_v_ligand_xyz.shape[0]);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1727</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">ligand_xyz_M</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_v_ligand_xyz_M = (__pyx_v_grid.shape[1]);
</pre><pre class="cython line score-0">&#xA0;<span class="">1728</span>:     <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">i</span><span class="p">,</span> <span class="nf">j</span><span class="p">,</span> <span class="nf">k</span><span class="p">,</span> <span class="nf">tid</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1729</span>:     <span class="c">#print(&#39;BB ----- &#39;, ligand_xyz.shape)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1730</span>: </pre>
<pre class="cython line score-46" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1731</span>:     <span class="k">cdef</span> <span class="kt">double</span> [<span class="p">:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="n">xyz_tm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_threads</span><span class="p">,</span> <span class="n">ligand_xyz_N</span><span class="p">,</span> <span class="n">ligand_xyz_M</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></pre>
<pre class='cython code score-46 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_number_of_threads);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ligand_xyz_N);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_ligand_xyz_M);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(3);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 2, __pyx_t_4);
  __pyx_t_1 = 0;
  __pyx_t_3 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_4, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsdsds_double</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_6.memview)) __PYX_ERR(0, 1731, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_xyz_tm = __pyx_t_6;
  __pyx_t_6.memview = NULL;
  __pyx_t_6.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">1732</span>:     <span class="c">#cdef double [:, :] rotation_vectors = np.zeros((sideChainsChiXYZIndices.shape[0], 3))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1733</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">u_ji_0</span><span class="p">,</span> <span class="nf">u_ji_1</span><span class="p">,</span> <span class="nf">u_ji_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1734</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">u_jk_0</span><span class="p">,</span> <span class="nf">u_jk_1</span><span class="p">,</span> <span class="nf">u_jk_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1735</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">u_lk_0</span><span class="p">,</span> <span class="nf">u_lk_1</span><span class="p">,</span> <span class="nf">u_lk_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1736</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">n_ijk_0</span><span class="p">,</span> <span class="nf">n_ijk_1</span><span class="p">,</span> <span class="nf">n_ijk_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1737</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">n_jkl_0</span><span class="p">,</span> <span class="nf">n_jkl_1</span><span class="p">,</span> <span class="nf">n_jkl_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1738</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">nn_cross_0</span><span class="p">,</span> <span class="nf">nn_cross_1</span><span class="p">,</span> <span class="nf">nn_cross_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1739</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">p0</span><span class="p">,</span> <span class="nf">p1</span><span class="p">,</span> <span class="nf">p2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1740</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">rotation_vector_0</span><span class="p">,</span> <span class="nf">rotation_vector_1</span><span class="p">,</span> <span class="nf">rotation_vector_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1741</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">q0</span><span class="p">,</span> <span class="nf">q1</span><span class="p">,</span> <span class="nf">q2</span><span class="p">,</span> <span class="nf">q3</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1742</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">n_ijk_nrom</span><span class="p">,</span> <span class="nf">n_jkl_norm</span><span class="p">,</span> <span class="nf">nn_dot</span><span class="p">,</span> <span class="nf">sign</span><span class="p">,</span> <span class="nf">rotation_vector_norm</span><span class="p">,</span> <span class="nf">energy</span></pre>
<pre class="cython line score-28" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1743</span>:     <span class="k">cdef</span> <span class="kt">double</span> [<span class="p">:]</span> <span class="n">torsion_current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">sideChainsChiXYZIndices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">])</span></pre>
<pre class='cython code score-28 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1743, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1743, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyInt_FromSsize_t</span>((__pyx_v_sideChainsChiXYZIndices.shape[0]));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1743, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_2, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 1743, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 1743, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_torsion_current = __pyx_t_7;
  __pyx_t_7.memview = NULL;
  __pyx_t_7.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">1744</span>:     <span class="k">cdef</span> <span class="kt">double</span> <span class="nf">rot_angle</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1745</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1746</span>:     <span class="c">#print(xyz_tm.shape)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1747</span>:     <span class="c">#print(np.array(xyz_tm))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1748</span>:     <span class="c"># Get the current torsion vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1749</span>:     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sideChainsChiXYZIndices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mf">0</span><span class="p">]):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (__pyx_v_sideChainsChiXYZIndices.shape[0]);
  __pyx_t_9 = __pyx_t_8;
  for (__pyx_t_10 = 0; __pyx_t_10 &lt; __pyx_t_9; __pyx_t_10+=1) {
    __pyx_v_i = __pyx_t_10;
</pre><pre class="cython line score-0">&#xA0;<span class="">1750</span>:         <span class="c">#print(&#39;BBB Cord i:&#39;, ligand_xyz[sideChainsChiXYZIndices[i, 0], 0], ligand_xyz[sideChainsChiXYZIndices[i, 0], 1], ligand_xyz[sideChainsChiXYZIndices[i, 0], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1751</span>:         <span class="c">#print(&#39;BBB Cord j:&#39;, ligand_xyz[sideChainsChiXYZIndices[i, 1], 0], ligand_xyz[sideChainsChiXYZIndices[i, 1], 1], ligand_xyz[sideChainsChiXYZIndices[i, 1], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1752</span>:         <span class="c">#print(&#39;BBB Cord k:&#39;, ligand_xyz[sideChainsChiXYZIndices[i, 2], 0], ligand_xyz[sideChainsChiXYZIndices[i, 2], 1], ligand_xyz[sideChainsChiXYZIndices[i, 2], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1753</span>:         <span class="c">#print(&#39;BBB Cord l:&#39;, ligand_xyz[sideChainsChiXYZIndices[i, 3], 0], ligand_xyz[sideChainsChiXYZIndices[i, 3], 1], ligand_xyz[sideChainsChiXYZIndices[i, 3], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1754</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1755</span>:         <span class="n">u_ji_0</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = 0;
    __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_14 = 0;
    __pyx_t_15 = __pyx_v_i;
    __pyx_t_16 = 1;
    __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_18 = 0;
    __pyx_v_u_ji_0 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_13 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_17 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_18 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1756</span>:         <span class="n">u_ji_1</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_16 = __pyx_v_i;
    __pyx_t_15 = 0;
    __pyx_t_18 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_17 = 1;
    __pyx_t_12 = __pyx_v_i;
    __pyx_t_11 = 1;
    __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_13 = 1;
    __pyx_v_u_ji_1 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_18 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_17 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_14 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1757</span>:         <span class="n">u_ji_2</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">0</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = 0;
    __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_14 = 2;
    __pyx_t_15 = __pyx_v_i;
    __pyx_t_16 = 1;
    __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_18 = 2;
    __pyx_v_u_ji_2 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_13 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_17 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_18 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1758</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1759</span>:         <span class="n">u_jk_0</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_16 = __pyx_v_i;
    __pyx_t_15 = 2;
    __pyx_t_18 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_17 = 0;
    __pyx_t_12 = __pyx_v_i;
    __pyx_t_11 = 1;
    __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_13 = 0;
    __pyx_v_u_jk_0 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_18 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_17 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_14 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1760</span>:         <span class="n">u_jk_1</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = 2;
    __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_14 = 1;
    __pyx_t_15 = __pyx_v_i;
    __pyx_t_16 = 1;
    __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_18 = 1;
    __pyx_v_u_jk_1 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_13 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_17 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_18 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1761</span>:         <span class="n">u_jk_2</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_16 = __pyx_v_i;
    __pyx_t_15 = 2;
    __pyx_t_18 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_17 = 2;
    __pyx_t_12 = __pyx_v_i;
    __pyx_t_11 = 1;
    __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_13 = 2;
    __pyx_v_u_jk_2 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_18 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_17 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_14 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1762</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1763</span>:         <span class="n">u_lk_0</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">3</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = 2;
    __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_14 = 0;
    __pyx_t_15 = __pyx_v_i;
    __pyx_t_16 = 3;
    __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_18 = 0;
    __pyx_v_u_lk_0 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_13 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_17 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_18 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1764</span>:         <span class="n">u_lk_1</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">3</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_16 = __pyx_v_i;
    __pyx_t_15 = 2;
    __pyx_t_18 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_17 = 1;
    __pyx_t_12 = __pyx_v_i;
    __pyx_t_11 = 3;
    __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_13 = 1;
    __pyx_v_u_lk_1 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_18 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_17 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_14 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_13 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1765</span>:         <span class="n">u_lk_2</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mf">3</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_i;
    __pyx_t_12 = 2;
    __pyx_t_13 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_14 = 2;
    __pyx_t_15 = __pyx_v_i;
    __pyx_t_16 = 3;
    __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_15 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
    __pyx_t_18 = 2;
    __pyx_v_u_lk_2 = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_13 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_14 * __pyx_v_ligand_xyz.strides[1]) ))) - (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_17 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_18 * __pyx_v_ligand_xyz.strides[1]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1766</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1767</span>:         <span class="c">#print(&#39;BBB&#39;, u_ji)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1768</span>:         <span class="c">#print(&#39;BBB&#39;, u_jk)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1769</span>:         <span class="c">#print(&#39;BBB&#39;, u_lk)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1770</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1771</span>:         <span class="n">n_ijk_0</span> <span class="o">=</span> <span class="n">u_ji_1</span> <span class="o">*</span> <span class="n">u_jk_2</span> <span class="o">-</span> <span class="n">u_ji_2</span> <span class="o">*</span> <span class="n">u_jk_1</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_ijk_0 = ((__pyx_v_u_ji_1 * __pyx_v_u_jk_2) - (__pyx_v_u_ji_2 * __pyx_v_u_jk_1));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1772</span>:         <span class="n">n_ijk_1</span> <span class="o">=</span> <span class="n">u_ji_2</span> <span class="o">*</span> <span class="n">u_jk_0</span> <span class="o">-</span> <span class="n">u_ji_0</span> <span class="o">*</span> <span class="n">u_jk_2</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_ijk_1 = ((__pyx_v_u_ji_2 * __pyx_v_u_jk_0) - (__pyx_v_u_ji_0 * __pyx_v_u_jk_2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1773</span>:         <span class="n">n_ijk_2</span> <span class="o">=</span> <span class="n">u_ji_0</span> <span class="o">*</span> <span class="n">u_jk_1</span> <span class="o">-</span> <span class="n">u_ji_1</span> <span class="o">*</span> <span class="n">u_jk_0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_ijk_2 = ((__pyx_v_u_ji_0 * __pyx_v_u_jk_1) - (__pyx_v_u_ji_1 * __pyx_v_u_jk_0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1774</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1775</span>:         <span class="n">n_jkl_0</span> <span class="o">=</span> <span class="n">u_jk_1</span> <span class="o">*</span> <span class="n">u_lk_2</span> <span class="o">-</span> <span class="n">u_jk_2</span> <span class="o">*</span> <span class="n">u_lk_1</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_jkl_0 = ((__pyx_v_u_jk_1 * __pyx_v_u_lk_2) - (__pyx_v_u_jk_2 * __pyx_v_u_lk_1));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1776</span>:         <span class="n">n_jkl_1</span> <span class="o">=</span> <span class="n">u_jk_2</span> <span class="o">*</span> <span class="n">u_lk_0</span> <span class="o">-</span> <span class="n">u_jk_0</span> <span class="o">*</span> <span class="n">u_lk_2</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_jkl_1 = ((__pyx_v_u_jk_2 * __pyx_v_u_lk_0) - (__pyx_v_u_jk_0 * __pyx_v_u_lk_2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1777</span>:         <span class="n">n_jkl_2</span> <span class="o">=</span> <span class="n">u_jk_0</span> <span class="o">*</span> <span class="n">u_lk_1</span> <span class="o">-</span> <span class="n">u_jk_1</span> <span class="o">*</span> <span class="n">u_lk_0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_jkl_2 = ((__pyx_v_u_jk_0 * __pyx_v_u_lk_1) - (__pyx_v_u_jk_1 * __pyx_v_u_lk_0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1778</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1779</span>:         <span class="n">n_ijk_nrom</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n_ijk_0</span> <span class="o">*</span> <span class="n">n_ijk_0</span> <span class="o">+</span> <span class="n">n_ijk_1</span> <span class="o">*</span> <span class="n">n_ijk_1</span> <span class="o">+</span> <span class="n">n_ijk_2</span> <span class="o">*</span> <span class="n">n_ijk_2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_ijk_nrom = sqrt((((__pyx_v_n_ijk_0 * __pyx_v_n_ijk_0) + (__pyx_v_n_ijk_1 * __pyx_v_n_ijk_1)) + (__pyx_v_n_ijk_2 * __pyx_v_n_ijk_2)));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1780</span>:         <span class="n">n_jkl_norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">n_jkl_0</span> <span class="o">*</span> <span class="n">n_jkl_0</span> <span class="o">+</span> <span class="n">n_jkl_1</span> <span class="o">*</span> <span class="n">n_jkl_1</span> <span class="o">+</span> <span class="n">n_jkl_2</span> <span class="o">*</span> <span class="n">n_jkl_2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_jkl_norm = sqrt((((__pyx_v_n_jkl_0 * __pyx_v_n_jkl_0) + (__pyx_v_n_jkl_1 * __pyx_v_n_jkl_1)) + (__pyx_v_n_jkl_2 * __pyx_v_n_jkl_2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1781</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1782</span>:         <span class="n">n_ijk_0</span> <span class="o">=</span> <span class="n">n_ijk_0</span> <span class="o">/</span> <span class="n">n_ijk_nrom</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_ijk_0 = (__pyx_v_n_ijk_0 / __pyx_v_n_ijk_nrom);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1783</span>:         <span class="n">n_ijk_1</span> <span class="o">=</span> <span class="n">n_ijk_1</span> <span class="o">/</span> <span class="n">n_ijk_nrom</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_ijk_1 = (__pyx_v_n_ijk_1 / __pyx_v_n_ijk_nrom);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1784</span>:         <span class="n">n_ijk_2</span> <span class="o">=</span> <span class="n">n_ijk_2</span> <span class="o">/</span> <span class="n">n_ijk_nrom</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_ijk_2 = (__pyx_v_n_ijk_2 / __pyx_v_n_ijk_nrom);
</pre><pre class="cython line score-0">&#xA0;<span class="">1785</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1786</span>:         <span class="n">n_jkl_0</span> <span class="o">=</span> <span class="n">n_jkl_0</span> <span class="o">/</span> <span class="n">n_jkl_norm</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_jkl_0 = (__pyx_v_n_jkl_0 / __pyx_v_n_jkl_norm);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1787</span>:         <span class="n">n_jkl_1</span> <span class="o">=</span> <span class="n">n_jkl_1</span> <span class="o">/</span> <span class="n">n_jkl_norm</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_jkl_1 = (__pyx_v_n_jkl_1 / __pyx_v_n_jkl_norm);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1788</span>:         <span class="n">n_jkl_2</span> <span class="o">=</span> <span class="n">n_jkl_2</span> <span class="o">/</span> <span class="n">n_jkl_norm</span></pre>
<pre class='cython code score-0 '>    __pyx_v_n_jkl_2 = (__pyx_v_n_jkl_2 / __pyx_v_n_jkl_norm);
</pre><pre class="cython line score-0">&#xA0;<span class="">1789</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1790</span>:         <span class="c">#print(&#39;BBB&#39;, n_ijk)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1791</span>:         <span class="c">#print(&#39;BBB&#39;, n_jkl)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1792</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1793</span>:         <span class="n">nn_dot</span> <span class="o">=</span> <span class="n">n_ijk_0</span> <span class="o">*</span> <span class="n">n_jkl_0</span> <span class="o">+</span> <span class="n">n_ijk_1</span> <span class="o">*</span> <span class="n">n_jkl_1</span> <span class="o">+</span> <span class="n">n_ijk_2</span> <span class="o">*</span> <span class="n">n_jkl_2</span></pre>
<pre class='cython code score-0 '>    __pyx_v_nn_dot = (((__pyx_v_n_ijk_0 * __pyx_v_n_jkl_0) + (__pyx_v_n_ijk_1 * __pyx_v_n_jkl_1)) + (__pyx_v_n_ijk_2 * __pyx_v_n_jkl_2));
</pre><pre class="cython line score-0">&#xA0;<span class="">1794</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1795</span>:         <span class="n">nn_cross_0</span> <span class="o">=</span> <span class="n">n_ijk_1</span> <span class="o">*</span> <span class="n">n_jkl_2</span> <span class="o">-</span> <span class="n">n_ijk_2</span> <span class="o">*</span> <span class="n">n_jkl_1</span></pre>
<pre class='cython code score-0 '>    __pyx_v_nn_cross_0 = ((__pyx_v_n_ijk_1 * __pyx_v_n_jkl_2) - (__pyx_v_n_ijk_2 * __pyx_v_n_jkl_1));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1796</span>:         <span class="n">nn_cross_1</span> <span class="o">=</span> <span class="n">n_ijk_2</span> <span class="o">*</span> <span class="n">n_jkl_0</span> <span class="o">-</span> <span class="n">n_ijk_0</span> <span class="o">*</span> <span class="n">n_jkl_2</span></pre>
<pre class='cython code score-0 '>    __pyx_v_nn_cross_1 = ((__pyx_v_n_ijk_2 * __pyx_v_n_jkl_0) - (__pyx_v_n_ijk_0 * __pyx_v_n_jkl_2));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1797</span>:         <span class="n">nn_cross_2</span> <span class="o">=</span> <span class="n">n_ijk_0</span> <span class="o">*</span> <span class="n">n_jkl_1</span> <span class="o">-</span> <span class="n">n_ijk_1</span> <span class="o">*</span> <span class="n">n_jkl_0</span></pre>
<pre class='cython code score-0 '>    __pyx_v_nn_cross_2 = ((__pyx_v_n_ijk_0 * __pyx_v_n_jkl_1) - (__pyx_v_n_ijk_1 * __pyx_v_n_jkl_0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1798</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1799</span>:         <span class="c"># Correct for precision error</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1800</span>:         <span class="k">if</span> <span class="n">nn_dot</span> <span class="o">&gt;</span> <span class="mf">1</span><span class="p">:</span> <span class="n">nn_dot</span> <span class="o">=</span> <span class="mf">1.0</span></pre>
<pre class='cython code score-0 '>    __pyx_t_19 = ((__pyx_v_nn_dot &gt; 1.0) != 0);
    if (__pyx_t_19) {
      __pyx_v_nn_dot = 1.0;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1801</span>:         <span class="k">if</span> <span class="n">nn_dot</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1</span><span class="p">:</span> <span class="n">nn_dot</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span></pre>
<pre class='cython code score-0 '>    __pyx_t_19 = ((__pyx_v_nn_dot &lt; -1.0) != 0);
    if (__pyx_t_19) {
      __pyx_v_nn_dot = -1.0;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">1802</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1803</span>:         <span class="c"># get the angle sign</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1804</span>:         <span class="n">sign</span> <span class="o">=</span> <span class="n">u_jk_0</span> <span class="o">*</span> <span class="n">nn_cross_0</span> <span class="o">+</span> <span class="n">u_jk_1</span> <span class="o">*</span> <span class="n">nn_cross_1</span> <span class="o">+</span> <span class="n">u_jk_2</span> <span class="o">*</span> <span class="n">nn_cross_2</span></pre>
<pre class='cython code score-0 '>    __pyx_v_sign = (((__pyx_v_u_jk_0 * __pyx_v_nn_cross_0) + (__pyx_v_u_jk_1 * __pyx_v_nn_cross_1)) + (__pyx_v_u_jk_2 * __pyx_v_nn_cross_2));
</pre><pre class="cython line score-0">&#xA0;<span class="">1805</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1806</span>:         <span class="c"># Save current torsion angles</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1807</span>:         <span class="k">if</span> <span class="n">sign</span> <span class="o">&lt;</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_19 = ((__pyx_v_sign &lt; 0.0) != 0);
    if (__pyx_t_19) {
/* â€¦ */
      goto __pyx_L7;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1808</span>:             <span class="n">torsion_current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">nn_dot</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">M_PI</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>      __pyx_t_16 = __pyx_v_i;
      *((double *) ( /* dim=0 */ (__pyx_v_torsion_current.data + __pyx_t_16 * __pyx_v_torsion_current.strides[0]) )) = ((acos(__pyx_v_nn_dot) * (180.0 / M_PI)) * -1.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">1809</span>:         <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1810</span>:             <span class="n">torsion_current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">acos</span><span class="p">(</span><span class="n">nn_dot</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">180.0</span> <span class="o">/</span> <span class="n">M_PI</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_16 = __pyx_v_i;
      *((double *) ( /* dim=0 */ (__pyx_v_torsion_current.data + __pyx_t_16 * __pyx_v_torsion_current.strides[0]) )) = (acos(__pyx_v_nn_dot) * (180.0 / M_PI));
    }
    __pyx_L7:;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">1811</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1812</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1813</span>:         <span class="c">#print(&#39;BBBB ----!!!&#39;, np.array(sideChainsChiXYZIndices[i, :]), np.array(torsion_current[i]))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1814</span>: </pre>
<pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1815</span>:     <span class="k">with</span> <span class="k">nogil</span><span class="p">,</span> <span class="n">parallel</span><span class="p">():</span></pre>
<pre class='cython code score-4 '>  {
      #ifdef WITH_THREAD
      PyThreadState *_save;
      Py_UNBLOCK_THREADS
      <span class='pyx_c_api'>__Pyx_FastGIL_Remember</span>();
      #endif
      /*try:*/ {
        {
            #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
                #undef likely
                #undef unlikely
                #define likely(x)   (x)
                #define unlikely(x) (x)
            #endif
            #ifdef _OPENMP
            #pragma omp parallel private(__pyx_v_tid)
            #endif /* _OPENMP */
            {
                /* Initialize private variables to invalid values */
                __pyx_v_tid = ((int)0xbad0bad0);
/* â€¦ */
      /*finally:*/ {
        /*normal exit:*/{
          #ifdef WITH_THREAD
          <span class='pyx_c_api'>__Pyx_FastGIL_Forget</span>();
          Py_BLOCK_THREADS
          #endif
          goto __pyx_L10;
        }
        __pyx_L10:;
      }
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1816</span>:         <span class="n">tid</span> <span class="o">=</span> <span class="n">openmp</span><span class="o">.</span><span class="n">omp_get_thread_num</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>                __pyx_v_tid = omp_get_thread_num();
</pre><pre class="cython line score-0">&#xA0;<span class="">1817</span>:         <span class="c">#printf(&quot;-------------------&gt;&gt;&gt; %i  %i  %i  %i \n&quot;, openmp.omp_get_num_threads(), tid, ligand_xyz_N, ligand_xyz_M)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1818</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1819</span>:         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prange</span><span class="p">(</span><span class="n">grid_N</span><span class="p">,</span> <span class="n">schedule</span><span class="o">=</span><span class="s">&#39;static&#39;</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>                __pyx_t_10 = __pyx_v_grid_N;
                if ((1 == 0)) abort();
                {
                    __pyx_t_21 = (__pyx_t_10 - 0 + 1 - 1/abs(1)) / 1;
                    if (__pyx_t_21 &gt; 0)
                    {
                        #ifdef _OPENMP
                        #pragma omp for firstprivate(__pyx_v_i) lastprivate(__pyx_v_i) lastprivate(__pyx_v_j) lastprivate(__pyx_v_k) lastprivate(__pyx_v_p0) lastprivate(__pyx_v_p1) lastprivate(__pyx_v_p2) lastprivate(__pyx_v_q0) lastprivate(__pyx_v_q1) lastprivate(__pyx_v_q2) lastprivate(__pyx_v_q3) lastprivate(__pyx_v_rot_angle) lastprivate(__pyx_v_rotation_vector_0) lastprivate(__pyx_v_rotation_vector_1) lastprivate(__pyx_v_rotation_vector_2) lastprivate(__pyx_v_rotation_vector_norm) schedule(static)
                        #endif /* _OPENMP */
                        for (__pyx_t_20 = 0; __pyx_t_20 &lt; __pyx_t_21; __pyx_t_20++){
                            {
                                __pyx_v_i = (int)(0 + 1 * __pyx_t_20);
                                /* Initialize private variables to invalid values */
                                __pyx_v_j = ((int)0xbad0bad0);
                                __pyx_v_k = ((int)0xbad0bad0);
                                __pyx_v_p0 = ((double)__PYX_NAN());
                                __pyx_v_p1 = ((double)__PYX_NAN());
                                __pyx_v_p2 = ((double)__PYX_NAN());
                                __pyx_v_q0 = ((double)__PYX_NAN());
                                __pyx_v_q1 = ((double)__PYX_NAN());
                                __pyx_v_q2 = ((double)__PYX_NAN());
                                __pyx_v_q3 = ((double)__PYX_NAN());
                                __pyx_v_rot_angle = ((double)__PYX_NAN());
                                __pyx_v_rotation_vector_0 = ((double)__PYX_NAN());
                                __pyx_v_rotation_vector_1 = ((double)__PYX_NAN());
                                __pyx_v_rotation_vector_2 = ((double)__PYX_NAN());
                                __pyx_v_rotation_vector_norm = ((double)__PYX_NAN());
</pre><pre class="cython line score-0">&#xA0;<span class="">1820</span>:             <span class="c">#printf(&#39;%i  %i \n&#39;, tid, i)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1821</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1822</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1823</span>:             <span class="c"># Fil up the tem matrix</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1824</span>:             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ligand_xyz_N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>                                __pyx_t_22 = __pyx_v_ligand_xyz_N;
                                __pyx_t_23 = __pyx_t_22;
                                for (__pyx_t_24 = 0; __pyx_t_24 &lt; __pyx_t_23; __pyx_t_24+=1) {
                                  __pyx_v_k = __pyx_t_24;
</pre><pre class="cython line score-0">&#xA0;<span class="">1825</span>:                 <span class="c">#printf(&#39;%i  %f  %f  %f \n&#39;, tid, ligand_xyz[k, 0], ligand_xyz[k, 1], ligand_xyz[k, 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1826</span>:                 <span class="c">#printf(&#39;%i  %f  %f  %f \n&#39;, tid, xyz_tm[tid, k, 0], xyz_tm[tid, k, 1], xyz_tm[tid, k, 2])</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1827</span>:                 <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                  __pyx_t_16 = __pyx_v_k;
                                  __pyx_t_15 = 0;
                                  __pyx_t_18 = __pyx_v_tid;
                                  __pyx_t_17 = __pyx_v_k;
                                  __pyx_t_12 = 0;
                                  *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_18 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_17 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_12 * __pyx_v_xyz_tm.strides[2]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_16 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_15 * __pyx_v_ligand_xyz.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1828</span>:                 <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                  __pyx_t_15 = __pyx_v_k;
                                  __pyx_t_16 = 1;
                                  __pyx_t_12 = __pyx_v_tid;
                                  __pyx_t_17 = __pyx_v_k;
                                  __pyx_t_18 = 1;
                                  *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_12 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_17 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[2]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_15 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_16 * __pyx_v_ligand_xyz.strides[1]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1829</span>:                 <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ligand_xyz</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                  __pyx_t_16 = __pyx_v_k;
                                  __pyx_t_15 = 2;
                                  __pyx_t_18 = __pyx_v_tid;
                                  __pyx_t_17 = __pyx_v_k;
                                  __pyx_t_12 = 2;
                                  *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_18 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_17 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_12 * __pyx_v_xyz_tm.strides[2]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_ligand_xyz.data + __pyx_t_16 * __pyx_v_ligand_xyz.strides[0]) ) + __pyx_t_15 * __pyx_v_ligand_xyz.strides[1]) )));
                                }
</pre><pre class="cython line score-0">&#xA0;<span class="">1830</span>:                 <span class="c">#printf(&#39;%i  %f  %f  %f \n&#39;, tid, xyz_tm[tid, k, 0], xyz_tm[tid, k, 1], xyz_tm[tid, k, 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1831</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1832</span>:             <span class="c"># iterate over torsion vector</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1833</span>:             <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>                                __pyx_t_25 = (__pyx_v_grid_M - 1);
                                __pyx_t_26 = __pyx_t_25;
                                for (__pyx_t_22 = 0; __pyx_t_22 &lt; __pyx_t_26; __pyx_t_22+=1) {
                                  __pyx_v_j = __pyx_t_22;
</pre><pre class="cython line score-0">&#xA0;<span class="">1834</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1835</span>:                 <span class="c">#if i == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1836</span>:                 <span class="c">#    printf(&#39;%i %i %i %i\n&#39;, i, j, openmp.omp_get_thread_num(), openmp.omp_get_num_threads())</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1837</span>:                 <span class="c">#    printf(&quot;%i BBB Cord i: %f %f %f \n&quot;, openmp.omp_get_thread_num(), xyz_tm[tid, sideChainsChiXYZIndices[j, 0], 0], xyz_tm[tid, sideChainsChiXYZIndices[j, 0], 1], xyz_tm[tid, sideChainsChiXYZIndices[j, 0], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1838</span>:                 <span class="c">#    printf(&quot;%i BBB Cord j: %f %f %f \n&quot;, openmp.omp_get_thread_num(), xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 0], xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 1], xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1839</span>:                 <span class="c">#    printf(&quot;%i BBB Cord k: %f %f %f \n&quot;, openmp.omp_get_thread_num(), xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 0], xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 1], xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1840</span>:                 <span class="c">#    printf(&quot;%i BBB Cord l: %f %f %f \n&quot;, openmp.omp_get_thread_num(), xyz_tm[tid, sideChainsChiXYZIndices[j, 3], 0], xyz_tm[tid, sideChainsChiXYZIndices[j, 3], 1], xyz_tm[tid, sideChainsChiXYZIndices[j, 3], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1841</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1842</span>:                 <span class="c"># Compute rotation angle for chi j</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1843</span>:                 <span class="n">rot_angle</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">torsion_current</span><span class="p">[</span><span class="n">j</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                  __pyx_t_15 = __pyx_v_i;
                                  __pyx_t_16 = __pyx_v_j;
                                  __pyx_t_12 = __pyx_v_j;
                                  __pyx_v_rot_angle = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_15 * __pyx_v_grid.strides[0]) ) + __pyx_t_16 * __pyx_v_grid.strides[1]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_torsion_current.data + __pyx_t_12 * __pyx_v_torsion_current.strides[0]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1844</span>:                 <span class="k">if</span> <span class="n">rot_angle</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">180.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                                  __pyx_t_19 = ((__pyx_v_rot_angle &lt; -180.0) != 0);
                                  if (__pyx_t_19) {
/* â€¦ */
                                    goto __pyx_L23;
                                  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1845</span>:                     <span class="n">rot_angle</span> <span class="o">=</span> <span class="n">rot_angle</span> <span class="o">+</span> <span class="mf">360.0</span></pre>
<pre class='cython code score-0 '>                                    __pyx_v_rot_angle = (__pyx_v_rot_angle + 360.0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1846</span>:                 <span class="k">elif</span> <span class="n">rot_angle</span> <span class="o">&gt;=</span> <span class="mf">180.0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                                  __pyx_t_19 = ((__pyx_v_rot_angle &gt;= 180.0) != 0);
                                  if (__pyx_t_19) {
/* â€¦ */
                                  }
                                  __pyx_L23:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1847</span>:                     <span class="n">rot_angle</span> <span class="o">=</span> <span class="n">rot_angle</span> <span class="o">-</span> <span class="mf">360.0</span></pre>
<pre class='cython code score-0 '>                                    __pyx_v_rot_angle = (__pyx_v_rot_angle - 360.0);
</pre><pre class="cython line score-0">&#xA0;<span class="">1848</span>:                 <span class="c"># Convert to radian</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1849</span>:                 <span class="n">rot_angle</span> <span class="o">=</span> <span class="n">rot_angle</span> <span class="o">*</span> <span class="p">(</span><span class="n">M_PI</span> <span class="o">/</span> <span class="mf">180</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>                                  __pyx_v_rot_angle = (__pyx_v_rot_angle * (M_PI / 180.0));
</pre><pre class="cython line score-0">&#xA0;<span class="">1850</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1851</span>:                 <span class="c"># Compute rotation vectors</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1852</span>:                 <span class="n">rotation_vector_0</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                  __pyx_t_12 = __pyx_v_j;
                                  __pyx_t_16 = 2;
                                  __pyx_t_15 = __pyx_v_tid;
                                  __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                  __pyx_t_18 = 0;
                                  __pyx_t_11 = __pyx_v_j;
                                  __pyx_t_14 = 1;
                                  __pyx_t_13 = __pyx_v_tid;
                                  __pyx_t_27 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_14 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                  __pyx_t_28 = 0;
                                  __pyx_v_rotation_vector_0 = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_15 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_17 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[2]) ))) - (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_13 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_27 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_28 * __pyx_v_xyz_tm.strides[2]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1853</span>:                 <span class="n">rotation_vector_1</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                  __pyx_t_14 = __pyx_v_j;
                                  __pyx_t_11 = 2;
                                  __pyx_t_28 = __pyx_v_tid;
                                  __pyx_t_27 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_14 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                  __pyx_t_13 = 1;
                                  __pyx_t_16 = __pyx_v_j;
                                  __pyx_t_12 = 1;
                                  __pyx_t_18 = __pyx_v_tid;
                                  __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                  __pyx_t_15 = 1;
                                  __pyx_v_rotation_vector_1 = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_28 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_27 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_13 * __pyx_v_xyz_tm.strides[2]) ))) - (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_18 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_17 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_15 * __pyx_v_xyz_tm.strides[2]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1854</span>:                 <span class="n">rotation_vector_2</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">2</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                  __pyx_t_12 = __pyx_v_j;
                                  __pyx_t_16 = 2;
                                  __pyx_t_15 = __pyx_v_tid;
                                  __pyx_t_17 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                  __pyx_t_18 = 2;
                                  __pyx_t_11 = __pyx_v_j;
                                  __pyx_t_14 = 1;
                                  __pyx_t_13 = __pyx_v_tid;
                                  __pyx_t_27 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_14 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                  __pyx_t_28 = 2;
                                  __pyx_v_rotation_vector_2 = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_15 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_17 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[2]) ))) - (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_13 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_27 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_28 * __pyx_v_xyz_tm.strides[2]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1855</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1856</span>:                 <span class="n">rotation_vector_norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">rotation_vector_0</span> <span class="o">*</span> <span class="n">rotation_vector_0</span> <span class="o">+</span> <span class="n">rotation_vector_1</span> <span class="o">*</span> <span class="n">rotation_vector_1</span> <span class="o">+</span> <span class="n">rotation_vector_2</span> <span class="o">*</span> <span class="n">rotation_vector_2</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>                                  __pyx_v_rotation_vector_norm = sqrt((((__pyx_v_rotation_vector_0 * __pyx_v_rotation_vector_0) + (__pyx_v_rotation_vector_1 * __pyx_v_rotation_vector_1)) + (__pyx_v_rotation_vector_2 * __pyx_v_rotation_vector_2)));
</pre><pre class="cython line score-0">&#xA0;<span class="">1857</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1858</span>:                 <span class="n">rotation_vector_0</span> <span class="o">=</span> <span class="n">rotation_vector_0</span> <span class="o">/</span> <span class="n">rotation_vector_norm</span></pre>
<pre class='cython code score-0 '>                                  __pyx_v_rotation_vector_0 = (__pyx_v_rotation_vector_0 / __pyx_v_rotation_vector_norm);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1859</span>:                 <span class="n">rotation_vector_1</span> <span class="o">=</span> <span class="n">rotation_vector_1</span> <span class="o">/</span> <span class="n">rotation_vector_norm</span></pre>
<pre class='cython code score-0 '>                                  __pyx_v_rotation_vector_1 = (__pyx_v_rotation_vector_1 / __pyx_v_rotation_vector_norm);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1860</span>:                 <span class="n">rotation_vector_2</span> <span class="o">=</span> <span class="n">rotation_vector_2</span> <span class="o">/</span> <span class="n">rotation_vector_norm</span></pre>
<pre class='cython code score-0 '>                                  __pyx_v_rotation_vector_2 = (__pyx_v_rotation_vector_2 / __pyx_v_rotation_vector_norm);
</pre><pre class="cython line score-0">&#xA0;<span class="">1861</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1862</span>:                 <span class="c"># compute the rotation quaternion</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1863</span>:                 <span class="n">rot_angle</span> <span class="o">=</span> <span class="n">rot_angle</span> <span class="o">*</span> <span class="mf">0.5</span></pre>
<pre class='cython code score-0 '>                                  __pyx_v_rot_angle = (__pyx_v_rot_angle * 0.5);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1864</span>:                 <span class="n">q0</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">rot_angle</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>                                  __pyx_v_q0 = cos(__pyx_v_rot_angle);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1865</span>:                 <span class="n">q1</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">rot_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">rotation_vector_0</span></pre>
<pre class='cython code score-0 '>                                  __pyx_v_q1 = (sin(__pyx_v_rot_angle) * __pyx_v_rotation_vector_0);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1866</span>:                 <span class="n">q2</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">rot_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">rotation_vector_1</span></pre>
<pre class='cython code score-0 '>                                  __pyx_v_q2 = (sin(__pyx_v_rot_angle) * __pyx_v_rotation_vector_1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1867</span>:                 <span class="n">q3</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">rot_angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">rotation_vector_2</span></pre>
<pre class='cython code score-0 '>                                  __pyx_v_q3 = (sin(__pyx_v_rot_angle) * __pyx_v_rotation_vector_2);
</pre><pre class="cython line score-0">&#xA0;<span class="">1868</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1869</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1870</span>:                 <span class="c"># Rotate the subtree</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1871</span>:                 <span class="c">#print(j, np.array(sideChainSubTreeMasks[j, :]))</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1872</span>:                 <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ligand_xyz_N</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>                                  __pyx_t_23 = __pyx_v_ligand_xyz_N;
                                  __pyx_t_24 = __pyx_t_23;
                                  for (__pyx_t_29 = 0; __pyx_t_29 &lt; __pyx_t_24; __pyx_t_29+=1) {
                                    __pyx_v_k = __pyx_t_29;
</pre><pre class="cython line score-0">&#xA0;<span class="">1873</span>:                     <span class="c"># Operate only on the subtree atoms for chi j</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1874</span>:                     <span class="k">if</span> <span class="n">sideChainSubTreeMasks</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>                                    __pyx_t_14 = __pyx_v_j;
                                    __pyx_t_11 = __pyx_v_k;
                                    __pyx_t_19 = (((*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainSubTreeMasks.data + __pyx_t_14 * __pyx_v_sideChainSubTreeMasks.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainSubTreeMasks.strides[1]) ))) == 0) != 0);
                                    if (__pyx_t_19) {
/* â€¦ */
                                    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1875</span>:                         <span class="k">continue</span></pre>
<pre class='cython code score-0 '>                                      goto __pyx_L24_continue;
</pre><pre class="cython line score-0">&#xA0;<span class="">1876</span>:                     <span class="k">else</span><span class="p">:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1877</span>:                         <span class="c">#Translate point to new coordinate system (rotation vector)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1878</span>:                         <span class="n">p0</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                    /*else*/ {
                                      __pyx_t_11 = __pyx_v_tid;
                                      __pyx_t_14 = __pyx_v_k;
                                      __pyx_t_28 = 0;
                                      __pyx_t_27 = __pyx_v_j;
                                      __pyx_t_13 = 1;
                                      __pyx_t_16 = __pyx_v_tid;
                                      __pyx_t_12 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_27 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_13 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                      __pyx_t_18 = 0;
                                      __pyx_v_p0 = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_11 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_14 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_28 * __pyx_v_xyz_tm.strides[2]) ))) - (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_16 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_12 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[2]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1879</span>:                         <span class="n">p1</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                      __pyx_t_13 = __pyx_v_tid;
                                      __pyx_t_27 = __pyx_v_k;
                                      __pyx_t_18 = 1;
                                      __pyx_t_12 = __pyx_v_j;
                                      __pyx_t_16 = 1;
                                      __pyx_t_28 = __pyx_v_tid;
                                      __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_16 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                      __pyx_t_11 = 1;
                                      __pyx_v_p1 = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_13 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_27 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[2]) ))) - (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_28 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_14 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_11 * __pyx_v_xyz_tm.strides[2]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1880</span>:                         <span class="n">p2</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                      __pyx_t_16 = __pyx_v_tid;
                                      __pyx_t_12 = __pyx_v_k;
                                      __pyx_t_11 = 2;
                                      __pyx_t_14 = __pyx_v_j;
                                      __pyx_t_28 = 1;
                                      __pyx_t_18 = __pyx_v_tid;
                                      __pyx_t_27 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_14 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_28 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                      __pyx_t_13 = 2;
                                      __pyx_v_p2 = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_16 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_12 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_11 * __pyx_v_xyz_tm.strides[2]) ))) - (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_18 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_27 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_13 * __pyx_v_xyz_tm.strides[2]) ))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1881</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1882</span>:                         <span class="c"># rotate</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1883</span>:                         <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">*</span> <span class="p">(</span><span class="n">q0</span> <span class="o">*</span> <span class="n">q0</span> <span class="o">+</span> <span class="n">q1</span> <span class="o">*</span> <span class="n">q1</span> <span class="o">-</span> <span class="n">q2</span> <span class="o">*</span> <span class="n">q2</span> <span class="o">-</span> <span class="n">q3</span> <span class="o">*</span> <span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">*</span> <span class="p">(</span><span class="n">q1</span> <span class="o">*</span> <span class="n">q2</span> <span class="o">-</span> <span class="n">q0</span> <span class="o">*</span> <span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p2</span> <span class="o">*</span> <span class="p">(</span><span class="n">q0</span> <span class="o">*</span> <span class="n">q2</span> <span class="o">+</span> <span class="n">q1</span> <span class="o">*</span> <span class="n">q3</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>                                      __pyx_t_28 = __pyx_v_tid;
                                      __pyx_t_14 = __pyx_v_k;
                                      __pyx_t_13 = 0;
                                      *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_28 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_14 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_13 * __pyx_v_xyz_tm.strides[2]) )) = (((__pyx_v_p0 * ((((__pyx_v_q0 * __pyx_v_q0) + (__pyx_v_q1 * __pyx_v_q1)) - (__pyx_v_q2 * __pyx_v_q2)) - (__pyx_v_q3 * __pyx_v_q3))) + ((2.0 * __pyx_v_p1) * ((__pyx_v_q1 * __pyx_v_q2) - (__pyx_v_q0 * __pyx_v_q3)))) + ((2.0 * __pyx_v_p2) * ((__pyx_v_q0 * __pyx_v_q2) + (__pyx_v_q1 * __pyx_v_q3))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1884</span>:                         <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p0</span> <span class="o">*</span> <span class="p">(</span><span class="n">q0</span> <span class="o">*</span> <span class="n">q3</span> <span class="o">+</span> <span class="n">q1</span> <span class="o">*</span> <span class="n">q2</span><span class="p">)</span> <span class="o">+</span>  <span class="n">p1</span> <span class="o">*</span> <span class="p">(</span><span class="n">q0</span> <span class="o">*</span> <span class="n">q0</span> <span class="o">-</span> <span class="n">q1</span> <span class="o">*</span> <span class="n">q1</span> <span class="o">+</span> <span class="n">q2</span> <span class="o">*</span> <span class="n">q2</span> <span class="o">-</span> <span class="n">q3</span> <span class="o">*</span> <span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p2</span> <span class="o">*</span> <span class="p">(</span><span class="n">q2</span> <span class="o">*</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q0</span> <span class="o">*</span> <span class="n">q1</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>                                      __pyx_t_13 = __pyx_v_tid;
                                      __pyx_t_14 = __pyx_v_k;
                                      __pyx_t_28 = 1;
                                      *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_13 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_14 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_28 * __pyx_v_xyz_tm.strides[2]) )) = ((((2.0 * __pyx_v_p0) * ((__pyx_v_q0 * __pyx_v_q3) + (__pyx_v_q1 * __pyx_v_q2))) + (__pyx_v_p1 * ((((__pyx_v_q0 * __pyx_v_q0) - (__pyx_v_q1 * __pyx_v_q1)) + (__pyx_v_q2 * __pyx_v_q2)) - (__pyx_v_q3 * __pyx_v_q3)))) + ((2.0 * __pyx_v_p2) * ((__pyx_v_q2 * __pyx_v_q3) - (__pyx_v_q0 * __pyx_v_q1))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1885</span>:                         <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p0</span> <span class="o">*</span> <span class="p">(</span><span class="n">q1</span> <span class="o">*</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q0</span> <span class="o">*</span> <span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">*</span> <span class="p">(</span><span class="n">q0</span> <span class="o">*</span> <span class="n">q1</span> <span class="o">+</span> <span class="n">q2</span> <span class="o">*</span> <span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">p2</span> <span class="o">*</span> <span class="p">(</span><span class="n">q0</span> <span class="o">*</span> <span class="n">q0</span> <span class="o">-</span> <span class="n">q1</span> <span class="o">*</span> <span class="n">q1</span> <span class="o">-</span> <span class="n">q2</span> <span class="o">*</span> <span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span> <span class="o">*</span> <span class="n">q3</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>                                      __pyx_t_28 = __pyx_v_tid;
                                      __pyx_t_14 = __pyx_v_k;
                                      __pyx_t_13 = 2;
                                      *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_28 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_14 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_13 * __pyx_v_xyz_tm.strides[2]) )) = ((((2.0 * __pyx_v_p0) * ((__pyx_v_q1 * __pyx_v_q3) - (__pyx_v_q0 * __pyx_v_q2))) + ((2.0 * __pyx_v_p1) * ((__pyx_v_q0 * __pyx_v_q1) + (__pyx_v_q2 * __pyx_v_q3)))) + (__pyx_v_p2 * ((((__pyx_v_q0 * __pyx_v_q0) - (__pyx_v_q1 * __pyx_v_q1)) - (__pyx_v_q2 * __pyx_v_q2)) + (__pyx_v_q3 * __pyx_v_q3))));
</pre><pre class="cython line score-0">&#xA0;<span class="">1886</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1887</span>:                         <span class="c"># translate back to the original coordinate system</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1888</span>:                         <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">0</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                      __pyx_t_13 = __pyx_v_tid;
                                      __pyx_t_14 = __pyx_v_k;
                                      __pyx_t_28 = 0;
                                      __pyx_t_27 = __pyx_v_j;
                                      __pyx_t_18 = 1;
                                      __pyx_t_11 = __pyx_v_tid;
                                      __pyx_t_12 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_27 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_18 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                      __pyx_t_16 = 0;
                                      __pyx_t_17 = __pyx_v_tid;
                                      __pyx_t_15 = __pyx_v_k;
                                      __pyx_t_30 = 0;
                                      *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_17 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_15 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_30 * __pyx_v_xyz_tm.strides[2]) )) = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_13 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_14 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_28 * __pyx_v_xyz_tm.strides[2]) ))) + (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_11 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_12 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_16 * __pyx_v_xyz_tm.strides[2]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1889</span>:                         <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                      __pyx_t_18 = __pyx_v_tid;
                                      __pyx_t_27 = __pyx_v_k;
                                      __pyx_t_16 = 1;
                                      __pyx_t_12 = __pyx_v_j;
                                      __pyx_t_11 = 1;
                                      __pyx_t_28 = __pyx_v_tid;
                                      __pyx_t_14 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_12 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_11 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                      __pyx_t_13 = 1;
                                      __pyx_t_30 = __pyx_v_tid;
                                      __pyx_t_15 = __pyx_v_k;
                                      __pyx_t_17 = 1;
                                      *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_30 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_15 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_17 * __pyx_v_xyz_tm.strides[2]) )) = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_18 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_27 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_16 * __pyx_v_xyz_tm.strides[2]) ))) + (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_28 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_14 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_13 * __pyx_v_xyz_tm.strides[2]) ))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1890</span>:                         <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="mf">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="n">sideChainsChiXYZIndices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mf">1</span><span class="p">],</span> <span class="mf">2</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                      __pyx_t_11 = __pyx_v_tid;
                                      __pyx_t_12 = __pyx_v_k;
                                      __pyx_t_13 = 2;
                                      __pyx_t_14 = __pyx_v_j;
                                      __pyx_t_28 = 1;
                                      __pyx_t_16 = __pyx_v_tid;
                                      __pyx_t_27 = (*((int *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_sideChainsChiXYZIndices.data + __pyx_t_14 * __pyx_v_sideChainsChiXYZIndices.strides[0]) ) + __pyx_t_28 * __pyx_v_sideChainsChiXYZIndices.strides[1]) )));
                                      __pyx_t_18 = 2;
                                      __pyx_t_17 = __pyx_v_tid;
                                      __pyx_t_15 = __pyx_v_k;
                                      __pyx_t_30 = 2;
                                      *((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_17 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_15 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_30 * __pyx_v_xyz_tm.strides[2]) )) = ((*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_11 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_12 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_13 * __pyx_v_xyz_tm.strides[2]) ))) + (*((double *) ( /* dim=2 */ (( /* dim=1 */ (( /* dim=0 */ (__pyx_v_xyz_tm.data + __pyx_t_16 * __pyx_v_xyz_tm.strides[0]) ) + __pyx_t_27 * __pyx_v_xyz_tm.strides[1]) ) + __pyx_t_18 * __pyx_v_xyz_tm.strides[2]) ))));
                                    }
                                    __pyx_L24_continue:;
                                  }
                                }
</pre><pre class="cython line score-0">&#xA0;<span class="">1891</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1892</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1893</span>:                 <span class="sd">&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1894</span>: <span class="sd">                #-----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1895</span>: <span class="sd">                #-----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1896</span>: <span class="sd">                #-----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1897</span>: <span class="sd">                </span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1898</span>: <span class="sd">                if i == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1899</span>: <span class="sd">                    printf(&quot;%i ABBB Cord i: %f %f %f \n&quot;, openmp.omp_get_thread_num(), xyz_tm[tid, sideChainsChiXYZIndices[j, 0], 0], xyz_tm[tid, sideChainsChiXYZIndices[j, 0], 1], xyz_tm[tid, sideChainsChiXYZIndices[j, 0], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1900</span>: <span class="sd">                    printf(&quot;%i ABBB Cord j: %f %f %f \n&quot;, openmp.omp_get_thread_num(), xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 0], xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 1], xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1901</span>: <span class="sd">                    printf(&quot;%i ABBB Cord k: %f %f %f \n&quot;, openmp.omp_get_thread_num(), xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 0], xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 1], xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1902</span>: <span class="sd">                    printf(&quot;%i ABBB Cord l: %f %f %f \n&quot;, openmp.omp_get_thread_num(), xyz_tm[tid, sideChainsChiXYZIndices[j, 3], 0], xyz_tm[tid, sideChainsChiXYZIndices[j, 3], 1], xyz_tm[tid, sideChainsChiXYZIndices[j, 3], 2])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1903</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1904</span>: <span class="sd">                u_ji_0 = xyz_tm[tid, sideChainsChiXYZIndices[j, 0], 0] - xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1905</span>: <span class="sd">                u_ji_1 = xyz_tm[tid, sideChainsChiXYZIndices[j, 0], 1] - xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1906</span>: <span class="sd">                u_ji_2 = xyz_tm[tid, sideChainsChiXYZIndices[j, 0], 2] - xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1907</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1908</span>: <span class="sd">                u_jk_0 = xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 0] - xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1909</span>: <span class="sd">                u_jk_1 = xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 1] - xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1910</span>: <span class="sd">                u_jk_2 = xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 2] - xyz_tm[tid, sideChainsChiXYZIndices[j, 1], 2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1911</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1912</span>: <span class="sd">                u_lk_0 = xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 0] - xyz_tm[tid, sideChainsChiXYZIndices[j, 3], 0]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1913</span>: <span class="sd">                u_lk_1 = xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 1] - xyz_tm[tid, sideChainsChiXYZIndices[j, 3], 1]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1914</span>: <span class="sd">                u_lk_2 = xyz_tm[tid, sideChainsChiXYZIndices[j, 2], 2] - xyz_tm[tid, sideChainsChiXYZIndices[j, 3], 2]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1915</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1916</span>: <span class="sd">                # print(&#39;BBB&#39;, u_ji)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1917</span>: <span class="sd">                # print(&#39;BBB&#39;, u_jk)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1918</span>: <span class="sd">                # print(&#39;BBB&#39;, u_lk)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1919</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1920</span>: <span class="sd">                n_ijk_0 = u_ji_1 * u_jk_2 - u_ji_2 * u_jk_1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1921</span>: <span class="sd">                n_ijk_1 = u_ji_2 * u_jk_0 - u_ji_0 * u_jk_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1922</span>: <span class="sd">                n_ijk_2 = u_ji_0 * u_jk_1 - u_ji_1 * u_jk_0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1923</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1924</span>: <span class="sd">                n_jkl_0 = u_jk_1 * u_lk_2 - u_jk_2 * u_lk_1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1925</span>: <span class="sd">                n_jkl_1 = u_jk_2 * u_lk_0 - u_jk_0 * u_lk_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1926</span>: <span class="sd">                n_jkl_2 = u_jk_0 * u_lk_1 - u_jk_1 * u_lk_0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1927</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1928</span>: <span class="sd">                n_ijk_nrom = sqrt(n_ijk_0 * n_ijk_0 + n_ijk_1 * n_ijk_1 + n_ijk_2 * n_ijk_2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1929</span>: <span class="sd">                n_jkl_norm = sqrt(n_jkl_0 * n_jkl_0 + n_jkl_1 * n_jkl_1 + n_jkl_2 * n_jkl_2)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1930</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1931</span>: <span class="sd">                n_ijk_0 = n_ijk_0 / n_ijk_nrom</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1932</span>: <span class="sd">                n_ijk_1 = n_ijk_1 / n_ijk_nrom</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1933</span>: <span class="sd">                n_ijk_2 = n_ijk_2 / n_ijk_nrom</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1934</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1935</span>: <span class="sd">                n_jkl_0 = n_jkl_0 / n_jkl_norm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1936</span>: <span class="sd">                n_jkl_1 = n_jkl_1 / n_jkl_norm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1937</span>: <span class="sd">                n_jkl_2 = n_jkl_2 / n_jkl_norm</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1938</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1939</span>: <span class="sd">                # print(&#39;BBB&#39;, n_ijk)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1940</span>: <span class="sd">                # print(&#39;BBB&#39;, n_jkl)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1941</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1942</span>: <span class="sd">                nn_dot = n_ijk_0 * n_jkl_0 + n_ijk_1 * n_jkl_1 + n_ijk_2 * n_jkl_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1943</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1944</span>: <span class="sd">                nn_cross_0 = n_ijk_1 * n_jkl_2 - n_ijk_2 * n_jkl_1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1945</span>: <span class="sd">                nn_cross_1 = n_ijk_2 * n_jkl_0 - n_ijk_0 * n_jkl_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1946</span>: <span class="sd">                nn_cross_2 = n_ijk_0 * n_jkl_1 - n_ijk_1 * n_jkl_0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1947</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1948</span>: <span class="sd">                # Correct for precision error</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1949</span>: <span class="sd">                if nn_dot &gt; 1: nn_dot = 1.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1950</span>: <span class="sd">                if nn_dot &lt; -1: nn_dot = -1.0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1951</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1952</span>: <span class="sd">                # get the angle sign</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1953</span>: <span class="sd">                sign = u_jk_0 * nn_cross_0 + u_jk_1 * nn_cross_1 + u_jk_2 * nn_cross_2</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1954</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1955</span>: <span class="sd">                # Save current torsion angles</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1956</span>: <span class="sd">                if i == 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1957</span>: <span class="sd">                    if sign &lt; 0:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1958</span>: <span class="sd">                        printf(&quot;%i %i %i current %f target %f \n&quot;, openmp.omp_get_thread_num(), i, j, acos(nn_dot) * (180.0 / M_PI) * -1, grid[i, j])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1959</span>: <span class="sd">                    else:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1960</span>: <span class="sd">                        printf(&quot;%i %i %i current %f target %f \n&quot;, openmp.omp_get_thread_num(), i, j, acos(nn_dot) * (180.0 / M_PI), grid[i, j])</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1961</span>: <span class="sd">                # -----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1962</span>: <span class="sd">                # -----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1963</span>: <span class="sd">                # -----------------------------------------------------------------------------------------------------------</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1964</span>: <span class="sd">                &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1965</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">1966</span>:             <span class="c">#print(np.array(xyz_tm))</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1967</span>:             <span class="c">#exit()</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1968</span>:             <span class="c"># Compute energy</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1969</span>:             <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span></pre>
<pre class='cython code score-0 '>                                __pyx_t_28 = __pyx_v_i;
                                __pyx_t_14 = (__pyx_v_grid_M - 1);
                                *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_28 * __pyx_v_grid.strides[0]) ) + __pyx_t_14 * __pyx_v_grid.strides[1]) )) = 0.0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1970</span>:             <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ligand_ligand_reduced</span><span class="p">(</span><span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span></pre>
<pre class='cython code score-0 '>                                __pyx_t_14 = __pyx_v_i;
                                __pyx_t_28 = (__pyx_v_grid_M - 1);
                                __pyx_t_31.data = __pyx_v_xyz_tm.data;
                                __pyx_t_31.memview = __pyx_v_xyz_tm.memview;
                                __PYX_INC_MEMVIEW(&amp;__pyx_t_31, 0);
                                {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_tid;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_xyz_tm.strides[0];
        __pyx_t_31.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_31.shape[0] = __pyx_v_xyz_tm.shape[1];
__pyx_t_31.strides[0] = __pyx_v_xyz_tm.strides[1];
    __pyx_t_31.suboffsets[0] = -1;

__pyx_t_31.shape[1] = __pyx_v_xyz_tm.shape[2];
__pyx_t_31.strides[1] = __pyx_v_xyz_tm.strides[2];
    __pyx_t_31.suboffsets[1] = -1;

__pyx_t_18 = __pyx_v_i;
/* â€¦ */
                                __pyx_t_27 = (__pyx_v_grid_M - 1);
                                *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_18 * __pyx_v_grid.strides[0]) ) + __pyx_t_27 * __pyx_v_grid.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_14 * __pyx_v_grid.strides[0]) ) + __pyx_t_28 * __pyx_v_grid.strides[1]) ))) + __pyx_f_6Energy_ligand_ligand_reduced(__pyx_t_31, __pyx_v_ligand_qij, __pyx_v_ligand_dljr, __pyx_v_ligand_dljep, __pyx_v_ligand_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_ligand_nonbonded, __pyx_v_ligand_nonbondedWeights, __pyx_v_ligand_coupling, __pyx_v_ligand_weights));
                                __PYX_XDEC_MEMVIEW(&amp;__pyx_t_31, 0);
                                __pyx_t_31.memview = NULL;
                                __pyx_t_31.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">1971</span>:                                           <span class="n">ligand_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1972</span>:                                           <span class="n">ligand_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1973</span>:                                           <span class="n">ligand_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1974</span>:                                           <span class="n">ligand_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1975</span>:                                           <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1976</span>:                                           <span class="n">ligand_nonbonded</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1977</span>:                                           <span class="n">ligand_nonbondedWeights</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1978</span>:                                           <span class="n">ligand_coupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1979</span>:                                           <span class="n">ligand_weights</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1980</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1981</span>:             <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>                                __pyx_t_28 = __pyx_v_i;
                                __pyx_t_14 = (__pyx_v_grid_M - 1);
                                __pyx_t_27 = __pyx_v_i;
                                __pyx_t_18 = (__pyx_v_grid_M - 1);
                                *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_27 * __pyx_v_grid.strides[0]) ) + __pyx_t_18 * __pyx_v_grid.strides[1]) )) = (*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_28 * __pyx_v_grid.strides[0]) ) + __pyx_t_14 * __pyx_v_grid.strides[1]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">1982</span>:             <span class="c"># Compute ligand_environment Energy</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">1983</span>:             <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">grid_M</span> <span class="o">-</span> <span class="mf">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">ligand_environment_reduced</span><span class="p">(</span><span class="n">xyz_tm</span><span class="p">[</span><span class="n">tid</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span></pre>
<pre class='cython code score-0 '>                                __pyx_t_14 = __pyx_v_i;
                                __pyx_t_28 = (__pyx_v_grid_M - 1);
                                __pyx_t_31.data = __pyx_v_xyz_tm.data;
                                __pyx_t_31.memview = __pyx_v_xyz_tm.memview;
                                __PYX_INC_MEMVIEW(&amp;__pyx_t_31, 0);
                                {
    Py_ssize_t __pyx_tmp_idx = __pyx_v_tid;
    Py_ssize_t __pyx_tmp_stride = __pyx_v_xyz_tm.strides[0];
        __pyx_t_31.data += __pyx_tmp_idx * __pyx_tmp_stride;
}

__pyx_t_31.shape[0] = __pyx_v_xyz_tm.shape[1];
__pyx_t_31.strides[0] = __pyx_v_xyz_tm.strides[1];
    __pyx_t_31.suboffsets[0] = -1;

__pyx_t_31.shape[1] = __pyx_v_xyz_tm.shape[2];
__pyx_t_31.strides[1] = __pyx_v_xyz_tm.strides[2];
    __pyx_t_31.suboffsets[1] = -1;

__pyx_t_18 = __pyx_v_i;
/* â€¦ */
                                __pyx_t_27 = (__pyx_v_grid_M - 1);
                                *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_18 * __pyx_v_grid.strides[0]) ) + __pyx_t_27 * __pyx_v_grid.strides[1]) )) = ((*((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_grid.data + __pyx_t_14 * __pyx_v_grid.strides[0]) ) + __pyx_t_28 * __pyx_v_grid.strides[1]) ))) + __pyx_f_6Energy_ligand_environment_reduced(__pyx_t_31, __pyx_v_environment_xyz, __pyx_v_ligand_mask, __pyx_v_ligand_environment_qij, __pyx_v_ligand_environment_dljr, __pyx_v_ligand_environment_dljep, __pyx_v_ligand_environment_sol_prefactor, __pyx_v_ligand_lklam, __pyx_v_environmen_lklam, __pyx_v_environment_sideChainFalgs, __pyx_v_environment_mainChainFalgs, __pyx_v_sideChainCoupling, __pyx_v_mainChainCoupling, __pyx_v_ligand_environment_weights));
                                __PYX_XDEC_MEMVIEW(&amp;__pyx_t_31, 0);
                                __pyx_t_31.memview = NULL;
                                __pyx_t_31.data = NULL;
                            }
                        }
                    }
                }
            }
        }
        #if ((defined(__APPLE__) || defined(__OSX__)) &amp;&amp; (defined(__GNUC__) &amp;&amp; (__GNUC__ &gt; 2 || (__GNUC__ == 2 &amp;&amp; (__GNUC_MINOR__ &gt; 95)))))
            #undef likely
            #undef unlikely
            #define likely(x)   __builtin_expect(!!(x), 1)
            #define unlikely(x) __builtin_expect(!!(x), 0)
        #endif
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">1984</span>:                                                                        <span class="n">environment_xyz</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1985</span>:                                                                        <span class="n">ligand_mask</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1986</span>:                                                                        <span class="n">ligand_environment_qij</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1987</span>:                                                                        <span class="n">ligand_environment_dljr</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1988</span>:                                                                        <span class="n">ligand_environment_dljep</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1989</span>:                                                                        <span class="n">ligand_environment_sol_prefactor</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1990</span>:                                                                        <span class="n">ligand_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1991</span>:                                                                        <span class="n">environmen_lklam</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1992</span>:                                                                        <span class="n">environment_sideChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1993</span>:                                                                        <span class="n">environment_mainChainFalgs</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1994</span>:                                                                        <span class="n">sideChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1995</span>:                                                                        <span class="n">mainChainCoupling</span><span class="p">,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">1996</span>:                                                                        <span class="n">ligand_environment_weights</span><span class="p">)</span></pre>
</div></body></html>
